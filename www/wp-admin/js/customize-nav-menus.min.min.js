(function(l,g,k){wpNavMenu.originalInit=wpNavMenu.init;wpNavMenu.options.menuItemDepthPerLevel=20;wpNavMenu.options.sortableItems="> .customize-control-nav_menu_item";wpNavMenu.options.targetTolerance=10;wpNavMenu.init=function(){this.jQueryExtensions()};l.Menus=l.Menus||{};l.Menus.data={itemTypes:[],l10n:{},settingTransport:"refresh",phpIntMax:0,defaultSettingValues:{nav_menu:{},nav_menu_item:{}},locationSlugMappedToName:{}};if("undefined"!==typeof _wpCustomizeNavMenusSettings){k.extend(l.Menus.data,_wpCustomizeNavMenusSettings)}l.Menus.generatePlaceholderAutoIncrementId=function(){return -Math.ceil(l.Menus.data.phpIntMax*Math.random())};l.Menus.AvailableItemModel=Backbone.Model.extend(k.extend({id:null},l.Menus.data.defaultSettingValues.nav_menu_item));l.Menus.AvailableItemCollection=Backbone.Collection.extend({model:l.Menus.AvailableItemModel,sort_key:"order",comparator:function(a){return -a.get(this.sort_key)},sortByField:function(a){this.sort_key=a;this.sort()}});l.Menus.availableMenuItems=new l.Menus.AvailableItemCollection(l.Menus.data.availableMenuItems);l.Menus.insertAutoDraftPost=function j(a){var b,c=k.Deferred();b=g.ajax.post("customize-nav-menus-insert-auto-draft",{"customize-menus-nonce":l.settings.nonce["customize-menus"],wp_customize:"on",params:a});b.done(function(d){if(d.post_id){l("nav_menus_created_posts").set(l("nav_menus_created_posts").get().concat([d.post_id]));if("page"===a.post_type){if(l.section.has("static_front_page")){l.section("static_front_page").activate()}l.control.each(function(e){var f;if("dropdown-pages"===e.params.type){f=e.container.find('select[name^="_customize-dropdown-pages-"]');f.append(new Option(a.post_title,d.post_id))}})}c.resolve(d)}});b.fail(function(e){var d=e||"";if("undefined"!==typeof e.message){d=e.message}console.error(d);c.rejectWith(d)});return c.promise()};l.Menus.AvailableMenuItemsPanelView=g.Backbone.View.extend({el:"#available-menu-items",events:{"input #menu-items-search":"debounceSearch","keyup #menu-items-search":"debounceSearch","focus .menu-item-tpl":"focus","click .menu-item-tpl":"_submit","click #custom-menu-item-submit":"_submitLink","keypress #custom-menu-item-name":"_submitLink","click .new-content-item .add-content":"_submitNew","keypress .create-item-input":"_submitNew",keydown:"keyboardAccessible"},selected:null,currentMenuControl:null,debounceSearch:null,$search:null,$clearResults:null,searchTerm:"",rendered:false,pages:{},sectionContent:"",loading:false,addingNew:false,initialize:function(){var a=this;if(!l.panel.has("nav_menus")){return}this.$search=k("#menu-items-search");this.$clearResults=this.$el.find(".clear-results");this.sectionContent=this.$el.find(".available-menu-items-list");this.debounceSearch=_.debounce(a.search,500);_.bindAll(this,"close");k("#customize-controls, .customize-section-back").on("click keydown",function(b){var d=k(b.target).is(".item-delete, .item-delete *"),c=k(b.target).is(".add-new-menu-item, .add-new-menu-item *");if(k("body").hasClass("adding-menu-items")&&!d&&!c){a.close()}});this.$clearResults.on("click",function(){a.$search.val("").focus().trigger("keyup")});this.$el.on("input","#custom-menu-item-name.invalid, #custom-menu-item-url.invalid",function(){k(this).removeClass("invalid")});l.panel("nav_menus").container.bind("expanded",function(){if(!a.rendered){a.initList();a.rendered=true}});this.sectionContent.scroll(function(){var c=a.$el.find(".accordion-section.open .available-menu-items-list").prop("scrollHeight"),e=a.$el.find(".accordion-section.open").height();if(!a.loading&&k(this).scrollTop()>3/4*c-e){var b=k(this).data("type"),d=k(this).data("object");if("search"===b){if(a.searchTerm){a.doSearch(a.pages.search)}}else{a.loadItems([{type:b,object:d}])}}});l.previewer.bind("url",this.close);a.delegateEvents()},search:function(b){var c=k("#available-menu-items-search"),a=k("#available-menu-items .accordion-section").not(c);if(!b){return}if(this.searchTerm===b.target.value){return}if(""!==b.target.value&&!c.hasClass("open")){a.fadeOut(100);c.find(".accordion-section-content").slideDown("fast");c.addClass("open");this.$clearResults.addClass("is-visible")}else{if(""===b.target.value){c.removeClass("open");a.show();this.$clearResults.removeClass("is-visible")}}this.searchTerm=b.target.value;this.pages.search=1;this.doSearch(1)},doSearch:function(b){var f=this,a,c=k("#available-menu-items-search"),e=c.find(".accordion-section-content"),d=g.template("available-menu-item");if(f.currentRequest){f.currentRequest.abort()}if(b<0){return}else{if(b>1){c.addClass("loading-more");e.attr("aria-busy","true");g.a11y.speak(l.Menus.data.l10n.itemsLoadingMore)}else{if(""===f.searchTerm){e.html("");g.a11y.speak("");return}}}c.addClass("loading");f.loading=true;a=l.previewer.query({excludeCustomizedSaved:true});_.extend(a,{"customize-menus-nonce":l.settings.nonce["customize-menus"],wp_customize:"on",search:f.searchTerm,page:b});f.currentRequest=g.ajax.post("search-available-menu-items-customizer",a);f.currentRequest.done(function(p){var o;if(1===b){e.empty()}c.removeClass("loading loading-more");e.attr("aria-busy","false");c.addClass("open");f.loading=false;o=new l.Menus.AvailableItemCollection(p.items);f.collection.add(o.models);o.each(function(m){e.append(d(m.attributes))});if(20>o.length){f.pages.search=-1}else{f.pages.search=f.pages.search+1}if(o&&b>1){g.a11y.speak(l.Menus.data.l10n.itemsFoundMore.replace("%d",o.length))}else{if(o&&b===1){g.a11y.speak(l.Menus.data.l10n.itemsFound.replace("%d",o.length))}}});f.currentRequest.fail(function(n){if(n.message){e.empty().append(k('<li class="nothing-found"></li>').text(n.message));g.a11y.speak(n.message)}f.pages.search=-1});f.currentRequest.always(function(){c.removeClass("loading loading-more");e.attr("aria-busy","false");f.loading=false;f.currentRequest=null})},initList:function(){var a=this;_.each(l.Menus.data.itemTypes,function(b){a.pages[b.type+":"+b.object]=0});a.loadItems(l.Menus.data.itemTypes)},loadItems:function(r,e){var a=this,q,c=[],p,f,b,d={};b=g.template("available-menu-item");if(_.isString(r)&&_.isString(e)){q=[{type:r,object:e}]}else{q=r}_.each(q,function(m){var o,n=m.type+":"+m.object;if(-1===a.pages[n]){return}o=k("#available-menu-items-"+m.type+"-"+m.object);o.find(".accordion-section-title").addClass("loading");d[n]=o;c.push({object:m.object,type:m.type,page:a.pages[n]})});if(0===c.length){return}a.loading=true;p=l.previewer.query({excludeCustomizedSaved:true});_.extend(p,{"customize-menus-nonce":l.settings.nonce["customize-menus"],wp_customize:"on",item_types:c});f=g.ajax.post("load-available-menu-items-customizer",p);f.done(function(m){var n;_.each(m.items,function(t,o){if(0===t.length){if(0===a.pages[o]){d[o].find(".accordion-section-title").addClass("cannot-expand").removeClass("loading").find(".accordion-section-title > button").prop("tabIndex",-1)}a.pages[o]=-1;return}else{if(("post_type:page"===o)&&(!d[o].hasClass("open"))){d[o].find(".accordion-section-title > button").click()}}t=new l.Menus.AvailableItemCollection(t);a.collection.add(t.models);n=d[o].find(".available-menu-items-list");t.each(function(s){n.append(b(s.attributes))});a.pages[o]+=1})});f.fail(function(m){if(typeof console!=="undefined"&&console.error){console.error(m)}});f.always(function(){_.each(d,function(m){m.find(".accordion-section-title").removeClass("loading")});a.loading=false})},itemSectionHeight:function(){var a,e,d,b,c;d=window.innerHeight;a=this.$el.find(".accordion-section:not( #available-menu-items-search ) .accordion-section-content");e=this.$el.find('.accordion-section:not( #available-menu-items-search ) .available-menu-items-list:not(":only-child")');b=46*(1+a.length)+14;c=d-b;if(120<c&&290>c){a.css("max-height",c);e.css("max-height",(c-60))}},select:function(a){this.selected=k(a);this.selected.siblings(".menu-item-tpl").removeClass("selected");this.selected.addClass("selected")},focus:function(a){this.select(k(a.currentTarget))},_submit:function(a){if("keypress"===a.type&&(13!==a.which&&32!==a.which)){return}this.submit(k(a.currentTarget))},submit:function(a){var b,c;if(!a){a=this.selected}if(!a||!this.currentMenuControl){return}this.select(a);b=k(this.selected).data("menu-item-id");c=this.collection.findWhere({id:b});if(!c){return}this.currentMenuControl.addItemToMenu(c.attributes);k(a).find(".menu-item-handle").addClass("item-added")},_submitLink:function(a){if("keypress"===a.type&&13!==a.which){return}this.submitLink()},submitLink:function(){var c,b=k("#custom-menu-item-name"),a=k("#custom-menu-item-url");if(!this.currentMenuControl){return}if(""===b.val()){b.addClass("invalid");return}else{if(""===a.val()||"http://"===a.val()){a.addClass("invalid");return}}c={title:b.val(),url:a.val(),type:"custom",type_label:l.Menus.data.l10n.custom_label,object:"custom"};this.currentMenuControl.addItemToMenu(c);a.val("http://");b.val("")},_submitNew:function(a){var b;if("keypress"===a.type&&13!==a.which){return}if(this.addingNew){return}b=k(a.target).closest(".accordion-section");this.submitNew(b)},submitNew:function(q){var r=this,a=q.find(".create-item-input"),d=a.val(),c=q.find(".available-menu-items-list"),f=c.data("type"),e=c.data("object"),p=c.data("type_label"),b;if(!this.currentMenuControl){return}if("post_type"!==f){return}if(""===k.trim(a.val())){a.addClass("invalid");a.focus();return}else{a.removeClass("invalid");q.find(".accordion-section-title").addClass("loading")}r.addingNew=true;a.attr("disabled","disabled");b=l.Menus.insertAutoDraftPost({post_title:d,post_type:e});b.done(function(m){var n,t,o;n=new l.Menus.AvailableItemModel({id:"post-"+m.post_id,title:a.val(),type:f,type_label:p,object:e,object_id:m.post_id,url:m.url});r.currentMenuControl.addItemToMenu(n.attributes);l.Menus.availableMenuItemsPanel.collection.add(n);t=q.find(".available-menu-items-list");o=k(g.template("available-menu-item")(n.attributes));o.find(".menu-item-handle:first").addClass("item-added");t.prepend(o);t.scrollTop();a.val("").removeAttr("disabled");r.addingNew=false;q.find(".accordion-section-title").removeClass("loading")})},open:function(a){this.currentMenuControl=a;this.itemSectionHeight();k("body").addClass("adding-menu-items");_(this.currentMenuControl.getMenuItemControls()).each(function(b){b.collapseForm()});this.$el.find(".selected").removeClass("selected");this.$search.focus()},close:function(a){a=a||{};if(a.returnFocus&&this.currentMenuControl){this.currentMenuControl.container.find(".add-new-menu-item").focus()}this.currentMenuControl=null;this.selected=null;k("body").removeClass("adding-menu-items");k("#available-menu-items .menu-item-handle.item-added").removeClass("item-added");this.$search.val("")},keyboardAccessible:function(c){var d=(13===c.which),b=(27===c.which),a=(9===c.which&&c.shiftKey),e=k(c.target).is(this.$search);if(d&&!this.$search.val()){return}if(e&&a){this.currentMenuControl.container.find(".add-new-menu-item").focus();c.preventDefault()}else{if(b){this.close({returnFocus:true})}}}});l.Menus.MenusPanel=l.Panel.extend({attachEvents:function(){l.Panel.prototype.attachEvents.call(this);var f=this,b=f.container.find(".panel-meta"),d=b.find(".customize-help-toggle"),a=b.find(".customize-panel-description"),e=k("#screen-options-wrap"),c=b.find(".customize-screen-options-toggle");c.on("click keydown",function(n){if(l.utils.isKeydownButNotEnterEvent(n)){return}n.preventDefault();if(a.not(":hidden")){a.slideUp("fast");d.attr("aria-expanded","false")}if("true"===c.attr("aria-expanded")){c.attr("aria-expanded","false");b.removeClass("open");b.removeClass("active-menu-screen-options");e.slideUp("fast")}else{c.attr("aria-expanded","true");b.addClass("open");b.addClass("active-menu-screen-options");e.slideDown("fast")}return false});d.on("click keydown",function(n){if(l.utils.isKeydownButNotEnterEvent(n)){return}n.preventDefault();if("true"===c.attr("aria-expanded")){c.attr("aria-expanded","false");d.attr("aria-expanded","true");b.addClass("open");b.removeClass("active-menu-screen-options");e.slideUp("fast");a.slideDown("fast")}})},ready:function(){var a=this;a.container.find(".hide-column-tog").click(function(){a.saveManageColumnsState()})},saveManageColumnsState:_.debounce(function(){var a=this;if(a._updateHiddenColumnsRequest){a._updateHiddenColumnsRequest.abort()}a._updateHiddenColumnsRequest=g.ajax.post("hidden-columns",{hidden:a.hidden(),screenoptionnonce:k("#screenoptionnonce").val(),page:"nav-menus"});a._updateHiddenColumnsRequest.always(function(){a._updateHiddenColumnsRequest=null})},2000),checked:function(){},unchecked:function(){},hidden:function(){return k(".hide-column-tog").not(":checked").map(function(){var a=this.id;return a.substring(0,a.length-5)}).get().join(",")}});l.Menus.MenuSection=l.Section.extend({initialize:function(a,c){var b=this;l.Section.prototype.initialize.call(b,a,c);b.deferred.initSortables=k.Deferred()},ready:function(){var a=this,b,c;if("undefined"===typeof a.params.menu_id){throw new Error("params.menu_id was not defined")}a.active.validate=function(){if(!l.has(a.id)){return false}return !!l(a.id).get()};a.populateControls();a.navMenuLocationSettings={};a.assignedLocations=new l.Value([]);l.each(function(f,d){var e=d.match(/^nav_menu_locations\[(.+?)]/);if(e){a.navMenuLocationSettings[e[1]]=f;f.bind(function(){a.refreshAssignedLocations()})}});a.assignedLocations.bind(function(d){a.updateAssignedLocationsInSectionTitle(d)});a.refreshAssignedLocations();l.bind("pane-contents-reflowed",function(){if(!a.contentContainer.parent().length){return}a.container.find(".menu-item .menu-item-reorder-nav button").attr({tabindex:"0","aria-hidden":"false"});a.container.find(".menu-item.move-up-disabled .menus-move-up").attr({tabindex:"-1","aria-hidden":"true"});a.container.find(".menu-item.move-down-disabled .menus-move-down").attr({tabindex:"-1","aria-hidden":"true"});a.container.find(".menu-item.move-left-disabled .menus-move-left").attr({tabindex:"-1","aria-hidden":"true"});a.container.find(".menu-item.move-right-disabled .menus-move-right").attr({tabindex:"-1","aria-hidden":"true"})});c=function(){var d="field-"+k(this).val()+"-active";a.contentContainer.toggleClass(d,k(this).prop("checked"))};b=l.panel("nav_menus").contentContainer.find(".metabox-prefs:first").find(".hide-column-tog");b.each(c);b.on("click",c)},populateControls:function(){var a=this,c,b,e,d,f;c=a.id+"[name]";d=l.control(c);if(!d){d=new l.controlConstructor.nav_menu_name(c,{params:{type:"nav_menu_name",content:'<li id="customize-control-'+a.id.replace("[","-").replace("]","")+'-name" class="customize-control customize-control-nav_menu_name"></li>',label:l.Menus.data.l10n.menuNameLabel,active:true,section:a.id,priority:0,settings:{"default":a.id}}});l.control.add(d.id,d);d.active.set(true)}e=l.control(a.id);if(!e){e=new l.controlConstructor.nav_menu(a.id,{params:{type:"nav_menu",content:'<li id="customize-control-'+a.id.replace("[","-").replace("]","")+'" class="customize-control customize-control-nav_menu"></li>',section:a.id,priority:998,active:true,settings:{"default":a.id},menu_id:a.params.menu_id}});l.control.add(e.id,e);e.active.set(true)}b=a.id+"[auto_add]";f=l.control(b);if(!f){f=new l.controlConstructor.nav_menu_auto_add(b,{params:{type:"nav_menu_auto_add",content:'<li id="customize-control-'+a.id.replace("[","-").replace("]","")+'-auto-add" class="customize-control customize-control-nav_menu_auto_add"></li>',label:"",active:true,section:a.id,priority:999,settings:{"default":a.id}}});l.control.add(f.id,f);f.active.set(true)}},refreshAssignedLocations:function(){var a=this,c=a.params.menu_id,b=[];_.each(a.navMenuLocationSettings,function(d,e){if(d()===c){b.push(e)}});a.assignedLocations.set(b)},updateAssignedLocationsInSectionTitle:function(a){var b=this,c;c=b.container.find(".accordion-section-title:first");c.find(".menu-in-location").remove();_.each(a,function(e){var f,d;f=k('<span class="menu-in-location"></span>');d=l.Menus.data.locationSlugMappedToName[e];f.text(l.Menus.data.l10n.menuLocation.replace("%s",d));c.append(f)});b.container.toggleClass("assigned-to-menu-location",0!==a.length)},onChangeExpanded:function(d,c){var a=this,b;if(d){wpNavMenu.menuList=a.contentContainer;wpNavMenu.targetList=wpNavMenu.menuList;k("#menu-to-edit").removeAttr("id");wpNavMenu.menuList.attr("id","menu-to-edit").addClass("menu");_.each(l.section(a.id).controls(),function(e){if("nav_menu_item"===e.params.type){e.actuallyEmbed()}});if(c.completeCallback){b=c.completeCallback}c.completeCallback=function(){if("resolved"!==a.deferred.initSortables.state()){wpNavMenu.initSortables();a.deferred.initSortables.resolve(wpNavMenu.menuList);l.control("nav_menu["+String(a.params.menu_id)+"]").reflowMenuItems()}if(_.isFunction(b)){b()}}}l.Section.prototype.onChangeExpanded.call(a,d,c)}});l.Menus.NewMenuSection=l.Section.extend({attachEvents:function(){var a=this;this.container.on("click",".add-menu-toggle",function(){if(a.expanded()){a.collapse()}else{a.expand()}})},onChangeExpanded:function(e){var a=this,d=a.container.find(".add-menu-toggle"),b=a.contentContainer,c=a.headContainer.closest(".wp-full-overlay-sidebar-content");if(e){d.addClass("open");d.attr("aria-expanded","true");b.slideDown("fast",function(){c.scrollTop(c.height())})}else{d.removeClass("open");d.attr("aria-expanded","false");b.slideUp("fast");b.find(".menu-name-field").removeClass("invalid")}},getContent:function(){return this.container.find("ul:first")}});l.Menus.MenuLocationControl=l.Control.extend({initialize:function(a,d){var b=this,c=a.match(/^nav_menu_locations\[(.+?)]/);b.themeLocation=c[1];l.Control.prototype.initialize.call(b,a,d)},ready:function(){var a=this,b=/^nav_menu\[(-?\d+)]/;a.setting.validate=function(c){if(""===c){return 0}else{return parseInt(c,10)}};a.container.find(".edit-menu").on("click",function(){var c=a.setting();l.section("nav_menu["+c+"]").focus()});a.setting.bind("change",function(){if(0===a.setting()){a.container.find(".edit-menu").addClass("hidden")}else{a.container.find(".edit-menu").removeClass("hidden")}});l.bind("add",function(e){var f,c,d=e.id.match(b);if(!d||false===e()){return}c=d[1];f=new Option(i(e().name),c);a.container.find("select").append(f)});l.bind("remove",function(e){var c,d=e.id.match(b);if(!d){return}c=parseInt(d[1],10);if(a.setting()===c){a.setting.set("")}a.container.find("option[value="+c+"]").remove()});l.bind("change",function(e){var c,d=e.id.match(b);if(!d){return}c=parseInt(d[1],10);if(false===e()){if(a.setting()===c){a.setting.set("")}a.container.find("option[value="+c+"]").remove()}else{a.container.find("option[value="+c+"]").text(i(e().name))}})}});l.Menus.MenuItemControl=l.Control.extend({initialize:function(a,c){var b=this;b.expanded=new l.Value(false);b.expandedArgumentsQueue=[];b.expanded.bind(function(e){var d=b.expandedArgumentsQueue.shift();d=k.extend({},b.defaultExpandedArguments,d);b.onChangeExpanded(e,d)});l.Control.prototype.initialize.call(b,a,c);b.active.validate=function(){var e,d=l.section(b.section());if(d){e=d.active()}else{e=false}return e}},embed:function(){var a=this,c=a.section(),b;if(!c){return}b=l.section(c);if((b&&b.expanded())||l.settings.autofocus.control===a.id){a.actuallyEmbed()}},actuallyEmbed:function(){var a=this;if("resolved"===a.deferred.embedded.state()){return}a.renderContent();a.deferred.embedded.resolve()},ready:function(){if("undefined"===typeof this.params.menu_item_id){throw new Error("params.menu_item_id was not defined")}this._setupControlToggle();this._setupReorderUI();this._setupUpdateUI();this._setupRemoveUI();this._setupLinksUI();this._setupTitleUI()},_setupControlToggle:function(){var a=this;this.container.find(".menu-item-handle").on("click",function(b){b.preventDefault();b.stopPropagation();var c=a.getMenuControl(),e=k(b.target).is(".item-delete, .item-delete *"),d=k(b.target).is(".add-new-menu-item, .add-new-menu-item *");if(k("body").hasClass("adding-menu-items")&&!e&&!d){l.Menus.availableMenuItemsPanel.close()}if(c.isReordering||c.isSorting){return}a.toggleForm()})},_setupReorderUI:function(){var a=this,b,c;b=g.template("menu-item-reorder-nav");a.container.find(".item-controls").after(b);c=a.container.find(".menu-item-reorder-nav");c.find(".menus-move-up, .menus-move-down, .menus-move-left, .menus-move-right").on("click",function(){var p=k(this);p.focus();var d=p.is(".menus-move-up"),e=p.is(".menus-move-down"),f=p.is(".menus-move-left"),o=p.is(".menus-move-right");if(d){a.moveUp()}else{if(e){a.moveDown()}else{if(f){a.moveLeft()}else{if(o){a.moveRight()}}}}p.focus()})},_setupUpdateUI:function(){var a=this,b=a.setting();a.elements={};a.elements.url=new l.Element(a.container.find(".edit-menu-item-url"));a.elements.title=new l.Element(a.container.find(".edit-menu-item-title"));a.elements.attr_title=new l.Element(a.container.find(".edit-menu-item-attr-title"));a.elements.target=new l.Element(a.container.find(".edit-menu-item-target"));a.elements.classes=new l.Element(a.container.find(".edit-menu-item-classes"));a.elements.xfn=new l.Element(a.container.find(".edit-menu-item-xfn"));a.elements.description=new l.Element(a.container.find(".edit-menu-item-description"));_.each(a.elements,function(d,c){d.bind(function(f){if(d.element.is("input[type=checkbox]")){f=(f)?d.element.val():""}var e=a.setting();if(e&&e[c]!==f){e=_.clone(e);e[c]=f;a.setting.set(e)}});if(b){if((c==="classes"||c==="xfn")&&_.isArray(b[c])){d.set(b[c].join(" "))}else{d.set(b[c])}}});a.setting.bind(function(p,c){var d=a.params.menu_item_id,e=[],f=[],o;if(false===p){o=l.control("nav_menu["+String(c.nav_menu_term_id)+"]");a.container.remove();_.each(o.getMenuItemControls(),function(m){if(c.menu_item_parent===m.setting().menu_item_parent&&m.setting().position>c.position){e.push(m)}else{if(m.setting().menu_item_parent===d){f.push(m)}}});_.each(e,function(m){var n=_.clone(m.setting());n.position+=f.length;m.setting.set(n)});_.each(f,function(n,r){var m=_.clone(n.setting());m.position=c.position+r;m.menu_item_parent=c.menu_item_parent;n.setting.set(m)});o.debouncedReflowMenuItems()}else{_.each(p,function(m,n){if(a.elements[n]){a.elements[n].set(p[n])}});a.container.find(".menu-item-data-parent-id").val(p.menu_item_parent);if(p.position!==c.position||p.menu_item_parent!==c.menu_item_parent){a.getMenuControl().debouncedReflowMenuItems()}}})},_setupRemoveUI:function(){var a=this,b;b=a.container.find(".item-delete");b.on("click",function(){var d=true,c,f,e;if(!k("body").hasClass("adding-menu-items")){d=false}f=a.container.nextAll(".customize-control-nav_menu_item:visible").first();e=a.container.prevAll(".customize-control-nav_menu_item:visible").first();if(f.length){c=f.find(false===d?".item-edit":".item-delete").first()}else{if(e.length){c=e.find(false===d?".item-edit":".item-delete").first()}else{c=a.container.nextAll(".customize-control-nav_menu").find(".add-new-menu-item").first()}}a.container.slideUp(function(){a.setting.set(false);g.a11y.speak(l.Menus.data.l10n.itemDeleted);c.focus()})})},_setupLinksUI:function(){var a;a=this.container.find("a.original-link");a.on("click",function(b){b.preventDefault();l.previewer.previewUrl(b.target.toString())})},_setupTitleUI:function(){var a=this,b;a.container.find(".edit-menu-item-title").on("blur",function(){k(this).val(k.trim(k(this).val()))});b=a.container.find(".menu-item-title");a.setting.bind(function(c){var d,e;if(!c){return}d=k.trim(c.title);e=d||c.original_title||l.Menus.data.l10n.untitled;if(c._invalid){e=l.Menus.data.l10n.invalidTitleTpl.replace("%s",e)}if(d||c.original_title){b.text(e).removeClass("no-title")}else{b.text(e).addClass("no-title")}})},getDepth:function(){var b=this,c=b.setting(),a=0;if(!c){return 0}while(c&&c.menu_item_parent){a+=1;b=l.control("nav_menu_item["+c.menu_item_parent+"]");if(!b){break}c=b.setting()}return a},renderContent:function(){var b=this,c=b.setting(),a;b.params.title=c.title||"";b.params.depth=b.getDepth();b.container.data("item-depth",b.params.depth);a=["menu-item","menu-item-depth-"+String(b.params.depth),"menu-item-"+c.object,"menu-item-edit-inactive"];if(c._invalid){a.push("menu-item-invalid");b.params.title=l.Menus.data.l10n.invalidTitleTpl.replace("%s",b.params.title)}else{if("draft"===c.status){a.push("pending");b.params.title=l.Menus.data.pendingTitleTpl.replace("%s",b.params.title)}}b.params.el_classes=a.join(" ");b.params.item_type_label=c.type_label;b.params.item_type=c.type;b.params.url=c.url;b.params.target=c.target;b.params.attr_title=c.attr_title;b.params.classes=_.isArray(c.classes)?c.classes.join(" "):c.classes;b.params.attr_title=c.attr_title;b.params.xfn=c.xfn;b.params.description=c.description;b.params.parent=c.menu_item_parent;b.params.original_title=c.original_title||"";b.container.addClass(b.params.el_classes);l.Control.prototype.renderContent.call(b)},getMenuControl:function(){var a=this,b=a.setting();if(b&&b.nav_menu_term_id){return l.control("nav_menu["+b.nav_menu_term_id+"]")}else{return null}},expandControlSection:function(){var a=this.container.closest(".accordion-section");if(!a.hasClass("open")){a.find(".accordion-section-title:first").trigger("click")}},_toggleExpanded:l.Section.prototype._toggleExpanded,expand:l.Section.prototype.expand,expandForm:function(a){this.expand(a)},collapse:l.Section.prototype.collapse,collapseForm:function(a){this.collapse(a)},toggleForm:function(b,a){if(typeof b==="undefined"){b=!this.expanded()}if(b){this.expand(a)}else{this.collapse(a)}},onChangeExpanded:function(e,a){var d=this,b,c,f;b=this.container;c=b.find(".menu-item-settings:first");if("undefined"===typeof e){e=!c.is(":visible")}if(c.is(":visible")===e){if(a&&a.completeCallback){a.completeCallback()}return}if(e){l.control.each(function(n){if(d.params.type===n.params.type&&d!==n){n.collapseForm()}});f=function(){b.removeClass("menu-item-edit-inactive").addClass("menu-item-edit-active");d.container.trigger("expanded");if(a&&a.completeCallback){a.completeCallback()}};b.find(".item-edit").attr("aria-expanded","true");c.slideDown("fast",f);d.container.trigger("expand")}else{f=function(){b.addClass("menu-item-edit-inactive").removeClass("menu-item-edit-active");d.container.trigger("collapsed");if(a&&a.completeCallback){a.completeCallback()}};d.container.trigger("collapse");b.find(".item-edit").attr("aria-expanded","false");c.slideUp("fast",f)}},focus:function(a){a=a||{};var b=this,c=a.completeCallback,d;d=function(){b.expandControlSection();a.completeCallback=function(){var e;e=b.container.find(".menu-item-settings").find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible");e.first().focus();if(c){c()}};b.expandForm(a)};if(l.section.has(b.section())){l.section(b.section()).expand({completeCallback:d})}else{d()}},moveUp:function(){this._changePosition(-1);g.a11y.speak(l.Menus.data.l10n.movedUp)},moveDown:function(){this._changePosition(1);g.a11y.speak(l.Menus.data.l10n.movedDown)},moveLeft:function(){this._changeDepth(-1);g.a11y.speak(l.Menus.data.l10n.movedLeft)},moveRight:function(){this._changeDepth(1);g.a11y.speak(l.Menus.data.l10n.movedRight)},_changePosition:function(a){var b=this,f,c=_.clone(b.setting()),e=[],d;if(1!==a&&-1!==a){throw new Error("Offset changes by 1 are only supported.")}if(!b.setting()){return}_(b.getMenuControl().getMenuItemControls()).each(function(n){if(n.setting().menu_item_parent===c.menu_item_parent){e.push(n.setting)}});e.sort(function(p,o){return p().position-o().position});d=_.indexOf(e,b.setting);if(-1===d){throw new Error("Expected setting to be among siblings.")}if((d===0&&a<0)||(d===e.length-1&&a>0)){return}f=e[d+a];if(f){f.set(k.extend(_.clone(f()),{position:c.position}))}c.position+=a;b.setting.set(c)},_changeDepth:function(a){if(1!==a&&-1!==a){throw new Error("Offset changes by 1 are only supported.")}var b=this,c=_.clone(b.setting()),n=[],d,e,f;_(b.getMenuControl().getMenuItemControls()).each(function(m){if(m.setting().menu_item_parent===c.menu_item_parent){n.push(m)}});n.sort(function(m,p){return m.setting().position-p.setting().position});d=_.indexOf(n,b);if(-1===d){throw new Error("Expected control to be among siblings.")}if(-1===a){if(!c.menu_item_parent){return}f=l.control("nav_menu_item["+c.menu_item_parent+"]");_(n).chain().slice(d).each(function(m,p){m.setting.set(k.extend({},m.setting(),{menu_item_parent:b.params.menu_item_id,position:p}))});_(b.getMenuControl().getMenuItemControls()).each(function(q){var r,m;m=(q.setting().menu_item_parent===f.setting().menu_item_parent&&q.setting().position>f.setting().position);if(m){r=_.clone(q.setting());q.setting.set(k.extend(r,{position:r.position+1}))}});c.position=f.setting().position+1;c.menu_item_parent=f.setting().menu_item_parent;b.setting.set(c)}else{if(1===a){if(d===0){return}e=n[d-1];c.menu_item_parent=e.params.menu_item_id;c.position=0;_(b.getMenuControl().getMenuItemControls()).each(function(m){if(m.setting().menu_item_parent===c.menu_item_parent){c.position=Math.max(c.position,m.setting().position)}});c.position+=1;b.setting.set(c)}}}});l.Menus.MenuNameControl=l.Control.extend({ready:function(){var a=this,b=a.setting();a.active.validate=function(){var d,c=l.section(a.section());if(c){d=c.active()}else{d=false}return d};a.nameElement=new l.Element(a.container.find(".menu-name-field"));a.nameElement.bind(function(d){var c=a.setting();if(c&&c.name!==d){c=_.clone(c);c.name=d;a.setting.set(c)}});if(b){a.nameElement.set(b.name)}a.setting.bind(function(c){if(c){a.nameElement.set(c.name)}})}});l.Menus.MenuAutoAddControl=l.Control.extend({ready:function(){var a=this,b=a.setting();a.active.validate=function(){var d,c=l.section(a.section());if(c){d=c.active()}else{d=false}return d};a.autoAddElement=new l.Element(a.container.find("input[type=checkbox].auto_add"));a.autoAddElement.bind(function(d){var c=a.setting();if(c&&c.name!==d){c=_.clone(c);c.auto_add=d;a.setting.set(c)}});if(b){a.autoAddElement.set(b.auto_add)}a.setting.bind(function(c){if(c){a.autoAddElement.set(c.auto_add)}})}});l.Menus.MenuControl=l.Control.extend({ready:function(){var c=this,d=l.section(c.section()),a=c.params.menu_id,b=c.setting(),f,e,n;if("undefined"===typeof this.params.menu_id){throw new Error("params.menu_id was not defined")}c.active.validate=function(){var m;if(d){m=d.active()}else{m=false}return m};c.$controlSection=d.headContainer;c.$sectionContent=c.container.closest(".accordion-section-content");this._setupModel();l.section(c.section(),function(m){m.deferred.initSortables.done(function(p){c._setupSortable(p)})});this._setupAddition();this._setupLocations();this._setupTitle();if(b){f=i(b.name);l.control.each(function(m){if(!m.extended(l.controlConstructor.widget_form)||"nav_menu"!==m.params.widget_id_base){return}m.container.find(".nav-menu-widget-form-controls:first").show();m.container.find(".nav-menu-widget-no-menus-message:first").hide();n=m.container.find("select");if(0===n.find("option[value="+String(a)+"]").length){n.append(new Option(f,a))}});e=k("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");e.find(".nav-menu-widget-form-controls:first").show();e.find(".nav-menu-widget-no-menus-message:first").hide();n=e.find(".widget-inside select:first");if(0===n.find("option[value="+String(a)+"]").length){n.append(new Option(f,a))}}},_setupModel:function(){var b=this,a=b.params.menu_id;b.setting.bind(function(c){var d;if(false===c){b._handleDeletion()}else{d=i(c.name);l.control.each(function(e){if(!e.extended(l.controlConstructor.widget_form)||"nav_menu"!==e.params.widget_id_base){return}var f=e.container.find("select");f.find("option[value="+String(a)+"]").text(d)})}});b.container.find(".menu-delete-item").on("click",function(c){c.stopPropagation();c.preventDefault();b.setting.set(false)})},_setupSortable:function(b){var a=this;if(!b.is(a.$sectionContent)){throw new Error("Unexpected menuList.")}b.on("sortstart",function(){a.isSorting=true});b.on("sortstop",function(){setTimeout(function(){var c=a.$sectionContent.sortable("toArray"),d=[],f=0,e=10;a.isSorting=false;a.$sectionContent.scrollLeft(0);_.each(c,function(q){var r,t,s;s=q.match(/^customize-control-nav_menu_item-(-?\d+)$/,"");if(!s){return}r=parseInt(s[1],10);t=l.control("nav_menu_item["+String(r)+"]");if(t){d.push(t)}});_.each(d,function(o){if(false===o.setting()){return}var p=_.clone(o.setting());f+=1;e+=1;p.position=f;o.priority(e);p.menu_item_parent=parseInt(o.container.find(".menu-item-data-parent-id").val(),10);if(!p.menu_item_parent){p.menu_item_parent=0}o.setting.set(p)})})});a.isReordering=false;this.container.find(".reorder-toggle").on("click",function(){a.toggleReordering(!a.isReordering)})},_setupAddition:function(){var a=this;this.container.find(".add-new-menu-item").on("click",function(b){if(a.$sectionContent.hasClass("reordering")){return}if(!k("body").hasClass("adding-menu-items")){k(this).attr("aria-expanded","true");l.Menus.availableMenuItemsPanel.open(a)}else{k(this).attr("aria-expanded","false");l.Menus.availableMenuItemsPanel.close();b.stopPropagation()}})},_handleDeletion:function(){var c=this,d,a=c.params.menu_id,f,e,b=0;d=l.section(c.section());f=function(){d.container.remove();l.section.remove(d.id)};if(d&&d.expanded()){d.collapse({completeCallback:function(){f();g.a11y.speak(l.Menus.data.l10n.menuDeleted);l.panel("nav_menus").focus()}})}else{f()}l.each(function(n){if(/^nav_menu\[/.test(n.id)&&false!==n()){b+=1}});l.control.each(function(p){if(!p.extended(l.controlConstructor.widget_form)||"nav_menu"!==p.params.widget_id_base){return}var o=p.container.find("select");if(o.val()===String(a)){o.prop("selectedIndex",0).trigger("change")}p.container.find(".nav-menu-widget-form-controls:first").toggle(0!==b);p.container.find(".nav-menu-widget-no-menus-message:first").toggle(0===b);p.container.find("option[value="+String(a)+"]").remove()});e=k("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");e.find(".nav-menu-widget-form-controls:first").toggle(0!==b);e.find(".nav-menu-widget-no-menus-message:first").toggle(0===b);e.find("option[value="+String(a)+"]").remove()},_setupLocations:function(){var a=this;a.container.find(".assigned-menu-location").each(function(){var f=k(this),b=f.find("input[type=checkbox]"),d,e,c=l("nav_menu_locations["+b.data("location-id")+"]");e=function(p){var o=l("nav_menu["+String(p)+"]");if(!p||!o||!o()){f.find(".theme-location-set").hide()}else{f.find(".theme-location-set").show().find("span").text(i(o().name))}};d=new l.Element(b);d.set(c.get()===a.params.menu_id);b.on("change",function(){c.set(this.checked?a.params.menu_id:0)});c.bind(function(n){d.set(n===a.params.menu_id);e(n)});e(c.get())})},_setupTitle:function(){var a=this;a.setting.bind(function(r){if(!r){return}var b=l.section(a.section()),q=a.params.menu_id,p=b.headContainer.find(".accordion-section-title"),d=b.contentContainer.find(".customize-section-title h3"),f=b.headContainer.find(".menu-in-location"),c=d.find(".customize-action"),e=i(r.name);p.text(e);if(f.length){f.appendTo(p)}d.text(e);if(c.length){c.prependTo(d)}l.control.each(function(m){if(/^nav_menu_locations\[/.test(m.id)){m.container.find("option[value="+q+"]").text(e)}});b.contentContainer.find(".customize-control-checkbox input").each(function(){if(k(this).prop("checked")){k(".current-menu-location-name-"+k(this).data("location-id")).text(e)}})})},toggleReordering:function(d){var b=this.container.find(".add-new-menu-item"),a=this.container.find(".reorder-toggle"),c=this.$sectionContent.find(".item-title");d=Boolean(d);if(d===this.$sectionContent.hasClass("reordering")){return}this.isReordering=d;this.$sectionContent.toggleClass("reordering",d);this.$sectionContent.sortable(this.isReordering?"disable":"enable");if(this.isReordering){b.attr({tabindex:"-1","aria-hidden":"true"});a.attr("aria-label",l.Menus.data.l10n.reorderLabelOff);g.a11y.speak(l.Menus.data.l10n.reorderModeOn);c.attr("aria-hidden","false")}else{b.removeAttr("tabindex aria-hidden");a.attr("aria-label",l.Menus.data.l10n.reorderLabelOn);g.a11y.speak(l.Menus.data.l10n.reorderModeOff);c.attr("aria-hidden","true")}if(d){_(this.getMenuItemControls()).each(function(e){e.collapseForm()})}},getMenuItemControls:function(){var b=this,a=[],c=b.params.menu_id;l.control.each(function(d){if("nav_menu_item"===d.params.type&&d.setting()&&c===d.setting().nav_menu_term_id){a.push(d)}});return a},reflowMenuItems:function(){var b=this,a=b.getMenuItemControls(),c;c=function(e){var d=[],f=e.currentParent;_.each(e.menuItemControls,function(n){if(f===n.setting().menu_item_parent){d.push(n)}});d.sort(function(p,o){return p.setting().position-o.setting().position});_.each(d,function(n){e.currentAbsolutePosition+=1;n.priority.set(e.currentAbsolutePosition);if(!n.container.hasClass("menu-item-depth-"+String(e.currentDepth))){_.each(n.container.prop("className").match(/menu-item-depth-\d+/g),function(m){n.container.removeClass(m)});n.container.addClass("menu-item-depth-"+String(e.currentDepth))}n.container.data("item-depth",e.currentDepth);e.currentDepth+=1;e.currentParent=n.params.menu_item_id;c(e);e.currentDepth-=1;e.currentParent=f});if(d.length){_(d).each(function(n){n.container.removeClass("move-up-disabled move-down-disabled move-left-disabled move-right-disabled");if(0===e.currentDepth){n.container.addClass("move-left-disabled")}else{if(10===e.currentDepth){n.container.addClass("move-right-disabled")}}});d[0].container.addClass("move-up-disabled").addClass("move-right-disabled").toggleClass("move-down-disabled",1===d.length);d[d.length-1].container.addClass("move-down-disabled").toggleClass("move-up-disabled",1===d.length)}};c({menuItemControls:a,currentParent:0,currentDepth:0,currentAbsolutePosition:0});b.container.find(".reorder-toggle").toggle(a.length>1)},debouncedReflowMenuItems:_.debounce(function(){this.reflowMenuItems.apply(this,arguments)},0),addItemToMenu:function(b){var e=this,r,q,a,f,c,p=0,d=10;_.each(e.getMenuItemControls(),function(m){if(false===m.setting()){return}d=Math.max(d,m.priority());if(0===m.setting().menu_item_parent){p=Math.max(p,m.setting().position)}});p+=1;d+=1;b=k.extend({},l.Menus.data.defaultSettingValues.nav_menu_item,b,{nav_menu_term_id:e.params.menu_id,original_title:b.title,position:p});delete b.id;c=l.Menus.generatePlaceholderAutoIncrementId();r="nav_menu_item["+String(c)+"]";q={type:"nav_menu_item",transport:l.Menus.data.settingTransport,previewer:l.previewer};a=l.create(r,r,{},q);a.set(b);f=new l.controlConstructor.nav_menu_item(r,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(c)+'" class="customize-control customize-control-nav_menu_item"></li>',section:e.id,priority:d,active:true,settings:{"default":r},menu_item_id:c},previewer:l.previewer});l.control.add(r,f);a.preview();e.debouncedReflowMenuItems();g.a11y.speak(l.Menus.data.l10n.itemAdded);return f}});l.Menus.NewMenuControl=l.Control.extend({ready:function(){this._bindHandlers()},_bindHandlers:function(){var c=this,b=k("#customize-control-new_menu_name input"),a=k("#create-new-menu-submit");b.on("keydown",function(d){if(13===d.which){c.submit()}});a.on("click",function(d){c.submit();d.stopPropagation();d.preventDefault()})},submit:function(){var a=this,n=a.container.closest(".accordion-section-new-menu"),c=n.find(".menu-name-field").first(),d=c.val(),f,b,e=l.Menus.generatePlaceholderAutoIncrementId();if(!d){c.addClass("invalid");c.focus();return}b="nav_menu["+String(e)+"]";l.create(b,b,{},{type:"nav_menu",transport:l.Menus.data.settingTransport,previewer:l.previewer});l(b).set(k.extend({},l.Menus.data.defaultSettingValues.nav_menu,{name:d}));f=new l.Menus.MenuSection(b,{params:{id:b,panel:"nav_menus",title:i(d),customizeAction:l.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:10,menu_id:e}});l.section.add(b,f);c.val("");c.removeClass("invalid");g.a11y.speak(l.Menus.data.l10n.menuAdded);l.section(b).focus()}});k.extend(l.controlConstructor,{nav_menu_location:l.Menus.MenuLocationControl,nav_menu_item:l.Menus.MenuItemControl,nav_menu:l.Menus.MenuControl,nav_menu_name:l.Menus.MenuNameControl,nav_menu_auto_add:l.Menus.MenuAutoAddControl,new_menu:l.Menus.NewMenuControl});k.extend(l.panelConstructor,{nav_menus:l.Menus.MenusPanel});k.extend(l.sectionConstructor,{nav_menu:l.Menus.MenuSection,new_menu:l.Menus.NewMenuSection});l.bind("ready",function(){l.Menus.availableMenuItemsPanel=new l.Menus.AvailableMenuItemsPanelView({collection:l.Menus.availableMenuItems});l.bind("saved",function(a){if(a.nav_menu_updates||a.nav_menu_item_updates){l.Menus.applySavedData(a)}});l.state("changesetStatus").bind(function(a){if("publish"===a){l("nav_menus_created_posts")._value=[]}});l.previewer.bind("focus-nav-menu-item-control",l.Menus.focusMenuItemControl)});l.Menus.applySavedData=function(b){var c={},a={};_(b.nav_menu_updates).each(function(e){var D,F,A,B,f,C,w,E,z,x,y,d;if("inserted"===e.status){if(!e.previous_term_id){throw new Error("Expected previous_term_id")}if(!e.term_id){throw new Error("Expected term_id")}D="nav_menu["+String(e.previous_term_id)+"]";if(!l.has(D)){throw new Error("Expected setting to exist: "+D)}B=l(D);if(!l.section.has(D)){throw new Error("Expected control to exist: "+D)}E=l.section(D);w=B.get();if(!w){throw new Error("Did not expect setting to be empty (deleted).")}w=k.extend(_.clone(w),e.saved_value);c[e.previous_term_id]=e.term_id;F="nav_menu["+String(e.term_id)+"]";f=l.create(F,F,w,{type:"nav_menu",transport:l.Menus.data.settingTransport,previewer:l.previewer});if(E.expanded()){E.collapse()}z=new l.Menus.MenuSection(F,{params:{id:F,panel:"nav_menus",title:w.name,customizeAction:l.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:E.priority.get(),active:true,menu_id:e.term_id}});l.section.add(F,z);l.control.each(function(p){if(!p.extended(l.controlConstructor.widget_form)||"nav_menu"!==p.params.widget_id_base){return}var n,o,m;n=p.container.find("select");o=n.find("option[value="+String(e.previous_term_id)+"]");m=n.find("option[value="+String(e.term_id)+"]");m.prop("selected",o.prop("selected"));o.remove()});B.callbacks.disable();B.set(false);B.preview();f.preview();B._dirty=false;E.container.remove();l.section.remove(D);d=0;l.each(function(m){if(/^nav_menu\[/.test(m.id)&&false!==m()){d+=1}});y=k("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");y.find(".nav-menu-widget-form-controls:first").toggle(0!==d);y.find(".nav-menu-widget-no-menus-message:first").toggle(0===d);y.find("option[value="+String(e.previous_term_id)+"]").remove();g.customize.control.each(function(m){if(/^nav_menu_locations\[/.test(m.id)){m.container.find("option[value="+String(e.previous_term_id)+"]").remove()}});l.each(function(n){var m=l.state("saved").get();if(/^nav_menu_locations\[/.test(n.id)&&n.get()===e.previous_term_id){n.set(e.term_id);n._dirty=false;l.state("saved").set(m);n.preview()}});if(E.expanded.get()){z.expand()}}else{if("updated"===e.status){A="nav_menu["+String(e.term_id)+"]";if(!l.has(A)){throw new Error("Expected setting to exist: "+A)}C=l(A);if(!_.isEqual(e.saved_value,C.get())){x=l.state("saved").get();C.set(e.saved_value);C._dirty=false;l.state("saved").set(x)}}}});_(b.nav_menu_item_updates).each(function(d){if(d.previous_post_id){a[d.previous_post_id]=d.post_id}});_(b.nav_menu_item_updates).each(function(s){var t,v,e,r,u,d,f;if("inserted"===s.status){if(!s.previous_post_id){throw new Error("Expected previous_post_id")}if(!s.post_id){throw new Error("Expected post_id")}t="nav_menu_item["+String(s.previous_post_id)+"]";if(!l.has(t)){throw new Error("Expected setting to exist: "+t)}e=l(t);if(!l.control.has(t)){throw new Error("Expected control to exist: "+t)}d=l.control(t);u=e.get();if(!u){throw new Error("Did not expect setting to be empty (deleted).")}u=_.clone(u);if(u.menu_item_parent<0){if(!a[u.menu_item_parent]){throw new Error("inserted ID for menu_item_parent not available")}u.menu_item_parent=a[u.menu_item_parent]}if(c[u.nav_menu_term_id]){u.nav_menu_term_id=c[u.nav_menu_term_id]}v="nav_menu_item["+String(s.post_id)+"]";r=l.create(v,v,u,{type:"nav_menu_item",transport:l.Menus.data.settingTransport,previewer:l.previewer});f=new l.controlConstructor.nav_menu_item(v,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(s.post_id)+'" class="customize-control customize-control-nav_menu_item"></li>',menu_id:s.post_id,section:"nav_menu["+String(u.nav_menu_term_id)+"]",priority:d.priority.get(),active:true,settings:{"default":v},menu_item_id:s.post_id},previewer:l.previewer});d.container.remove();l.control.remove(t);l.control.add(v,f);e.callbacks.disable();e.set(false);e.preview();r.preview();e._dirty=false;f.container.toggleClass("menu-item-edit-inactive",d.container.hasClass("menu-item-edit-inactive"))}});_.each(b.widget_nav_menu_updates,function(e,f){var d=l(f);if(d){d._value=e;d.preview()}})};l.Menus.focusMenuItemControl=function(a){var b=l.Menus.getMenuItemControl(a);if(b){b.focus()}};l.Menus.getMenuControl=function(a){return l.control("nav_menu["+a+"]")};l.Menus.getMenuItemControl=function(a){return l.control(h(a))};function h(a){return"nav_menu_item["+a+"]"}function i(a){a=a||"";a=k("<div>").text(a).html();a=k.trim(a);return a||l.Menus.data.l10n.unnamed}})(wp.customize,wp,jQuery);