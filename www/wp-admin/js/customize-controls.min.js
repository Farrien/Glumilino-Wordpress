(function(g,h){var f,l,j,i=wp.customize;i.Setting=i.Value.extend({initialize:function(p,o,m){var n=this;i.Value.prototype.initialize.call(n,o,m);n.id=p;n.transport=n.transport||"refresh";n._dirty=m.dirty||false;n.notifications=new i.Values({defaultConstructor:i.Notification});n.bind(n.preview)},preview:function(){var m=this,n;n=m.transport;if("postMessage"===n&&!i.state("previewerAlive").get()){n="refresh"}if("postMessage"===n){m.previewer.send("setting",[m.id,m()])}else{if("refresh"===n){m.previewer.refresh()}}},findControls:function(){var n=this,m=[];i.control.each(function(o){_.each(o.settings,function(p){if(p.id===n.id){m.push(o)}})});return m}});i._latestRevision=0;i._lastSavedRevision=0;i._latestSettingRevisions={};i.bind("change",function b(m){i._latestRevision+=1;i._latestSettingRevisions[m.id]=i._latestRevision});i.bind("ready",function(){i.bind("add",function m(n){if(n._dirty){i._latestRevision+=1;i._latestSettingRevisions[n.id]=i._latestRevision}})});i.dirtyValues=function e(n){var m={};i.each(function(p){var o;if(!p._dirty){return}o=i._latestSettingRevisions[p.id];if(i.state("changesetStatus").get()&&(n&&n.unsaved)&&(_.isUndefined(o)||o<=i._lastSavedRevision)){return}m[p.id]=p.get()});return m};i.requestChangesetUpdate=function a(q){var m,r,n={},s;m=new h.Deferred();if(q){_.extend(n,q)}_.each(i.dirtyValues({unsaved:true}),function(t,u){if(!q||null!==q[u]){n[u]=_.extend({},n[u]||{},{value:t})}});if(_.isEmpty(n)){m.resolve({});return m.promise()}i.state("processing").set(i.state("processing").get()+1);m.always(function(){i.state("processing").set(i.state("processing").get()-1)});i.trigger("changeset-save",n);s=i.previewer.query({excludeCustomizedSaved:true});delete s.customized;_.extend(s,{nonce:i.settings.nonce.save,customize_theme:i.settings.theme.stylesheet,customize_changeset_data:JSON.stringify(n)});r=wp.ajax.post("customize_save",s);r.done(function p(u){var t={};i._lastSavedRevision=Math.max(i._latestRevision,i._lastSavedRevision);i.state("changesetStatus").set(u.changeset_status);m.resolve(u);i.trigger("changeset-saved",u);if(u.setting_validities){_.each(u.setting_validities,function(v,w){if(true===v&&_.isObject(n[w])&&!_.isUndefined(n[w].value)){t[w]=n[w].value}})}i.previewer.send("changeset-saved",_.extend({},u,{saved_changeset_values:t}))});r.fail(function o(t){m.reject(t);i.trigger("changeset-error",t)});r.always(function(t){if(t.setting_validities){i._handleSettingValidities({settingValidities:t.setting_validities})}});return m.promise()};i.utils.bubbleChildValueChanges=function(m,n){h.each(n,function(p,o){m[o].bind(function(r,q){if(m.parent&&r!==q){m.parent.trigger("change",m)}})})};l=function(q){var m,p,o,n;m=this;q=q||{};o=function(){var r;if((m.extended(i.Panel)||m.extended(i.Section))&&m.expanded&&m.expanded()){r=m.contentContainer}else{r=m.container}n=r.find(".control-focus:first");if(0===n.length){n=r.find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible").first()}n.focus()};if(q.completeCallback){p=q.completeCallback;q.completeCallback=function(){o();p()}}else{q.completeCallback=o}i.state("paneVisible").set(true);if(m.expand){m.expand(q)}else{q.completeCallback()}};i.utils.prioritySort=function(n,m){if(n.priority()===m.priority()&&typeof n.params.instanceNumber==="number"&&typeof m.params.instanceNumber==="number"){return n.params.instanceNumber-m.params.instanceNumber}else{return n.priority()-m.priority()}};i.utils.isKeydownButNotEnterEvent=function(m){return("keydown"===m.type&&13!==m.which)};i.utils.areElementListsEqual=function(o,n){var m=(o.length===n.length&&-1===_.indexOf(_.map(_.zip(o,n),function(p){return h(p[0]).is(p[1])}),false));return m};j=(function(){var m,n,o;m=document.createElement("div");n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};o=_.find(_.keys(n),function(p){return !_.isUndefined(m.style[p])});if(o){return n[o]}else{return null}})();f=i.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:h.noop},defaultExpandedArguments:{duration:"fast",completeCallback:h.noop},containerType:"container",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:true,instanceNumber:null},initialize:function(o,n){var m=this;m.id=o;n=n||{};n.params=_.defaults(n.params||{},m.defaults);h.extend(m,n);m.templateSelector="customize-"+m.containerType+"-"+m.params.type;m.container=h(m.params.content);if(0===m.container.length){m.container=h(m.getContainer())}m.headContainer=m.container;m.contentContainer=m.getContent();m.container=m.container.add(m.contentContainer);m.deferred={embedded:new h.Deferred()};m.priority=new i.Value();m.active=new i.Value();m.activeArgumentsQueue=[];m.expanded=new i.Value();m.expandedArgumentsQueue=[];m.active.bind(function(q){var p=m.activeArgumentsQueue.shift();p=h.extend({},m.defaultActiveArguments,p);q=(q&&m.isContextuallyActive());m.onChangeActive(q,p)});m.expanded.bind(function(p){var q=m.expandedArgumentsQueue.shift();q=h.extend({},m.defaultExpandedArguments,q);m.onChangeExpanded(p,q)});m.deferred.embedded.done(function(){m.attachEvents()});i.utils.bubbleChildValueChanges(m,["priority","active"]);m.priority.set(m.params.priority);m.active.set(m.params.active);m.expanded.set(false)},ready:function(){},_children:function(p,m){var o=this,n=[];i[m].each(function(q){if(q[p].get()===o.id){n.push(q)}});n.sort(i.utils.prioritySort);return n},isContextuallyActive:function(){throw new Error("Container.isContextuallyActive() must be overridden in a subclass.")},onChangeActive:function(r,o){var m=this,p=m.headContainer,q,n;if(o.unchanged){if(o.completeCallback){o.completeCallback()}return}q=("resolved"===i.previewer.deferred.active.state()?o.duration:0);if(m.extended(i.Panel)){i.panel.each(function(s){if(s!==m&&s.expanded()){n=s;q=0}});if(!r){_.each(m.sections(),function(s){s.collapse({duration:0})})}}if(!h.contains(document,p.get(0))){p.toggle(r);if(o.completeCallback){o.completeCallback()}}else{if(r){p.slideDown(q,o.completeCallback)}else{if(m.expanded()){m.collapse({duration:q,completeCallback:function(){p.slideUp(q,o.completeCallback)}})}else{p.slideUp(q,o.completeCallback)}}}},_toggleActive:function(n,o){var m=this;o=o||{};if((n&&this.active.get())||(!n&&!this.active.get())){o.unchanged=true;m.onChangeActive(m.active.get(),o);return false}else{o.unchanged=false;this.activeArgumentsQueue.push(o);this.active.set(n);return true}},activate:function(m){return this._toggleActive(true,m)},deactivate:function(m){return this._toggleActive(false,m)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(o,p){var m=this,n;p=p||{};n=p.completeCallback;if(o&&!m.active()){return false}i.state("paneVisible").set(true);p.completeCallback=function(){if(n){n.apply(m,arguments)}if(o){m.container.trigger("expanded")}else{m.container.trigger("collapsed")}};if((o&&m.expanded.get())||(!o&&!m.expanded.get())){p.unchanged=true;m.onChangeExpanded(m.expanded.get(),p);return false}else{p.unchanged=false;m.expandedArgumentsQueue.push(p);m.expanded.set(o);return true}},expand:function(m){return this._toggleExpanded(true,m)},collapse:function(m){return this._toggleExpanded(false,m)},_animateChangeExpanded:function(s){if(!j){if(s){s()}return}var m=this,q=m.contentContainer,n=q.closest(".wp-full-overlay"),r,p,o;r=n.add(q);if(!m.panel||""===m.panel()){o=true}else{if(i.panel(m.panel()).contentContainer.hasClass("skip-transition")){o=true}else{o=false}}if(o){r=r.add("#customize-info, .customize-pane-parent")}p=function(t){if(2!==t.eventPhase||!h(t.target).is(q)){return}q.off(j,p);r.removeClass("busy");if(s){s()}};q.on(j,p);r.addClass("busy");_.defer(function(){var t=q.closest(".wp-full-overlay-sidebar-content"),w=t.scrollTop(),v=q.data("previous-scrollTop")||0,u=m.expanded();if(u&&0<w){q.css("top",w+"px");q.data("previous-scrollTop",w)}else{if(!u&&0<w+v){q.css("top",v-w+"px");t.scrollTop(v)}}})},focus:l,getContainer:function(){var n,m=this;if(0!==h("#tmpl-"+m.templateSelector).length){n=wp.template(m.templateSelector)}else{n=wp.template("customize-"+m.containerType+"-default")}if(n&&m.container){return h.trim(n(m.params))}return"<li></li>"},getContent:function(){var n=this,o=n.container,p=o.find(".accordion-section-content, .control-panel-content").first(),r="sub-"+o.attr("id"),q=r,m=o.attr("aria-owns");if(m){q=q+" "+m}o.attr("aria-owns",q);return p.detach().attr({id:r,"class":"customize-pane-child "+p.attr("class")+" "+o.attr("class")})}});i.Section=f.extend({containerType:"section",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:true,instanceNumber:null,panel:null,customizeAction:""},initialize:function(o,m){var n=this;f.prototype.initialize.call(n,o,m);n.id=o;n.panel=new i.Value();n.panel.bind(function(p){h(n.headContainer).toggleClass("control-subsection",!!p)});n.panel.set(n.params.panel||"");i.utils.bubbleChildValueChanges(n,["panel"]);n.embed();n.deferred.embedded.done(function(){n.ready()})},embed:function(){var n,o=this,m=h("#customize-theme-controls");n=function(p){var q;if(p){i.panel(p,function(r){r.deferred.embedded.done(function(){q=r.contentContainer;if(!o.headContainer.parent().is(q)){q.append(o.headContainer)}if(!o.contentContainer.parent().is(o.headContainer)){m.append(o.contentContainer)}o.deferred.embedded.resolve()})})}else{q=h(".customize-pane-parent");if(!o.headContainer.parent().is(q)){q.append(o.headContainer)}if(!o.contentContainer.parent().is(o.headContainer)){m.append(o.contentContainer)}o.deferred.embedded.resolve()}};o.panel.bind(n);n(o.panel.get())},attachEvents:function(){var o,m,n=this;if(n.container.hasClass("cannot-expand")){return}n.container.find(".accordion-section-title, .customize-section-back").on("click keydown",function(p){if(i.utils.isKeydownButNotEnterEvent(p)){return}p.preventDefault();if(n.expanded()){n.collapse()}else{n.expand()}});n.container.find(".customize-section-title .customize-help-toggle").on("click",function(){o=n.container.find(".section-meta");if(o.hasClass("cannot-expand")){return}m=o.find(".customize-section-description:first");m.toggleClass("open");m.slideToggle();m.attr("aria-expanded",function(q,p){return"true"===p?"false":"true"})})},isContextuallyActive:function(){var o=this,m=o.controls(),n=0;_(m).each(function(p){if(p.active()){n+=1}});return(n!==0)},controls:function(){return this._children("section","control")},onChangeExpanded:function(q,s){var u=this,n=u.headContainer.closest(".wp-full-overlay-sidebar-content"),r=u.contentContainer,o=u.headContainer.closest(".wp-full-overlay"),p=r.find(".customize-section-back"),v=u.headContainer.find(".accordion-section-title").first(),t,m;if(q&&!r.hasClass("open")){if(s.unchanged){t=s.completeCallback}else{t=h.proxy(function(){u._animateChangeExpanded(function(){v.attr("tabindex","-1");p.attr("tabindex","0");p.focus();r.css("top","");n.scrollTop(0);if(s.completeCallback){s.completeCallback()}});r.addClass("open");o.addClass("section-open");i.state("expandedSection").set(u)},this)}if(!s.allowMultiple){i.section.each(function(w){if(w!==u){w.collapse({duration:s.duration})}})}if(u.panel()){i.panel(u.panel()).expand({duration:s.duration,completeCallback:t})}else{i.panel.each(function(w){w.collapse()});t()}}else{if(!q&&r.hasClass("open")){if(u.panel()){m=i.panel(u.panel());if(m.contentContainer.hasClass("skip-transition")){m.collapse()}}u._animateChangeExpanded(function(){p.attr("tabindex","-1");v.attr("tabindex","0");v.focus();r.css("top","");if(s.completeCallback){s.completeCallback()}});r.removeClass("open");o.removeClass("section-open");if(u===i.state("expandedSection").get()){i.state("expandedSection").set(false)}}else{if(s.completeCallback){s.completeCallback()}}}}});i.ThemesSection=i.Section.extend({currentTheme:"",overlay:"",template:"",screenshotQueue:null,$window:h(window),initialize:function(){this.$customizeSidebar=h(".wp-full-overlay-sidebar-content:first");return i.Section.prototype.initialize.apply(this,arguments)},ready:function(){var m=this;m.overlay=m.container.find(".theme-overlay");m.template=wp.template("customize-themes-details-view");m.container.on("keydown",function(n){if(!m.overlay.find(".theme-wrap").is(":visible")){return}if(39===n.keyCode){m.nextTheme()}if(37===n.keyCode){m.previousTheme()}if(27===n.keyCode){m.closeDetails();n.stopPropagation()}});_.bindAll(this,"renderScreenshots")},isContextuallyActive:function(){return this.active()},attachEvents:function(){var n=this;n.container.find(".change-theme, .customize-theme").on("click keydown",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();if(n.expanded()){n.collapse()}else{n.expand()}});n.container.on("click keydown",".left",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();n.previousTheme()});n.container.on("click keydown",".right",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();n.nextTheme()});n.container.on("click keydown",".theme-backdrop, .close",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();n.closeDetails()});var m=_.throttle(_.bind(n.renderScreenshots,this),100);n.container.on("input","#themes-filter",function(r){var q,p=r.currentTarget.value.toLowerCase().trim().replace("-"," "),o=n.controls();_.each(o,function(s){s.filter(p)});m();q=n.container.find("li.customize-control:visible").length;n.container.find(".theme-count").text(q)});i.bind("ready",function(){_.each(n.controls().slice(0,3),function(p){var o,q=p.params.theme.screenshot[0];if(q){o=new Image();o.src=q}})})},onChangeExpanded:function(p,r){if(r.unchanged){if(r.completeCallback){r.completeCallback()}return}var o=this,t=o.contentContainer,q=t.closest(".wp-full-overlay"),n=t.closest(".wp-full-overlay-sidebar-content"),s=t.find(".customize-theme"),m=o.headContainer.find(".change-theme");if(p&&!t.hasClass("current-panel")){i.section.each(function(u){if(u!==o){u.collapse({duration:r.duration})}});i.panel.each(function(u){u.collapse({duration:0})});o._animateChangeExpanded(function(){m.attr("tabindex","-1");s.attr("tabindex","0");s.focus();t.css("top","");n.scrollTop(0);if(r.completeCallback){r.completeCallback()}});q.addClass("in-themes-panel");t.addClass("current-panel");_.delay(o.renderScreenshots,10);o.$customizeSidebar.on("scroll.customize-themes-section",_.throttle(o.renderScreenshots,300))}else{if(!p&&t.hasClass("current-panel")){o._animateChangeExpanded(function(){m.attr("tabindex","0");s.attr("tabindex","-1");m.focus();t.css("top","");if(r.completeCallback){r.completeCallback()}});q.removeClass("in-themes-panel");t.removeClass("current-panel");o.$customizeSidebar.off("scroll.customize-themes-section")}}},renderScreenshots:function(){var m=this;if(m.screenshotQueue===null){m.screenshotQueue=m.controls()}if(!m.screenshotQueue.length){return}m.screenshotQueue=_.filter(m.screenshotQueue,function(p){var r=p.container.find(".theme-screenshot"),n=r.find("img");if(!n.length){return false}if(n.is(":hidden")){return true}var s=m.$window.scrollTop(),o=s+m.$window.height(),v=n.offset().top,w=r.height(),t=v+w,q=w*3,u=t>=s-q&&v<=o+q;if(u){p.container.trigger("render-screenshot")}return !u})},nextTheme:function(){var m=this;if(m.getNextTheme()){m.showDetails(m.getNextTheme(),function(){m.overlay.find(".right").focus()})}},getNextTheme:function(){var n,m;n=i.control("theme_"+this.currentTheme);m=n.container.next("li.customize-control-theme");if(!m.length){return false}m=m[0].id.replace("customize-control-","");n=i.control(m);return n.params.theme},previousTheme:function(){var m=this;if(m.getPreviousTheme()){m.showDetails(m.getPreviousTheme(),function(){m.overlay.find(".left").focus()})}},getPreviousTheme:function(){var n,m;n=i.control("theme_"+this.currentTheme);m=n.container.prev("li.customize-control-theme");if(!m.length){return false}m=m[0].id.replace("customize-control-","");n=i.control(m);return n.params.theme},updateLimits:function(){if(!this.getNextTheme()){this.overlay.find(".right").addClass("disabled")}if(!this.getPreviousTheme()){this.overlay.find(".left").addClass("disabled")}},loadThemePreview:function(q){var n=h.Deferred(),m,p,o;o=document.createElement("a");o.href=location.href;o.search=h.param(_.extend(i.utils.parseQueryString(o.search.substr(1)),{theme:q,changeset_uuid:i.settings.changeset.uuid}));p=h(".wp-full-overlay");p.addClass("customize-loading");m=function(){var r;if(i.state("processing").get()>0){return}i.state("processing").unbind(m);r=i.requestChangesetUpdate();r.done(function(){h(window).off("beforeunload.customize-confirm");top.location.href=o.href;n.resolve()});r.fail(function(){p.removeClass("customize-loading");n.reject()})};if(0===i.state("processing").get()){m()}else{i.state("processing").bind(m)}return n.promise()},showDetails:function(o,p){var n=this,m;p=p||function(){};n.currentTheme=o.id;n.overlay.html(n.template(o)).fadeIn("fast").focus();h("body").addClass("modal-open");n.containFocus(n.overlay);n.updateLimits();m=n.overlay.find(".inactive-theme > a");m.on("click",function(q){q.preventDefault();if(m.hasClass("disabled")){return}m.addClass("disabled");n.loadThemePreview(o.id).fail(function(){m.removeClass("disabled")})});p()},closeDetails:function(){h("body").removeClass("modal-open");this.overlay.fadeOut("fast");i.control("theme_"+this.currentTheme).focus()},containFocus:function(m){var n;m.on("keydown",function(o){if(9!==o.keyCode){return}n=h(":tabbable",m);if(n.last()[0]===o.target&&!o.shiftKey){n.first().focus();return false}else{if(n.first()[0]===o.target&&o.shiftKey){n.last().focus();return false}}})}});i.Panel=f.extend({containerType:"panel",initialize:function(o,n){var m=this;f.prototype.initialize.call(m,o,n);m.embed();m.deferred.embedded.done(function(){m.ready()})},embed:function(){var n=this,m=h("#customize-theme-controls"),o=h(".customize-pane-parent");if(!n.headContainer.parent().is(o)){o.append(n.headContainer)}if(!n.contentContainer.parent().is(n.headContainer)){m.append(n.contentContainer);n.renderContent()}n.deferred.embedded.resolve()},attachEvents:function(){var n,m=this;m.headContainer.find(".accordion-section-title").on("click keydown",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();if(!m.expanded()){m.expand()}});m.container.find(".customize-panel-back").on("click keydown",function(o){if(i.utils.isKeydownButNotEnterEvent(o)){return}o.preventDefault();if(m.expanded()){m.collapse()}});n=m.container.find(".panel-meta:first");n.find("> .accordion-section-title .customize-help-toggle").on("click keydown",function(p){if(i.utils.isKeydownButNotEnterEvent(p)){return}p.preventDefault();if(n.hasClass("cannot-expand")){return}var o=n.find(".customize-panel-description:first");if(n.hasClass("open")){n.toggleClass("open");o.slideUp(m.defaultExpandedArguments.duration);h(this).attr("aria-expanded",false)}else{o.slideDown(m.defaultExpandedArguments.duration);n.toggleClass("open");h(this).attr("aria-expanded",true)}})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var m=this,o=m.sections(),n=0;_(o).each(function(p){if(p.active()&&p.isContextuallyActive()){n+=1}});return(n!==0)},onChangeExpanded:function(s,u){if(u.unchanged){if(u.completeCallback){u.completeCallback()}return}var m=this,o=m.contentContainer,p=o.closest(".wp-full-overlay"),n=o.closest(".wp-full-overlay-sidebar-content"),t=m.headContainer.find(".accordion-section-title"),r=o.find(".customize-panel-back"),v=m.sections(),q;if(s&&!o.hasClass("current-panel")){i.section.each(function(w){if(m.id!==w.panel()){w.collapse({duration:0})}});i.panel.each(function(w){if(m!==w){w.collapse({duration:0})}});if(m.params.autoExpandSoleSection&&1===v.length&&v[0].active.get()){o.addClass("current-panel skip-transition");p.addClass("in-sub-panel");v[0].expand({completeCallback:u.completeCallback})}else{m._animateChangeExpanded(function(){t.attr("tabindex","-1");r.attr("tabindex","0");r.focus();o.css("top","");n.scrollTop(0);if(u.completeCallback){u.completeCallback()}});o.addClass("current-panel");p.addClass("in-sub-panel")}i.state("expandedPanel").set(m)}else{if(!s&&o.hasClass("current-panel")){q=o.hasClass("skip-transition");if(!q){m._animateChangeExpanded(function(){t.attr("tabindex","0");r.attr("tabindex","-1");t.focus();o.css("top","");if(u.completeCallback){u.completeCallback()}})}else{o.removeClass("skip-transition")}p.removeClass("in-sub-panel");o.removeClass("current-panel");if(m===i.state("expandedPanel").get()){i.state("expandedPanel").set(false)}}}},renderContent:function(){var n,m=this;if(0!==h("#tmpl-"+m.templateSelector+"-content").length){n=wp.template(m.templateSelector+"-content")}else{n=wp.template("customize-panel-default-content")}if(n&&m.headContainer){m.contentContainer.html(n(m.params))}}});i.Control=i.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:h.noop},initialize:function(r,n){var p=this,m,q,o;p.params={};h.extend(p,n||{});p.id=r;p.selector="#customize-control-"+r.replace(/\]/g,"").replace(/\[/g,"-");p.templateSelector="customize-control-"+p.params.type+"-content";p.container=p.params.content?h(p.params.content):h(p.selector);p.deferred={embedded:new h.Deferred()};p.section=new i.Value();p.priority=new i.Value();p.active=new i.Value();p.activeArgumentsQueue=[];p.notifications=new i.Values({defaultConstructor:i.Notification});p.elements=[];m=p.container.find("[data-customize-setting-link]");q={};m.each(function(){var t=h(this),s;if(t.is(":radio")){s=t.prop("name");if(q[s]){return}q[s]=true;t=m.filter('[name="'+s+'"]')}i(t.data("customizeSettingLink"),function(v){var u=new i.Element(t);p.elements.push(u);u.sync(v);u.set(v())})});p.active.bind(function(t){var s=p.activeArgumentsQueue.shift();s=h.extend({},p.defaultActiveArguments,s);p.onChangeActive(t,s)});p.section.set(p.params.section);p.priority.set(isNaN(p.params.priority)?10:p.params.priority);p.active.set(p.params.active);i.utils.bubbleChildValueChanges(p,["section","priority","active"]);o=h.map(p.params.settings,function(s){return s});if(0===o.length){p.setting=null;p.settings={};p.embed()}else{i.apply(i,o.concat(function(){var s;p.settings={};for(s in p.params.settings){p.settings[s]=i(p.params.settings[s])}p.setting=p.settings["default"]||null;_.each(p.settings,function(t){t.notifications.bind("add",function(x){var u,v,w;v=t.id+":"+x.code;w=_.extend({},x,{setting:t.id});u=new i.Notification(v,w);p.notifications.add(u.code,u)});t.notifications.bind("remove",function(u){p.notifications.remove(t.id+":"+u.code)})});p.embed()}))}p.deferred.embedded.done(function(){var t=_.debounce(function s(){p.renderNotifications()});p.notifications.bind("add",function(u){wp.a11y.speak(u.message,"assertive");t()});p.notifications.bind("remove",t);p.renderNotifications();p.ready()})},embed:function(){var n=this,m;m=function(o){var p;if(!o){return}i.section(o,function(q){q.deferred.embedded.done(function(){p=(q.contentContainer.is("ul"))?q.contentContainer:q.contentContainer.find("ul:first");if(!n.container.parent().is(p)){p.append(n.container);n.renderContent()}n.deferred.embedded.resolve()})})};n.section.bind(m);m(n.section.get())},ready:function(){var n=this,m;if("dropdown-pages"===n.params.type&&n.params.allow_addition){m=n.container.find(".new-content-item");m.hide();n.container.on("click",".add-new-toggle",function(o){h(o.currentTarget).slideUp(180);m.slideDown(180);m.find(".create-item-input").focus()});n.container.on("click",".add-content",function(){n.addNewPage()});n.container.on("keyup",".create-item-input",function(o){if(13===o.which){n.addNewPage()}})}},getNotificationsContainerElement:function(){var o=this,m,n;n=o.container.find(".customize-control-notifications-container:first");if(n.length){return n}n=h('<div class="customize-control-notifications-container"></div>');if(o.container.hasClass("customize-control-nav_menu_item")){o.container.find(".menu-item-settings:first").prepend(n)}else{if(o.container.hasClass("customize-control-widget_form")){o.container.find(".widget-inside:first").prepend(n)}else{m=o.container.find(".customize-control-title");if(m.length){m.after(n)}else{o.container.prepend(n)}}}return n},renderNotifications:function(){var p=this,n,o,m=false;n=p.getNotificationsContainerElement();if(!n||!n.length){return}o=[];p.notifications.each(function(q){o.push(q);if("error"===q.type){m=true}});if(0===o.length){n.stop().slideUp("fast")}else{n.stop().slideDown("fast",null,function(){h(this).css("height","auto")})}if(!p.notificationsTemplate){p.notificationsTemplate=wp.template("customize-control-notifications")}p.container.toggleClass("has-notifications",0!==o.length);p.container.toggleClass("has-error",m);n.empty().append(h.trim(p.notificationsTemplate({notifications:o,altNotice:Boolean(p.altNotice)})))},expand:function(m){i.section(this.section()).expand(m)},focus:l,onChangeActive:function(n,m){if(m.unchanged){if(m.completeCallback){m.completeCallback()}return}if(!h.contains(document,this.container[0])){this.container.toggle(n);if(m.completeCallback){m.completeCallback()}}else{if(n){this.container.slideDown(m.duration,m.completeCallback)}else{this.container.slideUp(m.duration,m.completeCallback)}}},toggle:function(m){return this.onChangeActive(m,this.defaultActiveArguments)},activate:f.prototype.activate,deactivate:f.prototype.deactivate,_toggleActive:f.prototype._toggleActive,dropdownInit:function(){var o=this,n=this.container.find(".dropdown-status"),p=this.params,m=false,q=function(r){if(typeof r==="string"&&p.statuses&&p.statuses[r]){n.html(p.statuses[r]).show()}else{n.hide()}};this.container.on("click keydown",".dropdown",function(r){if(i.utils.isKeydownButNotEnterEvent(r)){return}r.preventDefault();if(!m){o.container.toggleClass("open")}if(o.container.hasClass("open")){o.container.parent().parent().find("li.library-selected").focus()}m=true;setTimeout(function(){m=false},400)});this.setting.bind(q);q(this.setting())},renderContent:function(){var m,n=this;if(0!==h("#tmpl-"+n.templateSelector).length){m=wp.template(n.templateSelector);if(m&&n.container){n.container.html(m(n.params))}}},addNewPage:function(){var q=this,s,n,o,p,r,m;if("dropdown-pages"!==q.params.type||!q.params.allow_addition||!i.Menus){return}n=q.container.find(".add-new-toggle");o=q.container.find(".new-content-item");p=q.container.find(".create-item-input");r=p.val();m=q.container.find("select");if(!r){p.addClass("invalid");return}p.removeClass("invalid");p.attr("disabled","disabled");s=i.Menus.insertAutoDraftPost({post_title:r,post_type:"page"});s.done(function(w){var u,t,v;u=new i.Menus.AvailableItemModel({id:"post-"+w.post_id,title:r,type:"post_type",type_label:i.Menus.data.l10n.page_label,object:"page",object_id:w.post_id,url:w.url});i.Menus.availableMenuItemsPanel.collection.add(u);t=h("#available-menu-items-post_type-page").find(".available-menu-items-list");v=wp.template("available-menu-item");t.prepend(v(u.attributes));m.focus();q.setting.set(String(w.post_id));o.slideUp(180);n.slideDown(180)});s.always(function(){p.val("").removeAttr("disabled")})}});i.ColorControl=i.Control.extend({ready:function(){var p=this,m=this.params.mode==="hue",o=false,n;if(m){n=this.container.find(".color-picker-hue");n.val(p.setting()).wpColorPicker({change:function(q,r){o=true;p.setting(r.color.h());o=false}})}else{n=this.container.find(".color-picker-hex");n.val(p.setting()).wpColorPicker({change:function(){o=true;p.setting.set(n.wpColorPicker("color"));o=false},clear:function(){o=true;p.setting.set("");o=false}})}p.setting.bind(function(q){if(o){return}n.val(q);n.wpColorPicker("color",q)});p.container.on("keydown",function(q){var r;if(27!==q.which){return}r=p.container.find(".wp-picker-container");if(r.hasClass("wp-picker-active")){n.wpColorPicker("close");p.container.find(".wp-color-result").focus();q.stopPropagation()}})}});i.MediaControl=i.Control.extend({ready:function(){var n=this;_.bindAll(n,"restoreDefault","removeFile","openFrame","select","pausePlayer");n.container.on("click keydown",".upload-button",n.openFrame);n.container.on("click keydown",".upload-button",n.pausePlayer);n.container.on("click keydown",".thumbnail-image img",n.openFrame);n.container.on("click keydown",".default-button",n.restoreDefault);n.container.on("click keydown",".remove-button",n.pausePlayer);n.container.on("click keydown",".remove-button",n.removeFile);n.container.on("click keydown",".remove-button",n.cleanupPlayer);i.section(n.section()).container.on("expanded",function(){if(n.player){n.player.setControlsSize()}}).on("collapsed",function(){n.pausePlayer()});function m(o){var p=h.Deferred();if(n.extended(i.UploadControl)){p.resolve()}else{o=parseInt(o,10);if(_.isNaN(o)||o<=0){delete n.params.attachment;p.resolve()}else{if(n.params.attachment&&n.params.attachment.id===o){p.resolve()}}}if("pending"===p.state()){wp.media.attachment(o).fetch().done(function(){n.params.attachment=this.attributes;p.resolve();wp.customize.previewer.send(n.setting.id+"-attachment-data",this.attributes)})}p.done(function(){n.renderContent()})}m(n.setting());n.setting.bind(m)},pausePlayer:function(){this.player&&this.player.pause()},cleanupPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)},openFrame:function(m){if(i.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();if(!this.frame){this.initFrame()}this.frame.open()},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:false,date:false})]});this.frame.on("select",this.select)},select:function(){var m,o=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=o;this.setting(o.id);m=this.container.find("audio, video").get(0);if(m){this.player=new MediaElementPlayer(m,n)}else{this.cleanupPlayer()}},restoreDefault:function(m){if(i.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();this.params.attachment=this.params.defaultAttachment;this.setting(this.params.defaultAttachment.url)},removeFile:function(m){if(i.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();this.params.attachment={};this.setting("");this.renderContent()}});i.UploadControl=i.MediaControl.extend({select:function(){var m,o=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=o;this.setting(o.url);m=this.container.find("audio, video").get(0);if(m){this.player=new MediaElementPlayer(m,n)}else{this.cleanupPlayer()}},success:function(){},removerVisibility:function(){}});i.ImageControl=i.UploadControl.extend({thumbnailSrc:function(){}});i.BackgroundControl=i.UploadControl.extend({ready:function(){i.UploadControl.prototype.ready.apply(this,arguments)},select:function(){i.UploadControl.prototype.select.apply(this,arguments);wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",customize_theme:i.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}});i.BackgroundPositionControl=i.Control.extend({ready:function(){var m=this,n;m.container.on("change",'input[name="background-position"]',function(){var o=h(this).val().split(" ");m.settings.x(o[0]);m.settings.y(o[1])});n=_.debounce(function(){var p,r,q,o;p=m.settings.x.get();r=m.settings.y.get();o=String(p)+" "+String(r);q=m.container.find('input[name="background-position"][value="'+o+'"]');q.click()});m.settings.x.bind(n);m.settings.y.bind(n);n()}});i.CroppedImageControl=i.MediaControl.extend({openFrame:function(m){if(i.utils.isKeydownButNotEnterEvent(m)){return}this.initFrame();this.frame.setState("library").open()},initFrame:function(){var m=_wpMediaViewsL10n;this.frame=wp.media({button:{text:m.select,close:false},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:false,date:false,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]});this.frame.on("select",this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var m=this.frame.state().get("selection").first().toJSON();if(this.params.width===m.width&&this.params.height===m.height&&!this.params.flex_width&&!this.params.flex_height){this.setImageFromAttachment(m);this.frame.close()}else{this.frame.setState("cropper")}},onCropped:function(m){this.setImageFromAttachment(m)},calculateImageSelectOptions:function(r,s){var q=s.get("control"),o=!!parseInt(q.params.flex_width,10),v=!!parseInt(q.params.flex_height,10),y=r.get("width"),u=r.get("height"),z=parseInt(q.params.width,10),x=parseInt(q.params.height,10),t=z/x,n=z,A=x,m,w,p;s.set("canSkipCrop",!q.mustBeCropped(o,v,z,x,y,u));if(y/u>t){x=u;z=x*t}else{z=y;x=z/t}m=(y-z)/2;w=(u-x)/2;p={handles:true,keys:true,instance:true,persistent:true,imageWidth:y,imageHeight:u,minWidth:n>z?z:n,minHeight:A>x?x:A,x1:m,y1:w,x2:z+m,y2:x+w};if(v===false&&o===false){p.aspectRatio=z+":"+x}if(true===v){delete p.minHeight;p.maxWidth=y}if(true===o){delete p.minWidth;p.maxHeight=u}return p},mustBeCropped:function(n,q,m,o,p,r){if(true===n&&true===q){return false}if(true===n&&o===r){return false}if(true===q&&m===p){return false}if(m===p&&o===r){return false}if(p<=m){return false}return true},onSkippedCrop:function(){var m=this.frame.state().get("selection").first().toJSON();this.setImageFromAttachment(m)},setImageFromAttachment:function(m){this.params.attachment=m;this.setting(m.id)}});i.SiteIconControl=i.CroppedImageControl.extend({initFrame:function(){var m=_wpMediaViewsL10n;this.frame=wp.media({button:{text:m.select,close:false},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:false,date:false,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.SiteIconCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]});this.frame.on("select",this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var n=this.frame.state().get("selection").first().toJSON(),m=this;if(this.params.width===n.width&&this.params.height===n.height&&!this.params.flex_width&&!this.params.flex_height){wp.ajax.post("crop-image",{nonce:n.nonces.edit,id:n.id,context:"site-icon",cropDetails:{x1:0,y1:0,width:this.params.width,height:this.params.height,dst_width:this.params.width,dst_height:this.params.height}}).done(function(o){m.setImageFromAttachment(o);m.frame.close()}).fail(function(){m.frame.trigger("content:error:crop")})}else{this.frame.setState("cropper")}},setImageFromAttachment:function(p){var o=["site_icon-32","thumbnail","full"],n,m;_.each(o,function(q){if(!m&&!_.isUndefined(p.sizes[q])){m=p.sizes[q]}});this.params.attachment=p;this.setting(p.id);if(!m){return}n=h('link[rel="icon"][sizes="32x32"]');n.attr("href",m.url)},removeFile:function(m){if(i.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();this.params.attachment={};this.setting("");this.renderContent();h('link[rel="icon"][sizes="32x32"]').attr("href","/favicon.ico")}});i.HeaderControl=i.Control.extend({ready:function(){this.btnRemove=h("#customize-control-header_image .actions .remove");this.btnNew=h("#customize-control-header_image .actions .new");_.bindAll(this,"openMedia","removeImage");this.btnNew.on("click",this.openMedia);this.btnRemove.on("click",this.removeImage);i.HeaderTool.currentHeader=this.getInitialHeaderImage();new i.HeaderTool.CurrentView({model:i.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"});new i.HeaderTool.ChoiceListView({collection:i.HeaderTool.UploadsList=new i.HeaderTool.ChoiceList(),el:"#customize-control-header_image .choices .uploaded .list"});new i.HeaderTool.ChoiceListView({collection:i.HeaderTool.DefaultsList=new i.HeaderTool.DefaultsList(),el:"#customize-control-header_image .choices .default .list"});i.HeaderTool.combinedList=i.HeaderTool.CombinedList=new i.HeaderTool.CombinedList([i.HeaderTool.UploadsList,i.HeaderTool.DefaultsList]);wp.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on";wp.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=i.settings.theme.stylesheet},getInitialHeaderImage:function(){if(!i.get().header_image||!i.get().header_image_data||_.contains(["remove-header","random-default-image","random-uploaded-image"],i.get().header_image)){return new i.HeaderTool.ImageModel()}var m=_.find(_wpCustomizeHeader.uploads,function(n){return(n.attachment_id===i.get().header_image_data.attachment_id)});if(!m){m={url:i.get().header_image,thumbnail_url:i.get().header_image,attachment_id:i.get().header_image_data.attachment_id}}return new i.HeaderTool.ImageModel({header:m,choice:m.url.split("/").pop()})},calculateImageSelectOptions:function(p,q){var w=parseInt(_wpCustomizeHeader.data.width,10),u=parseInt(_wpCustomizeHeader.data.height,10),n=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),t=!!parseInt(_wpCustomizeHeader.data["flex-height"],10),s,m,x,r,v,o;v=p.get("width");r=p.get("height");this.headerImage=new i.HeaderTool.ImageModel();this.headerImage.set({themeWidth:w,themeHeight:u,themeFlexWidth:n,themeFlexHeight:t,imageWidth:v,imageHeight:r});q.set("canSkipCrop",!this.headerImage.shouldBeCropped());s=w/u;m=v;x=r;if(m/x>s){u=x;w=u*s}else{w=m;u=w/s}o={handles:true,keys:true,instance:true,persistent:true,imageWidth:v,imageHeight:r,x1:0,y1:0,x2:w,y2:u};if(t===false&&n===false){o.aspectRatio=w+":"+u}if(t===false){o.maxHeight=u}if(n===false){o.maxWidth=w}return o},openMedia:function(n){var m=_wpMediaViewsL10n;n.preventDefault();this.frame=wp.media({button:{text:m.selectAndCrop,close:false},states:[new wp.media.controller.Library({title:m.chooseImage,library:wp.media.query({type:"image"}),multiple:false,date:false,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]});this.frame.on("select",this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this);this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(o){var n=o.url,q=o.attachment_id,m=o.width,p=o.height;this.setImageFromURL(n,q,m,p)},onSkippedCrop:function(p){var n=p.get("url"),m=p.get("width"),o=p.get("height");this.setImageFromURL(n,p.id,m,o)},setImageFromURL:function(o,r,p,m){var n,q={};q.url=o;q.thumbnail_url=o;q.timestamp=_.now();if(r){q.attachment_id=r}if(p){q.width=p}if(m){q.height=m}n=new i.HeaderTool.ImageModel({header:q,choice:o.split("/").pop()});i.HeaderTool.UploadsList.add(n);i.HeaderTool.currentHeader.set(n.toJSON());n.save();n.importImage()},removeImage:function(){i.HeaderTool.currentHeader.trigger("hide");i.HeaderTool.CombinedList.trigger("control:removeImage")}});i.ThemeControl=i.Control.extend({touchDrag:false,isRendered:false,renderContent:function(){var m=this,n=arguments;i.section(m.section(),function(o){if(o.expanded()){i.Control.prototype.renderContent.apply(m,n);m.isRendered=true}else{o.expanded.bind(function(p){if(p&&!m.isRendered){i.Control.prototype.renderContent.apply(m,n);m.isRendered=true}})}})},ready:function(){var m=this;m.container.on("touchmove",".theme",function(){m.touchDrag=true});m.container.on("click keydown touchend",".theme",function(n){if(i.utils.isKeydownButNotEnterEvent(n)){return}if(m.touchDrag===true){return m.touchDrag=false}if(h(n.target).is(".theme-actions .button")){return}i.section(m.section()).loadThemePreview(m.params.theme.id)});m.container.on("click keydown",".theme-actions .theme-details",function(n){if(i.utils.isKeydownButNotEnterEvent(n)){return}n.preventDefault();i.section(m.section()).showDetails(m.params.theme)});m.container.on("render-screenshot",function(){var o=h(this).find("img"),n=o.data("src");if(n){o.attr("src",n)}})},filter:function(m){var o=this,n=o.params.theme.name+" "+o.params.theme.description+" "+o.params.theme.tags+" "+o.params.theme.author;n=n.toLowerCase().replace("-"," ");if(-1!==n.search(m)){o.activate()}else{o.deactivate()}}});i.defaultConstructor=i.Setting;i.control=new i.Values({defaultConstructor:i.Control});i.section=new i.Values({defaultConstructor:i.Section});i.panel=new i.Values({defaultConstructor:i.Panel});i.PreviewFrame=i.Messenger.extend({sensitivity:null,initialize:function(o,n){var m=h.Deferred();m.promise(this);this.container=o.container;h.extend(o,{channel:i.PreviewFrame.uuid()});i.Messenger.prototype.initialize.call(this,o,n);this.add("previewUrl",o.previewUrl);this.query=h.extend(o.query||{},{customize_messenger_channel:this.channel()});this.run(m)},run:function(u){var n=this,p=false,s=false,q=null,r="{}"!==n.query.customized,t,o,m;if(n._ready){n.unbind("ready",n._ready)}n._ready=function(v){s=true;q=v;n.container.addClass("iframe-ready");if(!v){return}if(p){u.resolveWith(n,[v])}};n.bind("ready",n._ready);t=document.createElement("a");t.href=n.previewUrl();o=_.extend(i.utils.parseQueryString(t.search.substr(1)),{customize_changeset_uuid:n.query.customize_changeset_uuid,customize_theme:n.query.customize_theme,customize_messenger_channel:n.query.customize_messenger_channel});t.search=h.param(o);n.iframe=h("<iframe />",{title:i.l10n.previewIframeTitle,name:"customize-"+n.channel()});n.iframe.attr("onmousewheel","");if(!r){n.iframe.attr("src",t.href)}else{n.iframe.attr("data-src",t.href)}n.iframe.appendTo(n.container);n.targetWindow(n.iframe[0].contentWindow);if(r){m=h("<form>",{action:t.href,target:n.iframe.attr("name"),method:"post",hidden:"hidden"});m.append(h("<input>",{type:"hidden",name:"_method",value:"GET"}));_.each(n.query,function(w,v){m.append(h("<input>",{type:"hidden",name:v,value:w}))});n.container.append(m);m.submit();m.remove()}n.bind("iframe-loading-error",function(v){n.iframe.remove();if(0===v){n.login(u);return}if(-1===v){u.rejectWith(n,["cheatin"]);return}u.rejectWith(n,["request failure"])});n.iframe.one("load",function(){p=true;if(s){u.resolveWith(n,[q])}else{setTimeout(function(){u.rejectWith(n,["ready timeout"])},n.sensitivity)}})},login:function(n){var m=this,o;o=function(){n.rejectWith(m,["logged out"])};if(this.triedLogin){return o()}h.get(i.settings.url.ajax,{action:"logged-in"}).fail(o).done(function(p){var q;if("1"!==p){o()}q=h("<iframe />",{src:m.previewUrl(),title:i.l10n.previewIframeTitle}).hide();q.appendTo(m.container);q.on("load",function(){m.triedLogin=true;q.remove();m.run(n)})})},destroy:function(){i.Messenger.prototype.destroy.call(this);if(this.iframe){this.iframe.remove()}delete this.iframe;delete this.targetWindow}});(function(){var m=0;i.PreviewFrame.uuid=function(){return"preview-"+String(m++)}}());i.setDocumentTitle=function(n){var m,o;m=i.settings.documentTitleTmpl;o=m.replace("%s",n);document.title=o;i.trigger("title",o)};i.Previewer=i.Messenger.extend({refreshBuffer:null,initialize:function(o,n){var p=this,m=document.createElement("a");h.extend(p,n||{});p.deferred={active:h.Deferred()};p.refresh=_.debounce((function(q){return function(){var s,r;s=function(){return 0===i.state("processing").get()};if(s()){q.call(p)}else{r=function(){if(s()){q.call(p);i.state("processing").unbind(r)}};i.state("processing").bind(r)}}}(p.refresh)),p.refreshBuffer);p.container=i.ensure(o.container);p.allowedUrls=o.allowedUrls;o.url=window.location.href;i.Messenger.prototype.initialize.call(p,o);m.href=p.origin();p.add("scheme",m.protocol.replace(/:$/,""));p.add("previewUrl",o.previewUrl).setter(function(v){var r=null,s,t,u,q=[];s=document.createElement("a");s.href=v;if(/\/wp-(admin|includes|content)(\/|$)/.test(s.pathname)){return null}if(s.search.length>1){t=i.utils.parseQueryString(s.search.substr(1));delete t.customize_changeset_uuid;delete t.customize_theme;delete t.customize_messenger_channel;if(_.isEmpty(t)){s.search=""}else{s.search=h.param(t)}}q.push(s);if(p.scheme.get()+":"!==s.protocol){s=document.createElement("a");s.href=q[0].href;s.protocol=p.scheme.get()+":";q.unshift(s)}u=document.createElement("a");_.find(q,function(w){return !_.isUndefined(_.find(p.allowedUrls,function(x){u.href=x;if(s.protocol===u.protocol&&s.host===u.host&&0===s.pathname.indexOf(u.pathname.replace(/\/$/,""))){r=w.href;return true}}))});return r});p.bind("ready",p.ready);p.deferred.active.done(_.bind(p.keepPreviewAlive,p));p.bind("synced",function(){p.send("active")});p.previewUrl.bind(p.refresh);p.scroll=0;p.bind("scroll",function(q){p.scroll=q});p.bind("url",function(r){var q,s=false;p.scroll=0;q=function(){s=true};p.previewUrl.bind(q);p.previewUrl.set(r);p.previewUrl.unbind(q);if(!s){p.refresh()}});p.bind("documentTitle",function(q){i.setDocumentTitle(q)})},ready:function(n){var p=this,o={},m;o.settings=i.get();o["settings-modified-while-loading"]=p.settingsModifiedWhileLoading;if("resolved"!==p.deferred.active.state()||p.loading){o.scroll=p.scroll}o["edit-shortcut-visibility"]=i.state("editShortcutVisibility").get();p.send("sync",o);if(n.currentUrl){p.previewUrl.unbind(p.refresh);p.previewUrl.set(n.currentUrl);p.previewUrl.bind(p.refresh)}m={panel:n.activePanels,section:n.activeSections,control:n.activeControls};_(m).each(function(q,r){i[r].each(function(s,u){var t=_.isUndefined(i.settings[r+"s"][u]);if(!t||!_.isUndefined(q[u])){if(q[u]){s.activate()}else{s.deactivate()}}})});if(n.settingValidities){i._handleSettingValidities({settingValidities:n.settingValidities,focusInvalidControl:false})}},keepPreviewAlive:function d(){var q=this,m,p,o,n;n=function(){p=setTimeout(o,i.settings.timeouts.keepAliveCheck)};m=function(){i.state("previewerAlive").set(true);clearTimeout(p);n()};o=function(){i.state("previewerAlive").set(false)};n();q.bind("ready",m);q.bind("keep-alive",m)},query:function(){},abort:function(){if(this.loading){this.loading.destroy();delete this.loading}},refresh:function(){var n=this,m;n.send("loading-initiated");n.abort();n.loading=new i.PreviewFrame({url:n.url(),previewUrl:n.previewUrl(),query:n.query({excludeCustomizedSaved:true})||{},container:n.container});n.settingsModifiedWhileLoading={};m=function(o){n.settingsModifiedWhileLoading[o.id]=true};i.bind("change",m);n.loading.always(function(){i.unbind("change",m)});n.loading.done(function(q){var p=this,o;n.preview=p;n.targetWindow(p.targetWindow());n.channel(p.channel());o=function(){p.unbind("synced",o);if(n._previousPreview){n._previousPreview.destroy()}n._previousPreview=n.preview;n.deferred.active.resolve();delete n.loading};p.bind("synced",o);n.trigger("ready",q)});n.loading.fail(function(o){n.send("loading-failed");if("logged out"===o){if(n.preview){n.preview.destroy();delete n.preview}n.login().done(n.refresh)}if("cheatin"===o){n.cheatin()}})},login:function(){var p=this,m,o,n;if(this._login){return this._login}m=h.Deferred();this._login=m.promise();o=new i.Messenger({channel:"login",url:i.settings.url.login});n=h("<iframe />",{src:i.settings.url.login,title:i.l10n.loginIframeTitle}).appendTo(this.container);o.targetWindow(n[0].contentWindow);o.bind("login",function(){var q=p.refreshNonces();q.always(function(){n.remove();o.destroy();delete p._login});q.done(function(){m.resolve()});q.fail(function(){p.cheatin();m.reject()})});return this._login},cheatin:function(){h(document.body).empty().addClass("cheatin").append("<h1>"+i.l10n.cheatin+"</h1><p>"+i.l10n.notAllowed+"</p>")},refreshNonces:function(){var n,m=h.Deferred();m.promise();n=wp.ajax.post("customize_refresh_nonces",{wp_customize:"on",customize_theme:i.settings.theme.stylesheet});n.done(function(o){i.trigger("nonce-refresh",o);m.resolve()});n.fail(function(){m.reject()});return m}});i.settingConstructor={};i.controlConstructor={color:i.ColorControl,media:i.MediaControl,upload:i.UploadControl,image:i.ImageControl,cropped_image:i.CroppedImageControl,site_icon:i.SiteIconControl,header:i.HeaderControl,background:i.BackgroundControl,background_position:i.BackgroundPositionControl,theme:i.ThemeControl};i.panelConstructor={};i.sectionConstructor={themes:i.ThemesSection};i._handleSettingValidities=function k(m){var p,n=[],o=false;_.each(m.settingValidities,function(q,s){var r=i(s);if(r){if(_.isObject(q)){_.each(q,function(w,u){var v,t,x=false;v=new i.Notification(u,_.extend({fromServer:true},w));t=r.notifications(v.code);if(t){x=v.type!==t.type||v.message!==t.message||!_.isEqual(v.data,t.data)}if(x){r.notifications.remove(u)}if(!r.notifications.has(v.code)){r.notifications.add(u,v)}n.push(r.id)})}r.notifications.each(function(t){if(t.fromServer&&"error"===t.type&&(true===q||!q[t.code])){r.notifications.remove(t.code)}})}});if(m.focusInvalidControl){p=i.findControlsForSettings(n);_(_.values(p)).find(function(q){return _(q).find(function(r){var s=r.section()&&i.section.has(r.section())&&i.section(r.section()).expanded();if(s&&r.expanded){s=r.expanded()}if(s){r.focus();o=true}return o})});if(!o&&!_.isEmpty(p)){_.values(p)[0][0].focus()}}};i.findControlsForSettings=function c(o){var m={},n;_.each(_.unique(o),function(q){var p=i(q);if(p){n=p.findControls();if(n&&n.length>0){m[q]=n}}});return m};i.reflowPaneContents=_.bind(function(){var q,o,n,m=[],p=false;if(document.activeElement){o=h(document.activeElement)}i.panel.each(function(r){var t=r.sections(),s=_.pluck(t,"headContainer");m.push(r);q=(r.contentContainer.is("ul"))?r.contentContainer:r.contentContainer.find("ul:first");if(!i.utils.areElementListsEqual(s,q.children("[id]"))){_(t).each(function(u){q.append(u.headContainer)});p=true}});i.section.each(function(t){var r=t.controls(),s=_.pluck(r,"container");if(!t.panel()){m.push(t)}q=(t.contentContainer.is("ul"))?t.contentContainer:t.contentContainer.find("ul:first");if(!i.utils.areElementListsEqual(s,q.children("[id]"))){_(r).each(function(u){q.append(u.container)});p=true}});m.sort(i.utils.prioritySort);n=_.pluck(m,"headContainer");q=h("#customize-theme-controls .customize-pane-parent");if(!i.utils.areElementListsEqual(n,q.children())){_(m).each(function(r){q.append(r.headContainer)});p=true}i.panel.each(function(r){var s=r.active();r.active.callbacks.fireWith(r.active,[s,s])});i.section.each(function(s){var r=s.active();s.active.callbacks.fireWith(s.active,[r,r])});if(p&&o){o.focus()}i.trigger("pane-contents-reflowed")},i);h(function(){i.settings=window._wpCustomizeSettings;i.l10n=window._wpCustomizeControlsL10n;if(!i.settings){return}if(!h.support.postMessage||(!h.support.cors&&i.settings.isCrossDomain)){return}if(null===i.PreviewFrame.prototype.sensitivity){i.PreviewFrame.prototype.sensitivity=i.settings.timeouts.previewFrameSensitivity}if(null===i.Previewer.prototype.refreshBuffer){i.Previewer.prototype.refreshBuffer=i.settings.timeouts.windowRefresh}var w,r=h(document.body),q=r.children(".wp-full-overlay"),v=h("#customize-info .panel-title.site-title"),u=h(".customize-controls-close"),t=h("#save"),m=h("#customize-footer-actions");h("#customize-controls").on("keydown",function(z){var x=(13===z.which),y=h(z.target);if(x&&(y.is("input:not([type=button])")||y.is("select"))){z.preventDefault()}});h(".customize-info").find("> .accordion-section-title .customize-help-toggle").on("click",function(){var y=h(this).closest(".accordion-section"),x=y.find(".customize-panel-description:first");if(y.hasClass("cannot-expand")){return}if(y.hasClass("open")){y.toggleClass("open");x.slideUp(i.Panel.prototype.defaultExpandedArguments.duration);h(this).attr("aria-expanded",false)}else{x.slideDown(i.Panel.prototype.defaultExpandedArguments.duration);y.toggleClass("open");h(this).attr("aria-expanded",true)}});i.previewer=new i.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:i.settings.url.preview,allowedUrls:i.settings.url.allowed},{nonce:i.settings.nonce,query:function(y){var x={wp_customize:"on",customize_theme:i.settings.theme.stylesheet,nonce:this.nonce.preview,customize_changeset_uuid:i.settings.changeset.uuid};x.customized=JSON.stringify(i.dirtyValues({unsaved:y&&y.excludeCustomizedSaved}));return x},save:function(E){var z=this,H=h.Deferred(),B="publish",A=i.state("processing"),C,D,F={},y=[],G;if(E&&E.status){B=E.status}if(i.state("saving").get()){H.reject("already_saving");H.promise()}i.state("saving").set(true);function x(I){F[I.id]=true}i.bind("change",x);D=function(){var K,L,I={},J=i._latestRevision;i.each(function(M){M.notifications.each(function(N){if("error"===N.type&&!N.fromServer){y.push(M.id);if(!I[M.id]){I[M.id]={}}I[M.id][N.code]=N}})});G=i.findControlsForSettings(y);if(!_.isEmpty(G)){_.values(G)[0][0].focus();i.unbind("change",x);H.rejectWith(z,[{setting_invalidities:I}]);i.state("saving").set(false);return H.promise()}L=h.extend(z.query({excludeCustomizedSaved:false}),{nonce:z.nonce.save,customize_changeset_status:B});if(E&&E.date){L.customize_changeset_date=E.date}if(E&&E.title){L.customize_changeset_title=E.title}K=wp.ajax.post("customize_save",L);t.prop("disabled",true);i.trigger("save",K);K.always(function(){i.state("saving").set(false);t.prop("disabled",false);i.unbind("change",x)});K.fail(function(M){if("0"===M){M="not_logged_in"}else{if("-1"===M){M="invalid_nonce"}}if("invalid_nonce"===M){z.cheatin()}else{if("not_logged_in"===M){z.preview.iframe.hide();z.login().done(function(){z.save();z.preview.iframe.show()})}}if(M.setting_validities){i._handleSettingValidities({settingValidities:M.setting_validities,focusInvalidControl:true})}H.rejectWith(z,[M]);i.trigger("error",M)});K.done(function(M){z.send("saved",M);i.state("changesetStatus").set(M.changeset_status);if("publish"===M.changeset_status){i.each(function(N){if(N._dirty&&(_.isUndefined(i._latestSettingRevisions[N.id])||i._latestSettingRevisions[N.id]<=J)){N._dirty=false}});i.state("changesetStatus").set("");i.settings.changeset.uuid=M.next_changeset_uuid;w.send("changeset-uuid",i.settings.changeset.uuid)}if(M.setting_validities){i._handleSettingValidities({settingValidities:M.setting_validities,focusInvalidControl:true})}H.resolveWith(z,[M]);i.trigger("saved",M);if(!_.isEmpty(F)){i.state("saved").set(false)}})};if(0===A()){D()}else{C=function(){if(0===A()){i.state.unbind("change",C);D()}};i.state.bind("change",C)}return H.promise()}});h.ajaxPrefilter(function n(x){if(!/wp_customize=on/.test(x.data)){return}x.data+="&"+h.param({customize_preview_nonce:i.settings.nonce.preview})});i.previewer.bind("nonce",function(x){h.extend(this.nonce,x)});i.bind("nonce-refresh",function(x){h.extend(i.settings.nonce,x);h.extend(i.previewer.nonce,x);i.previewer.send("nonce-refresh",x)});h.each(i.settings.settings,function(A,z){var y=i.settingConstructor[z.type]||i.Setting,x;x=new y(A,z.value,{transport:z.transport,previewer:i.previewer,dirty:!!z.dirty});i.add(A,x)});h.each(i.settings.panels,function(A,z){var y=i.panelConstructor[z.type]||i.Panel,x;x=new y(A,{params:z});i.panel.add(A,x)});h.each(i.settings.sections,function(A,y){var x=i.sectionConstructor[y.type]||i.Section,z;z=new x(A,{params:y});i.section.add(A,z)});h.each(i.settings.controls,function(A,y){var x=i.controlConstructor[y.type]||i.Control,z;z=new x(A,{params:y,previewer:i.previewer});i.control.add(A,z)});_.each(["panel","section","control"],function(x){var y=i.settings.autofocus[x];if(!y){return}i[x](y,function(z){z.deferred.embedded.done(function(){i.previewer.deferred.active.done(function(){z.focus()})})})});i.bind("ready",i.reflowPaneContents);h([i.panel,i.section,i.control]).each(function(y,x){var z=_.debounce(i.reflowPaneContents,i.settings.timeouts.reflowPaneContents);x.bind("add",z);x.bind("change",z);x.bind("remove",z)});(function(){var x=new i.Values(),I=x.create("saved"),y=x.create("saving"),G=x.create("activated"),A=x.create("processing"),H=x.create("paneVisible"),C=x.create("expandedPanel"),F=x.create("expandedSection"),B=x.create("changesetStatus"),E=x.create("previewerAlive"),z=x.create("editShortcutVisibility"),D;x.bind("change",function(){var J;if(!G()){t.val(i.l10n.activate);u.find(".screen-reader-text").text(i.l10n.cancel)}else{if(""===B.get()&&I()){t.val(i.l10n.saved);u.find(".screen-reader-text").text(i.l10n.close)}else{t.val(i.l10n.save);u.find(".screen-reader-text").text(i.l10n.cancel)}}J=!y()&&(!G()||!I()||(""!==B()&&"publish"!==B()));t.prop("disabled",!J)});B(i.settings.changeset.status);I(true);if(""===B()){i.each(function(J){if(J._dirty){I(false)}})}y(false);G(i.settings.theme.active);A(0);H(true);C(false);F(false);E(true);z("visible");i.bind("change",function(){if(x("saved").get()){x("saved").set(false);D(true)}});y.bind(function(J){r.toggleClass("saving",J)});i.bind("saved",function(J){x("saved").set(true);if("publish"===J.changeset_status){x("activated").set(true)}});G.bind(function(J){if(J){i.trigger("activated")}});D=function(K){var J,L;if(!history.replaceState){return}J=document.createElement("a");J.href=location.href;L=i.utils.parseQueryString(J.search.substr(1));if(K){if(L.changeset_uuid===i.settings.changeset.uuid){return}L.changeset_uuid=i.settings.changeset.uuid}else{if(!L.changeset_uuid){return}delete L.changeset_uuid}J.search=h.param(L);history.replaceState({},document.title,J.href)};B.bind(function(J){D(""!==J&&"publish"!==J)});i.state=x}());if(i.previewer.previewUrl()){i.previewer.refresh()}else{i.previewer.previewUrl(i.settings.url.home)}t.click(function(x){i.previewer.save();x.preventDefault()}).keydown(function(x){if(9===x.which){return}if(13===x.which){i.previewer.save()}x.preventDefault()});u.keydown(function(x){if(9===x.which){return}if(13===x.which){this.click()}x.preventDefault()});h(".collapse-sidebar").on("click",function(){i.state("paneVisible").set(!i.state("paneVisible").get())});i.state("paneVisible").bind(function(x){q.toggleClass("preview-only",!x);q.toggleClass("expanded",x);q.toggleClass("collapsed",!x);if(!x){h(".collapse-sidebar").attr({"aria-expanded":"false","aria-label":i.l10n.expandSidebar})}else{h(".collapse-sidebar").attr({"aria-expanded":"true","aria-label":i.l10n.collapseSidebar})}});h("body").on("keydown",function(z){var x,B=[],y=[],A=[];if(27!==z.which){return}if(!h(z.target).is("body")&&!h.contains(h("#customize-controls")[0],z.target)){return}i.control.each(function(C){if(C.expanded&&C.expanded()&&_.isFunction(C.collapse)){B.push(C)}});i.section.each(function(C){if(C.expanded()){y.push(C)}});i.panel.each(function(C){if(C.expanded()){A.push(C)}});if(B.length>0&&0===y.length){B.length=0}x=B[0]||y[0]||A[0];if(x){x.collapse();z.preventDefault()}});h(".customize-controls-preview-toggle").on("click",function(){i.state("paneVisible").set(!i.state("paneVisible").get())});(function p(){var E=h(".wp-full-overlay-sidebar-content"),B,y,C,z,D,x,A;B=function(F){var J=F,I=i.state("expandedSection").get(),H=i.state("expandedPanel").get(),G;if(x&&x.element){C(x.element)}if(!J){if(!I&&H&&H.contentContainer){J=H}else{if(!H&&I&&I.contentContainer){J=I}else{x=false;return}}}G=J.contentContainer.find(".customize-section-title, .panel-meta").first();if(G.length){x={instance:J,element:G,parent:G.closest(".customize-pane-child"),height:y(G)};if(I){z(x.element,x.parent)}}else{x=false}};i.state("expandedSection").bind(B);i.state("expandedPanel").bind(B);E.on("scroll",_.throttle(function(){if(!x){return}var G=E.scrollTop(),F=(A)?G<=A:true;A=G;D(x,G,F)},8));C=function(F){if(!F.hasClass("is-sticky")){return}F.removeClass("is-sticky").addClass("maybe-sticky is-in-view").css("top",E.scrollTop()+"px")};z=function(F,G){F.removeClass("maybe-sticky is-in-view").css({width:"",top:""});G.css("padding-top","")};y=function(G){var F=G.data("height");if(!F){F=G.outerHeight();G.data("height",F)}return F};D=function(L,F,N){var M=L.element,I=L.parent,K=L.height,G=parseInt(M.css("top"),10),O=M.hasClass("maybe-sticky"),J=M.hasClass("is-sticky"),H=M.hasClass("is-in-view");if(!N){if(J){G=F;M.removeClass("is-sticky").css({top:G+"px",width:""})}if(H&&F>G+K){M.removeClass("is-in-view");I.css("padding-top","")}return}if(!O&&F>=K){O=true;M.addClass("maybe-sticky")}else{if(0===F){M.removeClass("maybe-sticky is-in-view is-sticky").css({top:"",width:""});I.css("padding-top","");return}}if(H&&!J){if(G>=F){M.addClass("is-sticky").css({top:"",width:I.outerWidth()+"px"})}}else{if(O&&!H){M.addClass("is-in-view").css("top",(F-K)+"px");I.css("padding-top",K+"px")}}}}());i.previewedDevice=new i.Value();i.bind("ready",function(){_.find(i.settings.previewableDevices,function(y,x){if(true===y["default"]){i.previewedDevice.set(x);return true}})});m.find(".devices button").on("click",function(x){i.previewedDevice.set(h(x.currentTarget).data("device"))});i.previewedDevice.bind(function(z){var y=h(".wp-full-overlay"),x="";m.find(".devices button").removeClass("active").attr("aria-pressed",false);m.find(".devices .preview-"+z).addClass("active").attr("aria-pressed",true);h.each(i.settings.previewableDevices,function(A){x+=" preview-"+A});y.removeClass(x).addClass("preview-"+z)});if(v.length){i("blogname",function(y){var x=function(){v.text(h.trim(y())||i.l10n.untitledBlogName)};y.bind(x);x()})}w=new i.Messenger({url:i.settings.url.parent,channel:"loader"});w.bind("back",function(){u.on("click.customize-controls-close",function(x){x.preventDefault();w.send("close")})});h(window).on("beforeunload.customize-confirm",function(){if(!i.state("saved")()){setTimeout(function(){q.removeClass("customize-loading")},1);return i.l10n.saveAlert}});h.each(["saved","change"],function(x,y){i.bind(y,function(){w.send(y)})});i.bind("title",function(x){w.send("title",x)});w.send("changeset-uuid",i.settings.changeset.uuid);w.send("ready");h.each({background_image:{controls:["background_preset","background_position","background_size","background_repeat","background_attachment"],callback:function(x){return !!x}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(x){return"page"===x}},header_textcolor:{controls:["header_textcolor"],callback:function(x){return"blank"!==x}}},function(x,y){i(x,function(z){h.each(y.controls,function(A,B){i.control(B,function(D){var C=function(E){D.container.toggle(y.callback(E))};C(z.get());z.bind(C)})})})});i.control("background_preset",function(C){var x,D,y,A,z,B;x={"default":[false,false,false,false],fill:[true,false,false,false],fit:[true,false,true,false],repeat:[true,false,false,true],custom:[true,true,true,true]};D=[_wpCustomizeBackground.defaults["default-position-x"],_wpCustomizeBackground.defaults["default-position-y"],_wpCustomizeBackground.defaults["default-size"],_wpCustomizeBackground.defaults["default-repeat"],_wpCustomizeBackground.defaults["default-attachment"]];y={"default":D,fill:["left","top","cover","no-repeat","fixed"],fit:["left","top","contain","no-repeat","fixed"],repeat:["left","top","auto","repeat","scroll"]};A=function(E){_.each(["background_position","background_size","background_repeat","background_attachment"],function(G,F){var H=i.control(G);if(H){H.container.toggle(x[E][F])}})};z=function(E){_.each(["background_position_x","background_position_y","background_size","background_repeat","background_attachment"],function(H,F){var G=i(H);if(G){G.set(y[E][F])}})};B=C.setting.get();A(B);C.setting.bind("change",function(E){A(E);if("custom"!==E){z(E)}})});i.control("background_repeat",function(x){x.elements[0].unsync(i("background_repeat"));x.element=new i.Element(x.container.find("input"));x.element.set("no-repeat"!==x.setting());x.element.bind(function(y){x.setting.set(y?"repeat":"no-repeat")});x.setting.bind(function(y){x.element.set("no-repeat"!==y)})});i.control("background_attachment",function(x){x.elements[0].unsync(i("background_attachment"));x.element=new i.Element(x.container.find("input"));x.element.set("fixed"!==x.setting());x.element.bind(function(y){x.setting.set(y?"scroll":"fixed")});x.setting.bind(function(y){x.element.set("fixed"!==y)})});i.control("display_header_text",function(y){var x="";y.elements[0].unsync(i("header_textcolor"));y.element=new i.Element(y.container.find("input"));y.element.set("blank"!==y.setting());y.element.bind(function(z){if(!z){x=i("header_textcolor").get()}y.setting.set(z?x:"blank")});y.setting.bind(function(z){y.element.set("blank"!==z)})});i("show_on_front","page_on_front",function(x,z){var y=function(){if(x()==="page"&&parseInt(z(),10)>0){i.previewer.previewUrl.set(i.settings.url.home)}};x.bind(y);z.bind(y)});i("page_for_posts",function(x){x.bind(function(y){y=parseInt(y,10);if(y>0){i.previewer.previewUrl.set(i.settings.url.home+"?page_id="+y)}})});i.control("custom_css",function o(y){y.deferred.embedded.done(function x(){var C=y.container.find("textarea"),z=C[0];C.on("blur",function B(){C.data("next-tab-blurs",false)});C.on("keydown",function A(E){var G,I,F,H=9,D=27;if(D===E.keyCode){if(!C.data("next-tab-blurs")){C.data("next-tab-blurs",true);E.stopPropagation()}return}if(H!==E.keyCode||E.ctrlKey||E.altKey||E.shiftKey){return}if(C.data("next-tab-blurs")){return}G=z.selectionStart;I=z.selectionEnd;F=z.value;if(G>=0){z.value=F.substring(0,G).concat("\t",F.substring(I));C.selectionStart=z.selectionEnd=G+1}E.stopPropagation();E.preventDefault()})})});i.control("header_video",function(x){x.deferred.embedded.done(function(){var y=function(){var A=i.section(x.section()),z;if(!A){return}z=A.container.find(".header-video-not-currently-previewable:first");if(x.active.get()){z.stop().slideUp("fast")}else{z.stop().slideDown("fast")}};y();x.active.bind(y)})});i.previewer.bind("selective-refresh-setting-validities",function s(x){i._handleSettingValidities({settingValidities:x,focusInvalidControl:false})});i.previewer.bind("focus-control-for-setting",function(y){var x=[];i.control.each(function(A){var z=_.pluck(A.settings,"id");if(-1!==_.indexOf(z,y)){x.push(A)}});if(x.length){x.sort(function(A,z){return A.priority()-z.priority()});x[0].focus()}});i.previewer.bind("refresh",function(){i.previewer.refresh()});i.state("paneVisible").bind(function(x){var y;if(window.matchMedia){y=window.matchMedia("screen and ( max-width: 640px )").matches}else{y=h(window).width()<=640}i.state("editShortcutVisibility").set(x||y?"visible":"hidden")});if(window.matchMedia){window.matchMedia("screen and ( max-width: 640px )").addListener(function(){var x=i.state("paneVisible");x.callbacks.fireWith(x,[x.get(),x.get()])})}i.previewer.bind("edit-shortcut-visibility",function(x){i.state("editShortcutVisibility").set(x)});i.state("editShortcutVisibility").bind(function(x){i.previewer.send("edit-shortcut-visibility",x)});(function(){var A,y,x,z=false;y=function(){if(!z){z=true;i.requestChangesetUpdate().always(function(){z=false})}x()};x=function(){clearTimeout(A);A=setTimeout(function(){y()},i.settings.timeouts.changesetAutoSave)};x();h(window).on("blur.wp-customize-changeset-update",function(){y()});h(window).on("beforeunload.wp-customize-changeset-update",function(){y()})}());i.trigger("ready")})})(wp,jQuery);