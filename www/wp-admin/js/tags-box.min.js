var tagBox,array_unique_noempty;(function(a){var b=(window.tagsSuggestL10n&&window.tagsSuggestL10n.tagDelimiter)||",";array_unique_noempty=function(d){var c=[];a.each(d,function(e,f){f=a.trim(f);if(f&&a.inArray(f,c)===-1){c.push(f)}});return c};tagBox={clean:function(c){if(","!==b){c=c.replace(new RegExp(b,"g"),",")}c=c.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");if(","!==b){c=c.replace(/,/g,b)}return c},parseTags:function(f){var i=f.id,c=i.split("-check-num-")[1],e=a(f).closest(".tagsdiv"),h=e.find(".the-tags"),d=h.val().split(b),g=[];delete d[c];a.each(d,function(j,k){k=a.trim(k);if(k){g.push(k)}});h.val(this.clean(g.join(b)));this.quickClicks(e);return false},quickClicks:function(e){var h=a(".the-tags",e),f=a(".tagchecklist",e),g=a(e).attr("id"),c,d;if(!h.length){return}d=h.prop("disabled");c=h.val().split(b);f.empty();a.each(c,function(j,l){var k,i;l=a.trim(l);if(!l){return}k=a("<span />").text(l);if(!d){i=a('<button type="button" id="'+g+"-check-num-"+j+'" class="ntdelbutton"><span class="remove-tag-icon" aria-hidden="true"></span><span class="screen-reader-text">'+window.tagsSuggestL10n.removeTerm+" "+k.html()+"</span></button>");i.on("click keypress",function(m){if("click"===m.type||13===m.keyCode||32===m.keyCode){if(13===m.keyCode||32===m.keyCode){a(this).closest(".tagsdiv").find("input.newtag").focus()}tagBox.userAction="remove";tagBox.parseTags(this)}});k.prepend("&nbsp;").prepend(i)}f.append(k)});tagBox.screenReadersMessage()},flushTags:function(g,c,h){var k,e,j,d=a(".the-tags",g),i=a("input.newtag",g);c=c||false;j=c?a(c).text():i.val();if("undefined"==typeof(j)||""===j){return false}k=d.val();e=k?k+b+j:j;e=this.clean(e);e=array_unique_noempty(e.split(b)).join(b);d.val(e);this.quickClicks(g);if(!c){i.val("")}if("undefined"==typeof(h)){i.focus()}return false},get:function(d){var c=d.substr(d.indexOf("-")+1);a.post(ajaxurl,{action:"get-tagcloud",tax:c},function(f,e){if(0===f||"success"!=e){return}f=a('<p id="tagcloud-'+c+'" class="the-tagcloud">'+f+"</p>");a("a",f).click(function(){tagBox.userAction="add";tagBox.flushTags(a("#"+c),this);return false});a("#"+d).after(f)})},userAction:"",screenReadersMessage:function(){var c;switch(this.userAction){case"remove":c=window.tagsSuggestL10n.termRemoved;break;case"add":c=window.tagsSuggestL10n.termAdded;break;default:return}window.wp.a11y.speak(c,"assertive")},init:function(){var c=a("div.ajaxtag");a(".tagsdiv").each(function(){tagBox.quickClicks(this)});a(".tagadd",c).click(function(){tagBox.userAction="add";tagBox.flushTags(a(this).closest(".tagsdiv"))});a("input.newtag",c).keyup(function(d){if(13==d.which){tagBox.userAction="add";tagBox.flushTags(a(this).closest(".tagsdiv"));d.preventDefault();d.stopPropagation()}}).keypress(function(d){if(13==d.which){d.preventDefault();d.stopPropagation()}}).each(function(e,d){a(d).wpTagsSuggest()});a("#post").submit(function(){a("div.tagsdiv").each(function(){tagBox.flushTags(this,false,1)})});a(".tagcloud-link").click(function(){tagBox.get(a(this).attr("id"));a(this).attr("aria-expanded","true").unbind().click(function(){a(this).attr("aria-expanded","false"===a(this).attr("aria-expanded")?"true":"false").siblings(".the-tagcloud").toggle()})})}}}(jQuery));