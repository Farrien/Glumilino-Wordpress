jQuery(document).ready(function(l){var n,j,m,h,i,k=false;j=function(){n=l("#media-items").sortable({items:"div.media-item",placeholder:"sorthelper",axis:"y",distance:2,handle:"div.filename",stop:function(){var a=l("#media-items").sortable("toArray"),b=a.length;l.each(a,function(d,c){var e=k?(b-d):(1+d);l("#"+c+" .menu_order input").val(e)})}})};m=function(){var a=l(".menu_order_input"),b=a.length;a.each(function(c){var d=k?(b-c):(1+c);l(this).val(d)})};h=function(a){a=a||0;l(".menu_order_input").each(function(){if(this.value==="0"||a){this.value=""}})};l("#asc").click(function(a){a.preventDefault();k=false;m()});l("#desc").click(function(a){a.preventDefault();k=true;m()});l("#clear").click(function(a){a.preventDefault();h(1)});l("#showall").click(function(a){a.preventDefault();l("#sort-buttons span a").toggle();l("a.describe-toggle-on").hide();l("a.describe-toggle-off, table.slidetoggle").show();l("img.pinkynail").toggle(false)});l("#hideall").click(function(a){a.preventDefault();l("#sort-buttons span a").toggle();l("a.describe-toggle-on").show();l("a.describe-toggle-off, table.slidetoggle").hide();l("img.pinkynail").toggle(true)});j();h();if(l("#media-items>*").length>1){i=wpgallery.getWin();l("#save-all, #gallery-settings").show();if(typeof i.tinyMCE!=="undefined"&&i.tinyMCE.activeEditor&&!i.tinyMCE.activeEditor.isHidden()){wpgallery.mcemode=true;wpgallery.init()}else{l("#insert-gallery").show()}}});jQuery(window).unload(function(){tinymce=tinyMCE=wpgallery=null});var tinymce=null,tinyMCE,wpgallery;wpgallery={mcemode:false,editor:{},dom:{},is_update:false,el:{},I:function(b){return document.getElementById(b)},init:function(){var k=this,h,i,l,j,g=k.getWin();if(!k.mcemode){return}h=(""+document.location.search).replace(/^\?/,"").split("&");i={};for(l=0;l<h.length;l++){j=h[l].split("=");i[unescape(j[0])]=unescape(j[1])}if(i.mce_rdomain){document.domain=i.mce_rdomain}tinymce=g.tinymce;tinyMCE=g.tinyMCE;k.editor=tinymce.EditorManager.activeEditor;k.setup()},getWin:function(){return window.dialogArguments||opener||parent||top},setup:function(){var m=this,p,o=m.editor,k,n,l,a,g;if(!m.mcemode){return}m.el=o.selection.getNode();if(m.el.nodeName!=="IMG"||!o.dom.hasClass(m.el,"wpGallery")){if((k=o.dom.select("img.wpGallery"))&&k[0]){m.el=k[0]}else{if(getUserSetting("galfile")==="1"){m.I("linkto-file").checked="checked"}if(getUserSetting("galdesc")==="1"){m.I("order-desc").checked="checked"}if(getUserSetting("galcols")){m.I("columns").value=getUserSetting("galcols")}if(getUserSetting("galord")){m.I("orderby").value=getUserSetting("galord")}jQuery("#insert-gallery").show();return}}p=o.dom.getAttrib(m.el,"title");p=o.dom.decode(p);if(p){jQuery("#update-gallery").show();m.is_update=true;n=p.match(/columns=['"]([0-9]+)['"]/);l=p.match(/link=['"]([^'"]+)['"]/i);a=p.match(/order=['"]([^'"]+)['"]/i);g=p.match(/orderby=['"]([^'"]+)['"]/i);if(l&&l[1]){m.I("linkto-file").checked="checked"}if(a&&a[1]){m.I("order-desc").checked="checked"}if(n&&n[1]){m.I("columns").value=""+n[1]}if(g&&g[1]){m.I("orderby").value=g[1]}}else{jQuery("#insert-gallery").show()}},update:function(){var e=this,f=e.editor,g="",h;if(!e.mcemode||!e.is_update){h="[gallery"+e.getSettings()+"]";e.getWin().send_to_editor(h);return}if(e.el.nodeName!=="IMG"){return}g=f.dom.decode(f.dom.getAttrib(e.el,"title"));g=g.replace(/\s*(order|link|columns|orderby)=['"]([^'"]+)['"]/gi,"");g+=e.getSettings();f.dom.setAttrib(e.el,"title",g);e.getWin().tb_remove()},getSettings:function(){var d=this.I,c="";if(d("linkto-file").checked){c+=' link="file"';setUserSetting("galfile","1")}if(d("order-desc").checked){c+=' order="DESC"';setUserSetting("galdesc","1")}if(d("columns").value!==3){c+=' columns="'+d("columns").value+'"';setUserSetting("galcols",d("columns").value)}if(d("orderby").value!=="menu_order"){c+=' orderby="'+d("orderby").value+'"';setUserSetting("galord",d("orderby").value)}return c}};