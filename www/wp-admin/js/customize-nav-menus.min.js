(function(c,b,d){wpNavMenu.originalInit=wpNavMenu.init;wpNavMenu.options.menuItemDepthPerLevel=20;wpNavMenu.options.sortableItems="> .customize-control-nav_menu_item";wpNavMenu.options.targetTolerance=10;wpNavMenu.init=function(){this.jQueryExtensions()};c.Menus=c.Menus||{};c.Menus.data={itemTypes:[],l10n:{},settingTransport:"refresh",phpIntMax:0,defaultSettingValues:{nav_menu:{},nav_menu_item:{}},locationSlugMappedToName:{}};if("undefined"!==typeof _wpCustomizeNavMenusSettings){d.extend(c.Menus.data,_wpCustomizeNavMenusSettings)}c.Menus.generatePlaceholderAutoIncrementId=function(){return -Math.ceil(c.Menus.data.phpIntMax*Math.random())};c.Menus.AvailableItemModel=Backbone.Model.extend(d.extend({id:null},c.Menus.data.defaultSettingValues.nav_menu_item));c.Menus.AvailableItemCollection=Backbone.Collection.extend({model:c.Menus.AvailableItemModel,sort_key:"order",comparator:function(g){return -g.get(this.sort_key)},sortByField:function(g){this.sort_key=g;this.sort()}});c.Menus.availableMenuItems=new c.Menus.AvailableItemCollection(c.Menus.data.availableMenuItems);c.Menus.insertAutoDraftPost=function e(i){var h,g=d.Deferred();h=b.ajax.post("customize-nav-menus-insert-auto-draft",{"customize-menus-nonce":c.settings.nonce["customize-menus"],wp_customize:"on",params:i});h.done(function(j){if(j.post_id){c("nav_menus_created_posts").set(c("nav_menus_created_posts").get().concat([j.post_id]));if("page"===i.post_type){if(c.section.has("static_front_page")){c.section("static_front_page").activate()}c.control.each(function(l){var k;if("dropdown-pages"===l.params.type){k=l.container.find('select[name^="_customize-dropdown-pages-"]');k.append(new Option(i.post_title,j.post_id))}})}g.resolve(j)}});h.fail(function(j){var k=j||"";if("undefined"!==typeof j.message){k=j.message}console.error(k);g.rejectWith(k)});return g.promise()};c.Menus.AvailableMenuItemsPanelView=b.Backbone.View.extend({el:"#available-menu-items",events:{"input #menu-items-search":"debounceSearch","keyup #menu-items-search":"debounceSearch","focus .menu-item-tpl":"focus","click .menu-item-tpl":"_submit","click #custom-menu-item-submit":"_submitLink","keypress #custom-menu-item-name":"_submitLink","click .new-content-item .add-content":"_submitNew","keypress .create-item-input":"_submitNew",keydown:"keyboardAccessible"},selected:null,currentMenuControl:null,debounceSearch:null,$search:null,$clearResults:null,searchTerm:"",rendered:false,pages:{},sectionContent:"",loading:false,addingNew:false,initialize:function(){var g=this;if(!c.panel.has("nav_menus")){return}this.$search=d("#menu-items-search");this.$clearResults=this.$el.find(".clear-results");this.sectionContent=this.$el.find(".available-menu-items-list");this.debounceSearch=_.debounce(g.search,500);_.bindAll(this,"close");d("#customize-controls, .customize-section-back").on("click keydown",function(j){var h=d(j.target).is(".item-delete, .item-delete *"),i=d(j.target).is(".add-new-menu-item, .add-new-menu-item *");if(d("body").hasClass("adding-menu-items")&&!h&&!i){g.close()}});this.$clearResults.on("click",function(){g.$search.val("").focus().trigger("keyup")});this.$el.on("input","#custom-menu-item-name.invalid, #custom-menu-item-url.invalid",function(){d(this).removeClass("invalid")});c.panel("nav_menus").container.bind("expanded",function(){if(!g.rendered){g.initList();g.rendered=true}});this.sectionContent.scroll(function(){var j=g.$el.find(".accordion-section.open .available-menu-items-list").prop("scrollHeight"),h=g.$el.find(".accordion-section.open").height();if(!g.loading&&d(this).scrollTop()>3/4*j-h){var k=d(this).data("type"),i=d(this).data("object");if("search"===k){if(g.searchTerm){g.doSearch(g.pages.search)}}else{g.loadItems([{type:k,object:i}])}}});c.previewer.bind("url",this.close);g.delegateEvents()},search:function(h){var g=d("#available-menu-items-search"),i=d("#available-menu-items .accordion-section").not(g);if(!h){return}if(this.searchTerm===h.target.value){return}if(""!==h.target.value&&!g.hasClass("open")){i.fadeOut(100);g.find(".accordion-section-content").slideDown("fast");g.addClass("open");this.$clearResults.addClass("is-visible")}else{if(""===h.target.value){g.removeClass("open");i.show();this.$clearResults.removeClass("is-visible")}}this.searchTerm=h.target.value;this.pages.search=1;this.doSearch(1)},doSearch:function(k){var g=this,l,j=d("#available-menu-items-search"),h=j.find(".accordion-section-content"),i=b.template("available-menu-item");if(g.currentRequest){g.currentRequest.abort()}if(k<0){return}else{if(k>1){j.addClass("loading-more");h.attr("aria-busy","true");b.a11y.speak(c.Menus.data.l10n.itemsLoadingMore)}else{if(""===g.searchTerm){h.html("");b.a11y.speak("");return}}}j.addClass("loading");g.loading=true;l=c.previewer.query({excludeCustomizedSaved:true});_.extend(l,{"customize-menus-nonce":c.settings.nonce["customize-menus"],wp_customize:"on",search:g.searchTerm,page:k});g.currentRequest=b.ajax.post("search-available-menu-items-customizer",l);g.currentRequest.done(function(n){var m;if(1===k){h.empty()}j.removeClass("loading loading-more");h.attr("aria-busy","false");j.addClass("open");g.loading=false;m=new c.Menus.AvailableItemCollection(n.items);g.collection.add(m.models);m.each(function(o){h.append(i(o.attributes))});if(20>m.length){g.pages.search=-1}else{g.pages.search=g.pages.search+1}if(m&&k>1){b.a11y.speak(c.Menus.data.l10n.itemsFoundMore.replace("%d",m.length))}else{if(m&&k===1){b.a11y.speak(c.Menus.data.l10n.itemsFound.replace("%d",m.length))}}});g.currentRequest.fail(function(m){if(m.message){h.empty().append(d('<li class="nothing-found"></li>').text(m.message));b.a11y.speak(m.message)}g.pages.search=-1});g.currentRequest.always(function(){j.removeClass("loading loading-more");h.attr("aria-busy","false");g.loading=false;g.currentRequest=null})},initList:function(){var g=this;_.each(c.Menus.data.itemTypes,function(h){g.pages[h.type+":"+h.object]=0});g.loadItems(c.Menus.data.itemTypes)},loadItems:function(g,k){var o=this,h,m=[],i,j,n,l={};n=b.template("available-menu-item");if(_.isString(g)&&_.isString(k)){h=[{type:g,object:k}]}else{h=g}_.each(h,function(r){var p,q=r.type+":"+r.object;if(-1===o.pages[q]){return}p=d("#available-menu-items-"+r.type+"-"+r.object);p.find(".accordion-section-title").addClass("loading");l[q]=p;m.push({object:r.object,type:r.type,page:o.pages[q]})});if(0===m.length){return}o.loading=true;i=c.previewer.query({excludeCustomizedSaved:true});_.extend(i,{"customize-menus-nonce":c.settings.nonce["customize-menus"],wp_customize:"on",item_types:m});j=b.ajax.post("load-available-menu-items-customizer",i);j.done(function(q){var p;_.each(q.items,function(r,s){if(0===r.length){if(0===o.pages[s]){l[s].find(".accordion-section-title").addClass("cannot-expand").removeClass("loading").find(".accordion-section-title > button").prop("tabIndex",-1)}o.pages[s]=-1;return}else{if(("post_type:page"===s)&&(!l[s].hasClass("open"))){l[s].find(".accordion-section-title > button").click()}}r=new c.Menus.AvailableItemCollection(r);o.collection.add(r.models);p=l[s].find(".available-menu-items-list");r.each(function(t){p.append(n(t.attributes))});o.pages[s]+=1})});j.fail(function(p){if(typeof console!=="undefined"&&console.error){console.error(p)}});j.always(function(){_.each(l,function(p){p.find(".accordion-section-title").removeClass("loading")});o.loading=false})},itemSectionHeight:function(){var k,g,h,j,i;h=window.innerHeight;k=this.$el.find(".accordion-section:not( #available-menu-items-search ) .accordion-section-content");g=this.$el.find('.accordion-section:not( #available-menu-items-search ) .available-menu-items-list:not(":only-child")');j=46*(1+k.length)+14;i=h-j;if(120<i&&290>i){k.css("max-height",i);g.css("max-height",(i-60))}},select:function(g){this.selected=d(g);this.selected.siblings(".menu-item-tpl").removeClass("selected");this.selected.addClass("selected")},focus:function(g){this.select(d(g.currentTarget))},_submit:function(g){if("keypress"===g.type&&(13!==g.which&&32!==g.which)){return}this.submit(d(g.currentTarget))},submit:function(i){var h,g;if(!i){i=this.selected}if(!i||!this.currentMenuControl){return}this.select(i);h=d(this.selected).data("menu-item-id");g=this.collection.findWhere({id:h});if(!g){return}this.currentMenuControl.addItemToMenu(g.attributes);d(i).find(".menu-item-handle").addClass("item-added")},_submitLink:function(g){if("keypress"===g.type&&13!==g.which){return}this.submitLink()},submitLink:function(){var g,h=d("#custom-menu-item-name"),i=d("#custom-menu-item-url");if(!this.currentMenuControl){return}if(""===h.val()){h.addClass("invalid");return}else{if(""===i.val()||"http://"===i.val()){i.addClass("invalid");return}}g={title:h.val(),url:i.val(),type:"custom",type_label:c.Menus.data.l10n.custom_label,object:"custom"};this.currentMenuControl.addItemToMenu(g);i.val("http://");h.val("")},_submitNew:function(h){var g;if("keypress"===h.type&&13!==h.which){return}if(this.addingNew){return}g=d(h.target).closest(".accordion-section");this.submitNew(g)},submitNew:function(h){var g=this,o=h.find(".create-item-input"),l=o.val(),m=h.find(".available-menu-items-list"),j=m.data("type"),k=m.data("object"),i=m.data("type_label"),n;if(!this.currentMenuControl){return}if("post_type"!==j){return}if(""===d.trim(o.val())){o.addClass("invalid");o.focus();return}else{o.removeClass("invalid");h.find(".accordion-section-title").addClass("loading")}g.addingNew=true;o.attr("disabled","disabled");n=c.Menus.insertAutoDraftPost({post_title:l,post_type:k});n.done(function(s){var r,p,q;r=new c.Menus.AvailableItemModel({id:"post-"+s.post_id,title:o.val(),type:j,type_label:i,object:k,object_id:s.post_id,url:s.url});g.currentMenuControl.addItemToMenu(r.attributes);c.Menus.availableMenuItemsPanel.collection.add(r);p=h.find(".available-menu-items-list");q=d(b.template("available-menu-item")(r.attributes));q.find(".menu-item-handle:first").addClass("item-added");p.prepend(q);p.scrollTop();o.val("").removeAttr("disabled");g.addingNew=false;h.find(".accordion-section-title").removeClass("loading")})},open:function(g){this.currentMenuControl=g;this.itemSectionHeight();d("body").addClass("adding-menu-items");_(this.currentMenuControl.getMenuItemControls()).each(function(h){h.collapseForm()});this.$el.find(".selected").removeClass("selected");this.$search.focus()},close:function(g){g=g||{};if(g.returnFocus&&this.currentMenuControl){this.currentMenuControl.container.find(".add-new-menu-item").focus()}this.currentMenuControl=null;this.selected=null;d("body").removeClass("adding-menu-items");d("#available-menu-items .menu-item-handle.item-added").removeClass("item-added");this.$search.val("")},keyboardAccessible:function(i){var h=(13===i.which),j=(27===i.which),k=(9===i.which&&i.shiftKey),g=d(i.target).is(this.$search);if(h&&!this.$search.val()){return}if(g&&k){this.currentMenuControl.container.find(".add-new-menu-item").focus();i.preventDefault()}else{if(j){this.close({returnFocus:true})}}}});c.Menus.MenusPanel=c.Panel.extend({attachEvents:function(){c.Panel.prototype.attachEvents.call(this);var g=this,k=g.container.find(".panel-meta"),i=k.find(".customize-help-toggle"),l=k.find(".customize-panel-description"),h=d("#screen-options-wrap"),j=k.find(".customize-screen-options-toggle");j.on("click keydown",function(m){if(c.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();if(l.not(":hidden")){l.slideUp("fast");i.attr("aria-expanded","false")}if("true"===j.attr("aria-expanded")){j.attr("aria-expanded","false");k.removeClass("open");k.removeClass("active-menu-screen-options");h.slideUp("fast")}else{j.attr("aria-expanded","true");k.addClass("open");k.addClass("active-menu-screen-options");h.slideDown("fast")}return false});i.on("click keydown",function(m){if(c.utils.isKeydownButNotEnterEvent(m)){return}m.preventDefault();if("true"===j.attr("aria-expanded")){j.attr("aria-expanded","false");i.attr("aria-expanded","true");k.addClass("open");k.removeClass("active-menu-screen-options");h.slideUp("fast");l.slideDown("fast")}})},ready:function(){var g=this;g.container.find(".hide-column-tog").click(function(){g.saveManageColumnsState()})},saveManageColumnsState:_.debounce(function(){var g=this;if(g._updateHiddenColumnsRequest){g._updateHiddenColumnsRequest.abort()}g._updateHiddenColumnsRequest=b.ajax.post("hidden-columns",{hidden:g.hidden(),screenoptionnonce:d("#screenoptionnonce").val(),page:"nav-menus"});g._updateHiddenColumnsRequest.always(function(){g._updateHiddenColumnsRequest=null})},2000),checked:function(){},unchecked:function(){},hidden:function(){return d(".hide-column-tog").not(":checked").map(function(){var g=this.id;return g.substring(0,g.length-5)}).get().join(",")}});c.Menus.MenuSection=c.Section.extend({initialize:function(i,g){var h=this;c.Section.prototype.initialize.call(h,i,g);h.deferred.initSortables=d.Deferred()},ready:function(){var i=this,h,g;if("undefined"===typeof i.params.menu_id){throw new Error("params.menu_id was not defined")}i.active.validate=function(){if(!c.has(i.id)){return false}return !!c(i.id).get()};i.populateControls();i.navMenuLocationSettings={};i.assignedLocations=new c.Value([]);c.each(function(j,l){var k=l.match(/^nav_menu_locations\[(.+?)]/);if(k){i.navMenuLocationSettings[k[1]]=j;j.bind(function(){i.refreshAssignedLocations()})}});i.assignedLocations.bind(function(j){i.updateAssignedLocationsInSectionTitle(j)});i.refreshAssignedLocations();c.bind("pane-contents-reflowed",function(){if(!i.contentContainer.parent().length){return}i.container.find(".menu-item .menu-item-reorder-nav button").attr({tabindex:"0","aria-hidden":"false"});i.container.find(".menu-item.move-up-disabled .menus-move-up").attr({tabindex:"-1","aria-hidden":"true"});i.container.find(".menu-item.move-down-disabled .menus-move-down").attr({tabindex:"-1","aria-hidden":"true"});i.container.find(".menu-item.move-left-disabled .menus-move-left").attr({tabindex:"-1","aria-hidden":"true"});i.container.find(".menu-item.move-right-disabled .menus-move-right").attr({tabindex:"-1","aria-hidden":"true"})});g=function(){var j="field-"+d(this).val()+"-active";i.contentContainer.toggleClass(j,d(this).prop("checked"))};h=c.panel("nav_menus").contentContainer.find(".metabox-prefs:first").find(".hide-column-tog");h.each(g);h.on("click",g)},populateControls:function(){var l=this,j,k,h,i,g;j=l.id+"[name]";i=c.control(j);if(!i){i=new c.controlConstructor.nav_menu_name(j,{params:{type:"nav_menu_name",content:'<li id="customize-control-'+l.id.replace("[","-").replace("]","")+'-name" class="customize-control customize-control-nav_menu_name"></li>',label:c.Menus.data.l10n.menuNameLabel,active:true,section:l.id,priority:0,settings:{"default":l.id}}});c.control.add(i.id,i);i.active.set(true)}h=c.control(l.id);if(!h){h=new c.controlConstructor.nav_menu(l.id,{params:{type:"nav_menu",content:'<li id="customize-control-'+l.id.replace("[","-").replace("]","")+'" class="customize-control customize-control-nav_menu"></li>',section:l.id,priority:998,active:true,settings:{"default":l.id},menu_id:l.params.menu_id}});c.control.add(h.id,h);h.active.set(true)}k=l.id+"[auto_add]";g=c.control(k);if(!g){g=new c.controlConstructor.nav_menu_auto_add(k,{params:{type:"nav_menu_auto_add",content:'<li id="customize-control-'+l.id.replace("[","-").replace("]","")+'-auto-add" class="customize-control customize-control-nav_menu_auto_add"></li>',label:"",active:true,section:l.id,priority:999,settings:{"default":l.id}}});c.control.add(g.id,g);g.active.set(true)}},refreshAssignedLocations:function(){var i=this,g=i.params.menu_id,h=[];_.each(i.navMenuLocationSettings,function(k,j){if(k()===g){h.push(j)}});i.assignedLocations.set(h)},updateAssignedLocationsInSectionTitle:function(i){var h=this,g;g=h.container.find(".accordion-section-title:first");g.find(".menu-in-location").remove();_.each(i,function(k){var j,l;j=d('<span class="menu-in-location"></span>');l=c.Menus.data.locationSlugMappedToName[k];j.text(c.Menus.data.l10n.menuLocation.replace("%s",l));g.append(j)});h.container.toggleClass("assigned-to-menu-location",0!==i.length)},onChangeExpanded:function(g,h){var j=this,i;if(g){wpNavMenu.menuList=j.contentContainer;wpNavMenu.targetList=wpNavMenu.menuList;d("#menu-to-edit").removeAttr("id");wpNavMenu.menuList.attr("id","menu-to-edit").addClass("menu");_.each(c.section(j.id).controls(),function(k){if("nav_menu_item"===k.params.type){k.actuallyEmbed()}});if(h.completeCallback){i=h.completeCallback}h.completeCallback=function(){if("resolved"!==j.deferred.initSortables.state()){wpNavMenu.initSortables();j.deferred.initSortables.resolve(wpNavMenu.menuList);c.control("nav_menu["+String(j.params.menu_id)+"]").reflowMenuItems()}if(_.isFunction(i)){i()}}}c.Section.prototype.onChangeExpanded.call(j,g,h)}});c.Menus.NewMenuSection=c.Section.extend({attachEvents:function(){var g=this;this.container.on("click",".add-menu-toggle",function(){if(g.expanded()){g.collapse()}else{g.expand()}})},onChangeExpanded:function(g){var k=this,h=k.container.find(".add-menu-toggle"),j=k.contentContainer,i=k.headContainer.closest(".wp-full-overlay-sidebar-content");if(g){h.addClass("open");h.attr("aria-expanded","true");j.slideDown("fast",function(){i.scrollTop(i.height())})}else{h.removeClass("open");h.attr("aria-expanded","false");j.slideUp("fast");j.find(".menu-name-field").removeClass("invalid")}},getContent:function(){return this.container.find("ul:first")}});c.Menus.MenuLocationControl=c.Control.extend({initialize:function(j,g){var i=this,h=j.match(/^nav_menu_locations\[(.+?)]/);i.themeLocation=h[1];c.Control.prototype.initialize.call(i,j,g)},ready:function(){var h=this,g=/^nav_menu\[(-?\d+)]/;h.setting.validate=function(i){if(""===i){return 0}else{return parseInt(i,10)}};h.container.find(".edit-menu").on("click",function(){var i=h.setting();c.section("nav_menu["+i+"]").focus()});h.setting.bind("change",function(){if(0===h.setting()){h.container.find(".edit-menu").addClass("hidden")}else{h.container.find(".edit-menu").removeClass("hidden")}});c.bind("add",function(j){var i,l,k=j.id.match(g);if(!k||false===j()){return}l=k[1];i=new Option(f(j().name),l);h.container.find("select").append(i)});c.bind("remove",function(i){var k,j=i.id.match(g);if(!j){return}k=parseInt(j[1],10);if(h.setting()===k){h.setting.set("")}h.container.find("option[value="+k+"]").remove()});c.bind("change",function(i){var k,j=i.id.match(g);if(!j){return}k=parseInt(j[1],10);if(false===i()){if(h.setting()===k){h.setting.set("")}h.container.find("option[value="+k+"]").remove()}else{h.container.find("option[value="+k+"]").text(f(i().name))}})}});c.Menus.MenuItemControl=c.Control.extend({initialize:function(i,g){var h=this;h.expanded=new c.Value(false);h.expandedArgumentsQueue=[];h.expanded.bind(function(j){var k=h.expandedArgumentsQueue.shift();k=d.extend({},h.defaultExpandedArguments,k);h.onChangeExpanded(j,k)});c.Control.prototype.initialize.call(h,i,g);h.active.validate=function(){var j,k=c.section(h.section());if(k){j=k.active()}else{j=false}return j}},embed:function(){var i=this,g=i.section(),h;if(!g){return}h=c.section(g);if((h&&h.expanded())||c.settings.autofocus.control===i.id){i.actuallyEmbed()}},actuallyEmbed:function(){var g=this;if("resolved"===g.deferred.embedded.state()){return}g.renderContent();g.deferred.embedded.resolve()},ready:function(){if("undefined"===typeof this.params.menu_item_id){throw new Error("params.menu_item_id was not defined")}this._setupControlToggle();this._setupReorderUI();this._setupUpdateUI();this._setupRemoveUI();this._setupLinksUI();this._setupTitleUI()},_setupControlToggle:function(){var g=this;this.container.find(".menu-item-handle").on("click",function(k){k.preventDefault();k.stopPropagation();var j=g.getMenuControl(),h=d(k.target).is(".item-delete, .item-delete *"),i=d(k.target).is(".add-new-menu-item, .add-new-menu-item *");if(d("body").hasClass("adding-menu-items")&&!h&&!i){c.Menus.availableMenuItemsPanel.close()}if(j.isReordering||j.isSorting){return}g.toggleForm()})},_setupReorderUI:function(){var i=this,h,g;h=b.template("menu-item-reorder-nav");i.container.find(".item-controls").after(h);g=i.container.find(".menu-item-reorder-nav");g.find(".menus-move-up, .menus-move-down, .menus-move-left, .menus-move-right").on("click",function(){var n=d(this);n.focus();var m=n.is(".menus-move-up"),l=n.is(".menus-move-down"),k=n.is(".menus-move-left"),j=n.is(".menus-move-right");if(m){i.moveUp()}else{if(l){i.moveDown()}else{if(k){i.moveLeft()}else{if(j){i.moveRight()}}}}n.focus()})},_setupUpdateUI:function(){var h=this,g=h.setting();h.elements={};h.elements.url=new c.Element(h.container.find(".edit-menu-item-url"));h.elements.title=new c.Element(h.container.find(".edit-menu-item-title"));h.elements.attr_title=new c.Element(h.container.find(".edit-menu-item-attr-title"));h.elements.target=new c.Element(h.container.find(".edit-menu-item-target"));h.elements.classes=new c.Element(h.container.find(".edit-menu-item-classes"));h.elements.xfn=new c.Element(h.container.find(".edit-menu-item-xfn"));h.elements.description=new c.Element(h.container.find(".edit-menu-item-description"));_.each(h.elements,function(i,j){i.bind(function(k){if(i.element.is("input[type=checkbox]")){k=(k)?i.element.val():""}var l=h.setting();if(l&&l[j]!==k){l=_.clone(l);l[j]=k;h.setting.set(l)}});if(g){if((j==="classes"||j==="xfn")&&_.isArray(g[j])){i.set(g[j].join(" "))}else{i.set(g[j])}}});h.setting.bind(function(n,m){var l=h.params.menu_item_id,k=[],j=[],i;if(false===n){i=c.control("nav_menu["+String(m.nav_menu_term_id)+"]");h.container.remove();_.each(i.getMenuItemControls(),function(o){if(m.menu_item_parent===o.setting().menu_item_parent&&o.setting().position>m.position){k.push(o)}else{if(o.setting().menu_item_parent===l){j.push(o)}}});_.each(k,function(p){var o=_.clone(p.setting());o.position+=j.length;p.setting.set(o)});_.each(j,function(p,o){var q=_.clone(p.setting());q.position=m.position+o;q.menu_item_parent=m.menu_item_parent;p.setting.set(q)});i.debouncedReflowMenuItems()}else{_.each(n,function(p,o){if(h.elements[o]){h.elements[o].set(n[o])}});h.container.find(".menu-item-data-parent-id").val(n.menu_item_parent);if(n.position!==m.position||n.menu_item_parent!==m.menu_item_parent){h.getMenuControl().debouncedReflowMenuItems()}}})},_setupRemoveUI:function(){var h=this,g;g=h.container.find(".item-delete");g.on("click",function(){var k=true,l,i,j;if(!d("body").hasClass("adding-menu-items")){k=false}i=h.container.nextAll(".customize-control-nav_menu_item:visible").first();j=h.container.prevAll(".customize-control-nav_menu_item:visible").first();if(i.length){l=i.find(false===k?".item-edit":".item-delete").first()}else{if(j.length){l=j.find(false===k?".item-edit":".item-delete").first()}else{l=h.container.nextAll(".customize-control-nav_menu").find(".add-new-menu-item").first()}}h.container.slideUp(function(){h.setting.set(false);b.a11y.speak(c.Menus.data.l10n.itemDeleted);l.focus()})})},_setupLinksUI:function(){var g;g=this.container.find("a.original-link");g.on("click",function(h){h.preventDefault();c.previewer.previewUrl(h.target.toString())})},_setupTitleUI:function(){var h=this,g;h.container.find(".edit-menu-item-title").on("blur",function(){d(this).val(d.trim(d(this).val()))});g=h.container.find(".menu-item-title");h.setting.bind(function(k){var j,i;if(!k){return}j=d.trim(k.title);i=j||k.original_title||c.Menus.data.l10n.untitled;if(k._invalid){i=c.Menus.data.l10n.invalidTitleTpl.replace("%s",i)}if(j||k.original_title){g.text(i).removeClass("no-title")}else{g.text(i).addClass("no-title")}})},getDepth:function(){var h=this,g=h.setting(),i=0;if(!g){return 0}while(g&&g.menu_item_parent){i+=1;h=c.control("nav_menu_item["+g.menu_item_parent+"]");if(!h){break}g=h.setting()}return i},renderContent:function(){var h=this,g=h.setting(),i;h.params.title=g.title||"";h.params.depth=h.getDepth();h.container.data("item-depth",h.params.depth);i=["menu-item","menu-item-depth-"+String(h.params.depth),"menu-item-"+g.object,"menu-item-edit-inactive"];if(g._invalid){i.push("menu-item-invalid");h.params.title=c.Menus.data.l10n.invalidTitleTpl.replace("%s",h.params.title)}else{if("draft"===g.status){i.push("pending");h.params.title=c.Menus.data.pendingTitleTpl.replace("%s",h.params.title)}}h.params.el_classes=i.join(" ");h.params.item_type_label=g.type_label;h.params.item_type=g.type;h.params.url=g.url;h.params.target=g.target;h.params.attr_title=g.attr_title;h.params.classes=_.isArray(g.classes)?g.classes.join(" "):g.classes;h.params.attr_title=g.attr_title;h.params.xfn=g.xfn;h.params.description=g.description;h.params.parent=g.menu_item_parent;h.params.original_title=g.original_title||"";h.container.addClass(h.params.el_classes);c.Control.prototype.renderContent.call(h)},getMenuControl:function(){var h=this,g=h.setting();if(g&&g.nav_menu_term_id){return c.control("nav_menu["+g.nav_menu_term_id+"]")}else{return null}},expandControlSection:function(){var g=this.container.closest(".accordion-section");if(!g.hasClass("open")){g.find(".accordion-section-title:first").trigger("click")}},_toggleExpanded:c.Section.prototype._toggleExpanded,expand:c.Section.prototype.expand,expandForm:function(g){this.expand(g)},collapse:c.Section.prototype.collapse,collapseForm:function(g){this.collapse(g)},toggleForm:function(g,h){if(typeof g==="undefined"){g=!this.expanded()}if(g){this.expand(h)}else{this.collapse(h)}},onChangeExpanded:function(h,l){var i=this,k,j,g;k=this.container;j=k.find(".menu-item-settings:first");if("undefined"===typeof h){h=!j.is(":visible")}if(j.is(":visible")===h){if(l&&l.completeCallback){l.completeCallback()}return}if(h){c.control.each(function(m){if(i.params.type===m.params.type&&i!==m){m.collapseForm()}});g=function(){k.removeClass("menu-item-edit-inactive").addClass("menu-item-edit-active");i.container.trigger("expanded");if(l&&l.completeCallback){l.completeCallback()}};k.find(".item-edit").attr("aria-expanded","true");j.slideDown("fast",g);i.container.trigger("expand")}else{g=function(){k.addClass("menu-item-edit-inactive").removeClass("menu-item-edit-active");i.container.trigger("collapsed");if(l&&l.completeCallback){l.completeCallback()}};i.container.trigger("collapse");k.find(".item-edit").attr("aria-expanded","false");j.slideUp("fast",g)}},focus:function(j){j=j||{};var i=this,h=j.completeCallback,g;g=function(){i.expandControlSection();j.completeCallback=function(){var k;k=i.container.find(".menu-item-settings").find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible");k.first().focus();if(h){h()}};i.expandForm(j)};if(c.section.has(i.section())){c.section(i.section()).expand({completeCallback:g})}else{g()}},moveUp:function(){this._changePosition(-1);b.a11y.speak(c.Menus.data.l10n.movedUp)},moveDown:function(){this._changePosition(1);b.a11y.speak(c.Menus.data.l10n.movedDown)},moveLeft:function(){this._changeDepth(-1);b.a11y.speak(c.Menus.data.l10n.movedLeft)},moveRight:function(){this._changeDepth(1);b.a11y.speak(c.Menus.data.l10n.movedRight)},_changePosition:function(l){var k=this,g,j=_.clone(k.setting()),h=[],i;if(1!==l&&-1!==l){throw new Error("Offset changes by 1 are only supported.")}if(!k.setting()){return}_(k.getMenuControl().getMenuItemControls()).each(function(m){if(m.setting().menu_item_parent===j.menu_item_parent){h.push(m.setting)}});h.sort(function(n,m){return n().position-m().position});i=_.indexOf(h,k.setting);if(-1===i){throw new Error("Expected setting to be among siblings.")}if((i===0&&l<0)||(i===h.length-1&&l>0)){return}g=h[i+l];if(g){g.set(d.extend(_.clone(g()),{position:j.position}))}j.position+=l;k.setting.set(j)},_changeDepth:function(m){if(1!==m&&-1!==m){throw new Error("Offset changes by 1 are only supported.")}var l=this,k=_.clone(l.setting()),g=[],j,i,h;_(l.getMenuControl().getMenuItemControls()).each(function(n){if(n.setting().menu_item_parent===k.menu_item_parent){g.push(n)}});g.sort(function(o,n){return o.setting().position-n.setting().position});j=_.indexOf(g,l);if(-1===j){throw new Error("Expected control to be among siblings.")}if(-1===m){if(!k.menu_item_parent){return}h=c.control("nav_menu_item["+k.menu_item_parent+"]");_(g).chain().slice(j).each(function(o,n){o.setting.set(d.extend({},o.setting(),{menu_item_parent:l.params.menu_item_id,position:n}))});_(l.getMenuControl().getMenuItemControls()).each(function(o){var n,p;p=(o.setting().menu_item_parent===h.setting().menu_item_parent&&o.setting().position>h.setting().position);if(p){n=_.clone(o.setting());o.setting.set(d.extend(n,{position:n.position+1}))}});k.position=h.setting().position+1;k.menu_item_parent=h.setting().menu_item_parent;l.setting.set(k)}else{if(1===m){if(j===0){return}i=g[j-1];k.menu_item_parent=i.params.menu_item_id;k.position=0;_(l.getMenuControl().getMenuItemControls()).each(function(n){if(n.setting().menu_item_parent===k.menu_item_parent){k.position=Math.max(k.position,n.setting().position)}});k.position+=1;l.setting.set(k)}}}});c.Menus.MenuNameControl=c.Control.extend({ready:function(){var h=this,g=h.setting();h.active.validate=function(){var i,j=c.section(h.section());if(j){i=j.active()}else{i=false}return i};h.nameElement=new c.Element(h.container.find(".menu-name-field"));h.nameElement.bind(function(i){var j=h.setting();if(j&&j.name!==i){j=_.clone(j);j.name=i;h.setting.set(j)}});if(g){h.nameElement.set(g.name)}h.setting.bind(function(i){if(i){h.nameElement.set(i.name)}})}});c.Menus.MenuAutoAddControl=c.Control.extend({ready:function(){var h=this,g=h.setting();h.active.validate=function(){var i,j=c.section(h.section());if(j){i=j.active()}else{i=false}return i};h.autoAddElement=new c.Element(h.container.find("input[type=checkbox].auto_add"));h.autoAddElement.bind(function(i){var j=h.setting();if(j&&j.name!==i){j=_.clone(j);j.auto_add=i;h.setting.set(j)}});if(g){h.autoAddElement.set(g.auto_add)}h.setting.bind(function(i){if(i){h.autoAddElement.set(i.auto_add)}})}});c.Menus.MenuControl=c.Control.extend({ready:function(){var k=this,j=c.section(k.section()),m=k.params.menu_id,l=k.setting(),h,i,g;if("undefined"===typeof this.params.menu_id){throw new Error("params.menu_id was not defined")}k.active.validate=function(){var n;if(j){n=j.active()}else{n=false}return n};k.$controlSection=j.headContainer;k.$sectionContent=k.container.closest(".accordion-section-content");this._setupModel();c.section(k.section(),function(n){n.deferred.initSortables.done(function(o){k._setupSortable(o)})});this._setupAddition();this._setupLocations();this._setupTitle();if(l){h=f(l.name);c.control.each(function(n){if(!n.extended(c.controlConstructor.widget_form)||"nav_menu"!==n.params.widget_id_base){return}n.container.find(".nav-menu-widget-form-controls:first").show();n.container.find(".nav-menu-widget-no-menus-message:first").hide();g=n.container.find("select");if(0===g.find("option[value="+String(m)+"]").length){g.append(new Option(h,m))}});i=d("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");i.find(".nav-menu-widget-form-controls:first").show();i.find(".nav-menu-widget-no-menus-message:first").hide();g=i.find(".widget-inside select:first");if(0===g.find("option[value="+String(m)+"]").length){g.append(new Option(h,m))}}},_setupModel:function(){var g=this,h=g.params.menu_id;g.setting.bind(function(j){var i;if(false===j){g._handleDeletion()}else{i=f(j.name);c.control.each(function(l){if(!l.extended(c.controlConstructor.widget_form)||"nav_menu"!==l.params.widget_id_base){return}var k=l.container.find("select");k.find("option[value="+String(h)+"]").text(i)})}});g.container.find(".menu-delete-item").on("click",function(i){i.stopPropagation();i.preventDefault();g.setting.set(false)})},_setupSortable:function(g){var h=this;if(!g.is(h.$sectionContent)){throw new Error("Unexpected menuList.")}g.on("sortstart",function(){h.isSorting=true});g.on("sortstop",function(){setTimeout(function(){var l=h.$sectionContent.sortable("toArray"),k=[],i=0,j=10;h.isSorting=false;h.$sectionContent.scrollLeft(0);_.each(l,function(m){var p,n,o;o=m.match(/^customize-control-nav_menu_item-(-?\d+)$/,"");if(!o){return}p=parseInt(o[1],10);n=c.control("nav_menu_item["+String(p)+"]");if(n){k.push(n)}});_.each(k,function(m){if(false===m.setting()){return}var n=_.clone(m.setting());i+=1;j+=1;n.position=i;m.priority(j);n.menu_item_parent=parseInt(m.container.find(".menu-item-data-parent-id").val(),10);if(!n.menu_item_parent){n.menu_item_parent=0}m.setting.set(n)})})});h.isReordering=false;this.container.find(".reorder-toggle").on("click",function(){h.toggleReordering(!h.isReordering)})},_setupAddition:function(){var g=this;this.container.find(".add-new-menu-item").on("click",function(h){if(g.$sectionContent.hasClass("reordering")){return}if(!d("body").hasClass("adding-menu-items")){d(this).attr("aria-expanded","true");c.Menus.availableMenuItemsPanel.open(g)}else{d(this).attr("aria-expanded","false");c.Menus.availableMenuItemsPanel.close();h.stopPropagation()}})},_handleDeletion:function(){var j=this,i,l=j.params.menu_id,g,h,k=0;i=c.section(j.section());g=function(){i.container.remove();c.section.remove(i.id)};if(i&&i.expanded()){i.collapse({completeCallback:function(){g();b.a11y.speak(c.Menus.data.l10n.menuDeleted);c.panel("nav_menus").focus()}})}else{g()}c.each(function(m){if(/^nav_menu\[/.test(m.id)&&false!==m()){k+=1}});c.control.each(function(n){if(!n.extended(c.controlConstructor.widget_form)||"nav_menu"!==n.params.widget_id_base){return}var m=n.container.find("select");if(m.val()===String(l)){m.prop("selectedIndex",0).trigger("change")}n.container.find(".nav-menu-widget-form-controls:first").toggle(0!==k);n.container.find(".nav-menu-widget-no-menus-message:first").toggle(0===k);n.container.find("option[value="+String(l)+"]").remove()});h=d("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");h.find(".nav-menu-widget-form-controls:first").toggle(0!==k);h.find(".nav-menu-widget-no-menus-message:first").toggle(0===k);h.find("option[value="+String(l)+"]").remove()},_setupLocations:function(){var g=this;g.container.find(".assigned-menu-location").each(function(){var h=d(this),l=h.find("input[type=checkbox]"),j,i,k=c("nav_menu_locations["+l.data("location-id")+"]");i=function(n){var m=c("nav_menu["+String(n)+"]");if(!n||!m||!m()){h.find(".theme-location-set").hide()}else{h.find(".theme-location-set").show().find("span").text(f(m().name))}};j=new c.Element(l);j.set(k.get()===g.params.menu_id);l.on("change",function(){k.set(this.checked?g.params.menu_id:0)});k.bind(function(m){j.set(m===g.params.menu_id);i(m)});i(k.get())})},_setupTitle:function(){var g=this;g.setting.bind(function(n){if(!n){return}var m=c.section(g.section()),o=g.params.menu_id,h=m.headContainer.find(".accordion-section-title"),k=m.contentContainer.find(".customize-section-title h3"),i=m.headContainer.find(".menu-in-location"),l=k.find(".customize-action"),j=f(n.name);h.text(j);if(i.length){i.appendTo(h)}k.text(j);if(l.length){l.prependTo(k)}c.control.each(function(p){if(/^nav_menu_locations\[/.test(p.id)){p.container.find("option[value="+o+"]").text(j)}});m.contentContainer.find(".customize-control-checkbox input").each(function(){if(d(this).prop("checked")){d(".current-menu-location-name-"+d(this).data("location-id")).text(j)}})})},toggleReordering:function(g){var i=this.container.find(".add-new-menu-item"),j=this.container.find(".reorder-toggle"),h=this.$sectionContent.find(".item-title");g=Boolean(g);if(g===this.$sectionContent.hasClass("reordering")){return}this.isReordering=g;this.$sectionContent.toggleClass("reordering",g);this.$sectionContent.sortable(this.isReordering?"disable":"enable");if(this.isReordering){i.attr({tabindex:"-1","aria-hidden":"true"});j.attr("aria-label",c.Menus.data.l10n.reorderLabelOff);b.a11y.speak(c.Menus.data.l10n.reorderModeOn);h.attr("aria-hidden","false")}else{i.removeAttr("tabindex aria-hidden");j.attr("aria-label",c.Menus.data.l10n.reorderLabelOn);b.a11y.speak(c.Menus.data.l10n.reorderModeOff);h.attr("aria-hidden","true")}if(g){_(this.getMenuItemControls()).each(function(k){k.collapseForm()})}},getMenuItemControls:function(){var h=this,i=[],g=h.params.menu_id;c.control.each(function(j){if("nav_menu_item"===j.params.type&&j.setting()&&g===j.setting().nav_menu_term_id){i.push(j)}});return i},reflowMenuItems:function(){var h=this,i=h.getMenuItemControls(),g;g=function(k){var l=[],j=k.currentParent;_.each(k.menuItemControls,function(m){if(j===m.setting().menu_item_parent){l.push(m)}});l.sort(function(n,m){return n.setting().position-m.setting().position});_.each(l,function(m){k.currentAbsolutePosition+=1;m.priority.set(k.currentAbsolutePosition);if(!m.container.hasClass("menu-item-depth-"+String(k.currentDepth))){_.each(m.container.prop("className").match(/menu-item-depth-\d+/g),function(n){m.container.removeClass(n)});m.container.addClass("menu-item-depth-"+String(k.currentDepth))}m.container.data("item-depth",k.currentDepth);k.currentDepth+=1;k.currentParent=m.params.menu_item_id;g(k);k.currentDepth-=1;k.currentParent=j});if(l.length){_(l).each(function(m){m.container.removeClass("move-up-disabled move-down-disabled move-left-disabled move-right-disabled");if(0===k.currentDepth){m.container.addClass("move-left-disabled")}else{if(10===k.currentDepth){m.container.addClass("move-right-disabled")}}});l[0].container.addClass("move-up-disabled").addClass("move-right-disabled").toggleClass("move-down-disabled",1===l.length);l[l.length-1].container.addClass("move-down-disabled").toggleClass("move-up-disabled",1===l.length)}};g({menuItemControls:i,currentParent:0,currentDepth:0,currentAbsolutePosition:0});h.container.find(".reorder-toggle").toggle(i.length>1)},debouncedReflowMenuItems:_.debounce(function(){this.reflowMenuItems.apply(this,arguments)},0),addItemToMenu:function(n){var k=this,g,h,o,j,m,i=0,l=10;_.each(k.getMenuItemControls(),function(p){if(false===p.setting()){return}l=Math.max(l,p.priority());if(0===p.setting().menu_item_parent){i=Math.max(i,p.setting().position)}});i+=1;l+=1;n=d.extend({},c.Menus.data.defaultSettingValues.nav_menu_item,n,{nav_menu_term_id:k.params.menu_id,original_title:n.title,position:i});delete n.id;m=c.Menus.generatePlaceholderAutoIncrementId();g="nav_menu_item["+String(m)+"]";h={type:"nav_menu_item",transport:c.Menus.data.settingTransport,previewer:c.previewer};o=c.create(g,g,{},h);o.set(n);j=new c.controlConstructor.nav_menu_item(g,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(m)+'" class="customize-control customize-control-nav_menu_item"></li>',section:k.id,priority:l,active:true,settings:{"default":g},menu_item_id:m},previewer:c.previewer});c.control.add(g,j);o.preview();k.debouncedReflowMenuItems();b.a11y.speak(c.Menus.data.l10n.itemAdded);return j}});c.Menus.NewMenuControl=c.Control.extend({ready:function(){this._bindHandlers()},_bindHandlers:function(){var g=this,h=d("#customize-control-new_menu_name input"),i=d("#create-new-menu-submit");h.on("keydown",function(j){if(13===j.which){g.submit()}});i.on("click",function(j){g.submit();j.stopPropagation();j.preventDefault()})},submit:function(){var m=this,g=m.container.closest(".accordion-section-new-menu"),k=g.find(".menu-name-field").first(),j=k.val(),h,l,i=c.Menus.generatePlaceholderAutoIncrementId();if(!j){k.addClass("invalid");k.focus();return}l="nav_menu["+String(i)+"]";c.create(l,l,{},{type:"nav_menu",transport:c.Menus.data.settingTransport,previewer:c.previewer});c(l).set(d.extend({},c.Menus.data.defaultSettingValues.nav_menu,{name:j}));h=new c.Menus.MenuSection(l,{params:{id:l,panel:"nav_menus",title:f(j),customizeAction:c.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:10,menu_id:i}});c.section.add(l,h);k.val("");k.removeClass("invalid");b.a11y.speak(c.Menus.data.l10n.menuAdded);c.section(l).focus()}});d.extend(c.controlConstructor,{nav_menu_location:c.Menus.MenuLocationControl,nav_menu_item:c.Menus.MenuItemControl,nav_menu:c.Menus.MenuControl,nav_menu_name:c.Menus.MenuNameControl,nav_menu_auto_add:c.Menus.MenuAutoAddControl,new_menu:c.Menus.NewMenuControl});d.extend(c.panelConstructor,{nav_menus:c.Menus.MenusPanel});d.extend(c.sectionConstructor,{nav_menu:c.Menus.MenuSection,new_menu:c.Menus.NewMenuSection});c.bind("ready",function(){c.Menus.availableMenuItemsPanel=new c.Menus.AvailableMenuItemsPanelView({collection:c.Menus.availableMenuItems});c.bind("saved",function(g){if(g.nav_menu_updates||g.nav_menu_item_updates){c.Menus.applySavedData(g)}});c.state("changesetStatus").bind(function(g){if("publish"===g){c("nav_menus_created_posts")._value=[]}});c.previewer.bind("focus-nav-menu-item-control",c.Menus.focusMenuItemControl)});c.Menus.applySavedData=function(h){var g={},i={};_(h.nav_menu_updates).each(function(q){var u,s,k,j,p,v,o,t,l,n,m,r;if("inserted"===q.status){if(!q.previous_term_id){throw new Error("Expected previous_term_id")}if(!q.term_id){throw new Error("Expected term_id")}u="nav_menu["+String(q.previous_term_id)+"]";if(!c.has(u)){throw new Error("Expected setting to exist: "+u)}j=c(u);if(!c.section.has(u)){throw new Error("Expected control to exist: "+u)}t=c.section(u);o=j.get();if(!o){throw new Error("Did not expect setting to be empty (deleted).")}o=d.extend(_.clone(o),q.saved_value);g[q.previous_term_id]=q.term_id;s="nav_menu["+String(q.term_id)+"]";p=c.create(s,s,o,{type:"nav_menu",transport:c.Menus.data.settingTransport,previewer:c.previewer});if(t.expanded()){t.collapse()}l=new c.Menus.MenuSection(s,{params:{id:s,panel:"nav_menus",title:o.name,customizeAction:c.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:t.priority.get(),active:true,menu_id:q.term_id}});c.section.add(s,l);c.control.each(function(y){if(!y.extended(c.controlConstructor.widget_form)||"nav_menu"!==y.params.widget_id_base){return}var w,z,x;w=y.container.find("select");z=w.find("option[value="+String(q.previous_term_id)+"]");x=w.find("option[value="+String(q.term_id)+"]");x.prop("selected",z.prop("selected"));z.remove()});j.callbacks.disable();j.set(false);j.preview();p.preview();j._dirty=false;t.container.remove();c.section.remove(u);r=0;c.each(function(w){if(/^nav_menu\[/.test(w.id)&&false!==w()){r+=1}});m=d("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");m.find(".nav-menu-widget-form-controls:first").toggle(0!==r);m.find(".nav-menu-widget-no-menus-message:first").toggle(0===r);m.find("option[value="+String(q.previous_term_id)+"]").remove();b.customize.control.each(function(w){if(/^nav_menu_locations\[/.test(w.id)){w.container.find("option[value="+String(q.previous_term_id)+"]").remove()}});c.each(function(w){var x=c.state("saved").get();if(/^nav_menu_locations\[/.test(w.id)&&w.get()===q.previous_term_id){w.set(q.term_id);w._dirty=false;c.state("saved").set(x);w.preview()}});if(t.expanded.get()){l.expand()}}else{if("updated"===q.status){k="nav_menu["+String(q.term_id)+"]";if(!c.has(k)){throw new Error("Expected setting to exist: "+k)}v=c(k);if(!_.isEqual(q.saved_value,v.get())){n=c.state("saved").get();v.set(q.saved_value);v._dirty=false;c.state("saved").set(n)}}}});_(h.nav_menu_item_updates).each(function(j){if(j.previous_post_id){i[j.previous_post_id]=j.post_id}});_(h.nav_menu_item_updates).each(function(q){var p,n,l,j,o,m,k;if("inserted"===q.status){if(!q.previous_post_id){throw new Error("Expected previous_post_id")}if(!q.post_id){throw new Error("Expected post_id")}p="nav_menu_item["+String(q.previous_post_id)+"]";if(!c.has(p)){throw new Error("Expected setting to exist: "+p)}l=c(p);if(!c.control.has(p)){throw new Error("Expected control to exist: "+p)}m=c.control(p);o=l.get();if(!o){throw new Error("Did not expect setting to be empty (deleted).")}o=_.clone(o);if(o.menu_item_parent<0){if(!i[o.menu_item_parent]){throw new Error("inserted ID for menu_item_parent not available")}o.menu_item_parent=i[o.menu_item_parent]}if(g[o.nav_menu_term_id]){o.nav_menu_term_id=g[o.nav_menu_term_id]}n="nav_menu_item["+String(q.post_id)+"]";j=c.create(n,n,o,{type:"nav_menu_item",transport:c.Menus.data.settingTransport,previewer:c.previewer});k=new c.controlConstructor.nav_menu_item(n,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(q.post_id)+'" class="customize-control customize-control-nav_menu_item"></li>',menu_id:q.post_id,section:"nav_menu["+String(o.nav_menu_term_id)+"]",priority:m.priority.get(),active:true,settings:{"default":n},menu_item_id:q.post_id},previewer:c.previewer});m.container.remove();c.control.remove(p);c.control.add(n,k);l.callbacks.disable();l.set(false);l.preview();j.preview();l._dirty=false;k.container.toggleClass("menu-item-edit-inactive",m.container.hasClass("menu-item-edit-inactive"))}});_.each(h.widget_nav_menu_updates,function(k,j){var l=c(j);if(l){l._value=k;l.preview()}})};c.Menus.focusMenuItemControl=function(h){var g=c.Menus.getMenuItemControl(h);if(g){g.focus()}};c.Menus.getMenuControl=function(g){return c.control("nav_menu["+g+"]")};c.Menus.getMenuItemControl=function(g){return c.control(a(g))};function a(g){return"nav_menu_item["+g+"]"}function f(g){g=g||"";g=d("<div>").text(g).html();g=d.trim(g);return g||c.Menus.data.l10n.unnamed}})(wp.customize,wp,jQuery);