window.wp=window.wp||{};(function(c){var a,b;a=wp.themes=wp.themes||{};a.data=_wpThemeSettings;b=a.data.l10n;a.isInstall=!!a.data.settings.isInstall;_.extend(a,{model:{},view:{},routes:{},router:{},template:wp.template});a.Model=Backbone.Model.extend({initialize:function(){var d;if(_.indexOf(a.data.installedThemes,this.get("slug"))!==-1){this.set({installed:true})}this.set({id:this.get("slug")||this.get("id")});if(this.has("sections")){d=this.get("sections").description;this.set({description:d})}}});a.view.Appearance=wp.Backbone.View.extend({el:"#wpbody-content .wrap .theme-browser",window:c(window),page:0,initialize:function(d){_.bindAll(this,"scroller");this.SearchView=d.SearchView?d.SearchView:a.view.Search;this.window.bind("scroll",_.throttle(this.scroller,300))},render:function(){this.view=new a.view.Themes({collection:this.collection,parent:this});this.search();this.view.render();this.$el.empty().append(this.view.el).addClass("rendered")},searchContainer:c("#wpbody h1:first"),search:function(){var d,e=this;if(a.data.themes.length===1){return}d=new this.SearchView({collection:e.collection,parent:this});d.render();this.searchContainer.append(c.parseHTML('<label class="screen-reader-text" for="wp-filter-search-input">'+b.search+"</label>")).append(d.el)},scroller:function(){var f=this,e,d;e=this.window.scrollTop()+f.window.height();d=f.$el.offset().top+f.$el.outerHeight(false)-f.window.height();d=Math.round(d*0.9);if(e>d){this.trigger("theme:scroll")}}});a.Collection=Backbone.Collection.extend({model:a.Model,terms:"",doSearch:function(d){if(this.terms===d){return}this.terms=d;if(this.terms.length>0){this.search(this.terms)}if(this.terms===""){this.reset(a.data.themes);c("body").removeClass("no-results")}this.trigger("themes:update")},search:function(g){var e,f,j,d,i,h;this.reset(a.data.themes,{silent:true});g=g.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");g=g.replace(/ /g,")(?=.*");e=new RegExp("^(?=.*"+g+").+","i");f=this.filter(function(k){d=k.get("name").replace(/(<([^>]+)>)/ig,"");i=k.get("description").replace(/(<([^>]+)>)/ig,"");h=k.get("author").replace(/(<([^>]+)>)/ig,"");j=_.union([d,k.get("id"),i,h,k.get("tags")]);if(e.test(k.get("author"))&&g.length>2){k.set("displayAuthor",true)}return e.test(j)});if(f.length===0){this.trigger("query:empty")}else{c("body").removeClass("no-results")}this.reset(f)},paginate:function(d){var e=this;d=d||0;e=_(e.rest(20*d));e=_(e.first(20));return e},count:false,query:function(g){var e=this.queries,d=this,h,i,f;this.currentQuery.request=g;h=_.find(e,function(j){return _.isEqual(j.request,g)});i=_.has(g,"page");if(!i){this.currentQuery.page=1}if(!h&&!i){h=this.apiCall(g).done(function(j){if(j.themes){d.reset(j.themes);f=j.info.results;e.push({themes:j.themes,request:g,total:f})}d.trigger("themes:update");d.trigger("query:success",f);if(j.themes&&j.themes.length===0){d.trigger("query:empty")}}).fail(function(){d.trigger("query:fail")})}else{if(i){return this.apiCall(g,i).done(function(j){d.add(j.themes);d.trigger("query:success");d.loadingThemes=false}).fail(function(){d.trigger("query:fail")})}if(h.themes.length===0){d.trigger("query:empty")}else{c("body").removeClass("no-results")}if(_.isNumber(h.total)){this.count=h.total}this.reset(h.themes);if(!h.total){this.count=this.length}this.trigger("themes:update");this.trigger("query:success",this.count)}},queries:[],currentQuery:{page:1,request:{}},apiCall:function(e,d){return wp.ajax.send("query-themes",{data:{request:_.extend({per_page:100,fields:{description:true,tested:true,requires:true,rating:true,downloaded:true,downloadLink:true,last_updated:true,homepage:true,num_ratings:true}},e)},beforeSend:function(){if(!d){c("body").addClass("loading-content").removeClass("no-results")}}})},loadingThemes:false});a.view.Theme=wp.Backbone.View.extend({className:"theme",state:"grid",html:a.template("theme"),events:{click:a.isInstall?"preview":"expand",keydown:a.isInstall?"preview":"expand",touchend:a.isInstall?"preview":"expand",keyup:"addFocus",touchmove:"preventExpand","click .theme-install":"installTheme","click .update-message":"updateTheme"},touchDrag:false,initialize:function(){this.model.on("change",this.render,this)},render:function(){var d=this.model.toJSON();this.$el.html(this.html(d)).attr({tabindex:0,"aria-describedby":d.id+"-action "+d.id+"-name","data-slug":d.id});this.activeTheme();if(this.model.get("displayAuthor")){this.$el.addClass("display-author")}},activeTheme:function(){if(this.model.get("active")){this.$el.addClass("active")}},addFocus:function(){var d=(c(":focus").hasClass("theme"))?c(":focus"):c(":focus").parents(".theme");c(".theme.focus").removeClass("focus");d.addClass("focus")},expand:function(e){var d=this;e=e||window.event;if(e.type==="keydown"&&(e.which!==13&&e.which!==32)){return}if(this.touchDrag===true){return this.touchDrag=false}if(c(e.target).is(".theme-actions a")){return}if(c(e.target).is(".theme-actions a, .update-message, .button-link, .notice-dismiss")){return}a.focusedTheme=this.$el;this.trigger("theme:expand",d.model.cid)},preventExpand:function(){this.touchDrag=true},preview:function(e){var d=this,g,f;e=e||window.event;if(this.touchDrag===true){return this.touchDrag=false}if(c(e.target).not(".install-theme-preview").parents(".theme-actions").length){return}if(e.type==="keydown"&&(e.which!==13&&e.which!==32)){return}if(e.type==="keydown"&&e.which!==13&&c(":focus").hasClass("button")){return}e.preventDefault();e=e||window.event;a.focusedTheme=this.$el;f=new a.view.Preview({model:this.model});f.render();this.setNavButtonsState();if(this.model.collection.length===1){f.$el.addClass("no-navigation")}else{f.$el.removeClass("no-navigation")}c("div.wrap").append(f.el);this.listenTo(f,"theme:next",function(){g=d.model;if(!_.isUndefined(d.current)){g=d.current}d.current=d.model.collection.at(d.model.collection.indexOf(g)+1);if(_.isUndefined(d.current)){d.options.parent.parent.trigger("theme:end");return d.current=g}f.model=d.current;f.render();this.setNavButtonsState();c(".next-theme").focus()}).listenTo(f,"theme:previous",function(){g=d.model;if(d.model.collection.indexOf(d.current)===0){return}if(!_.isUndefined(d.current)){g=d.current}d.current=d.model.collection.at(d.model.collection.indexOf(g)-1);if(_.isUndefined(d.current)){return}f.model=d.current;f.render();this.setNavButtonsState();c(".previous-theme").focus()});this.listenTo(f,"preview:close",function(){d.current=d.model})},setNavButtonsState:function(){var d=c(".theme-install-overlay"),e=_.isUndefined(this.current)?this.model:this.current;if(0===this.model.collection.indexOf(e)){d.find(".previous-theme").addClass("disabled")}if(_.isUndefined(this.model.collection.at(this.model.collection.indexOf(e)+1))){d.find(".next-theme").addClass("disabled")}},installTheme:function(d){var e=this;d.preventDefault();wp.updates.maybeRequestFilesystemCredentials(d);c(document).on("wp-theme-install-success",function(g,f){if(e.model.get("id")===f.slug){e.model.set({installed:true})}});wp.updates.installTheme({slug:c(d.target).data("slug")})},updateTheme:function(d){var e=this;if(!this.model.get("hasPackage")){return}d.preventDefault();wp.updates.maybeRequestFilesystemCredentials(d);c(document).on("wp-theme-update-success",function(g,f){e.model.off("change",e.render,e);if(e.model.get("id")===f.slug){e.model.set({hasUpdate:false,version:f.newVersion})}e.model.on("change",e.render,e)});wp.updates.updateTheme({slug:c(d.target).parents("div.theme").first().data("slug")})}});a.view.Details=wp.Backbone.View.extend({className:"theme-overlay",events:{click:"collapse","click .delete-theme":"deleteTheme","click .left":"previousTheme","click .right":"nextTheme","click #update-theme":"updateTheme"},html:a.template("theme-single"),render:function(){var d=this.model.toJSON();this.$el.html(this.html(d));this.activeTheme();this.navigation();this.screenshotCheck(this.$el);this.containFocus(this.$el)},activeTheme:function(){this.$el.toggleClass("active",this.model.get("active"))},containFocus:function(d){_.delay(function(){c(".theme-wrap a.button-primary:visible").focus()},100);d.on("keydown.wp-themes",function(g){var e=d.find(".theme-header button:not(.disabled)").first(),f=d.find(".theme-actions a:visible").last();if(9===g.which){if(e[0]===g.target&&g.shiftKey){f.focus();g.preventDefault()}else{if(f[0]===g.target&&!g.shiftKey){e.focus();g.preventDefault()}}}})},collapse:function(f){var e=this,d;f=f||window.event;if(a.data.themes.length===1){return}if(c(f.target).is(".theme-backdrop")||c(f.target).is(".close")||f.keyCode===27){c("body").addClass("closing-overlay");this.$el.fadeOut(130,function(){c("body").removeClass("closing-overlay");e.closeOverlay();d=document.body.scrollTop;a.router.navigate(a.router.baseUrl(""));document.body.scrollTop=d;if(a.focusedTheme){a.focusedTheme.focus()}})}},navigation:function(){if(this.model.cid===this.model.collection.at(0).cid){this.$el.find(".left").addClass("disabled").prop("disabled",true)}if(this.model.cid===this.model.collection.at(this.model.collection.length-1).cid){this.$el.find(".right").addClass("disabled").prop("disabled",true)}},closeOverlay:function(){c("body").removeClass("modal-open");this.remove();this.unbind();this.trigger("theme:collapse")},updateTheme:function(d){var e=this;d.preventDefault();wp.updates.maybeRequestFilesystemCredentials(d);c(document).on("wp-theme-update-success",function(g,f){if(e.model.get("id")===f.slug){e.model.set({hasUpdate:false,version:f.newVersion})}e.render()});wp.updates.updateTheme({slug:c(d.target).data("slug")})},deleteTheme:function(f){var g=this,e=g.model.collection,d=a;f.preventDefault();if(!window.confirm(wp.themes.data.settings.confirmDelete)){return}wp.updates.maybeRequestFilesystemCredentials(f);c(document).one("wp-theme-delete-success",function(i,h){g.$el.find(".close").trigger("click");c('[data-slug="'+h.slug+'"]').css({backgroundColor:"#faafaa"}).fadeOut(350,function(){c(this).remove();d.data.themes=_.without(d.data.themes,_.findWhere(d.data.themes,{id:h.slug}));c(".wp-filter-search").val("");e.doSearch("");e.remove(g.model);e.trigger("themes:update")})});wp.updates.deleteTheme({slug:this.model.get("id")})},nextTheme:function(){var d=this;d.trigger("theme:next",d.model.cid);return false},previousTheme:function(){var d=this;d.trigger("theme:previous",d.model.cid);return false},screenshotCheck:function(d){var f,e;f=d.find(".screenshot img");e=new Image();e.src=f.attr("src");if(e.width&&e.width<=300){d.addClass("small-screenshot")}}});a.view.Preview=a.view.Details.extend({className:"wp-full-overlay expanded",el:".theme-install-overlay",events:{"click .close-full-overlay":"close","click .collapse-sidebar":"collapse","click .devices button":"previewDevice","click .previous-theme":"previousTheme","click .next-theme":"nextTheme",keyup:"keyEvent","click .theme-install":"installTheme"},html:a.template("theme-preview"),render:function(){var d=this,e,g=this.model.toJSON(),f=c(document.body);f.attr("aria-busy","true");this.$el.removeClass("iframe-ready").html(this.html(g));e=this.$el.data("current-preview-device");if(e){d.tooglePreviewDeviceButtons(e)}a.router.navigate(a.router.baseUrl(a.router.themePath+this.model.get("id")),{replace:true});this.$el.fadeIn(200,function(){f.addClass("theme-installer-active full-overlay-active")});this.$el.find("iframe").one("load",function(){d.iframeLoaded()})},iframeLoaded:function(){this.$el.addClass("iframe-ready");c(document.body).attr("aria-busy","false")},close:function(){this.$el.fadeOut(200,function(){c("body").removeClass("theme-installer-active full-overlay-active");if(a.focusedTheme){a.focusedTheme.focus()}}).removeClass("iframe-ready");a.router.navigate(a.router.baseUrl(""));this.trigger("preview:close");this.undelegateEvents();this.unbind();return false},collapse:function(d){var e=c(d.currentTarget);if("true"===e.attr("aria-expanded")){e.attr({"aria-expanded":"false","aria-label":b.expandSidebar})}else{e.attr({"aria-expanded":"true","aria-label":b.collapseSidebar})}this.$el.toggleClass("collapsed").toggleClass("expanded");return false},previewDevice:function(e){var d=c(e.currentTarget).data("device");this.$el.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+d).data("current-preview-device",d);this.tooglePreviewDeviceButtons(d)},tooglePreviewDeviceButtons:function(d){var e=c(".wp-full-overlay-footer .devices");e.find("button").removeClass("active").attr("aria-pressed",false);e.find("button.preview-"+d).addClass("active").attr("aria-pressed",true)},keyEvent:function(d){if(d.keyCode===27){this.undelegateEvents();this.close()}if(d.keyCode===39){_.once(this.nextTheme())}if(d.keyCode===37){this.previousTheme()}},installTheme:function(e){var f=this,d=c(e.target);e.preventDefault();if(d.hasClass("disabled")){return}wp.updates.maybeRequestFilesystemCredentials(e);c(document).on("wp-theme-install-success",function(){f.model.set({installed:true})});wp.updates.installTheme({slug:d.data("slug")})}});a.view.Themes=wp.Backbone.View.extend({className:"themes wp-clearfix",$overlay:c("div.theme-overlay"),index:0,count:c(".wrap .theme-count"),liveThemeCount:0,initialize:function(e){var d=this;this.parent=e.parent;this.setView("grid");d.currentTheme();this.listenTo(d.collection,"themes:update",function(){d.parent.page=0;d.currentTheme();d.render(this)});this.listenTo(d.collection,"query:success",function(f){if(_.isNumber(f)){d.count.text(f);d.announceSearchResults(f)}else{d.count.text(d.collection.length);d.announceSearchResults(d.collection.length)}});this.listenTo(d.collection,"query:empty",function(){c("body").addClass("no-results")});this.listenTo(this.parent,"theme:scroll",function(){d.renderThemes(d.parent.page)});this.listenTo(this.parent,"theme:close",function(){if(d.overlay){d.overlay.closeOverlay()}});c("body").on("keyup",function(f){if(!d.overlay){return}if(c("#request-filesystem-credentials-dialog").is(":visible")){return}if(f.keyCode===39){d.overlay.nextTheme()}if(f.keyCode===37){d.overlay.previousTheme()}if(f.keyCode===27){d.overlay.collapse(f)}})},render:function(){this.$el.empty();if(a.data.themes.length===1){this.singleTheme=new a.view.Details({model:this.collection.models[0]});this.singleTheme.render();this.$el.addClass("single-theme");this.$el.append(this.singleTheme.el)}if(this.options.collection.size()>0){this.renderThemes(this.parent.page)}this.liveThemeCount=this.collection.count?this.collection.count:this.collection.length;this.count.text(this.liveThemeCount);if(!a.isInstall){this.announceSearchResults(this.liveThemeCount)}},renderThemes:function(e){var d=this;d.instance=d.collection.paginate(e);if(d.instance.size()===0){this.parent.trigger("theme:end");return}if(!a.isInstall&&e>=1){c(".add-new-theme").remove()}d.instance.each(function(f){d.theme=new a.view.Theme({model:f,parent:d});d.theme.render();d.$el.append(d.theme.el);d.listenTo(d.theme,"theme:expand",d.expand,d)});if(!a.isInstall&&a.data.settings.canInstall){this.$el.append('<div class="theme add-new-theme"><a href="'+a.data.settings.installURI+'"><div class="theme-screenshot"><span></span></div><h2 class="theme-name">'+b.addNew+"</h2></a></div>")}this.parent.page++},currentTheme:function(){var d=this,e;e=d.collection.findWhere({active:true});if(e){d.collection.remove(e);d.collection.add(e,{at:0})}},setView:function(d){return d},expand:function(g){var d=this,f,e;this.model=d.collection.get(g);a.router.navigate(a.router.baseUrl(a.router.themePath+this.model.id));this.setView("detail");c("body").addClass("modal-open");this.overlay=new a.view.Details({model:d.model});this.overlay.render();if(this.model.get("hasUpdate")){f=c('[data-slug="'+this.model.id+'"]');e=c(this.overlay.el);if(f.find(".updating-message").length){e.find(".notice-warning h3").remove();e.find(".notice-warning").removeClass("notice-large").addClass("updating-message").find("p").text(wp.updates.l10n.updating)}else{if(f.find(".notice-error").length){e.find(".notice-warning").remove()}}}this.$overlay.html(this.overlay.el);this.listenTo(this.overlay,"theme:next",function(){d.next([d.model.cid])}).listenTo(this.overlay,"theme:previous",function(){d.previous([d.model.cid])})},next:function(g){var e=this,f,d;f=e.collection.get(g[0]);d=e.collection.at(e.collection.indexOf(f)+1);if(d!==undefined){this.overlay.closeOverlay();e.theme.trigger("theme:expand",d.cid)}},previous:function(f){var d=this,e,g;e=d.collection.get(f[0]);g=d.collection.at(d.collection.indexOf(e)-1);if(g!==undefined){this.overlay.closeOverlay();d.theme.trigger("theme:expand",g.cid)}},announceSearchResults:function(d){if(0===d){wp.a11y.speak(b.noThemesFound)}else{wp.a11y.speak(b.themesFound.replace("%d",d))}}});a.view.Search=wp.Backbone.View.extend({tagName:"input",className:"wp-filter-search",id:"wp-filter-search-input",searching:false,attributes:{placeholder:b.searchPlaceholder,type:"search","aria-describedby":"live-search-desc"},events:{input:"search",keyup:"search",blur:"pushState"},initialize:function(d){this.parent=d.parent;this.listenTo(this.parent,"theme:close",function(){this.searching=false})},search:function(d){if(d.type==="keyup"&&d.which===27){d.target.value=""}this.doSearch(d)},doSearch:_.debounce(function(e){var d={};this.collection.doSearch(e.target.value);if(this.searching&&e.which!==13){d.replace=true}else{this.searching=true}if(e.target.value){a.router.navigate(a.router.baseUrl(a.router.searchPath+e.target.value),d)}else{a.router.navigate(a.router.baseUrl(""))}},500),pushState:function(e){var d=a.router.baseUrl("");if(e.target.value){d=a.router.baseUrl(a.router.searchPath+e.target.value)}this.searching=false;a.router.navigate(d)}});a.Router=Backbone.Router.extend({routes:{"themes.php?theme=:slug":"theme","themes.php?search=:query":"search","themes.php?s=:query":"search","themes.php":"themes","":"themes"},baseUrl:function(d){return"themes.php"+d},themePath:"?theme=",searchPath:"?search=",search:function(d){c(".wp-filter-search").val(d)},themes:function(){c(".wp-filter-search").val("")},navigate:function(){if(Backbone.history._hasPushState){Backbone.Router.prototype.navigate.apply(this,arguments)}}});a.Run={init:function(){this.themes=new a.Collection(a.data.themes);this.view=new a.view.Appearance({collection:this.themes});this.render()},render:function(){this.view.render();this.routes();Backbone.history.start({root:a.data.settings.adminUrl,pushState:true,hashChange:false})},routes:function(){var d=this;a.router=new a.Router();a.router.on("route:theme",function(e){d.view.view.expand(e)});a.router.on("route:themes",function(){d.themes.doSearch("");d.view.trigger("theme:close")});a.router.on("route:search",function(){c(".wp-filter-search").trigger("keyup")});this.extraRoutes()},extraRoutes:function(){return false}};a.view.InstallerSearch=a.view.Search.extend({events:{input:"search",keyup:"search"},terms:"",search:function(d){if(d.type==="keyup"&&(d.which===9||d.which===16)){return}this.collection=this.options.parent.view.collection;if(d.type==="keyup"&&d.which===27){d.target.value=""}this.doSearch(d.target.value)},doSearch:_.debounce(function(e){var d={};if(this.terms===e){return}this.terms=e;d.search=e;if(e.substring(0,7)==="author:"){d.search="";d.author=e.slice(7)}if(e.substring(0,4)==="tag:"){d.search="";d.tag=[e.slice(4)]}c(".filter-links li > a.current").removeClass("current");c("body").removeClass("show-filters filters-applied show-favorites-form");c(".drawer-toggle").attr("aria-expanded","false");this.collection.query(d);a.router.navigate(a.router.baseUrl(a.router.searchPath+e),{replace:true})},500)});a.view.Installer=a.view.Appearance.extend({el:"#wpbody-content .wrap",events:{"click .filter-links li > a":"onSort","click .theme-filter":"onFilter","click .drawer-toggle":"moreFilters","click .filter-drawer .apply-filters":"applyFilters",'click .filter-group [type="checkbox"]':"addFilter","click .filter-drawer .clear-filters":"clearFilters","click .edit-filters":"backToFilters","click .favorites-form-submit":"saveUsername","keyup #wporg-username-input":"saveUsername"},render:function(){var d=this;this.search();this.uploader();this.collection=new a.Collection();this.listenTo(this,"theme:end",function(){if(d.collection.loadingThemes){return}d.collection.loadingThemes=true;d.collection.currentQuery.page++;_.extend(d.collection.currentQuery.request,{page:d.collection.currentQuery.page});d.collection.query(d.collection.currentQuery.request)});this.listenTo(this.collection,"query:success",function(){c("body").removeClass("loading-content");c(".theme-browser").find("div.error").remove()});this.listenTo(this.collection,"query:fail",function(){c("body").removeClass("loading-content");c(".theme-browser").find("div.error").remove();c(".theme-browser").find("div.themes").before('<div class="error"><p>'+b.error+"</p></div>")});if(this.view){this.view.remove()}this.view=new a.view.Themes({collection:this.collection,parent:this});this.page=0;this.$el.find(".themes").remove();this.view.render();this.$el.find(".theme-browser").append(this.view.el).addClass("rendered")},browse:function(d){this.collection.query({browse:d})},onSort:function(f){var e=c(f.target),d=e.data("sort");f.preventDefault();c("body").removeClass("filters-applied show-filters");c(".drawer-toggle").attr("aria-expanded","false");if(e.hasClass(this.activeClass)){return}this.sort(d);a.router.navigate(a.router.baseUrl(a.router.browsePath+d))},sort:function(d){this.clearSearch();c(".filter-links li > a, .theme-filter").removeClass(this.activeClass);c('[data-sort="'+d+'"]').addClass(this.activeClass);if("favorites"===d){c("body").addClass("show-favorites-form")}else{c("body").removeClass("show-favorites-form")}this.browse(d)},onFilter:function(g){var f,d=c(g.target),e=d.data("filter");if(d.hasClass(this.activeClass)){return}c(".filter-links li > a, .theme-section").removeClass(this.activeClass);d.addClass(this.activeClass);if(!e){return}e=_.union([e,this.filtersChecked()]);f={tag:[e]};this.collection.query(f)},addFilter:function(){this.filtersChecked()},applyFilters:function(h){var e,d=this.filtersChecked(),g={tag:d},f=c(".filtered-by .tags");if(h){h.preventDefault()}if(!d){wp.a11y.speak(b.selectFeatureFilter);return}c("body").addClass("filters-applied");c(".filter-links li > a.current").removeClass("current");f.empty();_.each(d,function(i){e=c('label[for="filter-id-'+i+'"]').text();f.append('<span class="tag">'+e+"</span>")});this.collection.query(g)},saveUsername:function(g){var h=c("#wporg-username-input").val(),d=c("#wporg-username-nonce").val(),f={browse:"favorites",user:h},e=this;if(g){g.preventDefault()}if(g.type==="keyup"&&g.which!==13){return}return wp.ajax.send("save-wporg-username",{data:{_wpnonce:d,username:h},success:function(){e.collection.query(f)}})},filtersChecked:function(){var d=c(".filter-group").find(":checkbox"),e=[];_.each(d.filter(":checked"),function(f){e.push(c(f).prop("value"))});if(e.length===0){c(".filter-drawer .apply-filters").find("span").text("");c(".filter-drawer .clear-filters").hide();c("body").removeClass("filters-applied");return false}c(".filter-drawer .apply-filters").find("span").text(e.length);c(".filter-drawer .clear-filters").css("display","inline-block");return e},activeClass:"current",searchContainer:c(".wp-filter .search-form"),uploader:function(){var d=c(".upload-view-toggle"),e=c(document.body);d.on("click",function(){e.toggleClass("show-upload-view");d.attr("aria-expanded",e.hasClass("show-upload-view"))})},moreFilters:function(d){var e=c("body"),f=c(".drawer-toggle");d.preventDefault();if(e.hasClass("filters-applied")){return this.backToFilters()}this.clearSearch();a.router.navigate(a.router.baseUrl(""));e.toggleClass("show-filters");f.attr("aria-expanded",e.hasClass("show-filters"))},clearFilters:function(f){var e=c(".filter-group").find(":checkbox"),d=this;f.preventDefault();_.each(e.filter(":checked"),function(g){c(g).prop("checked",false);return d.filtersChecked()})},backToFilters:function(d){if(d){d.preventDefault()}c("body").removeClass("filters-applied")},clearSearch:function(){c("#wp-filter-search-input").val("")}});a.InstallerRouter=Backbone.Router.extend({routes:{"theme-install.php?theme=:slug":"preview","theme-install.php?browse=:sort":"sort","theme-install.php?search=:query":"search","theme-install.php":"sort"},baseUrl:function(d){return"theme-install.php"+d},themePath:"?theme=",browsePath:"?browse=",searchPath:"?search=",search:function(d){c(".wp-filter-search").val(d)},navigate:function(){if(Backbone.history._hasPushState){Backbone.Router.prototype.navigate.apply(this,arguments)}}});a.RunInstaller={init:function(){this.view=new a.view.Installer({section:"featured",SearchView:a.view.InstallerSearch});this.render()},render:function(){this.view.render();this.routes();Backbone.history.start({root:a.data.settings.adminUrl,pushState:true,hashChange:false})},routes:function(){var d=this,e={};a.router=new a.InstallerRouter();a.router.on("route:preview",function(f){e.theme=f;d.view.collection.query(e);d.view.collection.once("update",function(){d.view.view.theme.preview()})});a.router.on("route:sort",function(f){if(!f){f="featured"}d.view.sort(f);d.view.trigger("theme:close")});a.router.on("route:search",function(){c(".wp-filter-search").focus().trigger("keyup")});this.extraRoutes()},extraRoutes:function(){return false}};c(document).ready(function(){if(a.isInstall){a.RunInstaller.init()}else{a.Run.init()}c(".broken-themes .delete-theme").on("click",function(){return confirm(_wpThemeSettings.settings.confirmDelete)})})})(jQuery);var tb_position;jQuery(document).ready(function(a){tb_position=function(){var f=a("#TB_window"),e=a(window).width(),d=a(window).height(),c=(1040<e)?1040:e,b=0;if(a("#wpadminbar").length){b=parseInt(a("#wpadminbar").css("height"),10)}if(f.size()){f.width(c-50).height(d-45-b);a("#TB_iframeContent").width(c-50).height(d-75-b);f.css({"margin-left":"-"+parseInt(((c-50)/2),10)+"px"});if(typeof document.body.style.maxWidth!=="undefined"){f.css({top:20+b+"px","margin-top":"0"})}}};a(window).resize(function(){tb_position()})});