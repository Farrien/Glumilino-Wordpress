var tagBox,array_unique_noempty;(function(d){var c=(window.tagsSuggestL10n&&window.tagsSuggestL10n.tagDelimiter)||",";array_unique_noempty=function(a){var b=[];d.each(a,function(h,g){g=d.trim(g);if(g&&d.inArray(g,b)===-1){b.push(g)}});return b};tagBox={clean:function(a){if(","!==c){a=a.replace(new RegExp(c,"g"),",")}a=a.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");if(","!==c){a=a.replace(/,/g,c)}return a},parseTags:function(k){var a=k.id,n=a.split("-check-num-")[1],l=d(k).closest(".tagsdiv"),b=l.find(".the-tags"),m=b.val().split(c),j=[];delete m[n];d.each(m,function(f,e){e=d.trim(e);if(e){j.push(e)}});b.val(this.clean(j.join(c)));this.quickClicks(l);return false},quickClicks:function(j){var a=d(".the-tags",j),i=d(".tagchecklist",j),b=d(j).attr("id"),l,k;if(!a.length){return}k=a.prop("disabled");l=a.val().split(c);i.empty();d.each(l,function(g,e){var f,h;e=d.trim(e);if(!e){return}f=d("<span />").text(e);if(!k){h=d('<button type="button" id="'+b+"-check-num-"+g+'" class="ntdelbutton"><span class="remove-tag-icon" aria-hidden="true"></span><span class="screen-reader-text">'+window.tagsSuggestL10n.removeTerm+" "+f.html()+"</span></button>");h.on("click keypress",function(n){if("click"===n.type||13===n.keyCode||32===n.keyCode){if(13===n.keyCode||32===n.keyCode){d(this).closest(".tagsdiv").find("input.newtag").focus()}tagBox.userAction="remove";tagBox.parseTags(this)}});f.prepend("&nbsp;").prepend(h)}i.append(f)});tagBox.screenReadersMessage()},flushTags:function(m,p,l){var a,n,b,o=d(".the-tags",m),f=d("input.newtag",m);p=p||false;b=p?d(p).text():f.val();if("undefined"==typeof(b)||""===b){return false}a=o.val();n=a?a+c+b:b;n=this.clean(n);n=array_unique_noempty(n.split(c)).join(c);o.val(n);this.quickClicks(m);if(!p){f.val("")}if("undefined"==typeof(l)){f.focus()}return false},get:function(a){var b=a.substr(a.indexOf("-")+1);d.post(ajaxurl,{action:"get-tagcloud",tax:b},function(g,h){if(0===g||"success"!=h){return}g=d('<p id="tagcloud-'+b+'" class="the-tagcloud">'+g+"</p>");d("a",g).click(function(){tagBox.userAction="add";tagBox.flushTags(d("#"+b),this);return false});d("#"+a).after(g)})},userAction:"",screenReadersMessage:function(){var a;switch(this.userAction){case"remove":a=window.tagsSuggestL10n.termRemoved;break;case"add":a=window.tagsSuggestL10n.termAdded;break;default:return}window.wp.a11y.speak(a,"assertive")},init:function(){var a=d("div.ajaxtag");d(".tagsdiv").each(function(){tagBox.quickClicks(this)});d(".tagadd",a).click(function(){tagBox.userAction="add";tagBox.flushTags(d(this).closest(".tagsdiv"))});d("input.newtag",a).keyup(function(b){if(13==b.which){tagBox.userAction="add";tagBox.flushTags(d(this).closest(".tagsdiv"));b.preventDefault();b.stopPropagation()}}).keypress(function(b){if(13==b.which){b.preventDefault();b.stopPropagation()}}).each(function(b,f){d(f).wpTagsSuggest()});d("#post").submit(function(){d("div.tagsdiv").each(function(){tagBox.flushTags(this,false,1)})});d(".tagcloud-link").click(function(){tagBox.get(d(this).attr("id"));d(this).attr("aria-expanded","true").unbind().click(function(){d(this).attr("aria-expanded","false"===d(this).attr("aria-expanded")?"true":"false").siblings(".the-tagcloud").toggle()})})}}}(jQuery));