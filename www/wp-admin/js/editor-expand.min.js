(function(b,c,f){var e=c(b),d=c(document),g=c("#wpadminbar"),a=c("#wpfooter");c(function(){var U=c("#postdivrich"),A=c("#wp-content-wrap"),j=c("#wp-content-editor-tools"),q=c(),I=c(),O=c("#ed_toolbar"),h=c("#content"),p=h[0],D=0,k=c("#post-status-info"),C=c(),w=c(),s=c("#side-sortables"),r=c("#postbox-container-1"),u=c("#post-body"),i=b.wp.editor&&b.wp.editor.fullscreen,R,G=function(){},t=function(){},y=false,l=false,S=false,F=false,x,H=0,K=130,M=56,Q=20,V=300,v=A.hasClass("tmce-active")?"tinymce":"html",N=!!parseInt(b.getUserSetting("hidetb"),10),L={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};var m=b._.throttle(function(){var X=b.scrollX||document.documentElement.scrollLeft;var Y=b.scrollY||document.documentElement.scrollTop;var W=parseInt(p.style.height,10);p.style.height=V+"px";if(p.scrollHeight>V){p.style.height=p.scrollHeight+"px"}if(typeof X!=="undefined"){b.scrollTo(X,Y)}if(p.scrollHeight<W){P()}},300);function T(){var W=p.value.length;if(R&&!R.isHidden()){return}if(!R&&v==="tinymce"){return}if(W<D){m()}else{if(parseInt(p.style.height,10)<p.scrollHeight){p.style.height=Math.ceil(p.scrollHeight)+"px";P()}}D=W}function n(){var W=e.width();L={windowHeight:e.height(),windowWidth:W,adminBarHeight:(W>600?g.outerHeight():0),toolsHeight:j.outerHeight()||0,menuBarHeight:C.outerHeight()||0,visualTopHeight:q.outerHeight()||0,textTopHeight:O.outerHeight()||0,bottomHeight:k.outerHeight()||0,statusBarHeight:w.outerHeight()||0,sideSortablesHeight:s.height()||0};if(L.menuBarHeight<3){L.menuBarHeight=0}}d.on("tinymce-editor-init.editor-expand",function(W,Z){var ad=b.tinymce.util.VK,ae=_.debounce(function(){!c(".mce-floatpanel:hover").length&&b.tinymce.ui.FloatPanel.hideAll();c(".mce-tooltip").hide()},1000,true);if(Z.id!=="content"){return}R=Z;Z.settings.autoresize_min_height=V;q=A.find(".mce-toolbar-grp");I=A.find(".mce-edit-area");w=A.find(".mce-statusbar");C=A.find(".mce-menubar");function ac(){var aj=Z.selection.getNode(),ai,ah,ak;if(Z.wp&&Z.wp.getView&&(ah=Z.wp.getView(aj))){ak=ah.getBoundingClientRect()}else{ai=Z.selection.getRng();try{ak=ai.getClientRects()[0]}catch(al){}if(!ak){ak=aj.getBoundingClientRect()}}return ak.height?ak:false}function ag(ai){var ah=ai.keyCode;if(ah<=47&&!(ah===ad.SPACEBAR||ah===ad.ENTER||ah===ad.DELETE||ah===ad.BACKSPACE||ah===ad.UP||ah===ad.LEFT||ah===ad.DOWN||ah===ad.UP)){return}else{if((ah>=91&&ah<=93)||(ah>=112&&ah<=123)||ah===144||ah===145){return}}X(ah)}function X(ak){var an=ac(),ah=50,al,aj,am,ai;if(!an){return}al=an.top+Z.iframeElement.getBoundingClientRect().top;aj=al+an.height;al=al-ah;aj=aj+ah;am=L.adminBarHeight+L.toolsHeight+L.menuBarHeight+L.visualTopHeight;ai=L.windowHeight-(N?L.bottomHeight+L.statusBarHeight:0);if(ai-am<an.height){return}if(al<am&&(ak===ad.UP||ak===ad.LEFT||ak===ad.BACKSPACE)){b.scrollTo(b.pageXOffset,al+b.pageYOffset-am)}else{if(aj>ai){b.scrollTo(b.pageXOffset,aj+b.pageYOffset-ai)}}}function Y(ah){if(!ah.state){P()}}function af(){e.on("scroll.mce-float-panels",ae);setTimeout(function(){Z.execCommand("wpAutoResize");P()},300)}function aa(){e.off("scroll.mce-float-panels");setTimeout(function(){var ah=A.offset().top;if(b.pageYOffset>ah){b.scrollTo(b.pageXOffset,ah-L.adminBarHeight)}T();P()},100);P()}function ab(){N=!N}G=function(){Z.on("keyup",ag);Z.on("show",af);Z.on("hide",aa);Z.on("wp-toolbar-toggle",ab);Z.on("setcontent wp-autoresize wp-toolbar-toggle",P);Z.on("undo redo",X);Z.on("FullscreenStateChanged",Y);e.off("scroll.mce-float-panels").on("scroll.mce-float-panels",ae)};t=function(){Z.off("keyup",ag);Z.off("show",af);Z.off("hide",aa);Z.off("wp-toolbar-toggle",ab);Z.off("setcontent wp-autoresize wp-toolbar-toggle",P);Z.off("undo redo",X);Z.off("FullscreenStateChanged",Y);e.off("scroll.mce-float-panels")};if(U.hasClass("wp-editor-expand")){G();o(P)}});function P(ah){if(i&&i.settings.visible){return}var af=e.scrollTop(),ab=ah&&ah.type,aj=ab!=="scroll",ai=R&&!R.isHidden(),ag=V,Y=u.offset().top,am=1,aa=A.width(),ak,ad,Z,ac,al,W,X,ae,an;if(aj||!L.windowHeight){n()}if(!ai&&ab==="resize"){T()}if(ai){ak=q;ad=I;X=L.visualTopHeight}else{ak=O;ad=h;X=L.textTopHeight}if(!ai&&!ak.length){return}W=ak.parent().offset().top;ae=ad.offset().top;an=ad.outerHeight();al=ai?V+X:V+20;al=an>(al+5);if(!al){if(aj){j.css({position:"absolute",top:0,width:aa});if(ai&&C.length){C.css({position:"absolute",top:0,width:aa-(am*2)})}ak.css({position:"absolute",top:L.menuBarHeight,width:aa-(am*2)-(ai?0:(ak.outerWidth()-ak.width()))});w.attr("style",N?"":"visibility: hidden;");k.attr("style","")}}else{if((!y||aj)&&(af>=(W-L.toolsHeight-L.adminBarHeight)&&af<=(W-L.toolsHeight-L.adminBarHeight+an-ag))){y=true;j.css({position:"fixed",top:L.adminBarHeight,width:aa});if(ai&&C.length){C.css({position:"fixed",top:L.adminBarHeight+L.toolsHeight,width:aa-(am*2)-(ai?0:(ak.outerWidth()-ak.width()))})}ak.css({position:"fixed",top:L.adminBarHeight+L.toolsHeight+L.menuBarHeight,width:aa-(am*2)-(ai?0:(ak.outerWidth()-ak.width()))})}else{if(y||aj){if(af<=(W-L.toolsHeight-L.adminBarHeight)){y=false;j.css({position:"absolute",top:0,width:aa});if(ai&&C.length){C.css({position:"absolute",top:0,width:aa-(am*2)})}ak.css({position:"absolute",top:L.menuBarHeight,width:aa-(am*2)-(ai?0:(ak.outerWidth()-ak.width()))})}else{if(af>=(W-L.toolsHeight-L.adminBarHeight+an-ag)){y=false;j.css({position:"absolute",top:an-ag,width:aa});if(ai&&C.length){C.css({position:"absolute",top:an-ag,width:aa-(am*2)})}ak.css({position:"absolute",top:an-ag+L.menuBarHeight,width:aa-(am*2)-(ai?0:(ak.outerWidth()-ak.width()))})}}}}if((!l||(aj&&N))&&(af+L.windowHeight)<=(ae+an+L.bottomHeight+L.statusBarHeight+am)){if(ah&&ah.deltaHeight>0&&ah.deltaHeight<100){b.scrollBy(0,ah.deltaHeight)}else{if(ai&&N){l=true;w.css({position:"fixed",bottom:L.bottomHeight,visibility:"",width:aa-(am*2)});k.css({position:"fixed",bottom:0,width:aa})}}}else{if((!N&&l)||((l||aj)&&(af+L.windowHeight)>(ae+an+L.bottomHeight+L.statusBarHeight-am))){l=false;w.attr("style",N?"":"visibility: hidden;");k.attr("style","")}}}if(r.width()<300&&L.windowWidth>600&&d.height()>(s.height()+Y+120)&&L.windowHeight<an){if((L.sideSortablesHeight+M+Q)>L.windowHeight||S||F){if(af+M<=Y){s.attr("style","");S=F=false}else{if(af>H){if(S){S=false;Z=s.offset().top-L.adminBarHeight;ac=a.offset().top;if(ac<Z+L.sideSortablesHeight+Q){Z=ac-L.sideSortablesHeight-12}s.css({position:"absolute",top:Z,bottom:""})}else{if(!F&&L.sideSortablesHeight+s.offset().top+Q<af+L.windowHeight){F=true;s.css({position:"fixed",top:"auto",bottom:Q})}}}else{if(af<H){if(F){F=false;Z=s.offset().top-Q;ac=a.offset().top;if(ac<Z+L.sideSortablesHeight+Q){Z=ac-L.sideSortablesHeight-12}s.css({position:"absolute",top:Z,bottom:""})}else{if(!S&&s.offset().top>=af+M){S=true;s.css({position:"fixed",top:M,bottom:""})}}}}}}else{if(af>=(Y-M)){s.css({position:"fixed",top:M})}else{s.attr("style","")}S=F=false}H=af}else{s.attr("style","");S=F=false}if(aj){A.css({paddingTop:L.toolsHeight});if(ai){I.css({paddingTop:L.visualTopHeight+L.menuBarHeight})}else{h.css({marginTop:L.textTopHeight})}}}function E(){T();P()}function o(X){for(var W=1;W<6;W++){setTimeout(X,500*W)}}function z(){clearTimeout(x);x=setTimeout(P,100)}function B(){if(b.pageYOffset&&b.pageYOffset>K){b.scrollTo(b.pageXOffset,0)}U.addClass("wp-editor-expand");e.on("scroll.editor-expand resize.editor-expand",function(W){P(W.type);z()});d.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",P).on("postbox-toggled.editor-expand postbox-moved.editor-expand",function(){if(!S&&!F&&b.pageYOffset>M){F=true;b.scrollBy(0,-1);P();b.scrollBy(0,1)}P()}).on("wp-window-resized.editor-expand",function(){if(R&&!R.isHidden()){R.execCommand("wpAutoResize")}else{T()}});h.on("focus.editor-expand input.editor-expand propertychange.editor-expand",T);G();i&&i.pubsub.subscribe("hidden",E);if(R){R.settings.wp_autoresize_on=true;R.execCommand("wpAutoResizeOn");if(!R.isHidden()){R.execCommand("wpAutoResize")}}if(!R||R.isHidden()){T()}P();d.trigger("editor-expand-on")}function J(){var W=parseInt(b.getUserSetting("ed_size",300),10);if(W<50){W=50}else{if(W>5000){W=5000}}if(b.pageYOffset&&b.pageYOffset>K){b.scrollTo(b.pageXOffset,0)}U.removeClass("wp-editor-expand");e.off(".editor-expand");d.off(".editor-expand");h.off(".editor-expand");t();i&&i.pubsub.unsubscribe("hidden",E);c.each([q,O,j,C,k,w,A,I,h,s],function(Y,X){X&&X.attr("style","")});y=l=S=F=false;if(R){R.settings.wp_autoresize_on=false;R.execCommand("wpAutoResizeOff");if(!R.isHidden()){h.hide();if(W){R.theme.resizeTo(null,W)}}}if(W){h.height(W)}d.trigger("editor-expand-off")}if(U.hasClass("wp-editor-expand")){B();if(A.hasClass("html-active")){o(function(){P();T()})}}c("#adv-settings .editor-expand").show();c("#editor-expand-toggle").on("change.editor-expand",function(){if(c(this).prop("checked")){B();b.setUserSetting("editor_expand","on")}else{J();b.setUserSetting("editor_expand","off")}});b.editorExpand={on:B,off:J}});c(function(){var H=c(document.body),Z=c("#wpcontent"),l=c("#post-body-content"),n=c("#title"),i=c("#content"),L=c(document.createElement("DIV")),G=c("#edit-slug-box"),v=G.find("a").add(G.find("button")).add(G.find("input")),F=c("#adminmenuwrap"),O=c(),o=c(),r=b.getUserSetting("editor_expand","on")==="on",S=r?b.getUserSetting("post_dfw")==="on":false,X=0,W=0,B=20,q,D,t,J,N,M,K,h,j,u,z;H.append(L);L.css({display:"none",position:"fixed",top:g.height(),right:0,bottom:0,left:0,"z-index":9997});l.css({position:"relative"});e.on("mousemove.focus",function(x){K=x.pageY});function Y(){J=l.offset();J.right=J.left+l.outerWidth();J.bottom=J.top+l.outerHeight()}function p(){if(!r){r=true;d.trigger("dfw-activate");i.on("keydown.focus-shortcut",U)}}function k(){if(r){P();r=false;d.trigger("dfw-deactivate");i.off("keydown.focus-shortcut")}}function Q(){return r}function I(){if(!S&&r){S=true;i.on("keydown.focus",T);n.add(i).on("blur.focus",m);T();b.setUserSetting("post_dfw","on");d.trigger("dfw-on")}}function P(){if(S){S=false;n.add(i).off(".focus");C();l.off(".focus");b.setUserSetting("post_dfw","off");d.trigger("dfw-off")}}function E(){if(S){P()}else{I()}}function R(){return S}function T(aa){var y,x=aa&&aa.keyCode;if(b.navigator.platform){y=(b.navigator.platform.indexOf("Mac")>-1)}if(x===27||(x===87&&aa.altKey&&((!y&&aa.shiftKey)||(y&&aa.ctrlKey)))){C(aa);return}if(aa&&(aa.metaKey||(aa.ctrlKey&&!aa.altKey)||(aa.altKey&&aa.shiftKey)||(x&&((x<=47&&x!==8&&x!==13&&x!==32&&x!==46)||(x>=91&&x<=93)||(x>=112&&x<=135)||(x>=144&&x<=150)||x>=224)))){return}if(!q){q=true;clearTimeout(u);u=setTimeout(function(){L.show()},600);l.css("z-index",9998);L.on("mouseenter.focus",function(){Y();e.on("scroll.focus",function(){var ab=b.pageYOffset;if((h&&K&&h!==ab)&&(K<J.top-B||K>J.bottom+B)){C()}h=ab})}).on("mouseleave.focus",function(){N=M=null;X=W=0;e.off("scroll.focus")}).on("mousemove.focus",function(ad){var ab=ad.clientX,af=ad.clientY,ae=b.pageYOffset,ac=b.pageXOffset;if(N&&M&&(ab!==N||af!==M)){if((af<=M&&af<J.top-ae)||(af>=M&&af>J.bottom-ae)||(ab<=N&&ab<J.left-ac)||(ab>=N&&ab>J.right-ac)){X+=Math.abs(N-ab);W+=Math.abs(M-af);if((af<=J.top-B-ae||af>=J.bottom+B-ae||ab<=J.left-B-ac||ab>=J.right+B-ac)&&(X>10||W>10)){C();N=M=null;X=W=0;return}}else{X=W=0}}N=ab;M=af}).on("touchstart.focus",function(ab){ab.preventDefault();C()});l.off("mouseenter.focus");if(j){clearTimeout(j);j=null}H.addClass("focus-on").removeClass("focus-off")}w();s()}function C(x){if(q){q=false;clearTimeout(u);u=setTimeout(function(){L.hide()},200);l.css("z-index","");L.off("mouseenter.focus mouseleave.focus mousemove.focus touchstart.focus");if("undefined"===typeof x){l.on("mouseenter.focus",function(){if(c.contains(l.get(0),document.activeElement)||z){T()}})}j=setTimeout(function(){j=null;l.off("mouseenter.focus")},1000);H.addClass("focus-off").removeClass("focus-on")}V();A()}function m(){setTimeout(function(){var x=document.activeElement.compareDocumentPosition(l.get(0));function y(aa){return c.contains(aa.get(0),document.activeElement)}if((x===2||x===4)&&(y(F)||y(Z)||y(a))){C()}},0)}function w(){if(!D&&q){D=true;g.on("mouseenter.focus",function(){g.addClass("focus-off")}).on("mouseleave.focus",function(){g.removeClass("focus-off")})}}function V(){if(D){D=false;g.off(".focus")}}function s(){if(!t&&q&&!G.find(":focus").length){t=true;G.stop().fadeTo("fast",0.3).on("mouseenter.focus",A).off("mouseleave.focus");v.on("focus.focus",A).off("blur.focus")}}function A(){if(t){t=false;G.stop().fadeTo("fast",1).on("mouseleave.focus",s).off("mouseenter.focus");v.on("blur.focus",s).off("focus.focus")}}function U(x){if(x.altKey&&x.shiftKey&&87===x.keyCode){E()}}if(c("#postdivrich").hasClass("wp-editor-expand")){i.on("keydown.focus-shortcut",U)}d.on("tinymce-editor-setup.focus",function(y,x){x.addButton("dfw",{active:S,classes:"wp-dfw btn widget",disabled:!r,onclick:E,onPostRender:function(){var aa=this;d.on("dfw-activate.focus",function(){aa.disabled(false)}).on("dfw-deactivate.focus",function(){aa.disabled(true)}).on("dfw-on.focus",function(){aa.active(true)}).on("dfw-off.focus",function(){aa.active(false)})},tooltip:"Distraction-free writing mode",shortcut:"Alt+Shift+W"});x.addCommand("wpToggleDFW",E);x.addShortcut("access+w","","wpToggleDFW")});d.on("tinymce-editor-init.focus",function(ab,aa){var ad,y;function x(){z=true}function ac(){z=false}if(aa.id==="content"){O=c(aa.getWin());o=c(aa.getContentAreaContainer()).find("iframe");ad=function(){aa.on("keydown",T);aa.on("blur",m);aa.on("focus",x);aa.on("blur",ac);aa.on("wp-autoresize",Y)};y=function(){aa.off("keydown",T);aa.off("blur",m);aa.off("focus",x);aa.off("blur",ac);aa.off("wp-autoresize",Y)};if(S){ad()}d.on("dfw-on.focus",ad).on("dfw-off.focus",y);aa.on("click",function(ae){if(ae.target===aa.getDoc().documentElement){aa.focus()}})}});d.on("quicktags-init",function(y,x){var aa;if(x.settings.buttons&&(","+x.settings.buttons+",").indexOf(",dfw,")!==-1){aa=c("#"+x.name+"_dfw");c(document).on("dfw-activate",function(){aa.prop("disabled",false)}).on("dfw-deactivate",function(){aa.prop("disabled",true)}).on("dfw-on",function(){aa.addClass("active")}).on("dfw-off",function(){aa.removeClass("active")})}});d.on("editor-expand-on.focus",p).on("editor-expand-off.focus",k);if(S){i.on("keydown.focus",T);n.add(i).on("blur.focus",m)}b.wp=b.wp||{};b.wp.editor=b.wp.editor||{};b.wp.editor.dfw={activate:p,deactivate:k,isActive:Q,on:I,off:P,toggle:E,isOn:R}})})(window,window.jQuery);