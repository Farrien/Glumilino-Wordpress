var postboxes;(function(d){var c=d(document);postboxes={handle_click:function(){var g=d(this),b=g.parent(".postbox"),a=b.attr("id"),h;if("dashboard_browser_nag"===a){return}b.toggleClass("closed");h=!b.hasClass("closed");if(g.hasClass("handlediv")){g.attr("aria-expanded",h)}else{g.closest(".postbox").find("button.handlediv").attr("aria-expanded",h)}if(postboxes.page!=="press-this"){postboxes.save_state(postboxes.page)}if(a){if(!b.hasClass("closed")&&d.isFunction(postboxes.pbshow)){postboxes.pbshow(a)}else{if(b.hasClass("closed")&&d.isFunction(postboxes.pbhide)){postboxes.pbhide(a)}}}c.trigger("postbox-toggled",b)},add_postbox_toggles:function(a,b){var f=d(".postbox .hndle, .postbox .handlediv");this.page=a;this.init(a,b);f.on("click.postboxes",this.handle_click);d(".postbox .hndle a").click(function(e){e.stopPropagation()});d(".postbox a.dismiss").on("click.postboxes",function(e){var h=d(this).parents(".postbox").attr("id")+"-hide";e.preventDefault();d("#"+h).prop("checked",false).triggerHandler("click")});d(".hide-postbox-tog").bind("click.postboxes",function(){var i=d(this),e=i.val(),j=d("#"+e);if(i.prop("checked")){j.show();if(d.isFunction(postboxes.pbshow)){postboxes.pbshow(e)}}else{j.hide();if(d.isFunction(postboxes.pbhide)){postboxes.pbhide(e)}}postboxes.save_state(a);postboxes._mark_area();c.trigger("postbox-toggled",j)});d('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var e=parseInt(d(this).val(),10);if(e){postboxes._pb_edit(e);postboxes.save_order(a)}})},init:function(a,b){var h=d(document.body).hasClass("mobile"),g=d(".postbox .handlediv");d.extend(this,b||{});d("#wpbody-content").css("overflow","hidden");d(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:(h?200:0),distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(e,f){return f.clone().find(":input").attr("name",function(i,l){return"sort_"+parseInt(Math.random()*100000,10).toString()+"_"+l}).end()},opacity:0.65,stop:function(){var e=d(this);if(e.find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id){e.sortable("cancel");return}postboxes.save_order(a)},receive:function(e,f){if("dashboard_browser_nag"==f.item[0].id){d(f.sender).sortable("cancel")}postboxes._mark_area();c.trigger("postbox-moved",f.item)}});if(h){d(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()});this._pb_change()}this._mark_area();g.each(function(){var e=d(this);e.attr("aria-expanded",!e.parent(".postbox").hasClass("closed"))})},save_state:function(a){var f,b;if("nav-menus"===a){return}f=d(".postbox").filter(".closed").map(function(){return this.id}).get().join(",");b=d(".postbox").filter(":hidden").map(function(){return this.id}).get().join(",");d.post(ajaxurl,{action:"closed-postboxes",closed:f,hidden:b,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:a})},save_order:function(b){var f,a=d(".columns-prefs input:checked").val()||0;f={action:"meta-box-order",_ajax_nonce:d("#meta-box-order-nonce").val(),page_columns:a,page:b};d(".meta-box-sortables").each(function(){f["order["+this.id.split("-")[0]+"]"]=d(this).sortable("toArray").join(",")});d.post(ajaxurl,f)},_mark_area:function(){var a=d("div.postbox:visible").length,b=d("#post-body #side-sortables");d("#dashboard-widgets .meta-box-sortables:visible").each(function(){var f=d(this);if(a==1||f.children(".postbox:visible").length){f.removeClass("empty-container")}else{f.addClass("empty-container");f.attr("data-emptyString",postBoxL10n.postBoxEmptyString)}});if(b.length){if(b.children(".postbox:visible").length){b.removeClass("empty-container")}else{if(d("#postbox-container-1").css("width")=="280px"){b.addClass("empty-container")}}}},_pb_edit:function(a){var b=d(".metabox-holder").get(0);if(b){b.className=b.className.replace(/columns-\d+/,"columns-"+a)}d(document).trigger("postboxes-columnchange")},_pb_change:function(){var a=d('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case -90:if(!a.length||!a.is(":checked")){this._pb_edit(2)}break;case 0:case 180:if(d("#poststuff").length){this._pb_edit(1)}else{if(!a.length||!a.is(":checked")){this._pb_edit(2)}}break}},pbshow:false,pbhide:false}}(jQuery));