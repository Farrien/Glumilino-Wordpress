window.wp=window.wp||{};(function(f){var e,d;e=wp.themes=wp.themes||{};e.data=_wpThemeSettings;d=e.data.l10n;e.isInstall=!!e.data.settings.isInstall;_.extend(e,{model:{},view:{},routes:{},router:{},template:wp.template});e.Model=Backbone.Model.extend({initialize:function(){var a;if(_.indexOf(e.data.installedThemes,this.get("slug"))!==-1){this.set({installed:true})}this.set({id:this.get("slug")||this.get("id")});if(this.has("sections")){a=this.get("sections").description;this.set({description:a})}}});e.view.Appearance=wp.Backbone.View.extend({el:"#wpbody-content .wrap .theme-browser",window:f(window),page:0,initialize:function(a){_.bindAll(this,"scroller");this.SearchView=a.SearchView?a.SearchView:e.view.Search;this.window.bind("scroll",_.throttle(this.scroller,300))},render:function(){this.view=new e.view.Themes({collection:this.collection,parent:this});this.search();this.view.render();this.$el.empty().append(this.view.el).addClass("rendered")},searchContainer:f("#wpbody h1:first"),search:function(){var b,a=this;if(e.data.themes.length===1){return}b=new this.SearchView({collection:a.collection,parent:this});b.render();this.searchContainer.append(f.parseHTML('<label class="screen-reader-text" for="wp-filter-search-input">'+d.search+"</label>")).append(b.el)},scroller:function(){var a=this,b,c;b=this.window.scrollTop()+a.window.height();c=a.$el.offset().top+a.$el.outerHeight(false)-a.window.height();c=Math.round(c*0.9);if(b>c){this.trigger("theme:scroll")}}});e.Collection=Backbone.Collection.extend({model:e.Model,terms:"",doSearch:function(a){if(this.terms===a){return}this.terms=a;if(this.terms.length>0){this.search(this.terms)}if(this.terms===""){this.reset(e.data.themes);f("body").removeClass("no-results")}this.trigger("themes:update")},search:function(k){var m,l,a,n,b,c;this.reset(e.data.themes,{silent:true});k=k.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");k=k.replace(/ /g,")(?=.*");m=new RegExp("^(?=.*"+k+").+","i");l=this.filter(function(g){n=g.get("name").replace(/(<([^>]+)>)/ig,"");b=g.get("description").replace(/(<([^>]+)>)/ig,"");c=g.get("author").replace(/(<([^>]+)>)/ig,"");a=_.union([n,g.get("id"),b,c,g.get("tags")]);if(m.test(g.get("author"))&&k.length>2){g.set("displayAuthor",true)}return m.test(a)});if(l.length===0){this.trigger("query:empty")}else{f("body").removeClass("no-results")}this.reset(l)},paginate:function(b){var a=this;b=b||0;a=_(a.rest(20*b));a=_(a.first(20));return a},count:false,query:function(c){var k=this.queries,l=this,b,a,j;this.currentQuery.request=c;b=_.find(k,function(g){return _.isEqual(g.request,c)});a=_.has(c,"page");if(!a){this.currentQuery.page=1}if(!b&&!a){b=this.apiCall(c).done(function(g){if(g.themes){l.reset(g.themes);j=g.info.results;k.push({themes:g.themes,request:c,total:j})}l.trigger("themes:update");l.trigger("query:success",j);if(g.themes&&g.themes.length===0){l.trigger("query:empty")}}).fail(function(){l.trigger("query:fail")})}else{if(a){return this.apiCall(c,a).done(function(g){l.add(g.themes);l.trigger("query:success");l.loadingThemes=false}).fail(function(){l.trigger("query:fail")})}if(b.themes.length===0){l.trigger("query:empty")}else{f("body").removeClass("no-results")}if(_.isNumber(b.total)){this.count=b.total}this.reset(b.themes);if(!b.total){this.count=this.length}this.trigger("themes:update");this.trigger("query:success",this.count)}},queries:[],currentQuery:{page:1,request:{}},apiCall:function(a,b){return wp.ajax.send("query-themes",{data:{request:_.extend({per_page:100,fields:{description:true,tested:true,requires:true,rating:true,downloaded:true,downloadLink:true,last_updated:true,homepage:true,num_ratings:true}},a)},beforeSend:function(){if(!b){f("body").addClass("loading-content").removeClass("no-results")}}})},loadingThemes:false});e.view.Theme=wp.Backbone.View.extend({className:"theme",state:"grid",html:e.template("theme"),events:{click:e.isInstall?"preview":"expand",keydown:e.isInstall?"preview":"expand",touchend:e.isInstall?"preview":"expand",keyup:"addFocus",touchmove:"preventExpand","click .theme-install":"installTheme","click .update-message":"updateTheme"},touchDrag:false,initialize:function(){this.model.on("change",this.render,this)},render:function(){var a=this.model.toJSON();this.$el.html(this.html(a)).attr({tabindex:0,"aria-describedby":a.id+"-action "+a.id+"-name","data-slug":a.id});this.activeTheme();if(this.model.get("displayAuthor")){this.$el.addClass("display-author")}},activeTheme:function(){if(this.model.get("active")){this.$el.addClass("active")}},addFocus:function(){var a=(f(":focus").hasClass("theme"))?f(":focus"):f(":focus").parents(".theme");f(".theme.focus").removeClass("focus");a.addClass("focus")},expand:function(a){var b=this;a=a||window.event;if(a.type==="keydown"&&(a.which!==13&&a.which!==32)){return}if(this.touchDrag===true){return this.touchDrag=false}if(f(a.target).is(".theme-actions a")){return}if(f(a.target).is(".theme-actions a, .update-message, .button-link, .notice-dismiss")){return}e.focusedTheme=this.$el;this.trigger("theme:expand",b.model.cid)},preventExpand:function(){this.touchDrag=true},preview:function(c){var h=this,a,b;c=c||window.event;if(this.touchDrag===true){return this.touchDrag=false}if(f(c.target).not(".install-theme-preview").parents(".theme-actions").length){return}if(c.type==="keydown"&&(c.which!==13&&c.which!==32)){return}if(c.type==="keydown"&&c.which!==13&&f(":focus").hasClass("button")){return}c.preventDefault();c=c||window.event;e.focusedTheme=this.$el;b=new e.view.Preview({model:this.model});b.render();this.setNavButtonsState();if(this.model.collection.length===1){b.$el.addClass("no-navigation")}else{b.$el.removeClass("no-navigation")}f("div.wrap").append(b.el);this.listenTo(b,"theme:next",function(){a=h.model;if(!_.isUndefined(h.current)){a=h.current}h.current=h.model.collection.at(h.model.collection.indexOf(a)+1);if(_.isUndefined(h.current)){h.options.parent.parent.trigger("theme:end");return h.current=a}b.model=h.current;b.render();this.setNavButtonsState();f(".next-theme").focus()}).listenTo(b,"theme:previous",function(){a=h.model;if(h.model.collection.indexOf(h.current)===0){return}if(!_.isUndefined(h.current)){a=h.current}h.current=h.model.collection.at(h.model.collection.indexOf(a)-1);if(_.isUndefined(h.current)){return}b.model=h.current;b.render();this.setNavButtonsState();f(".previous-theme").focus()});this.listenTo(b,"preview:close",function(){h.current=h.model})},setNavButtonsState:function(){var b=f(".theme-install-overlay"),a=_.isUndefined(this.current)?this.model:this.current;if(0===this.model.collection.indexOf(a)){b.find(".previous-theme").addClass("disabled")}if(_.isUndefined(this.model.collection.at(this.model.collection.indexOf(a)+1))){b.find(".next-theme").addClass("disabled")}},installTheme:function(b){var a=this;b.preventDefault();wp.updates.maybeRequestFilesystemCredentials(b);f(document).on("wp-theme-install-success",function(c,h){if(a.model.get("id")===h.slug){a.model.set({installed:true})}});wp.updates.installTheme({slug:f(b.target).data("slug")})},updateTheme:function(b){var a=this;if(!this.model.get("hasPackage")){return}b.preventDefault();wp.updates.maybeRequestFilesystemCredentials(b);f(document).on("wp-theme-update-success",function(c,h){a.model.off("change",a.render,a);if(a.model.get("id")===h.slug){a.model.set({hasUpdate:false,version:h.newVersion})}a.model.on("change",a.render,a)});wp.updates.updateTheme({slug:f(b.target).parents("div.theme").first().data("slug")})}});e.view.Details=wp.Backbone.View.extend({className:"theme-overlay",events:{click:"collapse","click .delete-theme":"deleteTheme","click .left":"previousTheme","click .right":"nextTheme","click #update-theme":"updateTheme"},html:e.template("theme-single"),render:function(){var a=this.model.toJSON();this.$el.html(this.html(a));this.activeTheme();this.navigation();this.screenshotCheck(this.$el);this.containFocus(this.$el)},activeTheme:function(){this.$el.toggleClass("active",this.model.get("active"))},containFocus:function(a){_.delay(function(){f(".theme-wrap a.button-primary:visible").focus()},100);a.on("keydown.wp-themes",function(b){var h=a.find(".theme-header button:not(.disabled)").first(),c=a.find(".theme-actions a:visible").last();if(9===b.which){if(h[0]===b.target&&b.shiftKey){c.focus();b.preventDefault()}else{if(c[0]===b.target&&!b.shiftKey){h.focus();b.preventDefault()}}}})},collapse:function(a){var b=this,c;a=a||window.event;if(e.data.themes.length===1){return}if(f(a.target).is(".theme-backdrop")||f(a.target).is(".close")||a.keyCode===27){f("body").addClass("closing-overlay");this.$el.fadeOut(130,function(){f("body").removeClass("closing-overlay");b.closeOverlay();c=document.body.scrollTop;e.router.navigate(e.router.baseUrl(""));document.body.scrollTop=c;if(e.focusedTheme){e.focusedTheme.focus()}})}},navigation:function(){if(this.model.cid===this.model.collection.at(0).cid){this.$el.find(".left").addClass("disabled").prop("disabled",true)}if(this.model.cid===this.model.collection.at(this.model.collection.length-1).cid){this.$el.find(".right").addClass("disabled").prop("disabled",true)}},closeOverlay:function(){f("body").removeClass("modal-open");this.remove();this.unbind();this.trigger("theme:collapse")},updateTheme:function(b){var a=this;b.preventDefault();wp.updates.maybeRequestFilesystemCredentials(b);f(document).on("wp-theme-update-success",function(c,h){if(a.model.get("id")===h.slug){a.model.set({hasUpdate:false,version:h.newVersion})}a.render()});wp.updates.updateTheme({slug:f(b.target).data("slug")})},deleteTheme:function(b){var a=this,c=a.model.collection,h=e;b.preventDefault();if(!window.confirm(wp.themes.data.settings.confirmDelete)){return}wp.updates.maybeRequestFilesystemCredentials(b);f(document).one("wp-theme-delete-success",function(g,j){a.$el.find(".close").trigger("click");f('[data-slug="'+j.slug+'"]').css({backgroundColor:"#faafaa"}).fadeOut(350,function(){f(this).remove();h.data.themes=_.without(h.data.themes,_.findWhere(h.data.themes,{id:j.slug}));f(".wp-filter-search").val("");c.doSearch("");c.remove(a.model);c.trigger("themes:update")})});wp.updates.deleteTheme({slug:this.model.get("id")})},nextTheme:function(){var a=this;a.trigger("theme:next",a.model.cid);return false},previousTheme:function(){var a=this;a.trigger("theme:previous",a.model.cid);return false},screenshotCheck:function(c){var a,b;a=c.find(".screenshot img");b=new Image();b.src=a.attr("src");if(b.width&&b.width<=300){c.addClass("small-screenshot")}}});e.view.Preview=e.view.Details.extend({className:"wp-full-overlay expanded",el:".theme-install-overlay",events:{"click .close-full-overlay":"close","click .collapse-sidebar":"collapse","click .devices button":"previewDevice","click .previous-theme":"previousTheme","click .next-theme":"nextTheme",keyup:"keyEvent","click .theme-install":"installTheme"},html:e.template("theme-preview"),render:function(){var h=this,c,a=this.model.toJSON(),b=f(document.body);b.attr("aria-busy","true");this.$el.removeClass("iframe-ready").html(this.html(a));c=this.$el.data("current-preview-device");if(c){h.tooglePreviewDeviceButtons(c)}e.router.navigate(e.router.baseUrl(e.router.themePath+this.model.get("id")),{replace:true});this.$el.fadeIn(200,function(){b.addClass("theme-installer-active full-overlay-active")});this.$el.find("iframe").one("load",function(){h.iframeLoaded()})},iframeLoaded:function(){this.$el.addClass("iframe-ready");f(document.body).attr("aria-busy","false")},close:function(){this.$el.fadeOut(200,function(){f("body").removeClass("theme-installer-active full-overlay-active");if(e.focusedTheme){e.focusedTheme.focus()}}).removeClass("iframe-ready");e.router.navigate(e.router.baseUrl(""));this.trigger("preview:close");this.undelegateEvents();this.unbind();return false},collapse:function(b){var a=f(b.currentTarget);if("true"===a.attr("aria-expanded")){a.attr({"aria-expanded":"false","aria-label":d.expandSidebar})}else{a.attr({"aria-expanded":"true","aria-label":d.collapseSidebar})}this.$el.toggleClass("collapsed").toggleClass("expanded");return false},previewDevice:function(a){var b=f(a.currentTarget).data("device");this.$el.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+b).data("current-preview-device",b);this.tooglePreviewDeviceButtons(b)},tooglePreviewDeviceButtons:function(b){var a=f(".wp-full-overlay-footer .devices");a.find("button").removeClass("active").attr("aria-pressed",false);a.find("button.preview-"+b).addClass("active").attr("aria-pressed",true)},keyEvent:function(a){if(a.keyCode===27){this.undelegateEvents();this.close()}if(a.keyCode===39){_.once(this.nextTheme())}if(a.keyCode===37){this.previousTheme()}},installTheme:function(b){var a=this,c=f(b.target);b.preventDefault();if(c.hasClass("disabled")){return}wp.updates.maybeRequestFilesystemCredentials(b);f(document).on("wp-theme-install-success",function(){a.model.set({installed:true})});wp.updates.installTheme({slug:c.data("slug")})}});e.view.Themes=wp.Backbone.View.extend({className:"themes wp-clearfix",$overlay:f("div.theme-overlay"),index:0,count:f(".wrap .theme-count"),liveThemeCount:0,initialize:function(a){var b=this;this.parent=a.parent;this.setView("grid");b.currentTheme();this.listenTo(b.collection,"themes:update",function(){b.parent.page=0;b.currentTheme();b.render(this)});this.listenTo(b.collection,"query:success",function(c){if(_.isNumber(c)){b.count.text(c);b.announceSearchResults(c)}else{b.count.text(b.collection.length);b.announceSearchResults(b.collection.length)}});this.listenTo(b.collection,"query:empty",function(){f("body").addClass("no-results")});this.listenTo(this.parent,"theme:scroll",function(){b.renderThemes(b.parent.page)});this.listenTo(this.parent,"theme:close",function(){if(b.overlay){b.overlay.closeOverlay()}});f("body").on("keyup",function(c){if(!b.overlay){return}if(f("#request-filesystem-credentials-dialog").is(":visible")){return}if(c.keyCode===39){b.overlay.nextTheme()}if(c.keyCode===37){b.overlay.previousTheme()}if(c.keyCode===27){b.overlay.collapse(c)}})},render:function(){this.$el.empty();if(e.data.themes.length===1){this.singleTheme=new e.view.Details({model:this.collection.models[0]});this.singleTheme.render();this.$el.addClass("single-theme");this.$el.append(this.singleTheme.el)}if(this.options.collection.size()>0){this.renderThemes(this.parent.page)}this.liveThemeCount=this.collection.count?this.collection.count:this.collection.length;this.count.text(this.liveThemeCount);if(!e.isInstall){this.announceSearchResults(this.liveThemeCount)}},renderThemes:function(a){var b=this;b.instance=b.collection.paginate(a);if(b.instance.size()===0){this.parent.trigger("theme:end");return}if(!e.isInstall&&a>=1){f(".add-new-theme").remove()}b.instance.each(function(c){b.theme=new e.view.Theme({model:c,parent:b});b.theme.render();b.$el.append(b.theme.el);b.listenTo(b.theme,"theme:expand",b.expand,b)});if(!e.isInstall&&e.data.settings.canInstall){this.$el.append('<div class="theme add-new-theme"><a href="'+e.data.settings.installURI+'"><div class="theme-screenshot"><span></span></div><h2 class="theme-name">'+d.addNew+"</h2></a></div>")}this.parent.page++},currentTheme:function(){var b=this,a;a=b.collection.findWhere({active:true});if(a){b.collection.remove(a);b.collection.add(a,{at:0})}},setView:function(a){return a},expand:function(a){var h=this,b,c;this.model=h.collection.get(a);e.router.navigate(e.router.baseUrl(e.router.themePath+this.model.id));this.setView("detail");f("body").addClass("modal-open");this.overlay=new e.view.Details({model:h.model});this.overlay.render();if(this.model.get("hasUpdate")){b=f('[data-slug="'+this.model.id+'"]');c=f(this.overlay.el);if(b.find(".updating-message").length){c.find(".notice-warning h3").remove();c.find(".notice-warning").removeClass("notice-large").addClass("updating-message").find("p").text(wp.updates.l10n.updating)}else{if(b.find(".notice-error").length){c.find(".notice-warning").remove()}}}this.$overlay.html(this.overlay.el);this.listenTo(this.overlay,"theme:next",function(){h.next([h.model.cid])}).listenTo(this.overlay,"theme:previous",function(){h.previous([h.model.cid])})},next:function(a){var c=this,b,h;b=c.collection.get(a[0]);h=c.collection.at(c.collection.indexOf(b)+1);if(h!==undefined){this.overlay.closeOverlay();c.theme.trigger("theme:expand",h.cid)}},previous:function(b){var h=this,c,a;c=h.collection.get(b[0]);a=h.collection.at(h.collection.indexOf(c)-1);if(a!==undefined){this.overlay.closeOverlay();h.theme.trigger("theme:expand",a.cid)}},announceSearchResults:function(a){if(0===a){wp.a11y.speak(d.noThemesFound)}else{wp.a11y.speak(d.themesFound.replace("%d",a))}}});e.view.Search=wp.Backbone.View.extend({tagName:"input",className:"wp-filter-search",id:"wp-filter-search-input",searching:false,attributes:{placeholder:d.searchPlaceholder,type:"search","aria-describedby":"live-search-desc"},events:{input:"search",keyup:"search",blur:"pushState"},initialize:function(a){this.parent=a.parent;this.listenTo(this.parent,"theme:close",function(){this.searching=false})},search:function(a){if(a.type==="keyup"&&a.which===27){a.target.value=""}this.doSearch(a)},doSearch:_.debounce(function(a){var b={};this.collection.doSearch(a.target.value);if(this.searching&&a.which!==13){b.replace=true}else{this.searching=true}if(a.target.value){e.router.navigate(e.router.baseUrl(e.router.searchPath+a.target.value),b)}else{e.router.navigate(e.router.baseUrl(""))}},500),pushState:function(a){var b=e.router.baseUrl("");if(a.target.value){b=e.router.baseUrl(e.router.searchPath+a.target.value)}this.searching=false;e.router.navigate(b)}});e.Router=Backbone.Router.extend({routes:{"themes.php?theme=:slug":"theme","themes.php?search=:query":"search","themes.php?s=:query":"search","themes.php":"themes","":"themes"},baseUrl:function(a){return"themes.php"+a},themePath:"?theme=",searchPath:"?search=",search:function(a){f(".wp-filter-search").val(a)},themes:function(){f(".wp-filter-search").val("")},navigate:function(){if(Backbone.history._hasPushState){Backbone.Router.prototype.navigate.apply(this,arguments)}}});e.Run={init:function(){this.themes=new e.Collection(e.data.themes);this.view=new e.view.Appearance({collection:this.themes});this.render()},render:function(){this.view.render();this.routes();Backbone.history.start({root:e.data.settings.adminUrl,pushState:true,hashChange:false})},routes:function(){var a=this;e.router=new e.Router();e.router.on("route:theme",function(b){a.view.view.expand(b)});e.router.on("route:themes",function(){a.themes.doSearch("");a.view.trigger("theme:close")});e.router.on("route:search",function(){f(".wp-filter-search").trigger("keyup")});this.extraRoutes()},extraRoutes:function(){return false}};e.view.InstallerSearch=e.view.Search.extend({events:{input:"search",keyup:"search"},terms:"",search:function(a){if(a.type==="keyup"&&(a.which===9||a.which===16)){return}this.collection=this.options.parent.view.collection;if(a.type==="keyup"&&a.which===27){a.target.value=""}this.doSearch(a.target.value)},doSearch:_.debounce(function(a){var b={};if(this.terms===a){return}this.terms=a;b.search=a;if(a.substring(0,7)==="author:"){b.search="";b.author=a.slice(7)}if(a.substring(0,4)==="tag:"){b.search="";b.tag=[a.slice(4)]}f(".filter-links li > a.current").removeClass("current");f("body").removeClass("show-filters filters-applied show-favorites-form");f(".drawer-toggle").attr("aria-expanded","false");this.collection.query(b);e.router.navigate(e.router.baseUrl(e.router.searchPath+a),{replace:true})},500)});e.view.Installer=e.view.Appearance.extend({el:"#wpbody-content .wrap",events:{"click .filter-links li > a":"onSort","click .theme-filter":"onFilter","click .drawer-toggle":"moreFilters","click .filter-drawer .apply-filters":"applyFilters",'click .filter-group [type="checkbox"]':"addFilter","click .filter-drawer .clear-filters":"clearFilters","click .edit-filters":"backToFilters","click .favorites-form-submit":"saveUsername","keyup #wporg-username-input":"saveUsername"},render:function(){var a=this;this.search();this.uploader();this.collection=new e.Collection();this.listenTo(this,"theme:end",function(){if(a.collection.loadingThemes){return}a.collection.loadingThemes=true;a.collection.currentQuery.page++;_.extend(a.collection.currentQuery.request,{page:a.collection.currentQuery.page});a.collection.query(a.collection.currentQuery.request)});this.listenTo(this.collection,"query:success",function(){f("body").removeClass("loading-content");f(".theme-browser").find("div.error").remove()});this.listenTo(this.collection,"query:fail",function(){f("body").removeClass("loading-content");f(".theme-browser").find("div.error").remove();f(".theme-browser").find("div.themes").before('<div class="error"><p>'+d.error+"</p></div>")});if(this.view){this.view.remove()}this.view=new e.view.Themes({collection:this.collection,parent:this});this.page=0;this.$el.find(".themes").remove();this.view.render();this.$el.find(".theme-browser").append(this.view.el).addClass("rendered")},browse:function(a){this.collection.query({browse:a})},onSort:function(a){var b=f(a.target),c=b.data("sort");a.preventDefault();f("body").removeClass("filters-applied show-filters");f(".drawer-toggle").attr("aria-expanded","false");if(b.hasClass(this.activeClass)){return}this.sort(c);e.router.navigate(e.router.baseUrl(e.router.browsePath+c))},sort:function(a){this.clearSearch();f(".filter-links li > a, .theme-filter").removeClass(this.activeClass);f('[data-sort="'+a+'"]').addClass(this.activeClass);if("favorites"===a){f("body").addClass("show-favorites-form")}else{f("body").removeClass("show-favorites-form")}this.browse(a)},onFilter:function(a){var b,h=f(a.target),c=h.data("filter");if(h.hasClass(this.activeClass)){return}f(".filter-links li > a, .theme-section").removeClass(this.activeClass);h.addClass(this.activeClass);if(!c){return}c=_.union([c,this.filtersChecked()]);b={tag:[c]};this.collection.query(b)},addFilter:function(){this.filtersChecked()},applyFilters:function(a){var i,j=this.filtersChecked(),b={tag:j},c=f(".filtered-by .tags");if(a){a.preventDefault()}if(!j){wp.a11y.speak(d.selectFeatureFilter);return}f("body").addClass("filters-applied");f(".filter-links li > a.current").removeClass("current");c.empty();_.each(j,function(g){i=f('label[for="filter-id-'+g+'"]').text();c.append('<span class="tag">'+i+"</span>")});this.collection.query(b)},saveUsername:function(b){var a=f("#wporg-username-input").val(),j=f("#wporg-username-nonce").val(),c={browse:"favorites",user:a},i=this;if(b){b.preventDefault()}if(b.type==="keyup"&&b.which!==13){return}return wp.ajax.send("save-wporg-username",{data:{_wpnonce:j,username:a},success:function(){i.collection.query(c)}})},filtersChecked:function(){var b=f(".filter-group").find(":checkbox"),a=[];_.each(b.filter(":checked"),function(c){a.push(f(c).prop("value"))});if(a.length===0){f(".filter-drawer .apply-filters").find("span").text("");f(".filter-drawer .clear-filters").hide();f("body").removeClass("filters-applied");return false}f(".filter-drawer .apply-filters").find("span").text(a.length);f(".filter-drawer .clear-filters").css("display","inline-block");return a},activeClass:"current",searchContainer:f(".wp-filter .search-form"),uploader:function(){var b=f(".upload-view-toggle"),a=f(document.body);b.on("click",function(){a.toggleClass("show-upload-view");b.attr("aria-expanded",a.hasClass("show-upload-view"))})},moreFilters:function(c){var b=f("body"),a=f(".drawer-toggle");c.preventDefault();if(b.hasClass("filters-applied")){return this.backToFilters()}this.clearSearch();e.router.navigate(e.router.baseUrl(""));b.toggleClass("show-filters");a.attr("aria-expanded",b.hasClass("show-filters"))},clearFilters:function(a){var b=f(".filter-group").find(":checkbox"),c=this;a.preventDefault();_.each(b.filter(":checked"),function(h){f(h).prop("checked",false);return c.filtersChecked()})},backToFilters:function(a){if(a){a.preventDefault()}f("body").removeClass("filters-applied")},clearSearch:function(){f("#wp-filter-search-input").val("")}});e.InstallerRouter=Backbone.Router.extend({routes:{"theme-install.php?theme=:slug":"preview","theme-install.php?browse=:sort":"sort","theme-install.php?search=:query":"search","theme-install.php":"sort"},baseUrl:function(a){return"theme-install.php"+a},themePath:"?theme=",browsePath:"?browse=",searchPath:"?search=",search:function(a){f(".wp-filter-search").val(a)},navigate:function(){if(Backbone.history._hasPushState){Backbone.Router.prototype.navigate.apply(this,arguments)}}});e.RunInstaller={init:function(){this.view=new e.view.Installer({section:"featured",SearchView:e.view.InstallerSearch});this.render()},render:function(){this.view.render();this.routes();Backbone.history.start({root:e.data.settings.adminUrl,pushState:true,hashChange:false})},routes:function(){var b=this,a={};e.router=new e.InstallerRouter();e.router.on("route:preview",function(c){a.theme=c;b.view.collection.query(a);b.view.collection.once("update",function(){b.view.view.theme.preview()})});e.router.on("route:sort",function(c){if(!c){c="featured"}b.view.sort(c);b.view.trigger("theme:close")});e.router.on("route:search",function(){f(".wp-filter-search").focus().trigger("keyup")});this.extraRoutes()},extraRoutes:function(){return false}};f(document).ready(function(){if(e.isInstall){e.RunInstaller.init()}else{e.Run.init()}f(".broken-themes .delete-theme").on("click",function(){return confirm(_wpThemeSettings.settings.confirmDelete)})})})(jQuery);var tb_position;jQuery(document).ready(function(b){tb_position=function(){var g=b("#TB_window"),h=b(window).width(),i=b(window).height(),j=(1040<h)?1040:h,a=0;if(b("#wpadminbar").length){a=parseInt(b("#wpadminbar").css("height"),10)}if(g.size()){g.width(j-50).height(i-45-a);b("#TB_iframeContent").width(j-50).height(i-75-a);g.css({"margin-left":"-"+parseInt(((j-50)/2),10)+"px"});if(typeof document.body.style.maxWidth!=="undefined"){g.css({top:20+a+"px","margin-top":"0"})}}};b(window).resize(function(){tb_position()})});