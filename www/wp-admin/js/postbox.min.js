var postboxes;(function(a){var b=a(document);postboxes={handle_click:function(){var d=a(this),e=d.parent(".postbox"),f=e.attr("id"),c;if("dashboard_browser_nag"===f){return}e.toggleClass("closed");c=!e.hasClass("closed");if(d.hasClass("handlediv")){d.attr("aria-expanded",c)}else{d.closest(".postbox").find("button.handlediv").attr("aria-expanded",c)}if(postboxes.page!=="press-this"){postboxes.save_state(postboxes.page)}if(f){if(!e.hasClass("closed")&&a.isFunction(postboxes.pbshow)){postboxes.pbshow(f)}else{if(e.hasClass("closed")&&a.isFunction(postboxes.pbhide)){postboxes.pbhide(f)}}}b.trigger("postbox-toggled",e)},add_postbox_toggles:function(e,d){var c=a(".postbox .hndle, .postbox .handlediv");this.page=e;this.init(e,d);c.on("click.postboxes",this.handle_click);a(".postbox .hndle a").click(function(f){f.stopPropagation()});a(".postbox a.dismiss").on("click.postboxes",function(g){var f=a(this).parents(".postbox").attr("id")+"-hide";g.preventDefault();a("#"+f).prop("checked",false).triggerHandler("click")});a(".hide-postbox-tog").bind("click.postboxes",function(){var g=a(this),h=g.val(),f=a("#"+h);if(g.prop("checked")){f.show();if(a.isFunction(postboxes.pbshow)){postboxes.pbshow(h)}}else{f.hide();if(a.isFunction(postboxes.pbhide)){postboxes.pbhide(h)}}postboxes.save_state(e);postboxes._mark_area();b.trigger("postbox-toggled",f)});a('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var f=parseInt(a(this).val(),10);if(f){postboxes._pb_edit(f);postboxes.save_order(e)}})},init:function(f,e){var c=a(document.body).hasClass("mobile"),d=a(".postbox .handlediv");a.extend(this,e||{});a("#wpbody-content").css("overflow","hidden");a(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:(c?200:0),distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(h,g){return g.clone().find(":input").attr("name",function(k,j){return"sort_"+parseInt(Math.random()*100000,10).toString()+"_"+j}).end()},opacity:0.65,stop:function(){var g=a(this);if(g.find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id){g.sortable("cancel");return}postboxes.save_order(f)},receive:function(h,g){if("dashboard_browser_nag"==g.item[0].id){a(g.sender).sortable("cancel")}postboxes._mark_area();b.trigger("postbox-moved",g.item)}});if(c){a(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()});this._pb_change()}this._mark_area();d.each(function(){var g=a(this);g.attr("aria-expanded",!g.parent(".postbox").hasClass("closed"))})},save_state:function(e){var c,d;if("nav-menus"===e){return}c=a(".postbox").filter(".closed").map(function(){return this.id}).get().join(",");d=a(".postbox").filter(":hidden").map(function(){return this.id}).get().join(",");a.post(ajaxurl,{action:"closed-postboxes",closed:c,hidden:d,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:e})},save_order:function(d){var c,e=a(".columns-prefs input:checked").val()||0;c={action:"meta-box-order",_ajax_nonce:a("#meta-box-order-nonce").val(),page_columns:e,page:d};a(".meta-box-sortables").each(function(){c["order["+this.id.split("-")[0]+"]"]=a(this).sortable("toArray").join(",")});a.post(ajaxurl,c)},_mark_area:function(){var d=a("div.postbox:visible").length,c=a("#post-body #side-sortables");a("#dashboard-widgets .meta-box-sortables:visible").each(function(){var e=a(this);if(d==1||e.children(".postbox:visible").length){e.removeClass("empty-container")}else{e.addClass("empty-container");e.attr("data-emptyString",postBoxL10n.postBoxEmptyString)}});if(c.length){if(c.children(".postbox:visible").length){c.removeClass("empty-container")}else{if(a("#postbox-container-1").css("width")=="280px"){c.addClass("empty-container")}}}},_pb_edit:function(d){var c=a(".metabox-holder").get(0);if(c){c.className=c.className.replace(/columns-\d+/,"columns-"+d)}a(document).trigger("postboxes-columnchange")},_pb_change:function(){var c=a('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case -90:if(!c.length||!c.is(":checked")){this._pb_edit(2)}break;case 0:case 180:if(a("#poststuff").length){this._pb_edit(1)}else{if(!c.length||!c.is(":checked")){this._pb_edit(2)}}break}},pbshow:false,pbhide:false}}(jQuery));