(function(j){if(typeof window.tagsSuggestL10n==="undefined"||typeof window.uiAutocompleteL10n==="undefined"){return}var g=0;var i=window.tagsSuggestL10n.tagDelimiter||",";function f(a){return a.split(new RegExp(i+"\\s*"))}function h(a){return f(a).pop()}j.fn.wpTagsSuggest=function(b){var c;var a;var d=j(this);b=b||{};var e=b.taxonomy||d.attr("data-wp-taxonomy")||"post_tag";delete (b.taxonomy);b=j.extend({source:function(n,p){var o;if(a===n.term){p(c);return}o=h(n.term);j.get(window.ajaxurl,{action:"ajax-tag-search",tax:e,q:o}).always(function(){d.removeClass("ui-autocomplete-loading")}).done(function(l){var m;var r=[];if(l){l=l.split("\n");for(m in l){var k=++g;r.push({id:k,name:l[m]})}c=r;p(r)}else{p(r)}});a=n.term},focus:function(n,m){d.attr("aria-activedescendant","wp-tags-autocomplete-"+m.item.id);n.preventDefault()},select:function(o,n){var p=f(d.val());p.pop();p.push(n.item.name,"");d.val(p.join(i+" "));if(j.ui.keyCode.TAB===o.keyCode){window.wp.a11y.speak(window.tagsSuggestL10n.termSelected,"assertive");o.preventDefault()}else{if(j.ui.keyCode.ENTER===o.keyCode){o.preventDefault();o.stopPropagation()}}return false},open:function(){d.attr("aria-expanded","true")},close:function(){d.attr("aria-expanded","false")},minLength:2,position:{my:"left top+2",at:"left bottom",collision:"none"},messages:{noResults:window.uiAutocompleteL10n.noResults,results:function(l){if(l>1){return window.uiAutocompleteL10n.manyResults.replace("%d",l)}return window.uiAutocompleteL10n.oneResult}}},b);d.on("keydown",function(){d.removeAttr("aria-activedescendant")}).autocomplete(b).autocomplete("instance")._renderItem=function(n,m){return j('<li role="option" id="wp-tags-autocomplete-'+m.id+'">').text(m.name).appendTo(n)};d.attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-owns":d.autocomplete("widget").attr("id")}).on("focus",function(){var l=f(d.val()).pop();if(l){d.autocomplete("search")}}).autocomplete("widget").addClass("wp-tags-autocomplete").attr("role","listbox").removeAttr("tabindex").on("menufocus",function(n,m){m.item.attr("aria-selected","true")}).on("menublur",function(){j(this).find('[aria-selected="true"]').removeAttr("aria-selected")});return this}}(jQuery));