(function(h,n,k){var l=n(h),m=n(document),j=n("#wpadminbar"),i=n("#wpfooter");n(function(){var b=n("#postdivrich"),ak=n("#wp-content-wrap"),aC=n("#wp-content-editor-tools"),av=n(),ac=n(),W=n("#ed_toolbar"),aE=n("#content"),aw=aE[0],ah=0,aB=n("#post-status-info"),ai=n(),ao=n(),at=n("#side-sortables"),au=n("#postbox-container-1"),aq=n("#post-body"),aD=h.wp.editor&&h.wp.editor.fullscreen,e,ae=function(){},ar=function(){},am=false,aA=false,d=false,af=false,an,ad=0,aa=130,Y=56,f=20,a=300,ap=ak.hasClass("tmce-active")?"tinymce":"html",X=!!parseInt(h.getUserSetting("hidetb"),10),Z={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};var az=h._.throttle(function(){var q=h.scrollX||document.documentElement.scrollLeft;var p=h.scrollY||document.documentElement.scrollTop;var o=parseInt(aw.style.height,10);aw.style.height=a+"px";if(aw.scrollHeight>a){aw.style.height=aw.scrollHeight+"px"}if(typeof q!=="undefined"){h.scrollTo(q,p)}if(aw.scrollHeight<o){g()}},300);function c(){var o=aw.value.length;if(e&&!e.isHidden()){return}if(!e&&ap==="tinymce"){return}if(o<ah){az()}else{if(parseInt(aw.style.height,10)<aw.scrollHeight){aw.style.height=Math.ceil(aw.scrollHeight)+"px";g()}}ah=o}function ay(){var o=l.width();Z={windowHeight:l.height(),windowWidth:o,adminBarHeight:(o>600?j.outerHeight():0),toolsHeight:aC.outerHeight()||0,menuBarHeight:ai.outerHeight()||0,visualTopHeight:av.outerHeight()||0,textTopHeight:W.outerHeight()||0,bottomHeight:aB.outerHeight()||0,statusBarHeight:ao.outerHeight()||0,sideSortablesHeight:at.height()||0};if(Z.menuBarHeight<3){Z.menuBarHeight=0}}m.on("tinymce-editor-init.editor-expand",function(s,p){var w=h.tinymce.util.VK,v=_.debounce(function(){!n(".mce-floatpanel:hover").length&&h.tinymce.ui.FloatPanel.hideAll();n(".mce-tooltip").hide()},1000,true);if(p.id!=="content"){return}e=p;p.settings.autoresize_min_height=a;av=ak.find(".mce-toolbar-grp");ac=ak.find(".mce-edit-area");ao=ak.find(".mce-statusbar");ai=ak.find(".mce-menubar");function x(){var D=p.selection.getNode(),z,A,C;if(p.wp&&p.wp.getView&&(A=p.wp.getView(D))){C=A.getBoundingClientRect()}else{z=p.selection.getRng();try{C=z.getClientRects()[0]}catch(B){}if(!C){C=D.getBoundingClientRect()}}return C.height?C:false}function t(z){var A=z.keyCode;if(A<=47&&!(A===w.SPACEBAR||A===w.ENTER||A===w.DELETE||A===w.BACKSPACE||A===w.UP||A===w.LEFT||A===w.DOWN||A===w.UP)){return}else{if((A>=91&&A<=93)||(A>=112&&A<=123)||A===144||A===145){return}}r(A)}function r(E){var B=x(),A=50,D,F,C,z;if(!B){return}D=B.top+p.iframeElement.getBoundingClientRect().top;F=D+B.height;D=D-A;F=F+A;C=Z.adminBarHeight+Z.toolsHeight+Z.menuBarHeight+Z.visualTopHeight;z=Z.windowHeight-(X?Z.bottomHeight+Z.statusBarHeight:0);if(z-C<B.height){return}if(D<C&&(E===w.UP||E===w.LEFT||E===w.BACKSPACE)){h.scrollTo(h.pageXOffset,D+h.pageYOffset-C)}else{if(F>z){h.scrollTo(h.pageXOffset,F+h.pageYOffset-z)}}}function q(z){if(!z.state){g()}}function u(){l.on("scroll.mce-float-panels",v);setTimeout(function(){p.execCommand("wpAutoResize");g()},300)}function o(){l.off("scroll.mce-float-panels");setTimeout(function(){var z=ak.offset().top;if(h.pageYOffset>z){h.scrollTo(h.pageXOffset,z-Z.adminBarHeight)}c();g()},100);g()}function y(){X=!X}ae=function(){p.on("keyup",t);p.on("show",u);p.on("hide",o);p.on("wp-toolbar-toggle",y);p.on("setcontent wp-autoresize wp-toolbar-toggle",g);p.on("undo redo",r);p.on("FullscreenStateChanged",q);l.off("scroll.mce-float-panels").on("scroll.mce-float-panels",v)};ar=function(){p.off("keyup",t);p.off("show",u);p.off("hide",o);p.off("wp-toolbar-toggle",y);p.off("setcontent wp-autoresize wp-toolbar-toggle",g);p.off("undo redo",r);p.off("FullscreenStateChanged",q);l.off("scroll.mce-float-panels")};if(b.hasClass("wp-editor-expand")){ae();ax(g)}});function g(y){if(aD&&aD.settings.visible){return}var A=l.scrollTop(),E=y&&y.type,w=E!=="scroll",x=e&&!e.isHidden(),z=a,p=aq.offset().top,t=1,F=ak.width(),v,C,o,D,u,r,q,B,s;if(w||!Z.windowHeight){ay()}if(!x&&E==="resize"){c()}if(x){v=av;C=ac;q=Z.visualTopHeight}else{v=W;C=aE;q=Z.textTopHeight}if(!x&&!v.length){return}r=v.parent().offset().top;B=C.offset().top;s=C.outerHeight();u=x?a+q:a+20;u=s>(u+5);if(!u){if(w){aC.css({position:"absolute",top:0,width:F});if(x&&ai.length){ai.css({position:"absolute",top:0,width:F-(t*2)})}v.css({position:"absolute",top:Z.menuBarHeight,width:F-(t*2)-(x?0:(v.outerWidth()-v.width()))});ao.attr("style",X?"":"visibility: hidden;");aB.attr("style","")}}else{if((!am||w)&&(A>=(r-Z.toolsHeight-Z.adminBarHeight)&&A<=(r-Z.toolsHeight-Z.adminBarHeight+s-z))){am=true;aC.css({position:"fixed",top:Z.adminBarHeight,width:F});if(x&&ai.length){ai.css({position:"fixed",top:Z.adminBarHeight+Z.toolsHeight,width:F-(t*2)-(x?0:(v.outerWidth()-v.width()))})}v.css({position:"fixed",top:Z.adminBarHeight+Z.toolsHeight+Z.menuBarHeight,width:F-(t*2)-(x?0:(v.outerWidth()-v.width()))})}else{if(am||w){if(A<=(r-Z.toolsHeight-Z.adminBarHeight)){am=false;aC.css({position:"absolute",top:0,width:F});if(x&&ai.length){ai.css({position:"absolute",top:0,width:F-(t*2)})}v.css({position:"absolute",top:Z.menuBarHeight,width:F-(t*2)-(x?0:(v.outerWidth()-v.width()))})}else{if(A>=(r-Z.toolsHeight-Z.adminBarHeight+s-z)){am=false;aC.css({position:"absolute",top:s-z,width:F});if(x&&ai.length){ai.css({position:"absolute",top:s-z,width:F-(t*2)})}v.css({position:"absolute",top:s-z+Z.menuBarHeight,width:F-(t*2)-(x?0:(v.outerWidth()-v.width()))})}}}}if((!aA||(w&&X))&&(A+Z.windowHeight)<=(B+s+Z.bottomHeight+Z.statusBarHeight+t)){if(y&&y.deltaHeight>0&&y.deltaHeight<100){h.scrollBy(0,y.deltaHeight)}else{if(x&&X){aA=true;ao.css({position:"fixed",bottom:Z.bottomHeight,visibility:"",width:F-(t*2)});aB.css({position:"fixed",bottom:0,width:F})}}}else{if((!X&&aA)||((aA||w)&&(A+Z.windowHeight)>(B+s+Z.bottomHeight+Z.statusBarHeight-t))){aA=false;ao.attr("style",X?"":"visibility: hidden;");aB.attr("style","")}}}if(au.width()<300&&Z.windowWidth>600&&m.height()>(at.height()+p+120)&&Z.windowHeight<s){if((Z.sideSortablesHeight+Y+f)>Z.windowHeight||d||af){if(A+Y<=p){at.attr("style","");d=af=false}else{if(A>ad){if(d){d=false;o=at.offset().top-Z.adminBarHeight;D=i.offset().top;if(D<o+Z.sideSortablesHeight+f){o=D-Z.sideSortablesHeight-12}at.css({position:"absolute",top:o,bottom:""})}else{if(!af&&Z.sideSortablesHeight+at.offset().top+f<A+Z.windowHeight){af=true;at.css({position:"fixed",top:"auto",bottom:f})}}}else{if(A<ad){if(af){af=false;o=at.offset().top-f;D=i.offset().top;if(D<o+Z.sideSortablesHeight+f){o=D-Z.sideSortablesHeight-12}at.css({position:"absolute",top:o,bottom:""})}else{if(!d&&at.offset().top>=A+Y){d=true;at.css({position:"fixed",top:Y,bottom:""})}}}}}}else{if(A>=(p-Y)){at.css({position:"fixed",top:Y})}else{at.attr("style","")}d=af=false}ad=A}else{at.attr("style","");d=af=false}if(w){ak.css({paddingTop:Z.toolsHeight});if(x){ac.css({paddingTop:Z.visualTopHeight+Z.menuBarHeight})}else{aE.css({marginTop:Z.textTopHeight})}}}function ag(){c();g()}function ax(p){for(var o=1;o<6;o++){setTimeout(p,500*o)}}function al(){clearTimeout(an);an=setTimeout(g,100)}function aj(){if(h.pageYOffset&&h.pageYOffset>aa){h.scrollTo(h.pageXOffset,0)}b.addClass("wp-editor-expand");l.on("scroll.editor-expand resize.editor-expand",function(o){g(o.type);al()});m.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",g).on("postbox-toggled.editor-expand postbox-moved.editor-expand",function(){if(!d&&!af&&h.pageYOffset>Y){af=true;h.scrollBy(0,-1);g();h.scrollBy(0,1)}g()}).on("wp-window-resized.editor-expand",function(){if(e&&!e.isHidden()){e.execCommand("wpAutoResize")}else{c()}});aE.on("focus.editor-expand input.editor-expand propertychange.editor-expand",c);ae();aD&&aD.pubsub.subscribe("hidden",ag);if(e){e.settings.wp_autoresize_on=true;e.execCommand("wpAutoResizeOn");if(!e.isHidden()){e.execCommand("wpAutoResize")}}if(!e||e.isHidden()){c()}g();m.trigger("editor-expand-on")}function ab(){var o=parseInt(h.getUserSetting("ed_size",300),10);if(o<50){o=50}else{if(o>5000){o=5000}}if(h.pageYOffset&&h.pageYOffset>aa){h.scrollTo(h.pageXOffset,0)}b.removeClass("wp-editor-expand");l.off(".editor-expand");m.off(".editor-expand");aE.off(".editor-expand");ar();aD&&aD.pubsub.unsubscribe("hidden",ag);n.each([av,W,aC,ai,aB,ao,ak,ac,aE,at],function(p,q){q&&q.attr("style","")});am=aA=d=af=false;if(e){e.settings.wp_autoresize_on=false;e.execCommand("wpAutoResizeOff");if(!e.isHidden()){aE.hide();if(o){e.theme.resizeTo(null,o)}}}if(o){aE.height(o)}m.trigger("editor-expand-off")}if(b.hasClass("wp-editor-expand")){aj();if(ak.hasClass("html-active")){ax(function(){g();c()})}}n("#adv-settings .editor-expand").show();n("#editor-expand-toggle").on("change.editor-expand",function(){if(n(this).prop("checked")){aj();h.setUserSetting("editor_expand","on")}else{ab();h.setUserSetting("editor_expand","off")}});h.editorExpand={on:aj,off:ab}});n(function(){var aj=n(document.body),a=n("#wpcontent"),aE=n("#post-body-content"),aC=n("#title"),aH=n("#content"),af=n(document.createElement("DIV")),ak=n("#edit-slug-box"),au=ak.find("a").add(ak.find("button")).add(ak.find("input")),al=n("#adminmenuwrap"),ac=n(),aB=n(),ay=h.getUserSetting("editor_expand","on")==="on",x=ay?h.getUserSetting("post_dfw")==="on":false,c=0,d=0,ap=20,az,an,aw,ah,ad,ae,ag,aI,aG,av,ar;aj.append(af);af.css({display:"none",position:"fixed",top:j.height(),right:0,bottom:0,left:0,"z-index":9997});aE.css({position:"relative"});l.on("mousemove.focus",function(o){ag=o.pageY});function b(){ah=aE.offset();ah.right=ah.left+aE.outerWidth();ah.bottom=ah.top+aE.outerHeight()}function aA(){if(!ay){ay=true;m.trigger("dfw-activate");aH.on("keydown.focus-shortcut",f)}}function aF(){if(ay){ab();ay=false;m.trigger("dfw-deactivate");aH.off("keydown.focus-shortcut")}}function aa(){return ay}function ai(){if(!x&&ay){x=true;aH.on("keydown.focus",g);aC.add(aH).on("blur.focus",aD);g();h.setUserSetting("post_dfw","on");m.trigger("dfw-on")}}function ab(){if(x){x=false;aC.add(aH).off(".focus");ao();aE.off(".focus");h.setUserSetting("post_dfw","off");m.trigger("dfw-off")}}function am(){if(x){ab()}else{ai()}}function y(){return x}function g(p){var q,o=p&&p.keyCode;if(h.navigator.platform){q=(h.navigator.platform.indexOf("Mac")>-1)}if(o===27||(o===87&&p.altKey&&((!q&&p.shiftKey)||(q&&p.ctrlKey)))){ao(p);return}if(p&&(p.metaKey||(p.ctrlKey&&!p.altKey)||(p.altKey&&p.shiftKey)||(o&&((o<=47&&o!==8&&o!==13&&o!==32&&o!==46)||(o>=91&&o<=93)||(o>=112&&o<=135)||(o>=144&&o<=150)||o>=224)))){return}if(!az){az=true;clearTimeout(av);av=setTimeout(function(){af.show()},600);aE.css("z-index",9998);af.on("mouseenter.focus",function(){b();l.on("scroll.focus",function(){var r=h.pageYOffset;if((aI&&ag&&aI!==r)&&(ag<ah.top-ap||ag>ah.bottom+ap)){ao()}aI=r})}).on("mouseleave.focus",function(){ad=ae=null;c=d=0;l.off("scroll.focus")}).on("mousemove.focus",function(t){var v=t.clientX,r=t.clientY,s=h.pageYOffset,u=h.pageXOffset;if(ad&&ae&&(v!==ad||r!==ae)){if((r<=ae&&r<ah.top-s)||(r>=ae&&r>ah.bottom-s)||(v<=ad&&v<ah.left-u)||(v>=ad&&v>ah.right-u)){c+=Math.abs(ad-v);d+=Math.abs(ae-r);if((r<=ah.top-ap-s||r>=ah.bottom+ap-s||v<=ah.left-ap-u||v>=ah.right+ap-u)&&(c>10||d>10)){ao();ad=ae=null;c=d=0;return}}else{c=d=0}}ad=v;ae=r}).on("touchstart.focus",function(r){r.preventDefault();ao()});aE.off("mouseenter.focus");if(aG){clearTimeout(aG);aG=null}aj.addClass("focus-on").removeClass("focus-off")}at();ax()}function ao(o){if(az){az=false;clearTimeout(av);av=setTimeout(function(){af.hide()},200);aE.css("z-index","");af.off("mouseenter.focus mouseleave.focus mousemove.focus touchstart.focus");if("undefined"===typeof o){aE.on("mouseenter.focus",function(){if(n.contains(aE.get(0),document.activeElement)||ar){g()}})}aG=setTimeout(function(){aG=null;aE.off("mouseenter.focus")},1000);aj.addClass("focus-off").removeClass("focus-on")}e();aq()}function aD(){setTimeout(function(){var o=document.activeElement.compareDocumentPosition(aE.get(0));function p(q){return n.contains(q.get(0),document.activeElement)}if((o===2||o===4)&&(p(al)||p(a)||p(i))){ao()}},0)}function at(){if(!an&&az){an=true;j.on("mouseenter.focus",function(){j.addClass("focus-off")}).on("mouseleave.focus",function(){j.removeClass("focus-off")})}}function e(){if(an){an=false;j.off(".focus")}}function ax(){if(!aw&&az&&!ak.find(":focus").length){aw=true;ak.stop().fadeTo("fast",0.3).on("mouseenter.focus",aq).off("mouseleave.focus");au.on("focus.focus",aq).off("blur.focus")}}function aq(){if(aw){aw=false;ak.stop().fadeTo("fast",1).on("mouseleave.focus",ax).off("mouseenter.focus");au.on("blur.focus",ax).off("focus.focus")}}function f(o){if(o.altKey&&o.shiftKey&&87===o.keyCode){am()}}if(n("#postdivrich").hasClass("wp-editor-expand")){aH.on("keydown.focus-shortcut",f)}m.on("tinymce-editor-setup.focus",function(p,o){o.addButton("dfw",{active:x,classes:"wp-dfw btn widget",disabled:!ay,onclick:am,onPostRender:function(){var q=this;m.on("dfw-activate.focus",function(){q.disabled(false)}).on("dfw-deactivate.focus",function(){q.disabled(true)}).on("dfw-on.focus",function(){q.active(true)}).on("dfw-off.focus",function(){q.active(false)})},tooltip:"Distraction-free writing mode",shortcut:"Alt+Shift+W"});o.addCommand("wpToggleDFW",am);o.addShortcut("access+w","","wpToggleDFW")});m.on("tinymce-editor-init.focus",function(r,s){var p,t;function o(){ar=true}function q(){ar=false}if(s.id==="content"){ac=n(s.getWin());aB=n(s.getContentAreaContainer()).find("iframe");p=function(){s.on("keydown",g);s.on("blur",aD);s.on("focus",o);s.on("blur",q);s.on("wp-autoresize",b)};t=function(){s.off("keydown",g);s.off("blur",aD);s.off("focus",o);s.off("blur",q);s.off("wp-autoresize",b)};if(x){p()}m.on("dfw-on.focus",p).on("dfw-off.focus",t);s.on("click",function(u){if(u.target===s.getDoc().documentElement){s.focus()}})}});m.on("quicktags-init",function(q,o){var p;if(o.settings.buttons&&(","+o.settings.buttons+",").indexOf(",dfw,")!==-1){p=n("#"+o.name+"_dfw");n(document).on("dfw-activate",function(){p.prop("disabled",false)}).on("dfw-deactivate",function(){p.prop("disabled",true)}).on("dfw-on",function(){p.addClass("active")}).on("dfw-off",function(){p.removeClass("active")})}});m.on("editor-expand-on.focus",aA).on("editor-expand-off.focus",aF);if(x){aH.on("keydown.focus",g);aC.add(aH).on("blur.focus",aD)}h.wp=h.wp||{};h.wp.editor=h.wp.editor||{};h.wp.editor.dfw={activate:aA,deactivate:aF,isActive:aa,on:ai,off:ab,toggle:am,isOn:y}})})(window,window.jQuery);