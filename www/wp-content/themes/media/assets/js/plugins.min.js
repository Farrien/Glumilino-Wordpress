(function(a){jQuery.fn.searchApartments=function(l){l=a.extend({data:{},notFound__message:"Ничего не найдено. Попробуйте изменить условия поиска."},l);var e=a(this);var i=e.find(".resulting");var f="hash__calculate";var h={};a.each(l.data,function(m,n){if(n.tc!=0){h[m]=n}});e.find("div#calc div.slider-range").each(function(q,o){var r=a(this);var p=parseFloat(r.attr("minimal"));var m=parseFloat(r.attr("max"));var t=r.attr("default-values");var n=r.attr("data-type");var s=(r.attr("float")=="false")?1:0.1;if(n=="storey"){e.data("hash__storey",{start:p,end:m})}if(n=="rooms"){e.data("hash__rooms",{start:p,end:m})}if(n=="area"){e.data("hash__area",{start:p,end:m})}r.slider({range:true,min:p,max:m,step:s,animate:"slow",distance:0,values:[p,m],slide:function(u,v){k(true);a(".ui-slider-handle",r).eq(0).text(v.values[0]);a(".ui-slider-handle",r).eq(1).text(v.values[1]);if(v.values[0]==0){a(".ui-slider-handle",r).eq(0).text("Ст")}if(n=="rooms"){a(".ui-slider-handle",r).eq(0).text(parseInt(v.values[0],10))}if(n=="rooms"){a(".ui-slider-handle",r).eq(1).text(parseInt(v.values[1],10))}if(n=="storey"){e.data("hash__storey",{start:v.values[0],end:v.values[1]})}if(n=="rooms"){e.data("hash__rooms",{start:v.values[0],end:v.values[1]})}if(n=="area"){e.data("hash__area",{start:v.values[0],end:v.values[1]})}k(false);d()},stop:function(u,v){}});a(".ui-slider-handle",r).eq(0).text(p);a(".ui-slider-handle",r).eq(1).text(m);if(p==0){a(".ui-slider-handle",r).eq(0).text("Ст")}});a("#apartments__selection__page .section__selected a").click(function(){a("#apartments__selection__page .section__selected a").removeClass("active");var m=a(this).attr("attr-section");a(this).addClass("active");a(".find-the-apartment").hide();a('.find-the-apartment[attr-section="'+m+'"]').show()});function k(){}function d(s){var o=parseInt(e.data("hash__storey").start,10);var t=parseInt(e.data("hash__storey").end,10);var r=parseInt(e.data("hash__rooms").start,10);var q=parseInt(e.data("hash__rooms").end,10);var n=e.data("hash__area").start;var p=e.data("hash__area").end;var m={};a.each(h,function(u,v){if((v.f>=o&&v.f<=t)&&(v.rc>=r&&v.rc<=q)&&(v.sq>=n&&v.sq<=p)){m[u]=v}});j(m)}function b(m){if(m==0){m="Ст"}return m}function c(m){if(m==0){return"по запросу"}var n=m.toFixed(0).replace(/./g,function(q,p,o){return p&&q!=="."&&((o.length-p)%3===0)?" "+q:q});return n+" р."}function g(n){var p=n;var o=0;for(var m in p){if(p.hasOwnProperty(m)){++o}}return o}function j(m){i.empty();if(g(m)==0){i.html('<div style="color:#fff; text-align: center; padding-top: 20px;">'+l.notFound__message+"</div>")}else{a.each(m,function(n,o){i.append('<div class="r clearfix find-the-apartment" attr-storey="'+o.f+'" attr-apartment-number="'+o.n+'" attr-section="'+o.s+'"><div class="col" style="width: 16.6666666%;">'+o.s+'<div class="hidden__plan__view"><div class="apart-frame__centrer"><img src="http://glumilino.ru/assets/images/apts/'+o.s+"-"+o.n+'.png" height="100%"></div></div></div><div class="col" style="width: 16.6666666%;">'+o.f+'</div><div class="col" style="width: 16.6666666%;">'+o.n+'</div><div class="col" style="width: 16.6666666%;">'+b(o.rc)+'</div><div class="col" style="width: 16.6666666%;">'+o.sq+'</div><div class="col" style="width: 16.6666666%;">По запросу</div></div>')})}}j(h)}})(jQuery);$(document).on("ready async-page-loading",function(){var d=$("#publication__page");var c=d.find("div.slide");var b=c.size();var h=d.find("div.slide__dotted");var f=d.find("div.arrows a.left");var e=d.find("div.arrows a.right");var g=500;c.each(function(j,k){h.append('<a href="javascript:;" data-eq="'+j+'"></a>&nbsp;&nbsp;')});var a=function(j){c.removeClass("active").removeAttr("data-eq").stop(true).transition({opacity:0,scale:0.7},0);c.eq(j).addClass("active").attr("data-eq",c.eq(j).index()).stop(true).transition({opacity:1,scale:1},g);h.find("a").removeClass("active");h.find("a").eq(j).addClass("active");var l=(c.eq(j).index()+1);var k=(l>=b)?0:l;e.removeAttr("data-eq").attr("data-eq",k);var i=(l<=1)?(b-1):(l-2);f.removeAttr("data-eq").attr("data-eq",i)};h.find("a").click(function(){var i=$(this).attr("data-eq");a(i)});e.click(function(){var i=$(this).attr("data-eq");a(i)});f.click(function(){var i=$(this).attr("data-eq");a(i)});a(0)});