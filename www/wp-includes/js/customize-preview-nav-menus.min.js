wp.customize.navMenusPreview=wp.customize.MenusCustomizerPreview=(function(e,b,c,d){var a={data:{navMenuInstanceArgs:{}}};if("undefined"!==typeof _wpCustomizePreviewNavMenusExports){b.extend(a.data,_wpCustomizePreviewNavMenusExports)}a.init=function(){var f=this,g=false;d.preview.bind("sync",function(){g=true});if(d.selectiveRefresh){d.each(function(h){f.bindSettingListener(h)});d.bind("add",function(h){if(h.get()&&!h.get()._invalid){f.bindSettingListener(h,{fire:g})}});d.bind("remove",function(h){f.unbindSettingListener(h)});d.selectiveRefresh.bind("render-partials-response",function(h){if(h.nav_menu_instance_args){b.extend(f.data.navMenuInstanceArgs,h.nav_menu_instance_args)}})}d.preview.bind("active",function(){f.highlightControls()})};if(d.selectiveRefresh){a.NavMenuInstancePartial=d.selectiveRefresh.Partial.extend({initialize:function(j,g){var f=this,h,i;h=j.match(/^nav_menu_instance\[([0-9a-f]{32})]$/);if(!h){throw new Error("Illegal id for nav_menu_instance partial. The key corresponds with the args HMAC.")}i=h[1];g=g||{};g.params=b.extend({selector:'[data-customize-partial-id="'+j+'"]',navMenuArgs:g.constructingContainerContext||{},containerInclusive:true},g.params||{});d.selectiveRefresh.Partial.prototype.initialize.call(f,j,g);if(!b.isObject(f.params.navMenuArgs)){throw new Error("Missing navMenuArgs")}if(f.params.navMenuArgs.args_hmac!==i){throw new Error("args_hmac mismatch with id")}},isRelatedSetting:function(o,h,f){var k=this,l,m,i,j,g,n;if(b.isString(o)){o=d(o)}i=/^nav_menu_item\[/.test(o.id);if(i&&b.isObject(h)&&b.isObject(f)){j=b.clone(h);g=b.clone(f);delete j.type_label;delete g.type_label;if("https"===d.preview.scheme.get()){n=document.createElement("a");n.href=j.url;n.protocol="https:";j.url=n.href;n.href=g.url;n.protocol="https:";g.url=n.href}if(h.title){delete g.original_title;delete j.original_title}if(b.isEqual(g,j)){return false}}if(k.params.navMenuArgs.theme_location){if("nav_menu_locations["+k.params.navMenuArgs.theme_location+"]"===o.id){return true}l=d("nav_menu_locations["+k.params.navMenuArgs.theme_location+"]")}m=k.params.navMenuArgs.menu;if(!m&&l){m=l()}if(!m){return false}return(("nav_menu["+m+"]"===o.id)||(i&&((h&&h.nav_menu_term_id===m)||(f&&f.nav_menu_term_id===m))))},refresh:function(){var g=this,h,f=e.Deferred();if(b.isNumber(g.params.navMenuArgs.menu)){h=g.params.navMenuArgs.menu}else{if(g.params.navMenuArgs.theme_location&&d.has("nav_menu_locations["+g.params.navMenuArgs.theme_location+"]")){h=d("nav_menu_locations["+g.params.navMenuArgs.theme_location+"]").get()}}if(!h){g.fallback();f.reject();return f.promise()}return d.selectiveRefresh.Partial.prototype.refresh.call(g)},renderContent:function(g){var f=this,h=g.container;if(""===g.addedContent){g.partial.fallback()}if(d.selectiveRefresh.Partial.prototype.renderContent.call(f,g)){e(document).trigger("customize-preview-menu-refreshed",[{instanceNumber:null,wpNavArgs:g.context,wpNavMenuArgs:g.context,oldContainer:h,newContainer:g.container}])}}});d.selectiveRefresh.partialConstructor.nav_menu_instance=a.NavMenuInstancePartial;a.handleUnplacedNavMenuInstances=function(f){var g;g=b.filter(b.values(a.data.navMenuInstanceArgs),function(h){return !d.selectiveRefresh.partial.has("nav_menu_instance["+h.args_hmac+"]")});if(b.findWhere(g,f)){d.selectiveRefresh.requestFullRefresh();return true}return false};a.bindSettingListener=function(g,f){var h;f=f||{};h=g.id.match(/^nav_menu\[(-?\d+)]$/);if(h){g._navMenuId=parseInt(h[1],10);g.bind(this.onChangeNavMenuSetting);if(f.fire){this.onChangeNavMenuSetting.call(g,g(),false)}return true}h=g.id.match(/^nav_menu_item\[(-?\d+)]$/);if(h){g._navMenuItemId=parseInt(h[1],10);g.bind(this.onChangeNavMenuItemSetting);if(f.fire){this.onChangeNavMenuItemSetting.call(g,g(),false)}return true}h=g.id.match(/^nav_menu_locations\[(.+?)]/);if(h){g._navMenuThemeLocation=h[1];g.bind(this.onChangeNavMenuLocationsSetting);if(f.fire){this.onChangeNavMenuLocationsSetting.call(g,g(),false)}return true}return false};a.unbindSettingListener=function(f){f.unbind(this.onChangeNavMenuSetting);f.unbind(this.onChangeNavMenuItemSetting);f.unbind(this.onChangeNavMenuLocationsSetting)};a.onChangeNavMenuSetting=function(){var f=this;a.handleUnplacedNavMenuInstances({menu:f._navMenuId});d.each(function(g){if(!g._navMenuThemeLocation){return}if(f._navMenuId===g()){a.handleUnplacedNavMenuInstances({theme_location:g._navMenuThemeLocation})}})};a.onChangeNavMenuItemSetting=function(g,i){var h=g||i,f;f=d("nav_menu["+String(h.nav_menu_term_id)+"]");if(f){a.onChangeNavMenuSetting.call(f)}};a.onChangeNavMenuLocationsSetting=function(){var g=this,f;a.handleUnplacedNavMenuInstances({theme_location:g._navMenuThemeLocation});f=!!b.findWhere(b.values(a.data.navMenuInstanceArgs),{theme_location:g._navMenuThemeLocation});if(!f){d.selectiveRefresh.requestFullRefresh()}}}a.highlightControls=function(){var f=".menu-item";if(!d.settings.channel){return}e(document).on("click",f,function(h){var g;if(!h.shiftKey){return}g=e(this).attr("class").match(/(?:^|\s)menu-item-(-?\d+)(?:\s|$)/);if(g){h.preventDefault();h.stopPropagation();d.preview.send("focus-nav-menu-item-control",parseInt(g[1],10))}})};d.bind("preview-ready",function(){a.init()});return a}(jQuery,_,wp,wp.customize));