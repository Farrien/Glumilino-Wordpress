(function(f,e){var d={};wp.media.coerce=function(b,a){if(e.isUndefined(b[a])&&!e.isUndefined(this.defaults[a])){b[a]=this.defaults[a]}else{if("true"===b[a]){b[a]=true}else{if("false"===b[a]){b[a]=false}}}return b[a]};wp.media.string={props:function(l,b){var c,n,m,k,a=wp.media.view.settings.defaultProps;l=l?e.clone(l):{};if(b&&b.type){l.type=b.type}if("image"===l.type){l=e.defaults(l||{},{align:a.align||getUserSetting("align","none"),size:a.size||getUserSetting("imgsize","medium"),url:"",classes:[]})}if(!b){return l}l.title=l.title||b.title;c=l.link||a.link||getUserSetting("urlbutton","file");if("file"===c||"embed"===c){n=b.url}else{if("post"===c){n=b.link}else{if("custom"===c){n=l.linkUrl}}}l.linkUrl=n||"";if("image"===b.type){l.classes.push("wp-image-"+b.id);k=b.sizes;m=k&&k[l.size]?k[l.size]:b;e.extend(l,e.pick(b,"align","caption","alt"),{width:m.width,height:m.height,src:m.url,captionId:"attachment_"+b.id})}else{if("video"===b.type||"audio"===b.type){e.extend(l,e.pick(b,"title","type","icon","mime"))}else{l.title=l.title||b.filename;l.rel=l.rel||"attachment wp-att-"+b.id}}return l},link:function(b,a){var c;b=wp.media.string.props(b,a);c={tag:"a",content:b.title,attrs:{href:b.linkUrl}};if(b.rel){c.attrs.rel=b.rel}return wp.html.string(c)},audio:function(b,a){return wp.media.string._audioVideo("audio",b,a)},video:function(b,a){return wp.media.string._audioVideo("video",b,a)},_audioVideo:function(j,k,b){var c,l,a;k=wp.media.string.props(k,b);if(k.link!=="embed"){return wp.media.string.link(k)}c={};if("video"===j){if(b.image&&-1===b.image.src.indexOf(b.icon)){c.poster=b.image.src}if(b.width){c.width=b.width}if(b.height){c.height=b.height}}a=b.filename.split(".").pop();if(e.contains(wp.media.view.settings.embedExts,a)){c[a]=b.url}else{return wp.media.string.link(k)}l=wp.shortcode.string({tag:j,attrs:c});return l},image:function(c,a){var n={},m,k,b,l;c.type="image";c=wp.media.string.props(c,a);k=c.classes||[];n.src=!e.isUndefined(a)?a.url:c.url;e.extend(n,e.pick(c,"width","height","alt"));if(c.align&&!c.caption){k.push("align"+c.align)}if(c.size){k.push("size-"+c.size)}n["class"]=e.compact(k).join(" ");m={tag:"img",attrs:n,single:true};if(c.linkUrl){m={tag:"a",attrs:{href:c.linkUrl},content:m}}l=wp.html.string(m);if(c.caption){b={};if(n.width){b.width=n.width}if(c.captionId){b.id=c.captionId}if(c.align){b.align="align"+c.align}l=wp.shortcode.string({tag:"caption",attrs:b,content:l+" "+c.caption})}return l}};wp.media.embed={coerce:wp.media.coerce,defaults:{url:"",width:"",height:""},edit:function(c,a){var b,j={},i;if(a){j.url=c.replace(/<[^>]+>/g,"")}else{i=wp.shortcode.next("embed",c).shortcode;j=e.defaults(i.attrs.named,this.defaults);if(i.content){j.url=i.content}}b=wp.media({frame:"post",state:"embed",metadata:j});return b},shortcode:function(b){var c=this,a;e.each(this.defaults,function(i,j){b[j]=c.coerce(b,j);if(i===b[j]){delete b[j]}});a=b.url;delete b.url;return new wp.shortcode({tag:"embed",attrs:b,content:a})}};wp.media.collection=function(b){var a={};return e.extend({coerce:wp.media.coerce,attachments:function(o){var c=o.string(),t=a[c],q,r,n,p,s=this;delete a[c];if(t){return t}q=e.defaults(o.attrs.named,this.defaults);r=e.pick(q,"orderby","order");r.type=this.type;r.perPage=-1;if(undefined!==q.orderby){q._orderByField=q.orderby}if("rand"===q.orderby){q._orderbyRandom=true}if(!q.orderby||/^menu_order(?: ID)?$/i.test(q.orderby)){r.orderby="menuOrder"}if(q.ids){r.post__in=q.ids.split(",");r.orderby="post__in"}else{if(q.include){r.post__in=q.include.split(",")}}if(q.exclude){r.post__not_in=q.exclude.split(",")}if(!r.post__in){r.uploadedTo=q.id}p=e.omit(q,"id","ids","include","exclude","orderby","order");e.each(this.defaults,function(g,h){p[h]=s.coerce(p,h)});n=wp.media.query(r);n[this.tag]=new Backbone.Model(p);return n},shortcode:function(n){var l=n.props.toJSON(),m=e.pick(l,"orderby","order"),k,c;if(n.type){m.type=n.type;delete n.type}if(n[this.tag]){e.extend(m,n[this.tag].toJSON())}m.ids=n.pluck("id");if(l.uploadedTo){m.id=l.uploadedTo}delete m.orderby;if(m._orderbyRandom){m.orderby="rand"}else{if(m._orderByField&&m._orderByField!="rand"){m.orderby=m._orderByField}}delete m._orderbyRandom;delete m._orderByField;if(m.ids&&"post__in"===m.orderby){delete m.orderby}m=this.setDefaults(m);k=new wp.shortcode({tag:this.tag,attrs:m,type:"single"});c=new wp.media.model.Attachments(n.models,{props:l});c[this.tag]=n[this.tag];a[k.string()]=c;return k},edit:function(m){var n=wp.shortcode.next(this.tag,m),c=this.defaults.id,p,o,l;if(!n||n.content!==m){return}n=n.shortcode;if(e.isUndefined(n.get("id"))&&!e.isUndefined(c)){n.set("id",c)}p=this.attachments(n);o=new wp.media.model.Selection(p.models,{props:p.props.toJSON(),multiple:true});o[this.tag]=p[this.tag];o.more().done(function(){o.props.set({query:false});o.unmirror();o.props.unset("orderby")});if(this.frame){this.frame.dispose()}if(n.attrs.named.type&&"video"===n.attrs.named.type){l="video-"+this.tag+"-edit"}else{l=this.tag+"-edit"}this.frame=wp.media({frame:"post",state:l,title:this.editTitle,editing:true,multiple:true,selection:o}).open();return this.frame},setDefaults:function(c){var h=this;e.each(this.defaults,function(g,j){c[j]=h.coerce(c,j);if(g===c[j]){delete c[j]}});return c}},b)};wp.media._galleryDefaults={itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"};if(wp.media.view.settings.galleryDefaults){wp.media.galleryDefaults=e.extend({},wp.media._galleryDefaults,wp.media.view.settings.galleryDefaults)}else{wp.media.galleryDefaults=wp.media._galleryDefaults}wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:wp.media.galleryDefaults,setDefaults:function(b){var c=this,a=!e.isEqual(wp.media.galleryDefaults,wp.media._galleryDefaults);e.each(this.defaults,function(i,j){b[j]=c.coerce(b,j);if(i===b[j]&&(!a||i===wp.media._galleryDefaults[j])){delete b[j]}});return b}});wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(a){var b=wp.media.view.settings;b.post.featuredImageId=a;wp.media.post("get-post-thumbnail-html",{post_id:b.post.id,thumbnail_id:b.post.featuredImageId,_wpnonce:b.post.nonce}).done(function(c){if(c=="0"){window.alert(window.setPostThumbnailL10n.error);return}f(".inside","#postimagediv").html(c)})},remove:function(){wp.media.featuredImage.set(-1)},frame:function(){if(this._frame){wp.media.frame=this._frame;return this._frame}this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage(),new wp.media.controller.EditImage()]});this._frame.on("toolbar:create:featured-image",function(a){this.createSelectToolbar(a,{text:wp.media.view.l10n.setFeaturedImage})},this._frame);this._frame.on("content:render:edit-image",function(){var a=this.state("featured-image").get("selection"),b=new wp.media.view.EditImage({model:a.single(),controller:this}).render();this.content.set(b);b.loadEditor()},this._frame);this._frame.state("featured-image").on("select",this.select);return this._frame},select:function(){var a=this.get("selection").single();if(!wp.media.view.settings.post.featuredImageId){return}wp.media.featuredImage.set(a?a.id:-1)},init:function(){f("#postimagediv").on("click","#set-post-thumbnail",function(a){a.preventDefault();a.stopPropagation();wp.media.featuredImage.frame().open()}).on("click","#remove-post-thumbnail",function(){wp.media.featuredImage.remove();return false})}};f(wp.media.featuredImage.init);wp.media.editor={insert:function(k){var c,m,l=!e.isUndefined(window.tinymce),b=!e.isUndefined(window.QTags);if(this.activeEditor){m=window.wpActiveEditor=this.activeEditor}else{m=window.wpActiveEditor}if(window.send_to_editor){return window.send_to_editor.apply(this,arguments)}if(!m){if(l&&tinymce.activeEditor){c=tinymce.activeEditor;m=window.wpActiveEditor=c.id}else{if(!b){return false}}}else{if(l){c=tinymce.get(m)}}if(c&&!c.isHidden()){c.execCommand("mceInsertContent",false,k)}else{if(b){QTags.insertContent(k)}else{document.getElementById(m).value+=k}}if(window.tb_remove){try{window.tb_remove()}catch(a){}}},add:function(a,c){var b=this.get(a);if(b){return b}b=d[a]=wp.media(e.defaults(c||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:true}));b.on("insert",function(j){var i=b.state();j=j||i.get("selection");if(!j){return}f.when.apply(f,j.map(function(g){var h=i.display(g).toJSON();return this.send.attachment(h,g.toJSON())},this)).done(function(){wp.media.editor.insert(e.toArray(arguments).join("\n\n"))})},this);b.state("gallery-edit").on("update",function(h){this.insert(wp.media.gallery.shortcode(h).string())},this);b.state("playlist-edit").on("update",function(h){this.insert(wp.media.playlist.shortcode(h).string())},this);b.state("video-playlist-edit").on("update",function(h){this.insert(wp.media.playlist.shortcode(h).string())},this);b.state("embed").on("select",function(){var k=b.state(),l=k.get("type"),j=k.props.toJSON();j.url=j.url||"";if("link"===l){e.defaults(j,{linkText:j.url,linkUrl:j.url});this.send.link(j).done(function(g){wp.media.editor.insert(g)})}else{if("image"===l){e.defaults(j,{title:j.url,linkUrl:"",align:"none",link:"none"});if("none"===j.link){j.linkUrl=""}else{if("file"===j.link){j.linkUrl=j.url}}this.insert(wp.media.string.image(j))}}},this);b.state("featured-image").on("select",wp.media.featuredImage.select);b.setState(b.options.state);return b},id:function(a){if(a){return a}a=window.wpActiveEditor;if(!a&&!e.isUndefined(window.tinymce)&&tinymce.activeEditor){a=tinymce.activeEditor.id}a=a||"";return a},get:function(a){a=this.id(a);return d[a]},remove:function(a){a=this.id(a);delete d[a]},send:{attachment:function(b,a){var j=a.caption,i,c;if(!wp.media.view.settings.captions){delete a.caption}b=wp.media.string.props(b,a);i={id:a.id,post_content:a.description,post_excerpt:j};if(b.linkUrl){i.url=b.linkUrl}if("image"===a.type){c=wp.media.string.image(b);e.each({align:"align",size:"image-size",alt:"image_alt"},function(h,g){if(b[g]){i[h]=b[g]}})}else{if("video"===a.type){c=wp.media.string.video(b,a)}else{if("audio"===a.type){c=wp.media.string.audio(b,a)}else{c=wp.media.string.link(b);i.post_title=b.title}}}return wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:i,html:c,post_id:wp.media.view.settings.post.id})},link:function(a){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,src:a.linkUrl,link_text:a.linkText,html:wp.media.string.link(a),post_id:wp.media.view.settings.post.id})}},open:function(a,c){var b;c=c||{};a=this.id(a);this.activeEditor=a;b=this.get(a);if(!b||(b.options&&c.state!==b.options.state)){b=this.add(a,c)}wp.media.frame=b;return b.open()},init:function(){f(document.body).on("click.add-media-button",".insert-media",function(a){var b=f(a.currentTarget),c=b.data("editor"),h={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:true};a.preventDefault();if(b.hasClass("gallery")){h.state="gallery";h.title=wp.media.view.l10n.createGalleryTitle}wp.media.editor.open(c,h)});new wp.media.view.EditorUploader().render()}};e.bindAll(wp.media.editor,"open");f(wp.media.editor.init)}(jQuery,_));