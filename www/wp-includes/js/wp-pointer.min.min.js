(function(f){var e=0,d=9999;f.widget("wp.pointer",{options:{pointerClass:"wp-pointer",pointerWidth:320,content:function(){return f(this).text()},buttons:function(b,c){var a=(wpPointerL10n)?wpPointerL10n.dismiss:"Dismiss",h=f('<a class="close" href="#">'+a+"</a>");return h.bind("click.pointer",function(g){g.preventDefault();c.element.pointer("close")})},position:"top",show:function(a,b){b.pointer.show();b.opened()},hide:function(a,b){b.pointer.hide();b.closed()},document:document},_create:function(){var a,b;this.content=f('<div class="wp-pointer-content"></div>');this.arrow=f('<div class="wp-pointer-arrow"><div class="wp-pointer-arrow-inner"></div></div>');b=this.element.parents().add(this.element);a="absolute";if(b.filter(function(){return"fixed"===f(this).css("position")}).length){a="fixed"}this.pointer=f("<div />").append(this.content).append(this.arrow).attr("id","wp-pointer-"+e++).addClass(this.options.pointerClass).css({position:a,width:this.options.pointerWidth+"px",display:"none"}).appendTo(this.options.document.body)},_setOption:function(h,b){var a=this.options,c=this.pointer;if(h==="document"&&b!==a.document){c.detach().appendTo(b.body)}else{if(h==="pointerClass"){c.removeClass(a.pointerClass).addClass(b)}}f.Widget.prototype._setOption.apply(this,arguments);if(h==="position"){this.reposition()}else{if(h==="content"&&this.active){this.update()}}},destroy:function(){this.pointer.remove();f.Widget.prototype.destroy.call(this)},widget:function(){return this.pointer},update:function(b){var i=this,a=this.options,j=f.Deferred(),c;if(a.disabled){return}j.done(function(g){i._update(b,g)});if(typeof a.content==="string"){c=a.content}else{c=a.content.call(this.element[0],j.resolve,b,this._handoff())}if(c){j.resolve(c)}return j.promise()},_update:function(b,c){var h,a=this.options;if(!c){return}this.pointer.stop();this.content.html(c);h=a.buttons.call(this.element[0],b,this._handoff());if(h){h.wrap('<div class="wp-pointer-buttons" />').parent().appendTo(this.content)}this.reposition()},reposition:function(){var a;if(this.options.disabled){return}a=this._processPosition(this.options.position);this.pointer.css({top:0,left:0,zIndex:d++}).show().position(f.extend({of:this.element,collision:"fit none"},a));this.repoint()},repoint:function(){var a=this.options,b;if(a.disabled){return}b=(typeof a.position=="string")?a.position:a.position.edge;this.pointer[0].className=this.pointer[0].className.replace(/wp-pointer-[^\s'"]*/,"");this.pointer.addClass("wp-pointer-"+b)},_processPosition:function(b){var a={top:"bottom",bottom:"top",left:"right",right:"left"},c;if(typeof b=="string"){c={edge:b+""}}else{c=f.extend({},b)}if(!c.edge){return c}if(c.edge=="top"||c.edge=="bottom"){c.align=c.align||"left";c.at=c.at||c.align+" "+a[c.edge];c.my=c.my||c.align+" "+c.edge}else{c.align=c.align||"top";c.at=c.at||a[c.edge]+" "+c.align;c.my=c.my||c.edge+" "+c.align}return c},open:function(b){var c=this,a=this.options;if(this.active||a.disabled||this.element.is(":hidden")){return}this.update().done(function(){c._open(b)})},_open:function(b){var c=this,a=this.options;if(this.active||a.disabled||this.element.is(":hidden")){return}this.active=true;this._trigger("open",b,this._handoff());this._trigger("show",b,this._handoff({opened:function(){c._trigger("opened",b,c._handoff())}}))},close:function(a){if(!this.active||this.options.disabled){return}var b=this;this.active=false;this._trigger("close",a,this._handoff());this._trigger("hide",a,this._handoff({closed:function(){b._trigger("closed",a,b._handoff())}}))},sendToTop:function(){if(this.active){this.pointer.css("z-index",d++)}},toggle:function(a){if(this.pointer.is(":hidden")){this.open(a)}else{this.close(a)}},_handoff:function(a){return f.extend({pointer:this.pointer,element:this.element},a)}})})(jQuery);