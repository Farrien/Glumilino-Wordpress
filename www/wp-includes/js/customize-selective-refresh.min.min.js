wp.customize.selectiveRefresh=(function(h,i){var f,g,j;f={ready:h.Deferred(),editShortcutVisibility:new i.Value(),data:{partials:{},renderQueryVar:"",l10n:{shiftClickToEdit:""}},currentRequest:null};_.extend(f,i.Events);g=f.Partial=i.Class.extend({id:null,initialize:function(a,b){var c=this;b=b||{};c.id=a;c.params=_.extend({selector:null,settings:[],primarySetting:null,containerInclusive:false,fallbackRefresh:true},b.params||{});c.deferred={};c.deferred.ready=h.Deferred();c.deferred.ready.done(function(){c.ready()})},ready:function(){var a=this;_.each(a.placements(),function(b){h(b.container).attr("title",f.data.l10n.shiftClickToEdit);a.createEditShortcutForPlacement(b)});h(document).on("click",a.params.selector,function(b){if(!b.shiftKey){return}b.preventDefault();_.each(a.placements(),function(c){if(h(c.container).is(b.currentTarget)){a.showControl()}})})},createEditShortcutForPlacement:function(d){var l=this,a,e,c,b;if(!d.container){return}e=h(d.container);c="head";b="area, audio, base, bdi, bdo, br, button, canvas, col, colgroup, command, datalist, embed, head, hr, html, iframe, img, input, keygen, label, link, map, math, menu, meta, noscript, object, optgroup, option, param, progress, rp, rt, ruby, script, select, source, style, svg, table, tbody, textarea, tfoot, thead, title, tr, track, video, wbr";if(!e.length||e.is(b)||e.closest(c).length){return}a=l.createEditShortcut();a.on("click",function(k){k.preventDefault();k.stopPropagation();l.showControl()});l.addEditShortcutToPlacement(d,a)},addEditShortcutToPlacement:function(b,a){var c=h(b.container);c.prepend(a);if(!c.is(":visible")||"none"===c.css("display")){a.addClass("customize-partial-edit-shortcut-hidden")}},getEditShortcutClassName:function(){var b=this,a;a=b.id.replace(/]/g,"").replace(/\[/g,"-");return"customize-partial-edit-shortcut-"+a},getEditShortcutTitle:function(){var b=this,a=f.data.l10n;switch(b.getType()){case"widget":return a.clickEditWidget;case"blogname":return a.clickEditTitle;case"blogdescription":return a.clickEditTitle;case"nav_menu":return a.clickEditMenu;default:return a.clickEditMisc}},getType:function(){var b=this,a;a=b.params.primarySetting||_.first(b.settings())||"unknown";if(b.params.type){return b.params.type}if(a.match(/^nav_menu_instance\[/)){return"nav_menu"}if(a.match(/^widget_.+\[\d+]$/)){return"widget"}return a},createEditShortcut:function(){var e=this,a,d,b,c;a=e.getEditShortcutTitle();d=h("<span>",{"class":"customize-partial-edit-shortcut "+e.getEditShortcutClassName()});b=h("<button>",{"aria-label":a,title:a,"class":"customize-partial-edit-shortcut-button"});c=h('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13.89 3.39l2.71 2.72c.46.46.42 1.24.03 1.64l-8.01 8.02-5.56 1.16 1.16-5.58s7.6-7.63 7.99-8.03c.39-.39 1.22-.39 1.68.07zm-2.73 2.79l-5.59 5.61 1.11 1.11 5.54-5.65zm-2.97 8.23l5.58-5.6-1.07-1.08-5.59 5.6z"/></svg>');b.append(c);d.append(b);return d},placements:function(){var a=this,b;b=a.params.selector||"";if(b){b+=", "}b+='[data-customize-partial-id="'+a.id+'"]';return h(b).map(function(){var d=h(this),c;c=d.data("customize-partial-placement-context");if(_.isString(c)&&"{"===c.substr(0,1)){throw new Error("context JSON parse error")}return new j({partial:a,container:d,context:c})}).get()},settings:function(){var a=this;if(a.params.settings&&0!==a.params.settings.length){return a.params.settings}else{if(a.params.primarySetting){return[a.params.primarySetting]}else{return[a.id]}}},isRelatedSetting:function(a){var b=this;if(_.isString(a)){a=i(a)}if(!a){return false}return -1!==_.indexOf(b.settings(),a.id)},showControl:function(){var b=this,a=b.params.primarySetting;if(!a){a=_.first(b.settings())}if(b.getType()==="nav_menu"){if(b.params.navMenuArgs.theme_location){a="nav_menu_locations["+b.params.navMenuArgs.theme_location+"]"}else{if(b.params.navMenuArgs.menu){a="nav_menu["+String(b.params.navMenuArgs.menu)+"]"}}}i.preview.send("focus-control-for-setting",a)},preparePlacement:function(a){h(a.container).addClass("customize-partial-refreshing")},_pendingRefreshPromise:null,refresh:function(){var a=this,b;b=f.requestPartial(a);if(!a._pendingRefreshPromise){_.each(a.placements(),function(c){a.preparePlacement(c)});b.done(function(c){_.each(c,function(d){a.renderContent(d)})});b.fail(function(c,d){a.fallback(c,d)});a._pendingRefreshPromise=b;b.always(function(){a._pendingRefreshPromise=null})}return b},renderContent:function(b){var e=this,a,c;if(!b.container){e.fallback(new Error("no_container"),[b]);return false}b.container=h(b.container);if(false===b.addedContent){e.fallback(new Error("missing_render"),[b]);return false}if(!_.isString(b.addedContent)){e.fallback(new Error("non_string_content"),[b]);return false}f.orginalDocumentWrite=document.write;document.write=function(){throw new Error(f.data.l10n.badDocumentWrite)};try{a=b.addedContent;if(wp.emoji&&wp.emoji.parse&&!h.contains(document.head,b.container[0])){a=wp.emoji.parse(a)}if(e.params.containerInclusive){c=h(a);b.context=_.extend(b.context,c.data("customize-partial-placement-context")||{});c.data("customize-partial-placement-context",b.context);b.removedNodes=b.container;b.container=c;b.removedNodes.replaceWith(b.container);b.container.attr("title",f.data.l10n.shiftClickToEdit)}else{b.removedNodes=document.createDocumentFragment();while(b.container[0].firstChild){b.removedNodes.appendChild(b.container[0].firstChild)}b.container.html(a)}b.container.removeClass("customize-render-content-error")}catch(d){if("undefined"!==typeof console&&console.error){console.error(e.id,d)}}document.write=f.orginalDocumentWrite;f.orginalDocumentWrite=null;e.createEditShortcutForPlacement(b);b.container.removeClass("customize-partial-refreshing");b.container.data("customize-partial-content-rendered",true);f.trigger("partial-content-rendered",b);return true},fallback:function(){var a=this;if(a.params.fallbackRefresh){f.requestFullRefresh()}}});f.Placement=j=i.Class.extend({partial:null,container:null,startNode:null,endNode:null,context:null,addedContent:null,removedNodes:null,initialize:function(b){var a=this;b=_.extend({},b||{});if(!b.partial||!b.partial.extended(g)){throw new Error("Missing partial")}b.context=b.context||{};if(b.container){b.container=h(b.container)}_.extend(a,b)}});f.partialConstructor={};f.partial=new i.Values({defaultConstructor:g});f.getCustomizeQuery=function(){var a={};i.each(function(b,c){if(b._dirty){a[c]=b()}});return{wp_customize:"on",nonce:i.settings.nonce.preview,customize_theme:i.settings.theme.stylesheet,customized:JSON.stringify(a),customize_changeset_uuid:i.settings.changeset.uuid}};f._pendingPartialRequests={};f._debouncedTimeoutId=null;f._currentRequest=null;f.requestFullRefresh=function(){i.preview.send("refresh")};f.requestPartial=function(b){var a;if(f._debouncedTimeoutId){clearTimeout(f._debouncedTimeoutId);f._debouncedTimeoutId=null}if(f._currentRequest){f._currentRequest.abort();f._currentRequest=null}a=f._pendingPartialRequests[b.id];if(!a||"pending"!==a.deferred.state()){a={deferred:h.Deferred(),partial:b};f._pendingPartialRequests[b.id]=a}b=null;f._debouncedTimeoutId=setTimeout(function(){var c,l,e,d;f._debouncedTimeoutId=null;c=f.getCustomizeQuery();e={};l={};_.each(f._pendingPartialRequests,function(k,n){e[n]=k.partial.placements();if(!f.partial.has(n)){k.deferred.rejectWith(k.partial,[new Error("partial_removed"),e[n]])}else{l[n]=_.map(e[n],function(m){return m.context||{}})}});c.partials=JSON.stringify(l);c[f.data.renderQueryVar]="1";d=f._currentRequest=wp.ajax.send(null,{data:c,url:i.settings.url.self});d.done(function(k){f.trigger("render-partials-response",k);if(k.errors&&"undefined"!==typeof console&&console.warn){_.each(k.errors,function(n){console.warn(n)})}_.each(f._pendingPartialRequests,function(q,r){var p;if(!_.isArray(k.contents[r])){q.deferred.rejectWith(q.partial,[new Error("unrecognized_partial"),e[r]])}else{p=_.map(k.contents[r],function(m,n){var o=e[r][n];if(o){o.addedContent=m}else{o=new j({partial:q.partial,addedContent:m})}return o});q.deferred.resolveWith(q.partial,[p])}});f._pendingPartialRequests={}});d.fail(function(n,k){if("abort"===k){return}_.each(f._pendingPartialRequests,function(m,p){m.deferred.rejectWith(m.partial,[n,e[p]])});f._pendingPartialRequests={}})},i.settings.timeouts.selectiveRefresh);return a.deferred.promise()};f.addPartials=function(c,b){var a;if(!c){c=document.documentElement}c=h(c);b=_.extend({triggerRendered:true},b||{});a=c.find("[data-customize-partial-id]");if(c.is("[data-customize-partial-id]")){a=a.add(c)}a.each(function(){var s=h(this),r,p,t,e,q,d;t=s.data("customize-partial-id");if(!t){return}d=s.data("customize-partial-placement-context")||{};r=f.partial(t);if(!r){q=s.data("customize-partial-options")||{};q.constructingContainerContext=s.data("customize-partial-placement-context")||{};e=f.partialConstructor[s.data("customize-partial-type")]||f.Partial;r=new e(t,q);f.partial.add(r.id,r)}if(b.triggerRendered&&!s.data("customize-partial-content-rendered")){p=new j({partial:r,context:d,container:s});h(p.container).attr("title",f.data.l10n.shiftClickToEdit);r.createEditShortcutForPlacement(p);f.trigger("partial-content-rendered",p)}s.data("customize-partial-content-rendered",true)})};i.bind("preview-ready",function(){var c,d,b;_.extend(f.data,_customizePartialRefreshExports);_.each(f.data.partials,function(o,e){var n,p=f.partial(e);if(!p){n=f.partialConstructor[o.type]||f.Partial;p=new n(e,{params:o});f.partial.add(e,p)}else{_.extend(p.params,o)}});c=function(e,n){var m=this;f.partial.each(function(k){if(k.isRelatedSetting(m,e,n)){k.refresh()}})};d=function(e){c.call(e,e(),null);e.bind(c)};b=function(e){c.call(e,null,e());e.unbind(c)};i.bind("add",d);i.bind("remove",b);i.each(function(e){e.bind(c)});f.addPartials(document.documentElement,{triggerRendered:false});if("undefined"!==typeof MutationObserver){f.mutationObserver=new MutationObserver(function(e){_.each(e,function(l){f.addPartials(h(l.target))})});f.mutationObserver.observe(document.documentElement,{childList:true,subtree:true})}i.selectiveRefresh.bind("partial-content-rendered",function(e){if(e.container){f.addPartials(e.container)}});i.selectiveRefresh.bind("render-partials-response",function a(e){if(e.setting_validities){i.preview.send("selective-refresh-setting-validities",e.setting_validities)}});i.preview.bind("edit-shortcut-visibility",function(e){i.selectiveRefresh.editShortcutVisibility.set(e)});i.selectiveRefresh.editShortcutVisibility.bind(function(m){var n=h(document.body),e;e=("hidden"===m&&n.hasClass("customize-partial-edit-shortcuts-shown")&&!n.hasClass("customize-partial-edit-shortcuts-hidden"));n.toggleClass("customize-partial-edit-shortcuts-hidden",e);n.toggleClass("customize-partial-edit-shortcuts-shown","visible"===m)});i.preview.bind("active",function(){f.partial.each(function(e){e.deferred.ready.resolve()});f.partial.bind("add",function(e){e.deferred.ready.resolve()})})});return f}(jQuery,wp.customize));