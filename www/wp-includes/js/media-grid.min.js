(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(l){var o=b[m][1][l];return c(o?o:l)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(c,f,b){var d=wp.media.view.l10n,a;a=wp.media.controller.State.extend({defaults:{id:"edit-attachment",title:d.attachmentDetails,content:"edit-metadata",menu:false,toolbar:false,router:false}});f.exports=a},{}],2:[function(b,c,a){var d=wp.media;d.controller.EditAttachmentMetadata=b("./controllers/edit-attachment-metadata.js");d.view.MediaFrame.Manage=b("./views/frame/manage.js");d.view.Attachment.Details.TwoColumn=b("./views/attachment/details-two-column.js");d.view.MediaFrame.Manage.Router=b("./routers/manage.js");d.view.EditImage.Details=b("./views/edit-image-details.js");d.view.MediaFrame.EditAttachments=b("./views/frame/edit-attachments.js");d.view.SelectModeToggleButton=b("./views/button/select-mode-toggle.js");d.view.DeleteSelectedButton=b("./views/button/delete-selected.js");d.view.DeleteSelectedPermanentlyButton=b("./views/button/delete-selected-permanently.js")},{"./controllers/edit-attachment-metadata.js":1,"./routers/manage.js":3,"./views/attachment/details-two-column.js":4,"./views/button/delete-selected-permanently.js":5,"./views/button/delete-selected.js":6,"./views/button/select-mode-toggle.js":7,"./views/edit-image-details.js":8,"./views/frame/edit-attachments.js":9,"./views/frame/manage.js":10}],3:[function(c,d,b){var a=Backbone.Router.extend({routes:{"upload.php?item=:slug":"showItem","upload.php?search=:query":"search"},baseUrl:function(f){return"upload.php"+f},search:function(f){jQuery("#media-search-input").val(f).trigger("input")},showItem:function(h){var i=wp.media,f=i.frame.state().get("library"),g;g=f.findWhere({id:parseInt(h,10)});if(g){i.frame.trigger("edit:attachment",g)}else{g=i.attachment(h);i.frame.listenTo(g,"change",function(j){i.frame.stopListening(g);i.frame.trigger("edit:attachment",j)});g.fetch()}}});d.exports=a},{}],4:[function(c,d,b){var a=wp.media.view.Attachment.Details,f;f=a.extend({template:wp.template("attachment-details-two-column"),editAttachment:function(g){g.preventDefault();this.controller.content.mode("edit-image")},toggleSelectionHandler:function(){},render:function(){a.prototype.render.apply(this,arguments);wp.media.mixin.removeAllPlayers();this.$("audio, video").each(function(g,j){var h=wp.media.view.MediaDetails.prepareSrc(j);new window.MediaElementPlayer(h,wp.media.mixin.mejsSettings)})}});d.exports=f},{}],5:[function(c,d,b){var a=wp.media.view.Button,g=wp.media.view.DeleteSelectedButton,f;f=g.extend({initialize:function(){g.prototype.initialize.apply(this,arguments);this.controller.on("select:activate",this.selectActivate,this);this.controller.on("select:deactivate",this.selectDeactivate,this)},filterChange:function(h){this.canShow=("trash"===h.get("status"))},selectActivate:function(){this.toggleDisabled();this.$el.toggleClass("hidden",!this.canShow)},selectDeactivate:function(){this.toggleDisabled();this.$el.addClass("hidden")},render:function(){a.prototype.render.apply(this,arguments);this.selectActivate();return this}});d.exports=f},{}],6:[function(c,f,b){var a=wp.media.view.Button,d=wp.media.view.l10n,g;g=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments);if(this.options.filters){this.options.filters.model.on("change",this.filterChange,this)}this.controller.on("selection:toggle",this.toggleDisabled,this)},filterChange:function(h){if("trash"===h.get("status")){this.model.set("text",d.untrashSelected)}else{if(wp.media.view.settings.mediaTrash){this.model.set("text",d.trashSelected)}else{this.model.set("text",d.deleteSelected)}}},toggleDisabled:function(){this.model.set("disabled",!this.controller.state().get("selection").length)},render:function(){a.prototype.render.apply(this,arguments);if(this.controller.isModeActive("select")){this.$el.addClass("delete-selected-button")}else{this.$el.addClass("delete-selected-button hidden")}this.toggleDisabled();return this}});f.exports=g},{}],7:[function(c,g,b){var a=wp.media.view.Button,f=wp.media.view.l10n,d;d=a.extend({initialize:function(){_.defaults(this.options,{size:""});a.prototype.initialize.apply(this,arguments);this.controller.on("select:activate select:deactivate",this.toggleBulkEditHandler,this);this.controller.on("selection:action:done",this.back,this)},back:function(){this.controller.deactivateMode("select").activateMode("edit")},click:function(){a.prototype.click.apply(this,arguments);if(this.controller.isModeActive("select")){this.back()}else{this.controller.deactivateMode("edit").activateMode("select")}},render:function(){a.prototype.render.apply(this,arguments);this.$el.addClass("select-mode-toggle-button");return this},toggleBulkEditHandler:function(){var i=this.controller.content.get().toolbar,h;h=i.$(".media-toolbar-secondary > *, .media-toolbar-primary > *");if(this.controller.isModeActive("select")){this.model.set({size:"large",text:f.cancelSelection});h.not(".spinner, .media-button").hide();this.$el.show();i.$(".delete-selected-button").removeClass("hidden")}else{this.model.set({size:"",text:f.bulkSelect});this.controller.content.get().$el.removeClass("fixed");i.$el.css("width","");i.$(".delete-selected-button").addClass("hidden");h.not(".media-button").show();this.controller.state().get("selection").reset()}}});g.exports=d},{}],8:[function(d,f,b){var g=wp.media.View,c=wp.media.view.EditImage,a;a=c.extend({initialize:function(h){this.editor=window.imageEdit;this.frame=h.frame;this.controller=h.controller;g.prototype.initialize.apply(this,arguments)},back:function(){this.frame.content.mode("edit-metadata")},save:function(){this.model.fetch().done(_.bind(function(){this.frame.content.mode("edit-metadata")},this))}});f.exports=a},{}],9:[function(c,f,b){var d=wp.media.view.Frame,h=wp.media.view.MediaFrame,g=jQuery,a;a=h.extend({className:"edit-attachment-frame",template:wp.template("edit-attachment-frame"),regions:["title","content"],events:{"click .left":"previousMediaItem","click .right":"nextMediaItem"},initialize:function(){d.prototype.initialize.apply(this,arguments);_.defaults(this.options,{modal:true,state:"edit-attachment"});this.controller=this.options.controller;this.gridRouter=this.controller.gridRouter;this.library=this.options.library;if(this.options.model){this.model=this.options.model}this.bindHandlers();this.createStates();this.createModal();this.title.mode("default");this.toggleNav()},bindHandlers:function(){this.on("title:create:default",this.createTitle,this);this.listenTo(this.model,"change:status destroy",this.close,this);this.on("content:create:edit-metadata",this.editMetadataMode,this);this.on("content:create:edit-image",this.editImageMode,this);this.on("content:render:edit-image",this.editImageModeRender,this);this.on("close",this.detach)},createModal:function(){if(this.options.modal){this.modal=new wp.media.view.Modal({controller:this,title:this.options.title});this.modal.on("open",_.bind(function(){g("body").on("keydown.media-modal",_.bind(this.keyEvent,this))},this));this.modal.on("close",_.bind(function(){this.modal.remove();g("body").off("keydown.media-modal");g('li.attachment[data-id="'+this.model.get("id")+'"]').focus();this.resetRoute()},this));this.modal.content(this);this.modal.open()}},createStates:function(){this.states.add([new wp.media.controller.EditAttachmentMetadata({model:this.model})])},editMetadataMode:function(i){i.view=new wp.media.view.Attachment.Details.TwoColumn({controller:this,model:this.model});i.view.views.set(".attachment-compat",new wp.media.view.AttachmentCompat({controller:this,model:this.model}));if(this.model){this.gridRouter.navigate(this.gridRouter.baseUrl("?item="+this.model.id))}},editImageMode:function(j){var i=new wp.media.controller.EditImage({model:this.model,frame:this});i._toolbar=function(){};i._router=function(){};i._menu=function(){};j.view=new wp.media.view.EditImage.Details({model:this.model,frame:this,controller:i})},editImageModeRender:function(i){i.on("ready",i.loadEditor)},toggleNav:function(){this.$(".left").toggleClass("disabled",!this.hasPrevious());this.$(".right").toggleClass("disabled",!this.hasNext())},rerender:function(){if(this.content.mode()!=="edit-metadata"){this.content.mode("edit-metadata")}else{this.content.render()}this.toggleNav()},previousMediaItem:function(){if(!this.hasPrevious()){this.$(".left").blur();return}this.model=this.library.at(this.getCurrentIndex()-1);this.rerender();this.$(".left").focus()},nextMediaItem:function(){if(!this.hasNext()){this.$(".right").blur();return}this.model=this.library.at(this.getCurrentIndex()+1);this.rerender();this.$(".right").focus()},getCurrentIndex:function(){return this.library.indexOf(this.model)},hasNext:function(){return(this.getCurrentIndex()+1)<this.library.length},hasPrevious:function(){return(this.getCurrentIndex()-1)>-1},keyEvent:function(i){if(("INPUT"===i.target.nodeName||"TEXTAREA"===i.target.nodeName)&&!(i.target.readOnly||i.target.disabled)){return}if(39===i.keyCode){this.nextMediaItem()}if(37===i.keyCode){this.previousMediaItem()}},resetRoute:function(){this.gridRouter.navigate(this.gridRouter.baseUrl(""))}});f.exports=a},{}],10:[function(c,d,a){var g=wp.media.view.MediaFrame,h=wp.media.controller.Library,f=Backbone.$,b;b=g.extend({initialize:function(){_.defaults(this.options,{title:"",modal:false,selection:[],library:{},multiple:"add",state:"library",uploader:true,mode:["grid","edit"]});this.$body=f(document.body);this.$window=f(window);this.$adminBar=f("#wpadminbar");this.$window.on("scroll resize",_.debounce(_.bind(this.fixPosition,this),15));f(document).on("click",".page-title-action",_.bind(this.addNewClickHandler,this));this.$el.addClass("wp-core-ui");if(wp.Uploader.limitExceeded||!wp.Uploader.browser.supported){this.options.uploader=false}if(this.options.uploader){this.uploader=new wp.media.view.UploaderWindow({controller:this,uploader:{dropzone:document.body,container:document.body}}).render();this.uploader.ready();f("body").append(this.uploader.el);this.options.uploader=false}this.gridRouter=new wp.media.view.MediaFrame.Manage.Router();g.prototype.initialize.apply(this,arguments);this.$el.appendTo(this.options.container);this.createStates();this.bindRegionModeHandlers();this.render();this.bindSearchHandler()},bindSearchHandler:function(){var k=this.$("#media-search-input"),j=this.options.container.data("search"),m=this.browserView.toolbar.get("search").$el,l=this.$(".view-list"),i=_.debounce(function(o){var p=f(o.currentTarget).val(),n="";if(p){n+="?search="+p}this.gridRouter.navigate(this.gridRouter.baseUrl(n))},1000);k.on("input",_.bind(i,this));m.val(j).trigger("input");this.gridRouter.on("route:search",function(){var n=window.location.href;if(n.indexOf("mode=")>-1){n=n.replace(/mode=[^&]+/g,"mode=list")}else{n+=n.indexOf("?")>-1?"&mode=list":"?mode=list"}n=n.replace("search=","s=");l.prop("href",n)})},createStates:function(){var i=this.options;if(this.options.states){return}this.states.add([new h({library:wp.media.query(i.library),multiple:i.multiple,title:i.title,content:"browse",toolbar:"select",contentUserSetting:false,filterable:"all",autoSelect:false})])},bindRegionModeHandlers:function(){this.on("content:create:browse",this.browseContent,this);this.on("edit:attachment",this.openEditAttachmentModal,this);this.on("select:activate",this.bindKeydown,this);this.on("select:deactivate",this.unbindKeydown,this)},handleKeydown:function(i){if(27===i.which){i.preventDefault();this.deactivateMode("select").activateMode("edit")}},bindKeydown:function(){this.$body.on("keydown.select",_.bind(this.handleKeydown,this))},unbindKeydown:function(){this.$body.off("keydown.select")},fixPosition:function(){var i,j;if(!this.isModeActive("select")){return}i=this.$(".attachments-browser");j=i.find(".media-toolbar");if((i.offset().top+16)<this.$window.scrollTop()+this.$adminBar.height()){i.addClass("fixed");j.css("width",i.width()+"px")}else{i.removeClass("fixed");j.css("width","")}},addNewClickHandler:function(i){i.preventDefault();this.trigger("toggle:upload:attachment");if(this.uploader){this.uploader.refresh()}},openEditAttachmentModal:function(i){wp.media({frame:"edit-attachments",controller:this,library:this.state().get("library"),model:i})},browseContent:function(i){var j=this.state();this.browserView=i.view=new wp.media.view.AttachmentsBrowser({controller:this,collection:j.get("library"),selection:j.get("selection"),model:j,sortable:j.get("sortable"),search:j.get("searchable"),filters:j.get("filterable"),date:j.get("date"),display:j.get("displaySettings"),dragInfo:j.get("dragInfo"),sidebar:"errors",suggestedWidth:j.get("suggestedWidth"),suggestedHeight:j.get("suggestedHeight"),AttachmentView:j.get("AttachmentView"),scrollElement:document});this.browserView.on("ready",_.bind(this.bindDeferred,this));this.errors=wp.Uploader.errors;this.errors.on("add remove reset",this.sidebarVisibility,this)},sidebarVisibility:function(){this.browserView.$(".media-sidebar").toggle(!!this.errors.length)},bindDeferred:function(){if(!this.browserView.dfd){return}this.browserView.dfd.done(_.bind(this.startHistory,this))},startHistory:function(){if(window.history&&window.history.pushState){Backbone.history.start({root:window._wpMediaGridSettings.adminUrl,pushState:true})}}});d.exports=b},{}]},{},[2]);