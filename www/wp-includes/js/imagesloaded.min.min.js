(function(){function h(){}function g(e,d){for(var f=e.length;f--;){if(e[f].listener===d){return f}}return -1}function l(b){return function(){return this[b].apply(this,arguments)}}var k=h.prototype,j=this,i=j.EventEmitter;k.getListeners=function(f){var e,n,m=this._getEvents();if("object"==typeof f){e={};for(n in m){m.hasOwnProperty(n)&&f.test(n)&&(e[n]=m[n])}}else{e=m[f]||(m[f]=[])}return e},k.flattenListeners=function(e){var d,f=[];for(d=0;d<e.length;d+=1){f.push(e[d].listener)}return f},k.getListenersAsObject=function(e){var d,f=this.getListeners(e);return f instanceof Array&&(d={},d[e]=f),d||f},k.addListener=function(b,p){var o,n=this.getListenersAsObject(b),m="object"==typeof p;for(o in n){n.hasOwnProperty(o)&&-1===g(n[o],p)&&n[o].push(m?p:{listener:p,once:!1})}return this},k.on=l("addListener"),k.addOnceListener=function(d,c){return this.addListener(d,{listener:c,once:!0})},k.once=l("addOnceListener"),k.defineEvent=function(b){return this.getListeners(b),this},k.defineEvents=function(d){for(var c=0;c<d.length;c+=1){this.defineEvent(d[c])}return this},k.removeListener=function(b,p){var o,n,m=this.getListenersAsObject(b);for(n in m){m.hasOwnProperty(n)&&(o=g(m[n],p),-1!==o&&m[n].splice(o,1))}return this},k.off=l("removeListener"),k.addListeners=function(d,c){return this.manipulateListeners(!1,d,c)},k.removeListeners=function(d,c){return this.manipulateListeners(!0,d,c)},k.manipulateListeners=function(n,m,s){var r,q,p=n?this.removeListener:this.addListener,o=n?this.removeListeners:this.addListeners;if("object"!=typeof m||m instanceof RegExp){for(r=s.length;r--;){p.call(this,m,s[r])}}else{for(r in m){m.hasOwnProperty(r)&&(q=m[r])&&("function"==typeof q?p.call(this,r,q):o.call(this,r,q))}}return this},k.removeEvent=function(f){var e,n=typeof f,m=this._getEvents();if("string"===n){delete m[f]}else{if("object"===n){for(e in m){m.hasOwnProperty(e)&&f.test(e)&&delete m[e]}}else{delete this._events}}return this},k.removeAllListeners=l("removeEvent"),k.emitEvent=function(n,m){var s,r,q,p,o=this.getListenersAsObject(n);for(q in o){if(o.hasOwnProperty(q)){for(r=o[q].length;r--;){s=o[q][r],s.once===!0&&this.removeListener(n,s.listener),p=s.listener.apply(this,m||[]),p===this._getOnceReturnValue()&&this.removeListener(n,s.listener)}}}return this},k.trigger=l("emitEvent"),k.emit=function(d){var c=Array.prototype.slice.call(arguments,1);return this.emitEvent(d,c)},k.setOnceReturnValue=function(b){return this._onceReturnValue=b,this},k._getOnceReturnValue=function(){return !this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},k._getEvents=function(){return this._events||(this._events={})},h.noConflict=function(){return j.EventEmitter=i,h},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return h}):"object"==typeof module&&module.exports?module.exports=h:this.EventEmitter=h}).call(this),function(h){function g(a){var d=h.event;return d.target=d.target||d.srcElement||a,d}var l=document.documentElement,k=function(){};l.addEventListener?k=function(e,d,f){e.addEventListener(d,f,!1)}:l.attachEvent&&(k=function(b,f,e){b[f+e]=e.handleEvent?function(){var a=g(b);e.handleEvent.call(e,a)}:function(){var a=g(b);e.call(b,a)},b.attachEvent("on"+f,b[f+e])});var j=function(){};l.removeEventListener?j=function(e,d,f){e.removeEventListener(d,f,!1)}:l.detachEvent&&(j=function(f,e,n){f.detachEvent("on"+e,f[e+n]);try{delete f[e+n]}catch(m){f[e+n]=void 0}});var i={bind:k,unbind:j};"function"==typeof define&&define.amd?define("eventie/eventie",i):h.eventie=i}(this),function(d,c){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(b,a){return c(d,b,a)}):"object"==typeof module&&module.exports?module.exports=c(d,require("wolfy87-eventemitter"),require("eventie")):d.imagesLoaded=c(d,d.EventEmitter,d.eventie)}(window,function(B,A,z){function y(e,d){for(var f in d){e[f]=d[f]}return e}function x(b){return"[object Array]"==q.call(b)}function w(e){var d=[];if(x(e)){d=e}else{if("number"==typeof e.length){for(var f=0;f<e.length;f++){d.push(e[f])}}else{d.push(e)}}return d}function v(f,d,h){if(!(this instanceof v)){return new v(f,d,h)}"string"==typeof f&&(f=document.querySelectorAll(f)),this.elements=w(f),this.options=y({},this.options),"function"==typeof d?h=d:y(this.options,d),h&&this.on("always",h),this.getImages(),s&&(this.jqDeferred=new s.Deferred);var g=this;setTimeout(function(){g.check()})}function u(b){this.img=b}function t(d,c){this.url=d,this.element=c,this.img=new Image}var s=B.jQuery,r=B.console,q=Object.prototype.toString;v.prototype=new A,v.prototype.options={},v.prototype.getImages=function(){this.images=[];for(var d=0;d<this.elements.length;d++){var c=this.elements[d];this.addElementImages(c)}},v.prototype.addElementImages=function(i){"IMG"==i.nodeName&&this.addImage(i),this.options.background===!0&&this.addElementBackgroundImages(i);var h=i.nodeType;if(h&&p[h]){for(var n=i.querySelectorAll("img"),m=0;m<n.length;m++){var l=n[m];this.addImage(l)}if("string"==typeof this.options.background){var k=i.querySelectorAll(this.options.background);for(m=0;m<k.length;m++){var j=k[m];this.addElementBackgroundImages(j)}}}};var p={1:!0,9:!0,11:!0};v.prototype.addElementBackgroundImages=function(g){for(var f=o(g),j=/url\(['"]*([^'"\)]+)['"]*\)/gi,i=j.exec(f.backgroundImage);null!==i;){var h=i&&i[1];h&&this.addBackground(h,g),i=j.exec(f.backgroundImage)}};var o=B.getComputedStyle||function(b){return b.currentStyle};return v.prototype.addImage=function(d){var c=new u(d);this.images.push(c)},v.prototype.addBackground=function(e,d){var f=new t(e,d);this.images.push(f)},v.prototype.check=function(){function f(b,j,i){setTimeout(function(){e.progress(b,j,i)})}var e=this;if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length){return void this.complete()}for(var h=0;h<this.images.length;h++){var g=this.images[h];g.once("progress",f),g.check()}},v.prototype.progress=function(e,d,f){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emit("progress",this,e,d),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&r&&r.log("progress: "+f,e,d)},v.prototype.complete=function(){var d=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emit(d,this),this.emit("always",this),this.jqDeferred){var c=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[c](this)}},u.prototype=new A,u.prototype.check=function(){var b=this.getIsImageComplete();return b?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,z.bind(this.proxyImage,"load",this),z.bind(this.proxyImage,"error",this),z.bind(this.img,"load",this),z.bind(this.img,"error",this),void (this.proxyImage.src=this.img.src))},u.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},u.prototype.confirm=function(d,c){this.isLoaded=d,this.emit("progress",this,this.img,c)},u.prototype.handleEvent=function(d){var c="on"+d.type;this[c]&&this[c](d)},u.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},u.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},u.prototype.unbindEvents=function(){z.unbind(this.proxyImage,"load",this),z.unbind(this.proxyImage,"error",this),z.unbind(this.img,"load",this),z.unbind(this.img,"error",this)},t.prototype=new u,t.prototype.check=function(){z.bind(this.img,"load",this),z.bind(this.img,"error",this),this.img.src=this.url;var b=this.getIsImageComplete();b&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},t.prototype.unbindEvents=function(){z.unbind(this.img,"load",this),z.unbind(this.img,"error",this)},t.prototype.confirm=function(d,c){this.isLoaded=d,this.emit("progress",this,this.element,c)},v.makeJQueryPlugin=function(a){a=a||B.jQuery,a&&(s=a,s.fn.imagesLoaded=function(e,d){var f=new v(this,e,d);return f.jqDeferred.promise(s(this))})},v.makeJQueryPlugin(),v});