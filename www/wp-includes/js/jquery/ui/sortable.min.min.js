/*!
 * jQuery UI Sortable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/sortable/
 */
;!function(b){"function"==typeof define&&define.amd?define(["jquery","./core","./mouse","./widget"],b):b(jQuery)}(function(b){return b.widget("ui.sortable",b.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,d,f){return e>=d&&e<d+f},_isFloating:function(c){return/left|right/.test(c.css("float"))||/inline|table-cell/.test(c.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(d,c){this._super(d,c),"handle"===d&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),b.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var c=this.items.length-1;c>=0;c--){this.items[c].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function(a,j){var i=null,h=!1,g=this;return !this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(a),b(a.target).parents().each(function(){if(b.data(this,g.widgetName+"-item")===g){return i=b(this),!1}}),b.data(a.target,g.widgetName+"-item")===g&&(i=b(a.target)),!!i&&(!(this.options.handle&&!j&&(b(this.options.handle,i).find("*").addBack().each(function(){this===a.target&&(h=!0)}),!h))&&(this.currentItem=i,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(a,l,k){var j,i,h=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(a),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},b.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(a),this.originalPageX=a.pageX,this.originalPageY=a.pageY,h.cursorAt&&this._adjustOffsetFromHelper(h.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),h.containment&&this._setContainment(),h.cursor&&"auto"!==h.cursor&&(i=this.document.find("body"),this.storedCursor=i.css("cursor"),i.css("cursor",h.cursor),this.storedStylesheet=b("<style>*{ cursor: "+h.cursor+" !important; }</style>").appendTo(i)),h.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",h.opacity)),h.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",h.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",a,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!k){for(j=this.containers.length-1;j>=0;j--){this.containers[j]._trigger("activate",a,this._uiHash(this))}}return b.ui.ddmanager&&(b.ui.ddmanager.current=this),b.ui.ddmanager&&!h.dropBehaviour&&b.ui.ddmanager.prepareOffsets(this,a),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(a),!0},_mouseDrag:function(a){var n,m,l,k,j=this.options,i=!1;for(this.position=this._generatePosition(a),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<j.scrollSensitivity?this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+j.scrollSpeed:a.pageY-this.overflowOffset.top<j.scrollSensitivity&&(this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-j.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<j.scrollSensitivity?this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+j.scrollSpeed:a.pageX-this.overflowOffset.left<j.scrollSensitivity&&(this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-j.scrollSpeed)):(a.pageY-this.document.scrollTop()<j.scrollSensitivity?i=this.document.scrollTop(this.document.scrollTop()-j.scrollSpeed):this.window.height()-(a.pageY-this.document.scrollTop())<j.scrollSensitivity&&(i=this.document.scrollTop(this.document.scrollTop()+j.scrollSpeed)),a.pageX-this.document.scrollLeft()<j.scrollSensitivity?i=this.document.scrollLeft(this.document.scrollLeft()-j.scrollSpeed):this.window.width()-(a.pageX-this.document.scrollLeft())<j.scrollSensitivity&&(i=this.document.scrollLeft(this.document.scrollLeft()+j.scrollSpeed))),i!==!1&&b.ui.ddmanager&&!j.dropBehaviour&&b.ui.ddmanager.prepareOffsets(this,a)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--){if(m=this.items[n],l=m.item[0],k=this._intersectsWithPointer(m),k&&m.instance===this.currentContainer&&!(l===this.currentItem[0]||this.placeholder[1===k?"next":"prev"]()[0]===l||b.contains(this.placeholder[0],l)||"semi-dynamic"===this.options.type&&b.contains(this.element[0],l))){if(this.direction=1===k?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(m)){break}this._rearrange(a,m),this._trigger("change",a,this._uiHash());break}}return this._contactContainers(a),b.ui.ddmanager&&b.ui.ddmanager.drag(this,a),this._trigger("sort",a,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(a,l){if(a){if(b.ui.ddmanager&&!this.options.dropBehaviour&&b.ui.ddmanager.drop(this,a),this.options.revert){var k=this,j=this.placeholder.offset(),i=this.options.axis,h={};i&&"x"!==i||(h.left=j.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),i&&"y"!==i||(h.top=j.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,b(this.helper).animate(h,parseInt(this.options.revert,10)||500,function(){k._clear(a)})}else{this._clear(a,l)}return !1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var a=this.containers.length-1;a>=0;a--){this.containers[a]._trigger("deactivate",null,this._uiHash(this)),this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",null,this._uiHash(this)),this.containers[a].containerCache.over=0)}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),b.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?b(this.domPosition.prev).after(this.currentItem):b(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(a){var f=this._getItemsAsjQuery(a&&a.connected),e=[];return a=a||{},b(f).each(function(){var d=(b(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[\-=_](.+)/);d&&e.push((a.key||d[1]+"[]")+"="+(a.key&&a.expression?d[1]:d[2]))}),!e.length&&a.key&&e.push(a.key+"="),e.join("&")},toArray:function(a){var f=this._getItemsAsjQuery(a&&a.connected),e=[];return a=a||{},f.each(function(){e.push(b(a.item||this).attr(a.attribute||"id")||"")}),e},_intersectsWith:function(B){var A=this.positionAbs.left,z=A+this.helperProportions.width,y=this.positionAbs.top,x=y+this.helperProportions.height,w=B.left,v=w+B.width,u=B.top,t=u+B.height,s=this.offset.click.top,r=this.offset.click.left,q="x"===this.options.axis||y+s>u&&y+s<t,p="y"===this.options.axis||A+r>w&&A+r<v,o=q&&p;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>B[this.floating?"width":"height"]?o:w<A+this.helperProportions.width/2&&z-this.helperProportions.width/2<v&&u<y+this.helperProportions.height/2&&x-this.helperProportions.height/2<t},_intersectsWithPointer:function(h){var g="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,h.top,h.height),l="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,h.left,h.width),k=g&&l,j=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return !!k&&(this.floating?i&&"right"===i||"down"===j?2:1:j&&("down"===j?2:1))},_intersectsWithSides:function(g){var f=this._isOverAxis(this.positionAbs.top+this.offset.click.top,g.top+g.height/2,g.height),j=this._isOverAxis(this.positionAbs.left+this.offset.click.left,g.left+g.width/2,g.width),i=this._getDragVerticalDirection(),h=this._getDragHorizontalDirection();return this.floating&&h?"right"===h&&j||"left"===h&&!j:i&&("down"===i&&f||"up"===i&&!f)},_getDragVerticalDirection:function(){var c=this.positionAbs.top-this.lastPositionAbs.top;return 0!==c&&(c>0?"down":"up")},_getDragHorizontalDirection:function(){var c=this.positionAbs.left-this.lastPositionAbs.left;return 0!==c&&(c>0?"right":"left")},refresh:function(c){return this._refreshItems(c),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var c=this.options;return c.connectWith.constructor===String?[c.connectWith]:c.connectWith},_getItemsAsjQuery:function(r){function q(){l.push(this)}var p,o,n,m,l=[],k=[],a=this._connectWith();if(a&&r){for(p=a.length-1;p>=0;p--){for(n=b(a[p],this.document[0]),o=n.length-1;o>=0;o--){m=b.data(n[o],this.widgetFullName),m&&m!==this&&!m.options.disabled&&k.push([b.isFunction(m.options.items)?m.options.items.call(m.element):b(m.options.items,m.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),m])}}}for(k.push([b.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):b(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),p=k.length-1;p>=0;p--){k[p][0].each(q)}return b(l)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=b.grep(this.items,function(d){for(var e=0;e<a.length;e++){if(a[e]===d.item[0]){return !1}}return !0})},_refreshItems:function(x){this.items=[],this.containers=[this];var w,v,u,t,s,r,q,p,o=this.items,n=[[b.isFunction(this.options.items)?this.options.items.call(this.element[0],x,{item:this.currentItem}):b(this.options.items,this.element),this]],a=this._connectWith();if(a&&this.ready){for(w=a.length-1;w>=0;w--){for(u=b(a[w],this.document[0]),v=u.length-1;v>=0;v--){t=b.data(u[v],this.widgetFullName),t&&t!==this&&!t.options.disabled&&(n.push([b.isFunction(t.options.items)?t.options.items.call(t.element[0],x,{item:this.currentItem}):b(t.options.items,t.element),t]),this.containers.push(t))}}}for(w=n.length-1;w>=0;w--){for(s=n[w][1],r=n[w][0],v=0,p=r.length;v<p;v++){q=b(r[v]),q.data(this.widgetName+"-item",s),o.push({item:q,instance:s,width:0,height:0,left:0,top:0})}}},refreshPositions:function(a){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var j,i,h,g;for(j=this.items.length-1;j>=0;j--){i=this.items[j],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(h=this.options.toleranceElement?b(this.options.toleranceElement,i.item):i.item,a||(i.width=h.outerWidth(),i.height=h.outerHeight()),g=h.offset(),i.left=g.left,i.top=g.top)}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(j=this.containers.length-1;j>=0;j--){g=this.containers[j].element.offset(),this.containers[j].containerCache.left=g.left,this.containers[j].containerCache.top=g.top,this.containers[j].containerCache.width=this.containers[j].element.outerWidth(),this.containers[j].containerCache.height=this.containers[j].element.outerHeight()}}return this},_createPlaceholder:function(a){a=a||this;var f,e=a.options;e.placeholder&&e.placeholder.constructor!==String||(f=e.placeholder,e.placeholder={element:function(){var g=a.currentItem[0].nodeName.toLowerCase(),c=b("<"+g+">",a.document[0]).addClass(f||a.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===g?a._createTrPlaceholder(a.currentItem.find("tr").eq(0),b("<tr>",a.document[0]).appendTo(c)):"tr"===g?a._createTrPlaceholder(a.currentItem,c):"img"===g&&c.attr("src",a.currentItem.attr("src")),f||c.css("visibility","hidden"),c},update:function(c,d){f&&!e.forcePlaceholderSize||(d.height()||d.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10)),d.width()||d.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10)))}}),a.placeholder=b(e.placeholder.element.call(a.element,a.currentItem)),a.currentItem.after(a.placeholder),e.placeholder.update(a,a.placeholder)},_createTrPlaceholder:function(a,f){var e=this;a.children().each(function(){b("<td>&#160;</td>",e.document[0]).attr("colspan",b(this).attr("colspan")||1).appendTo(f)})},_contactContainers:function(z){var y,x,w,v,u,t,s,r,q,p,o=null,a=null;for(y=this.containers.length-1;y>=0;y--){if(!b.contains(this.currentItem[0],this.containers[y].element[0])){if(this._intersectsWith(this.containers[y].containerCache)){if(o&&b.contains(this.containers[y].element[0],o.element[0])){continue}o=this.containers[y],a=y}else{this.containers[y].containerCache.over&&(this.containers[y]._trigger("out",z,this._uiHash(this)),this.containers[y].containerCache.over=0)}}}if(o){if(1===this.containers.length){this.containers[a].containerCache.over||(this.containers[a]._trigger("over",z,this._uiHash(this)),this.containers[a].containerCache.over=1)}else{for(w=10000,v=null,q=o.floating||this._isFloating(this.currentItem),u=q?"left":"top",t=q?"width":"height",p=q?"clientX":"clientY",x=this.items.length-1;x>=0;x--){b.contains(this.containers[a].element[0],this.items[x].item[0])&&this.items[x].item[0]!==this.currentItem[0]&&(s=this.items[x].item.offset()[u],r=!1,z[p]-s>this.items[x][t]/2&&(r=!0),Math.abs(z[p]-s)<w&&(w=Math.abs(z[p]-s),v=this.items[x],this.direction=r?"up":"down"))}if(!v&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[a]){return void (this.currentContainer.containerCache.over||(this.containers[a]._trigger("over",z,this._uiHash()),this.currentContainer.containerCache.over=1))}v?this._rearrange(z,v,null,!0):this._rearrange(z,null,this.containers[a].element,!0),this._trigger("change",z,this._uiHash()),this.containers[a]._trigger("change",z,this._uiHash(this)),this.currentContainer=this.containers[a],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[a]._trigger("over",z,this._uiHash(this)),this.containers[a].containerCache.over=1}}},_createHelper:function(a){var f=this.options,e=b.isFunction(f.helper)?b(f.helper.apply(this.element[0],[a,this.currentItem])):"clone"===f.helper?this.currentItem.clone():this.currentItem;return e.parents("body").length||b("parent"!==f.appendTo?f.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),e[0].style.width&&!f.forceHelperSize||e.width(this.currentItem.width()),e[0].style.height&&!f.forceHelperSize||e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" ")),b.isArray(a)&&(a={left:+a[0],top:+a[1]||0}),"left" in a&&(this.offset.click.left=a.left+this.margins.left),"right" in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top" in a&&(this.offset.click.top=a.top+this.margins.top),"bottom" in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&b.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&b.ui.ie)&&(a={top:0,left:0}),{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var c=this.currentItem.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a,h,g,f=this.options;"parent"===f.containment&&(f.containment=this.helper[0].parentNode),"document"!==f.containment&&"window"!==f.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===f.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===f.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(f.containment)||(a=b(f.containment)[0],h=b(f.containment).offset(),g="hidden"!==b(a).css("overflow"),this.containment=[h.left+(parseInt(b(a).css("borderLeftWidth"),10)||0)+(parseInt(b(a).css("paddingLeft"),10)||0)-this.margins.left,h.top+(parseInt(b(a).css("borderTopWidth"),10)||0)+(parseInt(b(a).css("paddingTop"),10)||0)-this.margins.top,h.left+(g?Math.max(a.scrollWidth,a.offsetWidth):a.offsetWidth)-(parseInt(b(a).css("borderLeftWidth"),10)||0)-(parseInt(b(a).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,h.top+(g?Math.max(a.scrollHeight,a.offsetHeight):a.offsetHeight)-(parseInt(b(a).css("borderTopWidth"),10)||0)-(parseInt(b(a).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(a,j){j||(j=this.position);var i="absolute"===a?1:-1,h="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&b.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(h[0].tagName);return{top:j.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():g?0:h.scrollTop())*i,left:j.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():g?0:h.scrollLeft())*i}},_generatePosition:function(a){var p,o,n=this.options,m=a.pageX,l=a.pageY,k="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&b.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,j=/(html|body)/i.test(k[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(a.pageX-this.offset.click.left<this.containment[0]&&(m=this.containment[0]+this.offset.click.left),a.pageY-this.offset.click.top<this.containment[1]&&(l=this.containment[1]+this.offset.click.top),a.pageX-this.offset.click.left>this.containment[2]&&(m=this.containment[2]+this.offset.click.left),a.pageY-this.offset.click.top>this.containment[3]&&(l=this.containment[3]+this.offset.click.top)),n.grid&&(p=this.originalPageY+Math.round((l-this.originalPageY)/n.grid[1])*n.grid[1],l=this.containment?p-this.offset.click.top>=this.containment[1]&&p-this.offset.click.top<=this.containment[3]?p:p-this.offset.click.top>=this.containment[1]?p-n.grid[1]:p+n.grid[1]:p,o=this.originalPageX+Math.round((m-this.originalPageX)/n.grid[0])*n.grid[0],m=this.containment?o-this.offset.click.left>=this.containment[0]&&o-this.offset.click.left<=this.containment[2]?o:o-this.offset.click.left>=this.containment[0]?o-n.grid[0]:o+n.grid[0]:o)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():j?0:k.scrollTop()),left:m-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():j?0:k.scrollLeft())}},_rearrange:function(g,f,j,i){j?j[0].appendChild(this.placeholder[0]):f.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?f.item[0]:f.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var h=this.counter;this._delay(function(){h===this.counter&&this.refreshPositions(!i)})},_clear:function(g,f){function j(e,d,k){return function(a){k._trigger(e,a,d._uiHash(d))}}this.reverting=!1;var i,h=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="")}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(this.fromOutside&&!f&&h.push(function(c){this._trigger("receive",c,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||f||h.push(function(c){this._trigger("update",c,this._uiHash())}),this!==this.currentContainer&&(f||(h.push(function(c){this._trigger("remove",c,this._uiHash())}),h.push(function(c){return function(a){c._trigger("receive",a,this._uiHash(this))}}.call(this,this.currentContainer)),h.push(function(c){return function(a){c._trigger("update",a,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--){f||h.push(j("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(h.push(j("out",this,this.containers[i])),this.containers[i].containerCache.over=0)}if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,f||this._trigger("beforeStop",g,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!f){for(i=0;i<h.length;i++){h[i].call(this,g)}this._trigger("stop",g,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){b.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(a){var d=a||this;return{helper:d.helper,placeholder:d.placeholder||b([]),position:d.position,originalPosition:d.originalPosition,offset:d.positionAbs,item:d.currentItem,sender:a?a.element:null}}})});