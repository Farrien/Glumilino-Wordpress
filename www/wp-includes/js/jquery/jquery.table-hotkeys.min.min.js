(function(b){b.fn.filter_visible=function(d){d=d||3;var a=function(){var c=b(this),f;for(f=0;f<d-1;++f){if(!c.is(":visible")){return false}c=c.parent()}return true};return this.filter(a)};b.table_hotkeys=function(r,a,F){F=b.extend(b.table_hotkeys.defaults,F);var y,v,C,B,u,D,w,s,E,z,A,t,x;y=F.class_prefix+F.selected_suffix;v=F.class_prefix+F.destructive_suffix;C=function(c){if(b.table_hotkeys.current_row){b.table_hotkeys.current_row.removeClass(y)}c.addClass(y);c[0].scrollIntoView(false);b.table_hotkeys.current_row=c};B=function(c){if(!D(c)&&b.isFunction(F[c+"_page_link_cb"])){F[c+"_page_link_cb"]()}};u=function(d){var e,c;if(!b.table_hotkeys.current_row){e=z();b.table_hotkeys.current_row=e;return e[0]}c="prev"==d?b.fn.prevAll:b.fn.nextAll;return c.call(b.table_hotkeys.current_row,F.cycle_expr).filter_visible()[0]};D=function(c){var d=u(c);if(!d){return false}C(b(d));return true};w=function(){return D("prev")};s=function(){return D("next")};E=function(){b(F.checkbox_expr,b.table_hotkeys.current_row).each(function(){this.checked=!this.checked})};z=function(){return b(F.cycle_expr,r).filter_visible().eq(F.start_row_index)};A=function(){var c=b(F.cycle_expr,r).filter_visible();return c.eq(c.length-1)};t=function(c){return function(){if(null==b.table_hotkeys.current_row){return false}var d=b(c,b.table_hotkeys.current_row);if(!d.length){return false}if(d.is("."+v)){s()||w()}d.click()}};x=z();if(!x.length){return}if(F.highlight_first){C(x)}else{if(F.highlight_last){C(A())}}b.hotkeys.add(F.prev_key,F.hotkeys_opts,function(){return B("prev")});b.hotkeys.add(F.next_key,F.hotkeys_opts,function(){return B("next")});b.hotkeys.add(F.mark_key,F.hotkeys_opts,E);b.each(a,function(){var c,d;if(b.isFunction(this[1])){c=this[1];d=this[0];b.hotkeys.add(d,F.hotkeys_opts,function(e){return c(e,b.table_hotkeys.current_row)})}else{d=this;b.hotkeys.add(d,F.hotkeys_opts,t("."+F.class_prefix+d))}})};b.table_hotkeys.current_row=null;b.table_hotkeys.defaults={cycle_expr:"tr",class_prefix:"vim-",selected_suffix:"current",destructive_suffix:"destructive",hotkeys_opts:{disableInInput:true,type:"keypress"},checkbox_expr:":checkbox",next_key:"j",prev_key:"k",mark_key:"x",start_row_index:2,highlight_first:false,highlight_last:false,next_page_link_cb:false,prev_page_link_cb:false}})(jQuery);