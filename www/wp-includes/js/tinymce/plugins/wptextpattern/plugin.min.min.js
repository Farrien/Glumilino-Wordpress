!function(e,d){function f(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}e.Env.ie&&e.Env.ie<9||e.PluginManager.add("wptextpattern",function(x){function w(){var F,E,D,C,B,A=x.selection.getRng(),z=A.startContainer,y=A.startOffset;if(z&&3===z.nodeType&&z.data.length&&y){var o=z.data.slice(0,y),j=z.data.charAt(y-1);e.each(a,function(l){if(j===l.delimiter.slice(-1)){var g=f(l.delimiter),I=l.delimiter.charAt(0),H=new RegExp("(.*)"+g+".+"+g+"$"),G=o.match(H);if(G){F=G[1].length,E=y-l.delimiter.length;var n=o.charAt(F-1),m=o.charAt(F+l.delimiter.length);if(!(F&&/\S/.test(n)&&(/\s/.test(m)||n===I)||new RegExp("^[\\s"+f(I)+"]+$").test(o.slice(F,E)))){return D=l,!1}}}}),D&&(C=x.formatter.get(D.format),C&&C[0].inline&&(x.undoManager.add(),x.undoManager.transact(function(){z.insertData(y,"\ufeff"),z=z.splitText(F),B=z.splitText(y-F),z.deleteData(0,D.delimiter.length),z.deleteData(z.data.length-D.delimiter.length,D.delimiter.length),x.formatter.apply(D.format,{},z),x.selection.setCursorLocation(B,1)}),d(function(){r="space",x.once("selectionchange",function(){var g;B&&(g=B.data.indexOf("\ufeff"),g!==-1&&B.deleteData(g,g+1))})})))}}function v(h){var g,i=x.dom.getParent(h,"p");if(i){for(;(g=i.firstChild)&&3!==g.nodeType;){i=g}if(g){return g.data||(g=g.nextSibling&&3===g.nextSibling.nodeType?g.nextSibling:null),g}}}function u(){var l,k,j=x.selection.getRng(),i=j.startContainer;i&&v(i)===i&&(l=i.parentNode,k=i.data,e.each(c,function(g){var h=k.match(g.regExp);if(h&&j.startOffset===h[0].length){return x.undoManager.add(),x.undoManager.transact(function(){i.deleteData(0,h[0].length),l.innerHTML||l.appendChild(document.createElement("br")),x.selection.setCursorLocation(l),x.execCommand(g.cmd)}),d(function(){r="space"}),!1}}))}function t(){var A,z,y,o=x.selection.getRng(),n=o.startContainer,j=v(n),i=b.length;if(j){for(A=j.data;i--;){if(b[i].start){if(0===A.indexOf(b[i].start)){z=b[i];break}}else{if(b[i].regExp&&b[i].regExp.test(A)){z=b[i];break}}}z&&(j===n&&e.trim(A)===z.start||x.once("keyup",function(){x.undoManager.add(),x.undoManager.transact(function(){z.format?(x.formatter.apply(z.format,{},j),j.replaceData(0,j.data.length,s(j.data.slice(z.start.length)))):z.element&&(y=j.parentNode&&j.parentNode.parentNode,y&&y.replaceChild(document.createElement(z.element),j.parentNode))}),d(function(){r="enter"})}))}}function s(g){return g?g.replace(/^\s+/,""):""}var r,q=e.util.VK,p=x.settings.wptextpattern||{},c=p.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],b=p.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],a=p.inline||[{delimiter:"`",format:"code"}];x.on("selectionchange",function(){r=null}),x.on("keydown",function(g){(r&&27===g.keyCode||"space"===r&&g.keyCode===q.BACKSPACE)&&(x.undoManager.undo(),g.preventDefault(),g.stopImmediatePropagation()),q.metaKeyPressed(g)||(g.keyCode===q.ENTER?t():g.keyCode===q.SPACEBAR?d(u):g.keyCode>47&&!(g.keyCode>=91&&g.keyCode<=93)&&d(w))},!0)})}(window.tinymce,window.setTimeout);