(function(c,d){c.PluginManager.add("wpview",function(g){function a(){}if(!d||!d.mce||!d.mce.views){return{getView:a}}function h(e){return g.dom.hasClass(e,"wpview")}function b(f){function e(k,l){return"<p>"+window.decodeURIComponent(l)+"</p>"}if(!f){return f}return f.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?wpview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,e).replace(/<p[^>]+data-wpview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,e)}g.on("init",function(){var e=window.MutationObserver||window.WebKitMutationObserver;if(e){new e(function(){g.fire("wp-body-class-change")}).observe(g.getBody(),{attributes:true,attributeFilter:["class"]})}g.on("wp-body-class-change",function(){var f=g.getBody().className;g.$('iframe[class="wpview-sandbox"]').each(function(n,m){if(!m.src||m.src==='javascript:""'){try{m.contentWindow.document.body.className=f}catch(i){}}})})});g.on("beforesetcontent",function(e){var f;if(!e.selection){d.mce.views.unbind()}if(!e.content){return}if(!e.load){f=g.selection.getNode();if(f&&f!==g.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(e.content)){f=g.dom.getParent(f,"p");if(f&&/^[\s\uFEFF\u00A0]*$/.test(g.$(f).text()||"")){f.innerHTML=""}else{return}}}e.content=d.mce.views.setMarkers(e.content)});g.on("setcontent",function(e){if(e.load&&!e.initial&&g.quirks.refreshContentEditable){g.quirks.refreshContentEditable()}d.mce.views.render()});g.on("preprocess hide",function(e){g.$("div[data-wpview-text], p[data-wpview-marker]",e.node).each(function(i,f){f.innerHTML="."})},true);g.on("postprocess",function(e){e.content=b(e.content)});g.on("beforeaddundo",function(e){e.level.content=b(e.level.content)});g.on("drop objectselected",function(e){if(h(e.targetClone)){e.targetClone=g.getDoc().createTextNode(window.decodeURIComponent(g.dom.getAttrib(e.targetClone,"data-wpview-text")))}});g.on("pastepreprocess",function(e){var f=e.content;if(f){f=c.trim(f.replace(/<[^>]+>/g,""));if(/^https?:\/\/\S+$/i.test(f)){e.content=f}}});g.on("resolvename",function(e){if(h(e.target)){e.name=g.dom.getAttrib(e.target,"data-wpview-type")||"object"}});g.on("click keyup",function(){var e=g.selection.getNode();if(h(e)){if(g.dom.getAttrib(e,"data-mce-selected")){e.setAttribute("data-mce-selected","2")}}});g.addButton("wp_view_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",onclick:function(){var e=g.selection.getNode();if(h(e)){d.mce.views.edit(g,e)}}});g.addButton("wp_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){g.fire("cut")}});g.once("preinit",function(){var e;if(g.wp&&g.wp._createToolbar){e=g.wp._createToolbar(["wp_view_edit","wp_view_remove"]);g.on("wptoolbar",function(f){if(h(f.element)){f.toolbar=e}})}});g.wp=g.wp||{};g.wp.getView=a;g.wp.setViewCursor=a;return{getView:a}})})(window.tinymce,window.wp);