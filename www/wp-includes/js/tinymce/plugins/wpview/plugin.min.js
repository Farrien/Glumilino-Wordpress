(function(b,a){b.PluginManager.add("wpview",function(d){function f(){}if(!a||!a.mce||!a.mce.views){return{getView:f}}function c(g){return d.dom.hasClass(g,"wpview")}function e(g){function h(j,i){return"<p>"+window.decodeURIComponent(i)+"</p>"}if(!g){return g}return g.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?wpview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,h).replace(/<p[^>]+data-wpview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,h)}d.on("init",function(){var g=window.MutationObserver||window.WebKitMutationObserver;if(g){new g(function(){d.fire("wp-body-class-change")}).observe(d.getBody(),{attributes:true,attributeFilter:["class"]})}d.on("wp-body-class-change",function(){var h=d.getBody().className;d.$('iframe[class="wpview-sandbox"]').each(function(j,k){if(!k.src||k.src==='javascript:""'){try{k.contentWindow.document.body.className=h}catch(l){}}})})});d.on("beforesetcontent",function(h){var g;if(!h.selection){a.mce.views.unbind()}if(!h.content){return}if(!h.load){g=d.selection.getNode();if(g&&g!==d.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(h.content)){g=d.dom.getParent(g,"p");if(g&&/^[\s\uFEFF\u00A0]*$/.test(d.$(g).text()||"")){g.innerHTML=""}else{return}}}h.content=a.mce.views.setMarkers(h.content)});d.on("setcontent",function(g){if(g.load&&!g.initial&&d.quirks.refreshContentEditable){d.quirks.refreshContentEditable()}a.mce.views.render()});d.on("preprocess hide",function(g){d.$("div[data-wpview-text], p[data-wpview-marker]",g.node).each(function(h,j){j.innerHTML="."})},true);d.on("postprocess",function(g){g.content=e(g.content)});d.on("beforeaddundo",function(g){g.level.content=e(g.level.content)});d.on("drop objectselected",function(g){if(c(g.targetClone)){g.targetClone=d.getDoc().createTextNode(window.decodeURIComponent(d.dom.getAttrib(g.targetClone,"data-wpview-text")))}});d.on("pastepreprocess",function(h){var g=h.content;if(g){g=b.trim(g.replace(/<[^>]+>/g,""));if(/^https?:\/\/\S+$/i.test(g)){h.content=g}}});d.on("resolvename",function(g){if(c(g.target)){g.name=d.dom.getAttrib(g.target,"data-wpview-type")||"object"}});d.on("click keyup",function(){var g=d.selection.getNode();if(c(g)){if(d.dom.getAttrib(g,"data-mce-selected")){g.setAttribute("data-mce-selected","2")}}});d.addButton("wp_view_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",onclick:function(){var g=d.selection.getNode();if(c(g)){a.mce.views.edit(d,g)}}});d.addButton("wp_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){d.fire("cut")}});d.once("preinit",function(){var g;if(d.wp&&d.wp._createToolbar){g=d.wp._createToolbar(["wp_view_edit","wp_view_remove"]);d.on("wptoolbar",function(h){if(c(h.element)){h.toolbar=g}})}});d.wp=d.wp||{};d.wp.getView=f;d.wp.setViewCursor=f;return{getView:f}})})(window.tinymce,window.wp);