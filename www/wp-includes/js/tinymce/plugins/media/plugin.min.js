(function(){var d={};var a=function(p){var n=i(p);var l=p.split(".");var o=Function("return this;")();for(var m=0;m<l.length-1;++m){if(o[l[m]]===undefined){o[l[m]]={}}o=o[l[m]]}o[l[l.length-1]]=n};var k=function(s){var r=d[s];var p=r.deps;var n=r.defn;var l=p.length;var q=new Array(l);for(var m=0;m<l;++m){q[m]=i(p[m])}var o=n.apply(null,q);if(o===undefined){throw"module ["+s+"] returned undefined"}r.instance=o};var b=function(n,m,l){if(typeof n!=="string"){throw"module id must be a string"}else{if(m===undefined){throw"no dependencies for "+n}else{if(l===undefined){throw"no definition function for "+n}}}d[n]={deps:m,defn:l,instance:undefined}};var i=function(m){var l=d[m];if(l===undefined){throw"module ["+m+"] was undefined"}else{if(l.instance===undefined){k(m)}}return l.instance};var g=function(n,p){var l=n.length;var o=new Array(l);for(var m=0;m<l;++m){o.push(i(n[m]))}p.apply(null,p)};var h={};h.bolt={module:{api:{define:b,require:g,demand:i}}};var e=b;var c=g;var j=i;var f=function(m,l){e(m,[],function(){return l})};f("global!tinymce.PluginManager",tinymce.PluginManager);f("global!tinymce.util.Delay",tinymce.util.Delay);f("global!tinymce.util.Tools",tinymce.util.Tools);f("global!tinymce.html.SaxParser",tinymce.html.SaxParser);f("global!tinymce.html.Schema",tinymce.html.Schema);f("global!tinymce.dom.DOMUtils.DOM",tinymce.dom.DOMUtils.DOM);e("tinymce.media.core.VideoScript",[],function(){var l=function(n,o){if(n){for(var m=0;m<n.length;m++){if(o.indexOf(n[m].filter)!==-1){return n[m]}}}};return{getVideoScriptMatch:l}});e("tinymce.media.core.Size",[],function(){var l=function(p){return p.replace(/px$/,"")};var o=function(p){return/^[0-9.]+$/.test(p)?(p+"px"):p};var m=function(p){return function(q){return q?l(q.style[p]):""}};var n=function(p){return function(r,q){if(r){r.style[p]=o(q)}}};return{getMaxWidth:m("maxWidth"),getMaxHeight:m("maxHeight"),setMaxWidth:n("maxWidth"),setMaxHeight:n("maxHeight")}});e("tinymce.media.core.HtmlToData",["global!tinymce.util.Tools","global!tinymce.html.SaxParser","global!tinymce.html.Schema","global!tinymce.dom.DOMUtils.DOM","tinymce.media.core.VideoScript","tinymce.media.core.Size"],function(o,s,r,v,u,p){var n=function(w){return v.getAttrib(w,"data-ephox-embed-iri")};var q=function(x){var w=v.createFragment(x);return n(w.firstChild)!==""};var m=function(y,w){var x={};new s({validate:false,allow_conditional_comments:true,special:"script,noscript",start:function(A,z){if(!x.source1&&A==="param"){x.source1=z.map.movie}if(A==="iframe"||A==="object"||A==="embed"||A==="video"||A==="audio"){if(!x.type){x.type=A}x=o.extend(z.map,x)}if(A==="script"){var B=u.getVideoScriptMatch(y,z.map.src);if(!B){return}x={type:"script",source1:z.map.src,width:B.width,height:B.height}}if(A==="source"){if(!x.source1){x.source1=z.map.src}else{if(!x.source2){x.source2=z.map.src}}}if(A==="img"&&!x.poster){x.poster=z.map.src}}}).parse(w);x.source1=x.source1||x.src||x.data;x.source2=x.source2||"";x.poster=x.poster||"";return x};var l=function(x){var w=v.createFragment(x);var y=w.firstChild;return{type:"ephox-embed-iri",source1:n(y),source2:"",poster:"",width:p.getMaxWidth(y),height:p.getMaxHeight(y)}};var t=function(x,w){return q(w)?l(w):m(x,w)};return{htmlToData:t}});f("global!tinymce.html.Writer",tinymce.html.Writer);e("tinymce.media.core.UpdateHtml",["global!tinymce.html.Writer","global!tinymce.html.SaxParser","global!tinymce.html.Schema","global!tinymce.dom.DOMUtils.DOM","tinymce.media.core.Size"],function(o,t,p,u,m){var l=function(y,B){var x;var z;var A;var w;for(x in B){A=""+B[x];if(y.map[x]){z=y.length;while(z--){w=y[z];if(w.name===x){if(A){y.map[x]=A;w.value=A}else{delete y.map[x];y.splice(z,1)}}}}else{if(A){y.push({name:x,value:A});y.map[x]=A}}}};var v=function(w){var x=new o();var y=new t(x);y.parse(w);return x.getContent()};var q=function(x,A,B){var z=new o();var w=0;var y;new t({validate:false,allow_conditional_comments:true,special:"script,noscript",comment:function(C){z.comment(C)},cdata:function(C){z.cdata(C)},text:function(D,C){z.text(D,C)},start:function(D,C,E){switch(D){case"video":case"object":case"embed":case"img":case"iframe":l(C,{width:A.width,height:A.height});break}if(B){switch(D){case"video":l(C,{poster:A.poster,src:""});if(A.source2){l(C,{src:""})}break;case"iframe":l(C,{src:A.source1});break;case"source":w++;if(w<=2){l(C,{src:A["source"+w],type:A["source"+w+"mime"]});if(!A["source"+w]){return}}break;case"img":if(!A.poster){return}y=true;break}}z.start(D,C,E)},end:function(F){if(F==="video"&&B){for(var E=1;E<=2;E++){if(A["source"+E]){var D=[];D.map={};if(w<E){l(D,{src:A["source"+E],type:A["source"+E+"mime"]});z.start("source",D,true)}}}}if(A.poster&&F==="object"&&B&&!y){var C=[];C.map={};l(C,{src:A.poster,width:A.width,height:A.height});z.start("img",C,true)}z.end(F)}},new p({})).parse(x);return z.getContent()};var n=function(x){var w=u.createFragment(x);return u.getAttrib(w.firstChild,"data-ephox-embed-iri")!==""};var s=function(x,y){var w=u.createFragment(x);var z=w.firstChild;m.setMaxWidth(z,y.width);m.setMaxHeight(z,y.height);return v(z.outerHTML)};var r=function(w,x,y){return n(w)?s(w,x):q(w,x,y)};return{updateHtml:r}});e("tinymce.media.core.Mime",[],function(){var l=function(n){var m={mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"};var p=n.toLowerCase().split(".").pop();var o=m[p];return o?o:""};return{guess:l}});e("tinymce.media.core.UrlPatterns",[],function(){var l=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:true}];return{urlPatterns:l}});e("tinymce.media.core.DataToHtml",["tinymce.media.core.Mime","tinymce.media.core.HtmlToData","tinymce.media.core.UrlPatterns","tinymce.media.core.VideoScript","tinymce.media.core.UpdateHtml","global!tinymce.util.Tools"],function(n,q,l,r,p,m){var o=function(w,s){var v="";var x=m.extend({},s);if(!x.source1){m.extend(x,q.htmlToData(w.settings.media_scripts,x.embed));if(!x.source1){return""}}if(!x.source2){x.source2=""}if(!x.poster){x.poster=""}x.source1=w.convertURL(x.source1,"source");x.source2=w.convertURL(x.source2,"source");x.source1mime=n.guess(x.source1);x.source2mime=n.guess(x.source2);x.poster=w.convertURL(x.poster,"poster");m.each(l.urlPatterns,function(B){var A;var z;var y=B.regex.exec(x.source1);if(y){z=B.url;for(A=0;y[A];A++){z=z.replace("$"+A,function(){return y[A]})}x.source1=z;x.type=B.type;x.allowFullscreen=B.allowFullscreen;x.width=x.width||B.w;x.height=x.height||B.h}});if(x.embed){v=p.updateHtml(x.embed,x,true)}else{var u=r.getVideoScriptMatch(w.settings.media_scripts,x.source1);if(u){x.type="script";x.width=u.width;x.height=u.height}x.width=x.width||300;x.height=x.height||150;m.each(x,function(z,y){x[y]=w.dom.encode(z)});if(x.type==="iframe"){var t=x.allowFullscreen?' allowFullscreen="1"':"";v+='<iframe src="'+x.source1+'" width="'+x.width+'" height="'+x.height+'"'+t+"></iframe>"}else{if(x.source1mime==="application/x-shockwave-flash"){v+='<object data="'+x.source1+'" width="'+x.width+'" height="'+x.height+'" type="application/x-shockwave-flash">';if(x.poster){v+='<img src="'+x.poster+'" width="'+x.width+'" height="'+x.height+'" />'}v+="</object>"}else{if(x.source1mime.indexOf("audio")!==-1){if(w.settings.audio_template_callback){v=w.settings.audio_template_callback(x)}else{v+=('<audio controls="controls" src="'+x.source1+'">'+(x.source2?'\n<source src="'+x.source2+'"'+(x.source2mime?' type="'+x.source2mime+'"':"")+" />\n":"")+"</audio>")}}else{if(x.type==="script"){v+='<script src="'+x.source1+'"><\/script>'}else{if(w.settings.video_template_callback){v=w.settings.video_template_callback(x)}else{v=('<video width="'+x.width+'" height="'+x.height+'"'+(x.poster?' poster="'+x.poster+'"':"")+' controls="controls">\n<source src="'+x.source1+'"'+(x.source1mime?' type="'+x.source1mime+'"':"")+" />\n"+(x.source2?'<source src="'+x.source2+'"'+(x.source2mime?' type="'+x.source2mime+'"':"")+" />\n":"")+"</video>")}}}}}}return v};return{dataToHtml:o}});f("global!tinymce.util.Promise",tinymce.util.Promise);e("tinymce.media.core.Service",["tinymce.media.core.DataToHtml","global!tinymce.util.Promise"],function(m,q){var l=function(u,t,s){var r={};return new q(function(w,v){var x=function(y){if(y.html){r[u.source1]=y}return w({url:u.source1,html:y.html?y.html:t(u)})};if(r[u.source1]){x(r[u.source1])}else{s({url:u.source1},x,v)}})};var p=function(s,r){return new q(function(t){t({html:r(s),url:s.source1})})};var n=function(r){return function(s){return m.dataToHtml(r,s)}};var o=function(r,t){var s=r.settings.media_url_resolver;return s?l(t,n(r),s):p(t,n(r))};return{getEmbedHtml:o}});f("global!tinymce.Env",tinymce.Env);e("tinymce.media.ui.SizeManager",[],function(){var m=function(r,s){r.state.set("oldVal",r.value());s.state.set("oldVal",s.value())};var q=function(v,u){var r=v.find("#width")[0];var t=v.find("#height")[0];var s=v.find("#constrain")[0];if(r&&t&&s){u(r,t,s.checked())}};var p=function(t,w,v){var s=t.state.get("oldVal");var x=w.state.get("oldVal");var u=t.value();var r=w.value();if(v&&s&&x&&u&&r){if(u!==s){r=Math.round((u/s)*r);if(!isNaN(r)){w.value(r)}}else{u=Math.round((r/x)*u);if(!isNaN(u)){t.value(u)}}}m(t,w)};var o=function(r){q(r,m)};var l=function(r){q(r,p)};var n=function(s){var r=function(){s(function(t){l(t)})};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:r,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:r,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:true,text:"Constrain proportions"}]}};return{createUi:n,syncSize:o,updateSize:l}});e("tinymce.media.ui.Dialog",["global!tinymce.util.Delay","tinymce.media.core.HtmlToData","tinymce.media.core.UpdateHtml","tinymce.media.core.Service","tinymce.media.core.Size","global!tinymce.util.Tools","global!tinymce.Env","tinymce.media.ui.SizeManager"],function(p,y,o,x,C,l,n,r){var z=(n.ie&&n.ie<=8)?"onChange":"onInput";var s=function(D){return function(F){var E=F&&F.msg?"Media embed handler error: "+F.msg:"Media embed handler threw unknown error.";D.notificationManager.open({type:"error",text:E})}};var v=function(F){var E=F.selection.getNode();var D=E.getAttribute("data-ephox-embed-iri");if(D){return{source1:D,"data-ephox-embed-iri":D,width:C.getMaxWidth(E),height:C.getMaxHeight(E)}}return E.getAttribute("data-mce-object")?y.htmlToData(F.settings.media_scripts,F.serializer.serialize(E,{selection:true})):{}};var A=function(D){var E=D.selection.getNode();if(E.getAttribute("data-mce-object")||E.getAttribute("data-ephox-embed-iri")){return D.selection.getContent()}};var t=function(E,D){return function(F){var G=F.html;var I=E.find("#embed")[0];var H=l.extend(y.htmlToData(D.settings.media_scripts,G),{source1:F.url});E.fromJSON(H);if(I){I.value(G);r.updateSize(E)}}};var q=function(F,G){var E;var H;var D=F.dom.select("img[data-mce-object]");for(E=0;E<G.length;E++){for(H=D.length-1;H>=0;H--){if(G[E]===D[H]){D.splice(H,1)}}}F.selection.select(D[0])};var m=function(E,D){var F=E.dom.select("img[data-mce-object]");E.insertContent(D);q(E,F);E.nodeChanged()};var u=function(F,D){var E=F.toJSON();E.embed=o.updateHtml(E.embed,E);if(E.embed){m(D,E.embed)}else{x.getEmbedHtml(D,E).then(function(G){m(D,G.html)})["catch"](s(D))}};var B=function(E,D){l.each(D,function(G,F){E.find("#"+F).value(G)})};var w=function(K){var J;var I;var D=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:true,label:"Source",onpaste:function(){setTimeout(function(){x.getEmbedHtml(K,J.toJSON()).then(t(J,K))["catch"](s(K))},1)},onchange:function(M){x.getEmbedHtml(K,J.toJSON()).then(t(J,K))["catch"](s(K));B(J,M.meta)},onbeforecall:function(M){M.meta=J.toJSON()}}];var L=[];var E=function(M){M(J);I=J.toJSON();J.find("#embed").value(o.updateHtml(I.embed,I))};if(K.settings.media_alt_source!==false){L.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"})}if(K.settings.media_poster!==false){L.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"})}if(K.settings.media_dimensions!==false){var H=r.createUi(E);D.push(H)}I=v(K);var G={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:A(K),multiline:true,rows:5,label:"Source"};var F=function(){I=l.extend({},y.htmlToData(K.settings.media_scripts,this.value()));this.parent().parent().fromJSON(I)};G[z]=F;J=K.windowManager.open({title:"Insert/edit media",data:I,bodyType:"tabpanel",body:[{title:"General",type:"form",items:D},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},G]},{title:"Advanced",type:"form",items:L}],onSubmit:function(){r.updateSize(J);u(J,K)}});r.syncSize(J)};return{showDialog:w}});e("tinymce.media.core.Sanitize",["global!tinymce.util.Tools","global!tinymce.html.Writer","global!tinymce.html.SaxParser","global!tinymce.html.Schema"],function(m,p,l,o){var n=function(s,r){if(s.settings.media_filter_html===false){return r}var t=new p();var q;new l({validate:false,allow_conditional_comments:false,special:"script,noscript",comment:function(u){t.comment(u)},cdata:function(u){t.cdata(u)},text:function(v,u){t.text(v,u)},start:function(v,u,x){q=true;if(v==="script"||v==="noscript"){return}for(var w=0;w<u.length;w++){if(u[w].name.indexOf("on")===0){return}if(u[w].name==="style"){u[w].value=s.dom.serializeStyle(s.dom.parseStyle(u[w].value),v)}}t.start(v,u,x);q=false},end:function(u){if(q){return}t.end(u)}},new o({})).parse(r);return t.getContent()};return{sanitize:n}});f("global!tinymce.html.Node",tinymce.html.Node);e("tinymce.media.core.Nodes",["tinymce.media.core.Sanitize","tinymce.media.core.VideoScript","global!tinymce.html.Node","global!tinymce.Env"],function(t,s,o,p){var n=function(v,x){var w;var u=x.name;w=new o("img",1);w.shortEnded=true;q(v,x,w);w.attr({width:x.attr("width")||"300",height:x.attr("height")||(u==="audio"?"30":"150"),style:x.attr("style"),src:p.transparentSrc,"data-mce-object":u,"class":"mce-object mce-object-"+u});return w};var l=function(x,z){var y;var v;var u;var w=z.name;y=new o("span",1);y.attr({contentEditable:"false",style:z.attr("style"),"data-mce-object":w,"class":"mce-preview-object mce-object-"+w});q(x,z,y);v=new o(w,1);v.attr({src:z.attr("src"),allowfullscreen:z.attr("allowfullscreen"),width:z.attr("width")||"300",height:z.attr("height")||(w==="audio"?"30":"150"),frameborder:"0"});u=new o("span",1);u.attr("class","mce-shim");y.append(v);y.append(u);return y};var q=function(y,x,A){var w;var z;var B;var u;var v;B=x.attributes;u=B.length;while(u--){w=B[u].name;z=B[u].value;if(w!=="width"&&w!=="height"&&w!=="style"){if(w==="data"||w==="src"){z=y.convertURL(z,w)}A.attr("data-mce-p-"+w,z)}}v=x.firstChild&&x.firstChild.value;if(v){A.attr("data-mce-html",escape(t.sanitize(y,v)));A.firstChild=null}};var m=function(u){while((u=u.parent)){if(u.attr("data-ephox-embed-iri")){return true}}return false};var r=function(u){return function(v){var x=v.length;var y;var w;while(x--){y=v[x];if(!y.parent){continue}if(y.parent.attr("data-mce-object")){continue}if(y.name==="script"){w=s.getVideoScriptMatch(u.settings.media_scripts,y.attr("src"));if(!w){continue}}if(w){if(w.width){y.attr("width",w.width.toString())}if(w.height){y.attr("height",w.height.toString())}}if(y.name==="iframe"&&u.settings.media_live_embeds!==false&&p.ceFalse){if(!m(y)){y.replace(l(u,y))}}else{if(!m(y)){y.replace(n(u,y))}}}}};return{createPreviewIframeNode:l,createPlaceholderNode:n,placeHolderConverter:r}});e("tinymce.media.Plugin",["global!tinymce.PluginManager","tinymce.media.ui.Dialog","tinymce.media.core.Sanitize","tinymce.media.core.UpdateHtml","tinymce.media.core.Nodes"],function(m,l,o,p,q){var n=function(r){r.on("ResolveName",function(t){var s;if(t.target.nodeType===1&&(s=t.target.getAttribute("data-mce-object"))){t.name=s}});r.on("preInit",function(){var s=r.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(u){s[u]=new RegExp("</"+u+"[^>]*>","gi")});var t=r.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(u){t[u]={}});r.parser.addNodeFilter("iframe,video,audio,object,embed,script",q.placeHolderConverter(r));r.serializer.addAttributeFilter("data-mce-object",function(w,v){var z=w.length;var y;var E;var C;var u;var x;var F;var D;var A;while(z--){y=w[z];if(!y.parent){continue}D=y.attr(v);E=new tinymce.html.Node(D,1);if(D!=="audio"&&D!=="script"){A=y.attr("class");if(A&&A.indexOf("mce-preview-object")!==-1){E.attr({width:y.firstChild.attr("width"),height:y.firstChild.attr("height")})}else{E.attr({width:y.attr("width"),height:y.attr("height")})}}E.attr({style:y.attr("style")});u=y.attributes;C=u.length;while(C--){var B=u[C].name;if(B.indexOf("data-mce-p-")===0){E.attr(B.substr(11),u[C].value)}}if(D==="script"){E.attr("type","text/javascript")}x=y.attr("data-mce-html");if(x){F=new tinymce.html.Node("#text",3);F.raw=true;F.value=o.sanitize(r,unescape(x));E.append(F)}y.replace(E)}})});r.on("click keyup",function(){var s=r.selection.getNode();if(s&&r.dom.hasClass(s,"mce-preview-object")){if(r.dom.getAttrib(s,"data-mce-selected")){s.setAttribute("data-mce-selected","2")}}});r.on("ObjectSelected",function(t){var s=t.target.getAttribute("data-mce-object");if(s==="audio"||s==="script"){t.preventDefault()}});r.on("objectResized",function(u){var t=u.target;var s;if(t.getAttribute("data-mce-object")){s=t.getAttribute("data-mce-html");if(s){s=unescape(s);t.setAttribute("data-mce-html",escape(p.updateHtml(s,{width:u.width,height:u.height})))}}});this.showDialog=function(){l.showDialog(r)};r.addButton("media",{tooltip:"Insert/edit media",onclick:this.showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"]});r.addMenuItem("media",{icon:"media",text:"Media",onclick:this.showDialog,context:"insert",prependToContext:true});r.on("setContent",function(){r.$("span.mce-preview-object").each(function(t,u){var s=r.$(u);if(s.find("span.mce-shim",u).length===0){s.append('<span class="mce-shim"></span>')}})});r.addCommand("mceMedia",this.showDialog)};m.add("media",n);return function(){}});i("tinymce.media.Plugin")()})();