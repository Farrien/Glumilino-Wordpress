wp.customize.selectiveRefresh=(function(e,d){var b,a,c;b={ready:e.Deferred(),editShortcutVisibility:new d.Value(),data:{partials:{},renderQueryVar:"",l10n:{shiftClickToEdit:""}},currentRequest:null};_.extend(b,d.Events);a=b.Partial=d.Class.extend({id:null,initialize:function(h,g){var f=this;g=g||{};f.id=h;f.params=_.extend({selector:null,settings:[],primarySetting:null,containerInclusive:false,fallbackRefresh:true},g.params||{});f.deferred={};f.deferred.ready=e.Deferred();f.deferred.ready.done(function(){f.ready()})},ready:function(){var f=this;_.each(f.placements(),function(g){e(g.container).attr("title",b.data.l10n.shiftClickToEdit);f.createEditShortcutForPlacement(g)});e(document).on("click",f.params.selector,function(g){if(!g.shiftKey){return}g.preventDefault();_.each(f.placements(),function(h){if(e(h.container).is(g.currentTarget)){f.showControl()}})})},createEditShortcutForPlacement:function(h){var f=this,k,g,i,j;if(!h.container){return}g=e(h.container);i="head";j="area, audio, base, bdi, bdo, br, button, canvas, col, colgroup, command, datalist, embed, head, hr, html, iframe, img, input, keygen, label, link, map, math, menu, meta, noscript, object, optgroup, option, param, progress, rp, rt, ruby, script, select, source, style, svg, table, tbody, textarea, tfoot, thead, title, tr, track, video, wbr";if(!g.length||g.is(j)||g.closest(i).length){return}k=f.createEditShortcut();k.on("click",function(l){l.preventDefault();l.stopPropagation();f.showControl()});f.addEditShortcutToPlacement(h,k)},addEditShortcutToPlacement:function(g,h){var f=e(g.container);f.prepend(h);if(!f.is(":visible")||"none"===f.css("display")){h.addClass("customize-partial-edit-shortcut-hidden")}},getEditShortcutClassName:function(){var f=this,g;g=f.id.replace(/]/g,"").replace(/\[/g,"-");return"customize-partial-edit-shortcut-"+g},getEditShortcutTitle:function(){var f=this,g=b.data.l10n;switch(f.getType()){case"widget":return g.clickEditWidget;case"blogname":return g.clickEditTitle;case"blogdescription":return g.clickEditTitle;case"nav_menu":return g.clickEditMenu;default:return g.clickEditMisc}},getType:function(){var f=this,g;g=f.params.primarySetting||_.first(f.settings())||"unknown";if(f.params.type){return f.params.type}if(g.match(/^nav_menu_instance\[/)){return"nav_menu"}if(g.match(/^widget_.+\[\d+]$/)){return"widget"}return g},createEditShortcut:function(){var f=this,j,g,i,h;j=f.getEditShortcutTitle();g=e("<span>",{"class":"customize-partial-edit-shortcut "+f.getEditShortcutClassName()});i=e("<button>",{"aria-label":j,title:j,"class":"customize-partial-edit-shortcut-button"});h=e('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13.89 3.39l2.71 2.72c.46.46.42 1.24.03 1.64l-8.01 8.02-5.56 1.16 1.16-5.58s7.6-7.63 7.99-8.03c.39-.39 1.22-.39 1.68.07zm-2.73 2.79l-5.59 5.61 1.11 1.11 5.54-5.65zm-2.97 8.23l5.58-5.6-1.07-1.08-5.59 5.6z"/></svg>');i.append(h);g.append(i);return g},placements:function(){var g=this,f;f=g.params.selector||"";if(f){f+=", "}f+='[data-customize-partial-id="'+g.id+'"]';return e(f).map(function(){var h=e(this),i;i=h.data("customize-partial-placement-context");if(_.isString(i)&&"{"===i.substr(0,1)){throw new Error("context JSON parse error")}return new c({partial:g,container:h,context:i})}).get()},settings:function(){var f=this;if(f.params.settings&&0!==f.params.settings.length){return f.params.settings}else{if(f.params.primarySetting){return[f.params.primarySetting]}else{return[f.id]}}},isRelatedSetting:function(g){var f=this;if(_.isString(g)){g=d(g)}if(!g){return false}return -1!==_.indexOf(f.settings(),g.id)},showControl:function(){var f=this,g=f.params.primarySetting;if(!g){g=_.first(f.settings())}if(f.getType()==="nav_menu"){if(f.params.navMenuArgs.theme_location){g="nav_menu_locations["+f.params.navMenuArgs.theme_location+"]"}else{if(f.params.navMenuArgs.menu){g="nav_menu["+String(f.params.navMenuArgs.menu)+"]"}}}d.preview.send("focus-control-for-setting",g)},preparePlacement:function(f){e(f.container).addClass("customize-partial-refreshing")},_pendingRefreshPromise:null,refresh:function(){var g=this,f;f=b.requestPartial(g);if(!g._pendingRefreshPromise){_.each(g.placements(),function(h){g.preparePlacement(h)});f.done(function(h){_.each(h,function(i){g.renderContent(i)})});f.fail(function(i,h){g.fallback(i,h)});g._pendingRefreshPromise=f;f.always(function(){g._pendingRefreshPromise=null})}return f},renderContent:function(i){var f=this,j,h;if(!i.container){f.fallback(new Error("no_container"),[i]);return false}i.container=e(i.container);if(false===i.addedContent){f.fallback(new Error("missing_render"),[i]);return false}if(!_.isString(i.addedContent)){f.fallback(new Error("non_string_content"),[i]);return false}b.orginalDocumentWrite=document.write;document.write=function(){throw new Error(b.data.l10n.badDocumentWrite)};try{j=i.addedContent;if(wp.emoji&&wp.emoji.parse&&!e.contains(document.head,i.container[0])){j=wp.emoji.parse(j)}if(f.params.containerInclusive){h=e(j);i.context=_.extend(i.context,h.data("customize-partial-placement-context")||{});h.data("customize-partial-placement-context",i.context);i.removedNodes=i.container;i.container=h;i.removedNodes.replaceWith(i.container);i.container.attr("title",b.data.l10n.shiftClickToEdit)}else{i.removedNodes=document.createDocumentFragment();while(i.container[0].firstChild){i.removedNodes.appendChild(i.container[0].firstChild)}i.container.html(j)}i.container.removeClass("customize-render-content-error")}catch(g){if("undefined"!==typeof console&&console.error){console.error(f.id,g)}}document.write=b.orginalDocumentWrite;b.orginalDocumentWrite=null;f.createEditShortcutForPlacement(i);i.container.removeClass("customize-partial-refreshing");i.container.data("customize-partial-content-rendered",true);b.trigger("partial-content-rendered",i);return true},fallback:function(){var f=this;if(f.params.fallbackRefresh){b.requestFullRefresh()}}});b.Placement=c=d.Class.extend({partial:null,container:null,startNode:null,endNode:null,context:null,addedContent:null,removedNodes:null,initialize:function(f){var g=this;f=_.extend({},f||{});if(!f.partial||!f.partial.extended(a)){throw new Error("Missing partial")}f.context=f.context||{};if(f.container){f.container=e(f.container)}_.extend(g,f)}});b.partialConstructor={};b.partial=new d.Values({defaultConstructor:a});b.getCustomizeQuery=function(){var f={};d.each(function(h,g){if(h._dirty){f[g]=h()}});return{wp_customize:"on",nonce:d.settings.nonce.preview,customize_theme:d.settings.theme.stylesheet,customized:JSON.stringify(f),customize_changeset_uuid:d.settings.changeset.uuid}};b._pendingPartialRequests={};b._debouncedTimeoutId=null;b._currentRequest=null;b.requestFullRefresh=function(){d.preview.send("refresh")};b.requestPartial=function(f){var g;if(b._debouncedTimeoutId){clearTimeout(b._debouncedTimeoutId);b._debouncedTimeoutId=null}if(b._currentRequest){b._currentRequest.abort();b._currentRequest=null}g=b._pendingPartialRequests[f.id];if(!g||"pending"!==g.deferred.state()){g={deferred:e.Deferred(),partial:f};b._pendingPartialRequests[f.id]=g}f=null;b._debouncedTimeoutId=setTimeout(function(){var k,h,i,j;b._debouncedTimeoutId=null;k=b.getCustomizeQuery();i={};h={};_.each(b._pendingPartialRequests,function(m,l){i[l]=m.partial.placements();if(!b.partial.has(l)){m.deferred.rejectWith(m.partial,[new Error("partial_removed"),i[l]])}else{h[l]=_.map(i[l],function(n){return n.context||{}})}});k.partials=JSON.stringify(h);k[b.data.renderQueryVar]="1";j=b._currentRequest=wp.ajax.send(null,{data:k,url:d.settings.url.self});j.done(function(l){b.trigger("render-partials-response",l);if(l.errors&&"undefined"!==typeof console&&console.warn){_.each(l.errors,function(m){console.warn(m)})}_.each(b._pendingPartialRequests,function(o,n){var m;if(!_.isArray(l.contents[n])){o.deferred.rejectWith(o.partial,[new Error("unrecognized_partial"),i[n]])}else{m=_.map(l.contents[n],function(r,q){var p=i[n][q];if(p){p.addedContent=r}else{p=new c({partial:o.partial,addedContent:r})}return p});o.deferred.resolveWith(o.partial,[m])}});b._pendingPartialRequests={}});j.fail(function(l,m){if("abort"===m){return}_.each(b._pendingPartialRequests,function(o,n){o.deferred.rejectWith(o.partial,[l,i[n]])});b._pendingPartialRequests={}})},d.settings.timeouts.selectiveRefresh);return g.deferred.promise()};b.addPartials=function(f,g){var h;if(!f){f=document.documentElement}f=e(f);g=_.extend({triggerRendered:true},g||{});h=f.find("[data-customize-partial-id]");if(f.is("[data-customize-partial-id]")){h=h.add(f)}h.each(function(){var o=e(this),i,k,n,l,j,m;n=o.data("customize-partial-id");if(!n){return}m=o.data("customize-partial-placement-context")||{};i=b.partial(n);if(!i){j=o.data("customize-partial-options")||{};j.constructingContainerContext=o.data("customize-partial-placement-context")||{};l=b.partialConstructor[o.data("customize-partial-type")]||b.Partial;i=new l(n,j);b.partial.add(i.id,i)}if(g.triggerRendered&&!o.data("customize-partial-content-rendered")){k=new c({partial:i,context:m,container:o});e(k.container).attr("title",b.data.l10n.shiftClickToEdit);i.createEditShortcutForPlacement(k);b.trigger("partial-content-rendered",k)}o.data("customize-partial-content-rendered",true)})};d.bind("preview-ready",function(){var g,f,h;_.extend(b.data,_customizePartialRefreshExports);_.each(b.data.partials,function(k,m){var l,j=b.partial(m);if(!j){l=b.partialConstructor[k.type]||b.Partial;j=new l(m,{params:k});b.partial.add(m,j)}else{_.extend(j.params,k)}});g=function(l,j){var k=this;b.partial.each(function(m){if(m.isRelatedSetting(k,l,j)){m.refresh()}})};f=function(j){g.call(j,j(),null);j.bind(g)};h=function(j){g.call(j,null,j());j.unbind(g)};d.bind("add",f);d.bind("remove",h);d.each(function(j){j.bind(g)});b.addPartials(document.documentElement,{triggerRendered:false});if("undefined"!==typeof MutationObserver){b.mutationObserver=new MutationObserver(function(j){_.each(j,function(k){b.addPartials(e(k.target))})});b.mutationObserver.observe(document.documentElement,{childList:true,subtree:true})}d.selectiveRefresh.bind("partial-content-rendered",function(j){if(j.container){b.addPartials(j.container)}});d.selectiveRefresh.bind("render-partials-response",function i(j){if(j.setting_validities){d.preview.send("selective-refresh-setting-validities",j.setting_validities)}});d.preview.bind("edit-shortcut-visibility",function(j){d.selectiveRefresh.editShortcutVisibility.set(j)});d.selectiveRefresh.editShortcutVisibility.bind(function(k){var j=e(document.body),l;l=("hidden"===k&&j.hasClass("customize-partial-edit-shortcuts-shown")&&!j.hasClass("customize-partial-edit-shortcuts-hidden"));j.toggleClass("customize-partial-edit-shortcuts-hidden",l);j.toggleClass("customize-partial-edit-shortcuts-shown","visible"===k)});d.preview.bind("active",function(){b.partial.each(function(j){j.deferred.ready.resolve()});b.partial.bind("add",function(j){j.deferred.ready.resolve()})})});return b}(jQuery,wp.customize));