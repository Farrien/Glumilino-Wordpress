(function(c,e){var g=wp.customize,j,d={};(function(m){var l;if(!m.replaceState){return}l=function(o){var n,q,p;n=document.createElement("a");n.href=o;q=g.utils.parseQueryString(location.search.substr(1));p=g.utils.parseQueryString(n.search.substr(1));p.customize_changeset_uuid=q.customize_changeset_uuid;if(q.customize_theme){p.customize_theme=q.customize_theme}if(q.customize_messenger_channel){p.customize_messenger_channel=q.customize_messenger_channel}n.search=e.param(p);return n.href};m.replaceState=(function(n){return function o(q,r,p){d=q;return n.call(m,q,r,"string"===typeof p&&p.length>0?l(p):p)}})(m.replaceState);m.pushState=(function(o){return function n(q,r,p){d=q;return o.call(m,q,r,"string"===typeof p&&p.length>0?l(p):p)}})(m.pushState);window.addEventListener("popstate",function(n){d=n.state})}(history));j=function(n,l,m){var o;return function(){var p=arguments;m=m||this;clearTimeout(o);o=setTimeout(function(){o=null;n.apply(m,p)},l)}};g.Preview=g.Messenger.extend({initialize:function(o,m){var n=this,l=document.createElement("a");g.Messenger.prototype.initialize.call(n,o,m);l.href=n.origin();n.add("scheme",l.protocol.replace(/:$/,""));n.body=e(document.body);n.window=e(window);if(g.settings.channel){n.body.on("click.preview","a",function(p){n.handleLinkClick(p)});n.body.on("submit.preview","form",function(p){n.handleFormSubmit(p)});n.window.on("scroll.preview",j(function(){n.send("scroll",n.window.scrollTop())},200));n.bind("scroll",function(p){n.window.scrollTop(p)})}},handleLinkClick:function(m){var o=this,l,n;l=e(m.target).closest("a");if(_.isUndefined(l.attr("href"))){return}n=("#"===l.attr("href").substr(0,1));if(n||!/^https?:$/.test(l.prop("protocol"))){return}if(!g.isLinkPreviewable(l[0])){wp.a11y.speak(g.settings.l10n.linkUnpreviewable);m.preventDefault();return}m.preventDefault();if(m.shiftKey){return}o.send("url",l.prop("href"))},handleFormSubmit:function(n){var o=this,l,m;l=document.createElement("a");m=e(n.target);l.href=m.prop("action");if("GET"!==m.prop("method").toUpperCase()||!g.isLinkPreviewable(l)){wp.a11y.speak(g.settings.l10n.formUnpreviewable);n.preventDefault();return}if(!n.isDefaultPrevented()){if(l.search.length>1){l.search+="&"}l.search+=m.serialize();o.send("url",l.href)}n.preventDefault()}});g.addLinkPreviewing=function f(){var l="a[href], area";e(document.body).find(l).each(function(){g.prepareLinkPreview(this)});if("undefined"!==typeof MutationObserver){g.mutationObserver=new MutationObserver(function(m){_.each(m,function(n){e(n.target).find(l).each(function(){g.prepareLinkPreview(this)})})});g.mutationObserver.observe(document.documentElement,{childList:true,subtree:true})}else{e(document.documentElement).on("click focus mouseover",l,function(){g.prepareLinkPreview(this)})}};g.isLinkPreviewable=function k(o,n){var q,p,m,l;m=_.extend({},{allowAdminAjax:false},n||{});if("javascript:"===o.protocol){return true}if("https:"!==o.protocol&&"http:"!==o.protocol){return false}l=o.host.replace(/:(80|443)$/,"");p=document.createElement("a");q=!_.isUndefined(_.find(g.settings.url.allowed,function(r){p.href=r;return p.protocol===o.protocol&&p.host.replace(/:(80|443)$/,"")===l&&0===o.pathname.indexOf(p.pathname.replace(/\/$/,""))}));if(!q){return false}if(/\/wp-(login|signup)\.php$/.test(o.pathname)){return false}if(/\/wp-admin\/admin-ajax\.php$/.test(o.pathname)){return m.allowAdminAjax}if(/\/wp-(admin|includes|content)(\/|$)/.test(o.pathname)){return false}return true};g.prepareLinkPreview=function b(l){var m;if(e(l).closest("#wpadminbar").length){return}if("#"===e(l).attr("href").substr(0,1)||!/^https?:$/.test(l.protocol)){return}if(g.settings.channel&&"https"===g.preview.scheme.get()&&"http:"===l.protocol&&-1!==g.settings.url.allowedHosts.indexOf(l.host)){l.protocol="https:"}if(!g.isLinkPreviewable(l)){if(g.settings.channel){e(l).addClass("customize-unpreviewable")}return}e(l).removeClass("customize-unpreviewable");m=g.utils.parseQueryString(l.search.substring(1));m.customize_changeset_uuid=g.settings.changeset.uuid;if(!g.settings.theme.active){m.customize_theme=g.settings.theme.stylesheet}if(g.settings.channel){m.customize_messenger_channel=g.settings.channel}l.search=e.param(m);if(g.settings.channel){l.target="_self"}};g.addRequestPreviewing=function a(){var l=function(o,s,r){var n,p,q,m={};n=document.createElement("a");n.href=o.url;if(!g.isLinkPreviewable(n,{allowAdminAjax:true})){return}p=g.utils.parseQueryString(n.search.substring(1));g.each(function(t){if(t._dirty){m[t.id]=t.get()}});if(!_.isEmpty(m)){q=o.type.toUpperCase();if("POST"!==q){r.setRequestHeader("X-HTTP-Method-Override",q);p._method=q;o.type="POST"}if(o.data){o.data+="&"}else{o.data=""}o.data+=e.param({customized:JSON.stringify(m)})}p.customize_changeset_uuid=g.settings.changeset.uuid;if(!g.settings.theme.active){p.customize_theme=g.settings.theme.stylesheet}n.search=e.param(p);o.url=n.href};e.ajaxPrefilter(l)};g.addFormPreviewing=function i(){e(document.body).find("form").each(function(){g.prepareFormPreview(this)});if("undefined"!==typeof MutationObserver){g.mutationObserver=new MutationObserver(function(l){_.each(l,function(m){e(m.target).find("form").each(function(){g.prepareFormPreview(this)})})});g.mutationObserver.observe(document.documentElement,{childList:true,subtree:true})}};g.prepareFormPreview=function h(n){var m,l={};if(!n.action){n.action=location.href}m=document.createElement("a");m.href=n.action;if(g.settings.channel&&"https"===g.preview.scheme.get()&&"http:"===m.protocol&&-1!==g.settings.url.allowedHosts.indexOf(m.host)){m.protocol="https:";n.action=m.href}if("GET"!==n.method.toUpperCase()||!g.isLinkPreviewable(m)){if(g.settings.channel){e(n).addClass("customize-unpreviewable")}return}e(n).removeClass("customize-unpreviewable");l.customize_changeset_uuid=g.settings.changeset.uuid;if(!g.settings.theme.active){l.customize_theme=g.settings.theme.stylesheet}if(g.settings.channel){l.customize_messenger_channel=g.settings.channel}_.each(l,function(q,p){var o=e(n).find('input[name="'+p+'"]');if(o.length){o.val(q)}else{e(n).prepend(e("<input>",{type:"hidden",name:p,value:q}))}});if(g.settings.channel){n.target="_self"}};g.keepAliveCurrentUrl=(function(){var o=location.pathname,n=location.search.substr(1),p=null,l=["customize_theme","customize_changeset_uuid","customize_messenger_channel"];return function m(){var q,r;if(n===location.search.substr(1)&&o===location.pathname){g.preview.send("keep-alive");return}q=document.createElement("a");if(null===p){q.search=n;p=g.utils.parseQueryString(n);_.each(l,function(s){delete p[s]})}q.href=location.href;r=g.utils.parseQueryString(q.search.substr(1));_.each(l,function(s){delete r[s]});if(o!==location.pathname||!_.isEqual(p,r)){q.search=e.param(r);q.hash="";g.settings.url.self=q.href;g.preview.send("ready",{currentUrl:g.settings.url.self,activePanels:g.settings.activePanels,activeSections:g.settings.activeSections,activeControls:g.settings.activeControls,settingValidities:g.settings.settingValidities})}else{g.preview.send("keep-alive")}p=r;n=location.search.substr(1);o=location.pathname}})();g.settingPreviewHandlers={custom_logo:function(l){e("body").toggleClass("wp-custom-logo",!!l)},custom_css:function(l){e("#wp-custom-css").text(l)},background:function(){var l="",m={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(n){m[n]=g("background_"+n)});e(document.body).toggleClass("custom-background",!!(m.color()||m.image()));if(m.color()){l+="background-color: "+m.color()+";"}if(m.image()){l+='background-image: url("'+m.image()+'");';l+="background-size: "+m.size()+";";l+="background-position: "+m.position_x()+" "+m.position_y()+";";l+="background-repeat: "+m.repeat()+";";l+="background-attachment: "+m.attachment()+";"}e("#custom-background-css").text("body.custom-background { "+l+" }")}};e(function(){var l,m;g.settings=window._wpCustomizeSettings;if(!g.settings){return}g.preview=new g.Preview({url:window.location.href,channel:g.settings.channel});g.addLinkPreviewing();g.addRequestPreviewing();g.addFormPreviewing();m=function(q,p,o){var n=g(q);if(n){n.set(p)}else{o=o||false;n=g.create(q,p,{id:q});if(o){n._dirty=true}}};g.preview.bind("settings",function(n){e.each(n,m)});g.preview.trigger("settings",g.settings.values);e.each(g.settings._dirty,function(n,p){var o=g(p);if(o){o._dirty=true}});g.preview.bind("setting",function(n){var o=true;m.apply(null,n.concat(o))});g.preview.bind("sync",function(n){if(n.settings&&n["settings-modified-while-loading"]){_.each(_.keys(n.settings),function(o){if(g.has(o)&&!n["settings-modified-while-loading"][o]){delete n.settings[o]}})}e.each(n,function(p,o){g.preview.trigger(p,o)});g.preview.send("synced")});g.preview.bind("active",function(){g.preview.send("nonce",g.settings.nonce);g.preview.send("documentTitle",document.title);g.preview.send("scroll",e(window).scrollTop())});g.preview.bind("saved",function(n){if(n.next_changeset_uuid){g.settings.changeset.uuid=n.next_changeset_uuid;e(document.body).find("a[href], area").each(function(){g.prepareLinkPreview(this)});e(document.body).find("form").each(function(){g.prepareFormPreview(this)});if(history.replaceState){history.replaceState(d,"",location.href)}}g.trigger("saved",n)});g.preview.bind("changeset-saved",function(n){_.each(n.saved_changeset_values,function(p,q){var o=g(q);if(o&&_.isEqual(o.get(),p)){o._dirty=false}})});g.preview.bind("nonce-refresh",function(n){e.extend(g.settings.nonce,n)});g.preview.send("ready",{currentUrl:g.settings.url.self,activePanels:g.settings.activePanels,activeSections:g.settings.activeSections,activeControls:g.settings.activeControls,settingValidities:g.settings.settingValidities});setInterval(g.keepAliveCurrentUrl,g.settings.timeouts.keepAliveSend);g.preview.bind("loading-initiated",function(){e("body").addClass("wp-customizer-unloading")});g.preview.bind("loading-failed",function(){e("body").removeClass("wp-customizer-unloading")});l=e.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(n){return"background_"+n});g.when.apply(g,l).done(function(){e.each(arguments,function(){this.bind(g.settingPreviewHandlers.background)})});g("custom_logo",function(n){g.settingPreviewHandlers.custom_logo.call(n,n.get());n.bind(g.settingPreviewHandlers.custom_logo)});g("custom_css["+g.settings.theme.stylesheet+"]",function(n){n.bind(g.settingPreviewHandlers.custom_css)});g.trigger("preview-ready")})})(wp,jQuery);