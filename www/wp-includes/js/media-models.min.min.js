(function e(h,j,l){function m(a,c){if(!j[a]){if(!h[a]){var d=typeof require=="function"&&require;if(!c&&d){return d(a,!0)}if(i){return i(a,!0)}var b=new Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}var f=j[a]={exports:{}};h[a][0].call(f.exports,function(g){var n=h[a][1][g];return m(n?n:g)},f,f.exports,e,h,j,l)}return j[a].exports}var i=typeof require=="function"&&require;for(var k=0;k<l.length;k++){m(l[k])}return m})({1:[function(j,o,k){var m=jQuery,n,p,q,l;window.wp=window.wp||{};l=wp.media=function(c){var b=l.view.MediaFrame,a;if(!b){return}c=_.defaults(c||{},{frame:"select"});if("select"===c.frame&&b.Select){a=new b.Select(c)}else{if("post"===c.frame&&b.Post){a=new b.Post(c)}else{if("manage"===c.frame&&b.Manage){a=new b.Manage(c)}else{if("image"===c.frame&&b.ImageDetails){a=new b.ImageDetails(c)}else{if("audio"===c.frame&&b.AudioDetails){a=new b.AudioDetails(c)}else{if("video"===c.frame&&b.VideoDetails){a=new b.VideoDetails(c)}else{if("edit-attachments"===c.frame&&b.EditAttachments){a=new b.EditAttachments(c)}}}}}}}delete c.frame;l.frame=a;return a};_.extend(l,{model:{},view:{},controller:{},frames:{}});q=l.model.l10n=window._wpMediaModelsL10n||{};l.model.settings=q.settings||{};delete q.settings;n=l.model.Attachment=j("./models/attachment.js");p=l.model.Attachments=j("./models/attachments.js");l.model.Query=j("./models/query.js");l.model.PostImage=j("./models/post-image.js");l.model.Selection=j("./models/selection.js");l.compare=function(c,d,b,a){if(_.isEqual(c,d)){return b===a?0:(b>a?-1:1)}else{return c>d?-1:1}};_.extend(l,{template:wp.template,post:wp.ajax.post,ajax:wp.ajax.send,fit:function(g){var c=g.width,d=g.height,a=g.maxWidth,b=g.maxHeight,f;if(!_.isUndefined(a)&&!_.isUndefined(b)){f=(c/d>a/b)?"width":"height"}else{if(_.isUndefined(b)){f="width"}else{if(_.isUndefined(a)&&d>b){f="height"}}}if("width"===f&&c>a){return{width:a,height:Math.round(a*d/c)}}else{if("height"===f&&d>b){return{width:Math.round(b*c/d),height:b}}else{return{width:c,height:d}}}},truncate:function(c,a,b){a=a||30;b=b||"&hellip;";if(c.length<=a){return c}return c.substr(0,a/2)+b+c.substr(-1*a/2)}});l.attachment=function(a){return n.get(a)};p.all=new p();l.query=function(a){return new p(null,{props:_.extend(_.defaults(a||{},{orderby:"date"}),{query:true})})};m(window).on("unload",function(){window.wp=null})},{"./models/attachment.js":2,"./models/attachments.js":3,"./models/post-image.js":4,"./models/query.js":5,"./models/selection.js":6}],2:[function(g,k,h){var i=Backbone.$,j;j=Backbone.Model.extend({sync:function(a,b,c){if(_.isUndefined(this.id)){return i.Deferred().rejectWith(this).promise()}if("read"===a){c=c||{};c.context=this;c.data=_.extend(c.data||{},{action:"get-attachment",id:this.id});return wp.media.ajax(c)}else{if("update"===a){if(!this.get("nonces")||!this.get("nonces").update){return i.Deferred().rejectWith(this).promise()}c=c||{};c.context=this;c.data=_.extend(c.data||{},{action:"save-attachment",id:this.id,nonce:this.get("nonces").update,post_id:wp.media.model.settings.post.id});if(b.hasChanged()){c.data.changes={};_.each(b.changed,function(d,f){c.data.changes[f]=this.get(f)},this)}return wp.media.ajax(c)}else{if("delete"===a){c=c||{};if(!c.wait){this.destroyed=true}c.context=this;c.data=_.extend(c.data||{},{action:"delete-post",id:this.id,_wpnonce:this.get("nonces")["delete"]});return wp.media.ajax(c).done(function(){this.destroyed=true}).fail(function(){this.destroyed=false})}else{return Backbone.Model.prototype.sync.apply(this,arguments)}}}},parse:function(a){if(!a){return a}a.date=new Date(a.date);a.modified=new Date(a.modified);return a},saveCompat:function(a,b){var c=this;if(!this.get("nonces")||!this.get("nonces").update){return i.Deferred().rejectWith(this).promise()}return wp.media.post("save-attachment-compat",_.defaults({id:this.id,nonce:this.get("nonces").update,post_id:wp.media.model.settings.post.id},a)).done(function(d,m,f){c.set(c.parse(d,f),b)})}},{create:function(b){var a=wp.media.model.Attachments;return a.all.push(b)},get:_.memoize(function(a,b){var c=wp.media.model.Attachments;return c.all.push(b||{id:a})})});k.exports=j},{}],3:[function(f,h,g){var i=Backbone.Collection.extend({model:wp.media.model.Attachment,initialize:function(a,b){b=b||{};this.props=new Backbone.Model();this.filters=b.filters||{};this.props.on("change",this._changeFilteredProps,this);this.props.on("change:order",this._changeOrder,this);this.props.on("change:orderby",this._changeOrderby,this);this.props.on("change:query",this._changeQuery,this);this.props.set(_.defaults(b.props||{}));if(b.observe){this.observe(b.observe)}},_changeOrder:function(){if(this.comparator){this.sort()}},_changeOrderby:function(b,a){if(this.comparator&&this.comparator!==i.comparator){return}if(a&&"post__in"!==a){this.comparator=i.comparator}else{delete this.comparator}},_changeQuery:function(b,a){if(a){this.props.on("change",this._requery,this);this._requery()}else{this.props.off("change",this._requery,this)}},_changeFilteredProps:function(b){if(this.props.get("query")){return}var a=_.chain(b.changed).map(function(l,c){var d=i.filters[c],m=b.get(c);if(!d){return}if(m&&!this.filters[c]){this.filters[c]=d}else{if(!m&&this.filters[c]===d){delete this.filters[c]}else{return}}return true},this).any().value();if(!a){return}if(!this._source){this._source=new i(this.models)}this.reset(this._source.filter(this.validator,this))},validateDestroyed:false,validator:function(a){if(!this.validateDestroyed&&a.destroyed){return false}return _.all(this.filters,function(b){return !!b.call(this,a)},this)},validate:function(a,c){var b=this.validator(a),d=!!this.get(a.cid);if(!b&&d){this.remove(a,c)}else{if(b&&!d){this.add(a,c)}}return this},validateAll:function(b,a){a=a||{};_.each(b.models,function(c){this.validate(c,{silent:true})},this);if(!a.silent){this.trigger("reset",this,a)}return this},observe:function(a){this.observers=this.observers||[];this.observers.push(a);a.on("add change remove",this._validateHandler,this);a.on("reset",this._validateAllHandler,this);this.validateAll(a);return this},unobserve:function(a){if(a){a.off(null,null,this);this.observers=_.without(this.observers,a)}else{_.each(this.observers,function(b){b.off(null,null,this)},this);delete this.observers}return this},_validateHandler:function(a,c,b){b=c===this.mirroring?b:{silent:b&&b.silent};return this.validate(a,b)},_validateAllHandler:function(b,a){return this.validateAll(b,a)},mirror:function(a){if(this.mirroring&&this.mirroring===a){return this}this.unmirror();this.mirroring=a;this.reset([],{silent:true});this.observe(a);return this},unmirror:function(){if(!this.mirroring){return}this.unobserve(this.mirroring);delete this.mirroring},more:function(b){var c=jQuery.Deferred(),a=this.mirroring,d=this;if(!a||!a.more){return c.resolveWith(this).promise()}a.more(b).done(function(){if(this===d.mirroring){c.resolveWith(this)}});return c.promise()},hasMore:function(){return this.mirroring?this.mirroring.hasMore():false},parse:function(a,b){if(!_.isArray(a)){a=[a]}return _.map(a,function(m){var c,d,l;if(m instanceof Backbone.Model){c=m.get("id");m=m.attributes}else{c=m.id}d=wp.media.model.Attachment.get(c);l=d.parse(m,b);if(!_.isEqual(d.attributes,l)){d.set(l)}return d})},_requery:function(a){var b;if(this.props.get("query")){b=this.props.toJSON();b.cache=(true!==a);this.mirror(wp.media.model.Query.get(b))}},saveMenuOrder:function(){if("menuOrder"!==this.props.get("orderby")){return}var a=this.chain().filter(function(b){return !_.isUndefined(b.id)}).map(function(b,c){c=c+1;b.set("menuOrder",c);return[b.id,c]}).object().value();if(_.isEmpty(a)){return}return wp.media.post("save-attachment-order",{nonce:wp.media.model.settings.post.nonce,post_id:wp.media.model.settings.post.id,attachments:a})}},{comparator:function(m,n,d){var c=this.props.get("orderby"),o=this.props.get("order")||"DESC",b=m.cid,a=n.cid;m=m.get(c);n=n.get(c);if("date"===c||"modified"===c){m=m||new Date();n=n||new Date()}if(d&&d.ties){b=a=null}return("DESC"===o)?wp.media.compare(m,n,b,a):wp.media.compare(n,m,a,b)},filters:{search:function(a){if(!this.props.get("search")){return true}return _.any(["title","filename","description","caption","name"],function(c){var b=a.get(c);return b&&-1!==b.search(this.props.get("search"))},this)},type:function(b){var k=this.props.get("type"),a=b.toJSON(),c,d;if(!k||(_.isArray(k)&&!k.length)){return true}c=a.mime||(a.file&&a.file.type)||"";if(_.isArray(k)){d=_.find(k,function(j){return -1!==c.indexOf(j)})}else{d=-1!==c.indexOf(k)}return d},uploadedTo:function(a){var b=this.props.get("uploadedTo");if(_.isUndefined(b)){return true}return b===a.get("uploadedTo")},status:function(a){var b=this.props.get("status");if(_.isUndefined(b)){return true}return b===a.get("status")}}});h.exports=i},{}],4:[function(f,i,g){var h=Backbone.Model.extend({initialize:function(b){var a=wp.media.model.Attachment;this.attachment=false;if(b.attachment_id){this.attachment=a.get(b.attachment_id);if(this.attachment.get("url")){this.dfd=jQuery.Deferred();this.dfd.resolve()}else{this.dfd=this.attachment.fetch()}this.bindAttachmentListeners()}this.on("change:link",this.updateLinkUrl,this);this.on("change:size",this.updateSize,this);this.setLinkTypeFromUrl();this.setAspectRatio();this.set("originalUrl",b.url)},bindAttachmentListeners:function(){this.listenTo(this.attachment,"sync",this.setLinkTypeFromUrl);this.listenTo(this.attachment,"sync",this.setAspectRatio);this.listenTo(this.attachment,"change",this.updateSize)},changeAttachment:function(a,b){this.stopListening(this.attachment);this.attachment=a;this.bindAttachmentListeners();this.set("attachment_id",this.attachment.get("id"));this.set("caption",this.attachment.get("caption"));this.set("alt",this.attachment.get("alt"));this.set("size",b.get("size"));this.set("align",b.get("align"));this.set("link",b.get("link"));this.updateLinkUrl();this.updateSize()},setLinkTypeFromUrl:function(){var b=this.get("linkUrl"),a;if(!b){this.set("link","none");return}a="custom";if(this.attachment){if(this.attachment.get("url")===b){a="file"}else{if(this.attachment.get("link")===b){a="post"}}}else{if(this.get("url")===b){a="file"}}this.set("link",a)},updateLinkUrl:function(){var a=this.get("link"),b;switch(a){case"file":if(this.attachment){b=this.attachment.get("url")}else{b=this.get("url")}this.set("linkUrl",b);break;case"post":this.set("linkUrl",this.attachment.get("link"));break;case"none":this.set("linkUrl","");break}},updateSize:function(){var a;if(!this.attachment){return}if(this.get("size")==="custom"){this.set("width",this.get("customWidth"));this.set("height",this.get("customHeight"));this.set("url",this.get("originalUrl"));return}a=this.attachment.get("sizes")[this.get("size")];if(!a){return}this.set("url",a.url);this.set("width",a.width);this.set("height",a.height)},setAspectRatio:function(){var a;if(this.attachment&&this.attachment.get("sizes")){a=this.attachment.get("sizes").full;if(a){this.set("aspectRatio",a.width/a.height);return}}this.set("aspectRatio",this.get("customWidth")/this.get("customHeight"))}});i.exports=h},{}],5:[function(k,i,g){var j=wp.media.model.Attachments,h;h=j.extend({initialize:function(a,c){var b;c=c||{};j.prototype.initialize.apply(this,arguments);this.args=c.args;this._hasMore=true;this.created=new Date();this.filters.order=function(d){var f=this.props.get("orderby"),m=this.props.get("order");if(!this.comparator){return true}if(this.length){return 1!==this.comparator(d,this.last(),{ties:true})}else{if("DESC"===m&&("date"===f||"modified"===f)){return d.get(f)>=this.created}else{if("ASC"===m&&"menuOrder"===f){return d.get(f)===0}}}return false};b=["s","order","orderby","posts_per_page","post_mime_type","post_parent"];if(wp.Uploader&&_(this.args).chain().keys().difference(b).isEmpty().value()){this.observe(wp.Uploader.queue)}},hasMore:function(){return this._hasMore},more:function(b){var a=this;if(this._more&&"pending"===this._more.state()){return this._more}if(!this.hasMore()){return jQuery.Deferred().resolveWith(this).promise()}b=b||{};b.remove=false;return this._more=this.fetch(b).done(function(c){if(_.isEmpty(c)||-1===this.args.posts_per_page||c.length<this.args.posts_per_page){a._hasMore=false}})},sync:function(a,c,d){var f,b;if("read"===a){d=d||{};d.context=this;d.data=_.extend(d.data||{},{action:"query-attachments",post_id:wp.media.model.settings.post.id});f=_.clone(this.args);if(-1!==f.posts_per_page){f.paged=Math.round(this.length/f.posts_per_page)+1}d.data.query=f;return wp.media.ajax(d)}else{b=j.prototype.sync?j.prototype:Backbone;return b.sync.apply(this,arguments)}}},{defaultProps:{orderby:"date",order:"DESC"},defaultArgs:{posts_per_page:40},orderby:{allowed:["name","author","date","title","modified","uploadedTo","id","post__in","menuOrder"],valuemap:{id:"ID",uploadedTo:"parent",menuOrder:"menu_order ID"}},propmap:{search:"s",type:"post_mime_type",perPage:"posts_per_page",menuOrder:"menu_order",uploadedTo:"post_parent",status:"post_status",include:"post__in",exclude:"post__not_in"},get:(function(){var a=[];return function(d,f){var o={},b=h.orderby,q=h.defaultProps,c,p=!!d.cache||_.isUndefined(d.cache);delete d.query;delete d.cache;_.defaults(d,q);d.order=d.order.toUpperCase();if("DESC"!==d.order&&"ASC"!==d.order){d.order=q.order.toUpperCase()}if(!_.contains(b.allowed,d.orderby)){d.orderby=q.orderby}_.each(["include","exclude"],function(l){if(d[l]&&!_.isArray(d[l])){d[l]=[d[l]]}});_.each(d,function(m,l){if(_.isNull(m)){return}o[h.propmap[l]||l]=m});_.defaults(o,h.defaultArgs);o.orderby=b.valuemap[d.orderby]||d.orderby;if(p){c=_.find(a,function(l){return _.isEqual(l.args,o)})}else{a=[]}if(!c){c=new h([],_.extend(f||{},{props:d,args:o}));a.push(c)}return c}}())});i.exports=h},{}],6:[function(g,j,h){var k=wp.media.model.Attachments,i;i=k.extend({initialize:function(a,b){k.prototype.initialize.apply(this,arguments);this.multiple=b&&b.multiple;this.on("add remove reset",_.bind(this.single,this,false))},add:function(a,b){if(!this.multiple){this.remove(this.models)}return k.prototype.add.call(this,a,b)},single:function(b){var a=this._single;if(b){this._single=b}if(this._single&&!this.get(this._single.cid)){delete this._single}this._single=this._single||this.last();if(this._single!==a){if(a){a.trigger("selection:unsingle",a,this);if(!this.get(a.cid)){this.trigger("selection:unsingle",a,this)}}if(this._single){this._single.trigger("selection:single",this._single,this)}}return this._single}});j.exports=i},{}]},{},[1]);