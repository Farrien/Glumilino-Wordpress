(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(l){var o=b[m][1][l];return c(o?o:l)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,f,a){var h=jQuery,g,d,c,i;window.wp=window.wp||{};i=wp.media=function(j){var k=i.view.MediaFrame,l;if(!k){return}j=_.defaults(j||{},{frame:"select"});if("select"===j.frame&&k.Select){l=new k.Select(j)}else{if("post"===j.frame&&k.Post){l=new k.Post(j)}else{if("manage"===j.frame&&k.Manage){l=new k.Manage(j)}else{if("image"===j.frame&&k.ImageDetails){l=new k.ImageDetails(j)}else{if("audio"===j.frame&&k.AudioDetails){l=new k.AudioDetails(j)}else{if("video"===j.frame&&k.VideoDetails){l=new k.VideoDetails(j)}else{if("edit-attachments"===j.frame&&k.EditAttachments){l=new k.EditAttachments(j)}}}}}}}delete j.frame;i.frame=l;return l};_.extend(i,{model:{},view:{},controller:{},frames:{}});c=i.model.l10n=window._wpMediaModelsL10n||{};i.model.settings=c.settings||{};delete c.settings;g=i.model.Attachment=b("./models/attachment.js");d=i.model.Attachments=b("./models/attachments.js");i.model.Query=b("./models/query.js");i.model.PostImage=b("./models/post-image.js");i.model.Selection=b("./models/selection.js");i.compare=function(k,j,l,m){if(_.isEqual(k,j)){return l===m?0:(l>m?-1:1)}else{return k>j?-1:1}};_.extend(i,{template:wp.template,post:wp.ajax.post,ajax:wp.ajax.send,fit:function(n){var k=n.width,j=n.height,m=n.maxWidth,l=n.maxHeight,o;if(!_.isUndefined(m)&&!_.isUndefined(l)){o=(k/j>m/l)?"width":"height"}else{if(_.isUndefined(l)){o="width"}else{if(_.isUndefined(m)&&j>l){o="height"}}}if("width"===o&&k>m){return{width:m,height:Math.round(m*j/k)}}else{if("height"===o&&j>l){return{width:Math.round(l*k/j),height:l}}else{return{width:k,height:j}}}},truncate:function(j,l,k){l=l||30;k=k||"&hellip;";if(j.length<=l){return j}return j.substr(0,l/2)+k+j.substr(-1*l/2)}});i.attachment=function(j){return g.get(j)};d.all=new d();i.query=function(j){return new d(null,{props:_.extend(_.defaults(j||{},{orderby:"date"}),{query:true})})};h(window).on("unload",function(){window.wp=null})},{"./models/attachment.js":2,"./models/attachments.js":3,"./models/post-image.js":4,"./models/query.js":5,"./models/selection.js":6}],2:[function(b,c,a){var f=Backbone.$,d;d=Backbone.Model.extend({sync:function(i,h,g){if(_.isUndefined(this.id)){return f.Deferred().rejectWith(this).promise()}if("read"===i){g=g||{};g.context=this;g.data=_.extend(g.data||{},{action:"get-attachment",id:this.id});return wp.media.ajax(g)}else{if("update"===i){if(!this.get("nonces")||!this.get("nonces").update){return f.Deferred().rejectWith(this).promise()}g=g||{};g.context=this;g.data=_.extend(g.data||{},{action:"save-attachment",id:this.id,nonce:this.get("nonces").update,post_id:wp.media.model.settings.post.id});if(h.hasChanged()){g.data.changes={};_.each(h.changed,function(k,j){g.data.changes[j]=this.get(j)},this)}return wp.media.ajax(g)}else{if("delete"===i){g=g||{};if(!g.wait){this.destroyed=true}g.context=this;g.data=_.extend(g.data||{},{action:"delete-post",id:this.id,_wpnonce:this.get("nonces")["delete"]});return wp.media.ajax(g).done(function(){this.destroyed=true}).fail(function(){this.destroyed=false})}else{return Backbone.Model.prototype.sync.apply(this,arguments)}}}},parse:function(g){if(!g){return g}g.date=new Date(g.date);g.modified=new Date(g.modified);return g},saveCompat:function(i,h){var g=this;if(!this.get("nonces")||!this.get("nonces").update){return f.Deferred().rejectWith(this).promise()}return wp.media.post("save-attachment-compat",_.defaults({id:this.id,nonce:this.get("nonces").update,post_id:wp.media.model.settings.post.id},i)).done(function(l,j,k){g.set(g.parse(l,k),h)})}},{create:function(g){var h=wp.media.model.Attachments;return h.all.push(g)},get:_.memoize(function(i,h){var g=wp.media.model.Attachments;return g.all.push(h||{id:i})})});c.exports=d},{}],3:[function(b,d,a){var c=Backbone.Collection.extend({model:wp.media.model.Attachment,initialize:function(g,f){f=f||{};this.props=new Backbone.Model();this.filters=f.filters||{};this.props.on("change",this._changeFilteredProps,this);this.props.on("change:order",this._changeOrder,this);this.props.on("change:orderby",this._changeOrderby,this);this.props.on("change:query",this._changeQuery,this);this.props.set(_.defaults(f.props||{}));if(f.observe){this.observe(f.observe)}},_changeOrder:function(){if(this.comparator){this.sort()}},_changeOrderby:function(f,g){if(this.comparator&&this.comparator!==c.comparator){return}if(g&&"post__in"!==g){this.comparator=c.comparator}else{delete this.comparator}},_changeQuery:function(f,g){if(g){this.props.on("change",this._requery,this);this._requery()}else{this.props.off("change",this._requery,this)}},_changeFilteredProps:function(f){if(this.props.get("query")){return}var g=_.chain(f.changed).map(function(i,k){var j=c.filters[k],h=f.get(k);if(!j){return}if(h&&!this.filters[k]){this.filters[k]=j}else{if(!h&&this.filters[k]===j){delete this.filters[k]}else{return}}return true},this).any().value();if(!g){return}if(!this._source){this._source=new c(this.models)}this.reset(this._source.filter(this.validator,this))},validateDestroyed:false,validator:function(f){if(!this.validateDestroyed&&f.destroyed){return false}return _.all(this.filters,function(g){return !!g.call(this,f)},this)},validate:function(i,g){var h=this.validator(i),f=!!this.get(i.cid);if(!h&&f){this.remove(i,g)}else{if(h&&!f){this.add(i,g)}}return this},validateAll:function(f,g){g=g||{};_.each(f.models,function(h){this.validate(h,{silent:true})},this);if(!g.silent){this.trigger("reset",this,g)}return this},observe:function(f){this.observers=this.observers||[];this.observers.push(f);f.on("add change remove",this._validateHandler,this);f.on("reset",this._validateAllHandler,this);this.validateAll(f);return this},unobserve:function(f){if(f){f.off(null,null,this);this.observers=_.without(this.observers,f)}else{_.each(this.observers,function(g){g.off(null,null,this)},this);delete this.observers}return this},_validateHandler:function(h,f,g){g=f===this.mirroring?g:{silent:g&&g.silent};return this.validate(h,g)},_validateAllHandler:function(f,g){return this.validateAll(f,g)},mirror:function(f){if(this.mirroring&&this.mirroring===f){return this}this.unmirror();this.mirroring=f;this.reset([],{silent:true});this.observe(f);return this},unmirror:function(){if(!this.mirroring){return}this.unobserve(this.mirroring);delete this.mirroring},more:function(h){var g=jQuery.Deferred(),i=this.mirroring,f=this;if(!i||!i.more){return g.resolveWith(this).promise()}i.more(h).done(function(){if(this===f.mirroring){g.resolveWith(this)}});return g.promise()},hasMore:function(){return this.mirroring?this.mirroring.hasMore():false},parse:function(g,f){if(!_.isArray(g)){g=[g]}return _.map(g,function(h){var k,j,i;if(h instanceof Backbone.Model){k=h.get("id");h=h.attributes}else{k=h.id}j=wp.media.model.Attachment.get(k);i=j.parse(h,f);if(!_.isEqual(j.attributes,i)){j.set(i)}return j})},_requery:function(g){var f;if(this.props.get("query")){f=this.props.toJSON();f.cache=(true!==g);this.mirror(wp.media.model.Query.get(f))}},saveMenuOrder:function(){if("menuOrder"!==this.props.get("orderby")){return}var f=this.chain().filter(function(g){return !_.isUndefined(g.id)}).map(function(h,g){g=g+1;h.set("menuOrder",g);return[h.id,g]}).object().value();if(_.isEmpty(f)){return}return wp.media.post("save-attachment-order",{nonce:wp.media.model.settings.post.nonce,post_id:wp.media.model.settings.post.id,attachments:f})}},{comparator:function(h,g,i){var j=this.props.get("orderby"),f=this.props.get("order")||"DESC",k=h.cid,l=g.cid;h=h.get(j);g=g.get(j);if("date"===j||"modified"===j){h=h||new Date();g=g||new Date()}if(i&&i.ties){k=l=null}return("DESC"===f)?wp.media.compare(h,g,k,l):wp.media.compare(g,h,l,k)},filters:{search:function(f){if(!this.props.get("search")){return true}return _.any(["title","filename","description","caption","name"],function(g){var h=f.get(g);return h&&-1!==h.search(this.props.get("search"))},this)},type:function(i){var f=this.props.get("type"),j=i.toJSON(),h,g;if(!f||(_.isArray(f)&&!f.length)){return true}h=j.mime||(j.file&&j.file.type)||"";if(_.isArray(f)){g=_.find(f,function(k){return -1!==h.indexOf(k)})}else{g=-1!==h.indexOf(f)}return g},uploadedTo:function(g){var f=this.props.get("uploadedTo");if(_.isUndefined(f)){return true}return f===g.get("uploadedTo")},status:function(g){var f=this.props.get("status");if(_.isUndefined(f)){return true}return f===g.get("status")}}});d.exports=c},{}],4:[function(b,c,a){var d=Backbone.Model.extend({initialize:function(f){var g=wp.media.model.Attachment;this.attachment=false;if(f.attachment_id){this.attachment=g.get(f.attachment_id);if(this.attachment.get("url")){this.dfd=jQuery.Deferred();this.dfd.resolve()}else{this.dfd=this.attachment.fetch()}this.bindAttachmentListeners()}this.on("change:link",this.updateLinkUrl,this);this.on("change:size",this.updateSize,this);this.setLinkTypeFromUrl();this.setAspectRatio();this.set("originalUrl",f.url)},bindAttachmentListeners:function(){this.listenTo(this.attachment,"sync",this.setLinkTypeFromUrl);this.listenTo(this.attachment,"sync",this.setAspectRatio);this.listenTo(this.attachment,"change",this.updateSize)},changeAttachment:function(g,f){this.stopListening(this.attachment);this.attachment=g;this.bindAttachmentListeners();this.set("attachment_id",this.attachment.get("id"));this.set("caption",this.attachment.get("caption"));this.set("alt",this.attachment.get("alt"));this.set("size",f.get("size"));this.set("align",f.get("align"));this.set("link",f.get("link"));this.updateLinkUrl();this.updateSize()},setLinkTypeFromUrl:function(){var f=this.get("linkUrl"),g;if(!f){this.set("link","none");return}g="custom";if(this.attachment){if(this.attachment.get("url")===f){g="file"}else{if(this.attachment.get("link")===f){g="post"}}}else{if(this.get("url")===f){g="file"}}this.set("link",g)},updateLinkUrl:function(){var g=this.get("link"),f;switch(g){case"file":if(this.attachment){f=this.attachment.get("url")}else{f=this.get("url")}this.set("linkUrl",f);break;case"post":this.set("linkUrl",this.attachment.get("link"));break;case"none":this.set("linkUrl","");break}},updateSize:function(){var f;if(!this.attachment){return}if(this.get("size")==="custom"){this.set("width",this.get("customWidth"));this.set("height",this.get("customHeight"));this.set("url",this.get("originalUrl"));return}f=this.attachment.get("sizes")[this.get("size")];if(!f){return}this.set("url",f.url);this.set("width",f.width);this.set("height",f.height)},setAspectRatio:function(){var f;if(this.attachment&&this.attachment.get("sizes")){f=this.attachment.get("sizes").full;if(f){this.set("aspectRatio",f.width/f.height);return}}this.set("aspectRatio",this.get("customWidth")/this.get("customHeight"))}});c.exports=d},{}],5:[function(c,f,b){var d=wp.media.model.Attachments,a;a=d.extend({initialize:function(i,g){var h;g=g||{};d.prototype.initialize.apply(this,arguments);this.args=g.args;this._hasMore=true;this.created=new Date();this.filters.order=function(l){var k=this.props.get("orderby"),j=this.props.get("order");if(!this.comparator){return true}if(this.length){return 1!==this.comparator(l,this.last(),{ties:true})}else{if("DESC"===j&&("date"===k||"modified"===k)){return l.get(k)>=this.created}else{if("ASC"===j&&"menuOrder"===k){return l.get(k)===0}}}return false};h=["s","order","orderby","posts_per_page","post_mime_type","post_parent"];if(wp.Uploader&&_(this.args).chain().keys().difference(h).isEmpty().value()){this.observe(wp.Uploader.queue)}},hasMore:function(){return this._hasMore},more:function(g){var h=this;if(this._more&&"pending"===this._more.state()){return this._more}if(!this.hasMore()){return jQuery.Deferred().resolveWith(this).promise()}g=g||{};g.remove=false;return this._more=this.fetch(g).done(function(i){if(_.isEmpty(i)||-1===this.args.posts_per_page||i.length<this.args.posts_per_page){h._hasMore=false}})},sync:function(k,i,h){var g,j;if("read"===k){h=h||{};h.context=this;h.data=_.extend(h.data||{},{action:"query-attachments",post_id:wp.media.model.settings.post.id});g=_.clone(this.args);if(-1!==g.posts_per_page){g.paged=Math.round(this.length/g.posts_per_page)+1}h.data.query=g;return wp.media.ajax(h)}else{j=d.prototype.sync?d.prototype:Backbone;return j.sync.apply(this,arguments)}}},{defaultProps:{orderby:"date",order:"DESC"},defaultArgs:{posts_per_page:40},orderby:{allowed:["name","author","date","title","modified","uploadedTo","id","post__in","menuOrder"],valuemap:{id:"ID",uploadedTo:"parent",menuOrder:"menu_order ID"}},propmap:{search:"s",type:"post_mime_type",perPage:"posts_per_page",menuOrder:"menu_order",uploadedTo:"post_parent",status:"post_status",include:"post__in",exclude:"post__not_in"},get:(function(){var g=[];return function(k,j){var i={},m=a.orderby,n=a.defaultProps,l,h=!!k.cache||_.isUndefined(k.cache);delete k.query;delete k.cache;_.defaults(k,n);k.order=k.order.toUpperCase();if("DESC"!==k.order&&"ASC"!==k.order){k.order=n.order.toUpperCase()}if(!_.contains(m.allowed,k.orderby)){k.orderby=n.orderby}_.each(["include","exclude"],function(o){if(k[o]&&!_.isArray(k[o])){k[o]=[k[o]]}});_.each(k,function(o,p){if(_.isNull(o)){return}i[a.propmap[p]||p]=o});_.defaults(i,a.defaultArgs);i.orderby=m.valuemap[k.orderby]||k.orderby;if(h){l=_.find(g,function(o){return _.isEqual(o.args,i)})}else{g=[]}if(!l){l=new a([],_.extend(j||{},{props:k,args:i}));g.push(l)}return l}}())});f.exports=a},{}],6:[function(b,d,a){var c=wp.media.model.Attachments,f;f=c.extend({initialize:function(h,g){c.prototype.initialize.apply(this,arguments);this.multiple=g&&g.multiple;this.on("add remove reset",_.bind(this.single,this,false))},add:function(h,g){if(!this.multiple){this.remove(this.models)}return c.prototype.add.call(this,h,g)},single:function(g){var h=this._single;if(g){this._single=g}if(this._single&&!this.get(this._single.cid)){delete this._single}this._single=this._single||this.last();if(this._single!==h){if(h){h.trigger("selection:unsingle",h,this);if(!this.get(h.cid)){this.trigger("selection:unsingle",h,this)}}if(this._single){this._single.trigger("selection:single",this._single,this)}}return this._single}});d.exports=f},{}]},{},[1]);