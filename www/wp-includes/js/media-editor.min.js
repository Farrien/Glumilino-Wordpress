(function(c,a){var b={};wp.media.coerce=function(d,e){if(a.isUndefined(d[e])&&!a.isUndefined(this.defaults[e])){d[e]=this.defaults[e]}else{if("true"===d[e]){d[e]=true}else{if("false"===d[e]){d[e]=false}}}return d[e]};wp.media.string={props:function(f,i){var h,d,e,g,j=wp.media.view.settings.defaultProps;f=f?a.clone(f):{};if(i&&i.type){f.type=i.type}if("image"===f.type){f=a.defaults(f||{},{align:j.align||getUserSetting("align","none"),size:j.size||getUserSetting("imgsize","medium"),url:"",classes:[]})}if(!i){return f}f.title=f.title||i.title;h=f.link||j.link||getUserSetting("urlbutton","file");if("file"===h||"embed"===h){d=i.url}else{if("post"===h){d=i.link}else{if("custom"===h){d=f.linkUrl}}}f.linkUrl=d||"";if("image"===i.type){f.classes.push("wp-image-"+i.id);g=i.sizes;e=g&&g[f.size]?g[f.size]:i;a.extend(f,a.pick(i,"align","caption","alt"),{width:e.width,height:e.height,src:e.url,captionId:"attachment_"+i.id})}else{if("video"===i.type||"audio"===i.type){a.extend(f,a.pick(i,"title","type","icon","mime"))}else{f.title=f.title||i.filename;f.rel=f.rel||"attachment wp-att-"+i.id}}return f},link:function(e,f){var d;e=wp.media.string.props(e,f);d={tag:"a",content:e.title,attrs:{href:e.linkUrl}};if(e.rel){d.attrs.rel=e.rel}return wp.html.string(d)},audio:function(d,e){return wp.media.string._audioVideo("audio",d,e)},video:function(d,e){return wp.media.string._audioVideo("video",d,e)},_audioVideo:function(f,e,h){var g,d,i;e=wp.media.string.props(e,h);if(e.link!=="embed"){return wp.media.string.link(e)}g={};if("video"===f){if(h.image&&-1===h.image.src.indexOf(h.icon)){g.poster=h.image.src}if(h.width){g.width=h.width}if(h.height){g.height=h.height}}i=h.filename.split(".").pop();if(a.contains(wp.media.view.settings.embedExts,i)){g[i]=h.url}else{return wp.media.string.link(e)}d=wp.shortcode.string({tag:f,attrs:g});return d},image:function(h,j){var d={},e,g,i,f;h.type="image";h=wp.media.string.props(h,j);g=h.classes||[];d.src=!a.isUndefined(j)?j.url:h.url;a.extend(d,a.pick(h,"width","height","alt"));if(h.align&&!h.caption){g.push("align"+h.align)}if(h.size){g.push("size-"+h.size)}d["class"]=a.compact(g).join(" ");e={tag:"img",attrs:d,single:true};if(h.linkUrl){e={tag:"a",attrs:{href:h.linkUrl},content:e}}f=wp.html.string(e);if(h.caption){i={};if(d.width){i.width=d.width}if(h.captionId){i.id=h.captionId}if(h.align){i.align="align"+h.align}f=wp.shortcode.string({tag:"caption",attrs:i,content:f+" "+h.caption})}return f}};wp.media.embed={coerce:wp.media.coerce,defaults:{url:"",width:"",height:""},edit:function(f,h){var g,d={},e;if(h){d.url=f.replace(/<[^>]+>/g,"")}else{e=wp.shortcode.next("embed",f).shortcode;d=a.defaults(e.attrs.named,this.defaults);if(e.content){d.url=e.content}}g=wp.media({frame:"post",state:"embed",metadata:d});return g},shortcode:function(e){var d=this,f;a.each(this.defaults,function(h,g){e[g]=d.coerce(e,g);if(h===e[g]){delete e[g]}});f=e.url;delete e.url;return new wp.shortcode({tag:"embed",attrs:e,content:f})}};wp.media.collection=function(d){var e={};return a.extend({coerce:wp.media.coerce,attachments:function(k){var m=k.string(),f=e[m],i,h,l,j,g=this;delete e[m];if(f){return f}i=a.defaults(k.attrs.named,this.defaults);h=a.pick(i,"orderby","order");h.type=this.type;h.perPage=-1;if(undefined!==i.orderby){i._orderByField=i.orderby}if("rand"===i.orderby){i._orderbyRandom=true}if(!i.orderby||/^menu_order(?: ID)?$/i.test(i.orderby)){h.orderby="menuOrder"}if(i.ids){h.post__in=i.ids.split(",");h.orderby="post__in"}else{if(i.include){h.post__in=i.include.split(",")}}if(i.exclude){h.post__not_in=i.exclude.split(",")}if(!h.post__in){h.uploadedTo=i.id}j=a.omit(i,"id","ids","include","exclude","orderby","order");a.each(this.defaults,function(o,n){j[n]=g.coerce(j,n)});l=wp.media.query(h);l[this.tag]=new Backbone.Model(j);return l},shortcode:function(f){var h=f.props.toJSON(),g=a.pick(h,"orderby","order"),i,j;if(f.type){g.type=f.type;delete f.type}if(f[this.tag]){a.extend(g,f[this.tag].toJSON())}g.ids=f.pluck("id");if(h.uploadedTo){g.id=h.uploadedTo}delete g.orderby;if(g._orderbyRandom){g.orderby="rand"}else{if(g._orderByField&&g._orderByField!="rand"){g.orderby=g._orderByField}}delete g._orderbyRandom;delete g._orderByField;if(g.ids&&"post__in"===g.orderby){delete g.orderby}g=this.setDefaults(g);i=new wp.shortcode({tag:this.tag,attrs:g,type:"single"});j=new wp.media.model.Attachments(f.models,{props:h});j[this.tag]=f[this.tag];e[i.string()]=j;return i},edit:function(i){var h=wp.shortcode.next(this.tag,i),k=this.defaults.id,f,g,j;if(!h||h.content!==i){return}h=h.shortcode;if(a.isUndefined(h.get("id"))&&!a.isUndefined(k)){h.set("id",k)}f=this.attachments(h);g=new wp.media.model.Selection(f.models,{props:f.props.toJSON(),multiple:true});g[this.tag]=f[this.tag];g.more().done(function(){g.props.set({query:false});g.unmirror();g.props.unset("orderby")});if(this.frame){this.frame.dispose()}if(h.attrs.named.type&&"video"===h.attrs.named.type){j="video-"+this.tag+"-edit"}else{j=this.tag+"-edit"}this.frame=wp.media({frame:"post",state:j,title:this.editTitle,editing:true,multiple:true,selection:g}).open();return this.frame},setDefaults:function(g){var f=this;a.each(this.defaults,function(i,h){g[h]=f.coerce(g,h);if(i===g[h]){delete g[h]}});return g}},d)};wp.media._galleryDefaults={itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"};if(wp.media.view.settings.galleryDefaults){wp.media.galleryDefaults=a.extend({},wp.media._galleryDefaults,wp.media.view.settings.galleryDefaults)}else{wp.media.galleryDefaults=wp.media._galleryDefaults}wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:wp.media.galleryDefaults,setDefaults:function(e){var d=this,f=!a.isEqual(wp.media.galleryDefaults,wp.media._galleryDefaults);a.each(this.defaults,function(h,g){e[g]=d.coerce(e,g);if(h===e[g]&&(!f||h===wp.media._galleryDefaults[g])){delete e[g]}});return e}});wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(e){var d=wp.media.view.settings;d.post.featuredImageId=e;wp.media.post("get-post-thumbnail-html",{post_id:d.post.id,thumbnail_id:d.post.featuredImageId,_wpnonce:d.post.nonce}).done(function(f){if(f=="0"){window.alert(window.setPostThumbnailL10n.error);return}c(".inside","#postimagediv").html(f)})},remove:function(){wp.media.featuredImage.set(-1)},frame:function(){if(this._frame){wp.media.frame=this._frame;return this._frame}this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage(),new wp.media.controller.EditImage()]});this._frame.on("toolbar:create:featured-image",function(d){this.createSelectToolbar(d,{text:wp.media.view.l10n.setFeaturedImage})},this._frame);this._frame.on("content:render:edit-image",function(){var e=this.state("featured-image").get("selection"),d=new wp.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(d);d.loadEditor()},this._frame);this._frame.state("featured-image").on("select",this.select);return this._frame},select:function(){var d=this.get("selection").single();if(!wp.media.view.settings.post.featuredImageId){return}wp.media.featuredImage.set(d?d.id:-1)},init:function(){c("#postimagediv").on("click","#set-post-thumbnail",function(d){d.preventDefault();d.stopPropagation();wp.media.featuredImage.frame().open()}).on("click","#remove-post-thumbnail",function(){wp.media.featuredImage.remove();return false})}};c(wp.media.featuredImage.init);wp.media.editor={insert:function(g){var h,d,f=!a.isUndefined(window.tinymce),i=!a.isUndefined(window.QTags);if(this.activeEditor){d=window.wpActiveEditor=this.activeEditor}else{d=window.wpActiveEditor}if(window.send_to_editor){return window.send_to_editor.apply(this,arguments)}if(!d){if(f&&tinymce.activeEditor){h=tinymce.activeEditor;d=window.wpActiveEditor=h.id}else{if(!i){return false}}}else{if(f){h=tinymce.get(d)}}if(h&&!h.isHidden()){h.execCommand("mceInsertContent",false,g)}else{if(i){QTags.insertContent(g)}else{document.getElementById(d).value+=g}}if(window.tb_remove){try{window.tb_remove()}catch(j){}}},add:function(f,d){var e=this.get(f);if(e){return e}e=b[f]=wp.media(a.defaults(d||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:true}));e.on("insert",function(g){var h=e.state();g=g||h.get("selection");if(!g){return}c.when.apply(c,g.map(function(j){var i=h.display(j).toJSON();return this.send.attachment(i,j.toJSON())},this)).done(function(){wp.media.editor.insert(a.toArray(arguments).join("\n\n"))})},this);e.state("gallery-edit").on("update",function(g){this.insert(wp.media.gallery.shortcode(g).string())},this);e.state("playlist-edit").on("update",function(g){this.insert(wp.media.playlist.shortcode(g).string())},this);e.state("video-playlist-edit").on("update",function(g){this.insert(wp.media.playlist.shortcode(g).string())},this);e.state("embed").on("select",function(){var h=e.state(),g=h.get("type"),i=h.props.toJSON();i.url=i.url||"";if("link"===g){a.defaults(i,{linkText:i.url,linkUrl:i.url});this.send.link(i).done(function(j){wp.media.editor.insert(j)})}else{if("image"===g){a.defaults(i,{title:i.url,linkUrl:"",align:"none",link:"none"});if("none"===i.link){i.linkUrl=""}else{if("file"===i.link){i.linkUrl=i.url}}this.insert(wp.media.string.image(i))}}},this);e.state("featured-image").on("select",wp.media.featuredImage.select);e.setState(e.options.state);return e},id:function(d){if(d){return d}d=window.wpActiveEditor;if(!d&&!a.isUndefined(window.tinymce)&&tinymce.activeEditor){d=tinymce.activeEditor.id}d=d||"";return d},get:function(d){d=this.id(d);return b[d]},remove:function(d){d=this.id(d);delete b[d]},send:{attachment:function(g,h){var d=h.caption,e,f;if(!wp.media.view.settings.captions){delete h.caption}g=wp.media.string.props(g,h);e={id:h.id,post_content:h.description,post_excerpt:d};if(g.linkUrl){e.url=g.linkUrl}if("image"===h.type){f=wp.media.string.image(g);a.each({align:"align",size:"image-size",alt:"image_alt"},function(i,j){if(g[j]){e[i]=g[j]}})}else{if("video"===h.type){f=wp.media.string.video(g,h)}else{if("audio"===h.type){f=wp.media.string.audio(g,h)}else{f=wp.media.string.link(g);e.post_title=g.title}}}return wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:e,html:f,post_id:wp.media.view.settings.post.id})},link:function(d){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,src:d.linkUrl,link_text:d.linkText,html:wp.media.string.link(d),post_id:wp.media.view.settings.post.id})}},open:function(f,d){var e;d=d||{};f=this.id(f);this.activeEditor=f;e=this.get(f);if(!e||(e.options&&d.state!==e.options.state)){e=this.add(f,d)}wp.media.frame=e;return e.open()},init:function(){c(document.body).on("click.add-media-button",".insert-media",function(g){var f=c(g.currentTarget),e=f.data("editor"),d={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:true};g.preventDefault();if(f.hasClass("gallery")){d.state="gallery";d.title=wp.media.view.l10n.createGalleryTitle}wp.media.editor.open(e,d)});new wp.media.view.EditorUploader().render()}};a.bindAll(wp.media.editor,"open");c(wp.media.editor.init)}(jQuery,_));