(function(e,f,g){var h=function(){var a=e(document),c={suspend:false,suspendEnabled:true,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:false,connectionError:false,errorcount:0,hasConnected:false,hasFocus:true,userActivity:0,userActivityEvents:false,checkFocusTimer:0,beatTimer:0};function S(){var j,i,l,k;if(typeof f.pagenow==="string"){c.screenId=f.pagenow}if(typeof f.ajaxurl==="string"){c.url=f.ajaxurl}if(typeof f.heartbeatSettings==="object"){j=f.heartbeatSettings;if(!c.url&&j.ajaxurl){c.url=j.ajaxurl}if(j.interval){c.mainInterval=j.interval;if(c.mainInterval<15){c.mainInterval=15}else{if(c.mainInterval>120){c.mainInterval=120}}}if(j.minimalInterval){j.minimalInterval=parseInt(j.minimalInterval,10);c.minimalInterval=j.minimalInterval>0&&j.minimalInterval<=600?j.minimalInterval*1000:0}if(c.minimalInterval&&c.mainInterval<c.minimalInterval){c.mainInterval=c.minimalInterval}if(!c.screenId){c.screenId=j.screenId||"front"}if(j.suspension==="disable"){c.suspendEnabled=false}}c.mainInterval=c.mainInterval*1000;c.originalInterval=c.mainInterval;if(typeof document.hidden!=="undefined"){i="hidden";k="visibilitychange";l="visibilityState"}else{if(typeof document.msHidden!=="undefined"){i="msHidden";k="msvisibilitychange";l="msVisibilityState"}else{if(typeof document.webkitHidden!=="undefined"){i="webkitHidden";k="webkitvisibilitychange";l="webkitVisibilityState"}}}if(i){if(document[i]){c.hasFocus=false}a.on(k+".wp-heartbeat",function(){if(document[l]==="hidden"){E();f.clearInterval(c.checkFocusTimer)}else{F();if(document.hasFocus){c.checkFocusTimer=f.setInterval(T,10000)}}})}if(document.hasFocus){c.checkFocusTimer=f.setInterval(T,10000)}e(f).on("unload.wp-heartbeat",function(){c.suspend=true;if(c.xhr&&c.xhr.readyState!==4){c.xhr.abort()}});f.setInterval(G,30000);a.ready(function(){c.lastTick=L();d()})}function L(){return(new Date()).getTime()}function B(i){var l,j=i.src;if(j&&/^https?:\/\//.test(j)){l=f.location.origin?f.location.origin:f.location.protocol+"//"+f.location.host;if(j.indexOf(l)!==0){return false}}try{if(i.contentWindow.document){return true}}catch(k){}return false}function T(){if(c.hasFocus&&!document.hasFocus()){E()}else{if(!c.hasFocus&&document.hasFocus()){F()}}}function K(i,k){var j;if(i){switch(i){case"abort":break;case"timeout":j=true;break;case"error":if(503===k&&c.hasConnected){j=true;break}case"parsererror":case"empty":case"unknown":c.errorcount++;if(c.errorcount>2&&c.hasConnected){j=true}break}if(j&&!I()){c.connectionError=true;a.trigger("heartbeat-connection-lost",[i,k])}}}function N(){c.hasConnected=true;if(I()){c.errorcount=0;c.connectionError=false;a.trigger("heartbeat-connection-restored")}}function R(){var j,i;if(c.connecting||c.suspend){return}c.lastTick=L();i=e.extend({},c.queue);c.queue={};a.trigger("heartbeat-send",[i]);j={data:i,interval:c.tempInterval?c.tempInterval/1000:c.mainInterval/1000,_nonce:typeof f.heartbeatSettings==="object"?f.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:c.screenId,has_focus:c.hasFocus};c.connecting=true;c.xhr=e.ajax({url:c.url,type:"post",timeout:30000,data:j,dataType:"json"}).always(function(){c.connecting=false;d()}).done(function(n,k,l){var m;if(!n){K("empty");return}N();if(n.nonces_expired){a.trigger("heartbeat-nonces-expired")}if(n.heartbeat_interval){m=n.heartbeat_interval;delete n.heartbeat_interval}a.trigger("heartbeat-tick",[n,k,l]);if(m){b(m)}}).fail(function(l,k,m){K(k||"unknown",l.status);a.trigger("heartbeat-error",[l,k,m])})}function d(){var i=L()-c.lastTick,j=c.mainInterval;if(c.suspend){return}if(!c.hasFocus){j=120000}else{if(c.countdown>0&&c.tempInterval){j=c.tempInterval;c.countdown--;if(c.countdown<1){c.tempInterval=0}}}if(c.minimalInterval&&j<c.minimalInterval){j=c.minimalInterval}f.clearTimeout(c.beatTimer);if(i<j){c.beatTimer=f.setTimeout(function(){R()},j-i)}else{R()}}function E(){c.hasFocus=false}function F(){c.userActivity=L();c.suspend=false;if(!c.hasFocus){c.hasFocus=true;d()}}function H(){c.userActivityEvents=false;a.off(".wp-heartbeat-active");e("iframe").each(function(j,i){if(B(i)){e(i.contentWindow).off(".wp-heartbeat-active")}});F()}function G(){var i=c.userActivity?L()-c.userActivity:0;if(i>300000&&c.hasFocus){E()}if((c.suspendEnabled&&i>600000)||i>3600000){c.suspend=true}if(!c.userActivityEvents){a.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){H()});e("iframe").each(function(k,j){if(B(j)){e(j.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){H()})}});c.userActivityEvents=true}}function O(){return c.hasFocus}function I(){return c.connectionError}function J(){c.lastTick=0;d()}function P(){c.suspendEnabled=false}function b(i,k){var l,j=c.tempInterval?c.tempInterval:c.mainInterval;if(i){switch(i){case"fast":case 5:l=5000;break;case 15:l=15000;break;case 30:l=30000;break;case 60:l=60000;break;case 120:l=120000;break;case"long-polling":c.mainInterval=0;return 0;default:l=c.originalInterval}if(c.minimalInterval&&l<c.minimalInterval){l=c.minimalInterval}if(5000===l){k=parseInt(k,10)||30;k=k<1||k>30?30:k;c.countdown=k;c.tempInterval=l}else{c.countdown=0;c.tempInterval=0;c.mainInterval=l}if(l!==j){d()}}return c.tempInterval?c.tempInterval/1000:c.mainInterval/1000}function C(j,k,i){if(j){if(i&&this.isQueued(j)){return false}c.queue[j]=k;return true}return false}function D(i){if(i){return c.queue.hasOwnProperty(i)}}function Q(i){if(i){delete c.queue[i]}}function M(i){if(i){return this.isQueued(i)?c.queue[i]:g}}S();return{hasFocus:O,connectNow:J,disableSuspend:P,interval:b,hasConnectionError:I,enqueue:C,dequeue:Q,isQueued:D,getQueuedItem:M}};f.wp=f.wp||{};f.wp.heartbeat=new h()}(jQuery,window));