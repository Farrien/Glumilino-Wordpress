window.wp=window.wp||{};(function(e,d){var f;if(typeof _wpPluploadSettings==="undefined"){return}f=function(j){var l=this,b=navigator.userAgent.indexOf("Trident/")!=-1||navigator.userAgent.indexOf("MSIE ")!=-1,a={container:"container",browser:"browse_button",dropzone:"drop_element"},c,k;this.supports={upload:f.browser.supported};this.supported=this.supports.upload;if(!this.supported){return}this.plupload=d.extend(true,{multipart_params:{}},f.defaults);this.container=document.body;d.extend(true,this,j);for(c in this){if(d.isFunction(this[c])){this[c]=d.proxy(this[c],this)}}for(c in a){if(!this[c]){continue}this[c]=d(this[c]).first();if(!this[c].length){delete this[c];continue}if(!this[c].prop("id")){this[c].prop("id","__wp-uploader-id-"+f.uuid++)}this.plupload[a[c]]=this[c].prop("id")}if(!(this.browser&&this.browser.length)&&!(this.dropzone&&this.dropzone.length)){return}if(!b&&"flash"===plupload.predictRuntime(this.plupload)&&(!this.plupload.required_features||!this.plupload.required_features.hasOwnProperty("send_binary_string"))){this.plupload.required_features=this.plupload.required_features||{};this.plupload.required_features.send_binary_string=true}this.uploader=new plupload.Uploader(this.plupload);delete this.plupload;this.param(this.params||{});delete this.params;k=function(h,g,i){if(i.attachment){i.attachment.destroy()}f.errors.unshift({message:h||pluploadL10n.default_error,data:g,file:i});l.error(h,g,i)};this.uploader.bind("init",function(g){var p,h,i,o=l.dropzone;i=l.supports.dragdrop=g.features.dragdrop&&!f.browser.mobile;if(!o){return}o.toggleClass("supports-drag-drop",!!i);if(!i){return o.unbind(".wp-uploader")}o.bind("dragover.wp-uploader",function(){if(p){clearTimeout(p)}if(h){return}o.trigger("dropzone:enter").addClass("drag-over");h=true});o.bind("dragleave.wp-uploader, drop.wp-uploader",function(){p=setTimeout(function(){h=false;o.trigger("dropzone:leave").removeClass("drag-over")},0)});l.ready=true;d(l).trigger("uploader:ready")});this.uploader.bind("postinit",function(g){g.refresh();l.init()});this.uploader.init();if(this.browser){this.browser.on("mouseenter",this.refresh)}else{this.uploader.disableBrowse(true);d("#"+this.uploader.id+"_html5_container").hide()}this.uploader.bind("FilesAdded",function(h,g){_.each(g,function(i){var o,p;if(plupload.FAILED===i.status){return}o=_.extend({file:i,uploading:true,date:new Date(),filename:i.name,menuOrder:0,uploadedTo:wp.media.model.settings.post.id},_.pick(i,"loaded","size","percent"));p=/(?:jpe?g|png|gif)$/i.exec(i.name);if(p){o.type="image";o.subtype=("jpg"===p[0])?"jpeg":p[0]}i.attachment=wp.media.model.Attachment.create(o);f.queue.add(i.attachment);l.added(i.attachment)});h.refresh();h.start()});this.uploader.bind("UploadProgress",function(h,g){g.attachment.set(_.pick(g,"loaded","percent"));l.progress(g.attachment)});this.uploader.bind("FileUploaded",function(o,g,h){var i;try{h=JSON.parse(h.response)}catch(p){return k(pluploadL10n.default_error,p,g)}if(!_.isObject(h)||_.isUndefined(h.success)){return k(pluploadL10n.default_error,null,g)}else{if(!h.success){return k(h.data&&h.data.message,h.data,g)}}_.each(["file","loaded","size","percent"],function(m){g.attachment.unset(m)});g.attachment.set(_.extend(h.data,{uploading:false}));wp.media.model.Attachment.get(h.data.id,g.attachment);i=f.queue.all(function(m){return !m.get("uploading")});if(i){f.queue.reset()}l.success(g.attachment)});this.uploader.bind("Error",function(n,g){var h=pluploadL10n.default_error,i;for(i in f.errorMap){if(g.code===plupload[i]){h=f.errorMap[i];if(_.isFunction(h)){h=h(g.file,g)}break}}k(h,g,g.file);n.refresh()})};d.extend(f,_wpPluploadSettings);f.uuid=0;f.errorMap={FAILED:pluploadL10n.upload_failed,FILE_EXTENSION_ERROR:pluploadL10n.invalid_filetype,IMAGE_FORMAT_ERROR:pluploadL10n.not_an_image,IMAGE_MEMORY_ERROR:pluploadL10n.image_memory_exceeded,IMAGE_DIMENSIONS_ERROR:pluploadL10n.image_dimensions_exceeded,GENERIC_ERROR:pluploadL10n.upload_failed,IO_ERROR:pluploadL10n.io_error,HTTP_ERROR:pluploadL10n.http_error,SECURITY_ERROR:pluploadL10n.security_error,FILE_SIZE_ERROR:function(a){return pluploadL10n.file_exceeds_size_limit.replace("%s",a.name)}};d.extend(f.prototype,{param:function(b,a){if(arguments.length===1&&typeof b==="string"){return this.uploader.settings.multipart_params[b]}if(arguments.length>1){this.uploader.settings.multipart_params[b]=a}else{d.extend(this.uploader.settings.multipart_params,b)}},init:function(){},error:function(){},success:function(){},added:function(){},progress:function(){},complete:function(){},refresh:function(){var b,c,h,a;if(this.browser){b=this.browser[0];while(b){if(b===document.body){c=true;break}b=b.parentNode}if(!c){a="wp-uploader-browser-"+this.uploader.id;h=d("#"+a);if(!h.length){h=d('<div class="wp-uploader-browser" />').css({position:"fixed",top:"-1000px",left:"-1000px",height:0,width:0}).attr("id","wp-uploader-browser-"+this.uploader.id).appendTo("body")}h.append(this.browser)}}this.uploader.refresh()}});f.queue=new wp.media.model.Attachments([],{query:false});f.errors=new Backbone.Collection();e.Uploader=f})(wp,jQuery);