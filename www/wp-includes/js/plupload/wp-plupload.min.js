window.wp=window.wp||{};(function(a,b){var c;if(typeof _wpPluploadSettings==="undefined"){return}c=function(f){var d=this,h=navigator.userAgent.indexOf("Trident/")!=-1||navigator.userAgent.indexOf("MSIE ")!=-1,i={container:"container",browser:"browse_button",dropzone:"drop_element"},g,e;this.supports={upload:c.browser.supported};this.supported=this.supports.upload;if(!this.supported){return}this.plupload=b.extend(true,{multipart_params:{}},c.defaults);this.container=document.body;b.extend(true,this,f);for(g in this){if(b.isFunction(this[g])){this[g]=b.proxy(this[g],this)}}for(g in i){if(!this[g]){continue}this[g]=b(this[g]).first();if(!this[g].length){delete this[g];continue}if(!this[g].prop("id")){this[g].prop("id","__wp-uploader-id-"+c.uuid++)}this.plupload[i[g]]=this[g].prop("id")}if(!(this.browser&&this.browser.length)&&!(this.dropzone&&this.dropzone.length)){return}if(!h&&"flash"===plupload.predictRuntime(this.plupload)&&(!this.plupload.required_features||!this.plupload.required_features.hasOwnProperty("send_binary_string"))){this.plupload.required_features=this.plupload.required_features||{};this.plupload.required_features.send_binary_string=true}this.uploader=new plupload.Uploader(this.plupload);delete this.plupload;this.param(this.params||{});delete this.params;e=function(k,l,j){if(j.attachment){j.attachment.destroy()}c.errors.unshift({message:k||pluploadL10n.default_error,data:l,file:j});d.error(k,l,j)};this.uploader.bind("init",function(m){var n,l,k,j=d.dropzone;k=d.supports.dragdrop=m.features.dragdrop&&!c.browser.mobile;if(!j){return}j.toggleClass("supports-drag-drop",!!k);if(!k){return j.unbind(".wp-uploader")}j.bind("dragover.wp-uploader",function(){if(n){clearTimeout(n)}if(l){return}j.trigger("dropzone:enter").addClass("drag-over");l=true});j.bind("dragleave.wp-uploader, drop.wp-uploader",function(){n=setTimeout(function(){l=false;j.trigger("dropzone:leave").removeClass("drag-over")},0)});d.ready=true;b(d).trigger("uploader:ready")});this.uploader.bind("postinit",function(j){j.refresh();d.init()});this.uploader.init();if(this.browser){this.browser.on("mouseenter",this.refresh)}else{this.uploader.disableBrowse(true);b("#"+this.uploader.id+"_html5_container").hide()}this.uploader.bind("FilesAdded",function(j,k){_.each(k,function(m){var l,n;if(plupload.FAILED===m.status){return}l=_.extend({file:m,uploading:true,date:new Date(),filename:m.name,menuOrder:0,uploadedTo:wp.media.model.settings.post.id},_.pick(m,"loaded","size","percent"));n=/(?:jpe?g|png|gif)$/i.exec(m.name);if(n){l.type="image";l.subtype=("jpg"===n[0])?"jpeg":n[0]}m.attachment=wp.media.model.Attachment.create(l);c.queue.add(m.attachment);d.added(m.attachment)});j.refresh();j.start()});this.uploader.bind("UploadProgress",function(j,k){k.attachment.set(_.pick(k,"loaded","percent"));d.progress(k.attachment)});this.uploader.bind("FileUploaded",function(j,m,l){var k;try{l=JSON.parse(l.response)}catch(n){return e(pluploadL10n.default_error,n,m)}if(!_.isObject(l)||_.isUndefined(l.success)){return e(pluploadL10n.default_error,null,m)}else{if(!l.success){return e(l.data&&l.data.message,l.data,m)}}_.each(["file","loaded","size","percent"],function(o){m.attachment.unset(o)});m.attachment.set(_.extend(l.data,{uploading:false}));wp.media.model.Attachment.get(l.data.id,m.attachment);k=c.queue.all(function(o){return !o.get("uploading")});if(k){c.queue.reset()}d.success(m.attachment)});this.uploader.bind("Error",function(j,m){var l=pluploadL10n.default_error,k;for(k in c.errorMap){if(m.code===plupload[k]){l=c.errorMap[k];if(_.isFunction(l)){l=l(m.file,m)}break}}e(l,m,m.file);j.refresh()})};b.extend(c,_wpPluploadSettings);c.uuid=0;c.errorMap={FAILED:pluploadL10n.upload_failed,FILE_EXTENSION_ERROR:pluploadL10n.invalid_filetype,IMAGE_FORMAT_ERROR:pluploadL10n.not_an_image,IMAGE_MEMORY_ERROR:pluploadL10n.image_memory_exceeded,IMAGE_DIMENSIONS_ERROR:pluploadL10n.image_dimensions_exceeded,GENERIC_ERROR:pluploadL10n.upload_failed,IO_ERROR:pluploadL10n.io_error,HTTP_ERROR:pluploadL10n.http_error,SECURITY_ERROR:pluploadL10n.security_error,FILE_SIZE_ERROR:function(d){return pluploadL10n.file_exceeds_size_limit.replace("%s",d.name)}};b.extend(c.prototype,{param:function(d,e){if(arguments.length===1&&typeof d==="string"){return this.uploader.settings.multipart_params[d]}if(arguments.length>1){this.uploader.settings.multipart_params[d]=e}else{b.extend(this.uploader.settings.multipart_params,d)}},init:function(){},error:function(){},success:function(){},added:function(){},progress:function(){},complete:function(){},refresh:function(){var f,e,d,g;if(this.browser){f=this.browser[0];while(f){if(f===document.body){e=true;break}f=f.parentNode}if(!e){g="wp-uploader-browser-"+this.uploader.id;d=b("#"+g);if(!d.length){d=b('<div class="wp-uploader-browser" />').css({position:"fixed",top:"-1000px",left:"-1000px",height:0,width:0}).attr("id","wp-uploader-browser-"+this.uploader.id).appendTo("body")}d.append(this.browser)}}this.uploader.refresh()}});c.queue=new wp.media.model.Attachments([],{query:false});c.errors=new Backbone.Collection();a.Uploader=c})(wp,jQuery);