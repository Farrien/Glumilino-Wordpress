function fileQueued(e){jQuery(".media-blank").remove();var d=jQuery("#media-items").children(),f=post_id||0;1==d.length&&d.removeClass("open").find(".slidetoggle").slideUp(200),jQuery('<div class="media-item">').attr("id","media-item-"+e.id).addClass("child-of-"+f).append('<div class="progress"><div class="percent">0%</div><div class="bar"></div></div>',jQuery('<div class="filename original">').text(" "+e.name)).appendTo(jQuery("#media-items")),jQuery("#insert-gallery").prop("disabled",!0)}function uploadStart(){try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").unbind("click",topWin.tb_remove)}catch(b){}return !0}function uploadProgress(e,d){var f=jQuery("#media-item-"+d.id);jQuery(".bar",f).width(200*d.loaded/d.size),jQuery(".percent",f).html(d.percent+"%")}function fileUploading(f,e){var h=104857600,g=parseInt(f.settings.max_file_size,10);g>h&&e.size>h&&setTimeout(function(){e.status<3&&0===e.loaded&&(wpFileError(e,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")),f.stop(),f.removeFile(e),f.start())},10000)}function updateMediaForm(){var b=jQuery("#media-items").children();1==b.length?(b.addClass("open").find(".slidetoggle").show(),jQuery(".insert-gallery").hide()):b.length>1&&(b.removeClass("open"),jQuery(".insert-gallery").show()),b.not(".media-blank").length>0?jQuery(".savebutton").show():jQuery(".savebutton").hide()}function uploadSuccess(e,d){var f=jQuery("#media-item-"+e.id);return d=d.replace(/^<pre>(\d+)<\/pre>$/,"$1"),d.match(/media-upload-error|error-div/)?void f.html(d):(jQuery(".percent",f).html(pluploadL10n.crunching),prepareMediaItem(e,d),updateMediaForm(),void (post_id&&f.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(1*jQuery("#attachments-count").text()+1)))}function setResize(b){b?window.resize_width&&window.resize_height?uploader.settings.resize={enabled:!0,width:window.resize_width,height:window.resize_height,quality:100}:uploader.settings.multipart_params.image_resize=!0:delete uploader.settings.multipart_params.image_resize}function prepareMediaItem(g,f){var j="undefined"==typeof shortform?1:2,i=jQuery("#media-item-"+g.id);2==j&&shortform>2&&(j=shortform);try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").click(topWin.tb_remove)}catch(h){}isNaN(f)||!f?(i.append(f),prepareMediaItemInit(g)):i.load("async-upload.php",{attachment_id:f,fetch:j},function(){prepareMediaItemInit(g),updateMediaForm()})}function prepareMediaItemInit(d){var c=jQuery("#media-item-"+d.id);jQuery(".thumbnail",c).clone().attr("class","pinkynail toggle").prependTo(c),jQuery(".filename.original",c).replaceWith(jQuery(".filename.new",c)),jQuery("a.delete",c).click(function(){return jQuery.ajax({url:ajaxurl,type:"post",success:deleteSuccess,error:deleteError,id:d.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"trash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")}}),!1}),jQuery("a.undo",c).click(function(){return jQuery.ajax({url:ajaxurl,type:"post",id:d.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"untrash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")},success:function(){var a,e=jQuery("#media-item-"+d.id);(a=jQuery("#type-of-"+d.id).val())&&jQuery("#"+a+"-counter").text(jQuery("#"+a+"-counter").text()-0+1),post_id&&e.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-0+1),jQuery(".filename .trashnotice",e).remove(),jQuery(".filename .title",e).css("font-weight","normal"),jQuery("a.undo",e).addClass("hidden"),jQuery(".menu_order_input",e).show(),e.css({backgroundColor:"#ceb"}).animate({backgroundColor:"#fff"},{queue:!1,duration:500,complete:function(){jQuery(this).css({backgroundColor:""})}}).removeClass("undo")}}),!1}),jQuery("#media-item-"+d.id+".startopen").removeClass("startopen").addClass("open").find("slidetoggle").fadeIn()}function wpQueueError(b){jQuery("#media-upload-error").show().html('<div class="error"><p>'+b+"</p></div>")}function wpFileError(d,c){itemAjaxError(d.id,c)}function itemAjaxError(g,f){var j=jQuery("#media-item-"+g),i=j.find(".filename").text(),h=j.data("last-err");h!=g&&j.html('<div class="error-div"><a class="dismiss" href="#">'+pluploadL10n.dismiss+"</a><strong>"+pluploadL10n.error_uploading.replace("%s",jQuery.trim(i))+"</strong> "+f+"</div>").data("last-err",g)}function deleteSuccess(f){var e,h,g;return"-1"==f?itemAjaxError(this.id,"You do not have permission. Has your session expired?"):"0"==f?itemAjaxError(this.id,"Could not be deleted. Has it been deleted already?"):(h=this.id,g=jQuery("#media-item-"+h),(e=jQuery("#type-of-"+h).val())&&jQuery("#"+e+"-counter").text(jQuery("#"+e+"-counter").text()-1),post_id&&g.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-1),1==jQuery("form.type-form #media-items").children().length&&jQuery(".hidden","#media-items").length>0&&(jQuery(".toggle").toggle(),jQuery(".slidetoggle").slideUp(200).siblings().removeClass("hidden")),jQuery(".toggle",g).toggle(),jQuery(".slidetoggle",g).slideUp(200).siblings().removeClass("hidden"),g.css({backgroundColor:"#faa"}).animate({backgroundColor:"#f4f4f4"},{queue:!1,duration:500}).addClass("undo"),jQuery(".filename:empty",g).remove(),jQuery(".filename .title",g).css("font-weight","bold"),jQuery(".filename",g).append('<span class="trashnotice"> '+pluploadL10n.deleted+" </span>").siblings("a.toggle").hide(),jQuery(".filename",g).append(jQuery("a.undo",g).removeClass("hidden")),void jQuery(".menu_order_input",g).hide())}function deleteError(){}function uploadComplete(){jQuery("#insert-gallery").prop("disabled",!1)}function switchUploader(b){b?(deleteUserSetting("uploader"),jQuery(".media-upload-form").removeClass("html-uploader"),"object"==typeof uploader&&uploader.refresh()):(setUserSetting("uploader","1"),jQuery(".media-upload-form").addClass("html-uploader"))}function uploadError(h,g,l,k){var j,i=104857600;switch(g){case plupload.FAILED:wpFileError(h,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:wpFileExtensionError(k,h,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(k,h);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(h,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(h,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(h,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:j=parseInt(k.settings.filters.max_file_size,10),j>i&&h.size>i?wpFileError(h,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(h,pluploadL10n.default_error)}}function uploadSizeError(f,e){var h,g;h=pluploadL10n.file_exceeds_size_limit.replace("%s",e.name),g=jQuery("<div />").attr({id:"media-item-"+e.id,"class":"media-item error"}).append(jQuery("<p />").text(h)),jQuery("#media-items").append(g),f.removeFile(e)}function wpFileExtensionError(e,d,f){jQuery("#media-items").append('<div id="media-item-'+d.id+'" class="media-item error"><p>'+f+"</p></div>"),e.removeFile(d)}var topWin=window.dialogArguments||opener||parent||top,uploader,uploader_init;jQuery(document).ready(function(b){b(".media-upload-form").bind("click.uploader",function(a){var h,g,f=b(a.target);f.is('input[type="radio"]')?(h=f.closest("tr"),h.hasClass("align")?setUserSetting("align",f.val()):h.hasClass("image-size")&&setUserSetting("imgsize",f.val())):f.is("button.button")?(g=a.target.className||"",g=g.match(/url([^ '"]+)/),g&&g[1]&&(setUserSetting("urlbutton",g[1]),f.siblings(".urlfield").val(f.data("link-url")))):f.is("a.dismiss")?f.parents(".media-item").fadeOut(200,function(){b(this).remove()}):f.is(".upload-flash-bypass a")||f.is("a.uploader-html")?(b("#media-items, p.submit, span.big-file-warning").css("display","none"),switchUploader(0),a.preventDefault()):f.is(".upload-html-bypass a")?(b("#media-items, p.submit, span.big-file-warning").css("display",""),switchUploader(1),a.preventDefault()):f.is("a.describe-toggle-on")?(f.parent().addClass("open"),f.siblings(".slidetoggle").fadeIn(250,function(){var i,n,m=b(window).scrollTop(),l=b(window).height(),k=b(this).offset().top,j=b(this).height();l&&k&&j&&(i=k+j,n=m+l,i>n&&(i-n<k-m?window.scrollBy(0,i-n+10):window.scrollBy(0,k-m-40)))}),a.preventDefault()):f.is("a.describe-toggle-off")&&(f.siblings(".slidetoggle").fadeOut(250,function(){f.parent().removeClass("open")}),a.preventDefault())}),uploader_init=function(){var a=navigator.userAgent.indexOf("Trident/")!=-1||navigator.userAgent.indexOf("MSIE ")!=-1;a||"flash"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty("send_binary_string")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),uploader=new plupload.Uploader(wpUploaderInit),b("#image_resize").bind("change",function(){var c=b(this).prop("checked");setResize(c),c?setUserSetting("upload_resize","1"):deleteUserSetting("upload_resize")}),uploader.bind("Init",function(d){var e=b("#plupload-upload-ui");setResize(getUserSetting("upload_resize",!1)),d.features.dragdrop&&!b(document.body).hasClass("mobile")?(e.addClass("drag-drop"),b("#drag-drop-area").on("dragover.wp-uploader",function(){e.addClass("drag-over")}).on("dragleave.wp-uploader, drop.wp-uploader",function(){e.removeClass("drag-over")})):(e.removeClass("drag-drop"),b("#drag-drop-area").off(".wp-uploader")),"html4"===d.runtime&&b(".upload-flash-bypass").hide()}),uploader.bind("postinit",function(c){c.refresh()}),uploader.init(),uploader.bind("FilesAdded",function(d,e){b("#media-upload-error").empty(),uploadStart(),plupload.each(e,function(c){fileQueued(c)}),d.refresh(),d.start()}),uploader.bind("UploadFile",function(d,c){fileUploading(d,c)}),uploader.bind("UploadProgress",function(d,c){uploadProgress(d,c)}),uploader.bind("Error",function(d,c){uploadError(c.file,c.code,c.message,d),d.refresh()}),uploader.bind("FileUploaded",function(e,d,f){uploadSuccess(d,f.response)}),uploader.bind("UploadComplete",function(){uploadComplete()})},"object"==typeof wpUploaderInit&&uploader_init()});