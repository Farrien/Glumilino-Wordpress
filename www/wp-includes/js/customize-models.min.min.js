(function(f,e){var d=e.customize;d.HeaderTool={};d.HeaderTool.ImageModel=Backbone.Model.extend({defaults:function(){return{header:{attachment_id:0,url:"",timestamp:_.now(),thumbnail_url:""},choice:"",selected:false,random:false}},initialize:function(){this.on("hide",this.hide,this)},hide:function(){this.set("choice","");d("header_image").set("remove-header");d("header_image_data").set("remove-header")},destroy:function(){var b=this.get("header"),a=d.HeaderTool.currentHeader.get("header").attachment_id;if(a&&b.attachment_id===a){d.HeaderTool.currentHeader.trigger("hide")}e.ajax.post("custom-header-remove",{nonce:_wpCustomizeHeader.nonces.remove,wp_customize:"on",theme:d.settings.theme.stylesheet,attachment_id:b.attachment_id});this.trigger("destroy",this,this.collection)},save:function(){if(this.get("random")){d("header_image").set(this.get("header").random);d("header_image_data").set(this.get("header").random)}else{if(this.get("header").defaultName){d("header_image").set(this.get("header").url);d("header_image_data").set(this.get("header").defaultName)}else{d("header_image").set(this.get("header").url);d("header_image_data").set(this.get("header"))}}d.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var a=this.get("header");if(a.attachment_id===undefined){return}e.ajax.post("custom-header-add",{nonce:_wpCustomizeHeader.nonces.add,wp_customize:"on",theme:d.settings.theme.stylesheet,attachment_id:a.attachment_id})},shouldBeCropped:function(){if(this.get("themeFlexWidth")===true&&this.get("themeFlexHeight")===true){return false}if(this.get("themeFlexWidth")===true&&this.get("themeHeight")===this.get("imageHeight")){return false}if(this.get("themeFlexHeight")===true&&this.get("themeWidth")===this.get("imageWidth")){return false}if(this.get("themeWidth")===this.get("imageWidth")&&this.get("themeHeight")===this.get("imageHeight")){return false}if(this.get("imageWidth")<=this.get("themeWidth")){return false}return true}});d.HeaderTool.ChoiceList=Backbone.Collection.extend({model:d.HeaderTool.ImageModel,comparator:function(a){return -a.get("header").timestamp},initialize:function(){var a=d.HeaderTool.currentHeader.get("choice").replace(/^https?:\/\//,""),b=this.isRandomChoice(d.get().header_image);if(!this.type){this.type="uploaded"}if(typeof this.data==="undefined"){this.data=_wpCustomizeHeader.uploads}if(b){a=d.get().header_image}this.on("control:setImage",this.setImage,this);this.on("control:removeImage",this.removeImage,this);this.on("add",this.maybeAddRandomChoice,this);_.each(this.data,function(c,h){if(!c.attachment_id){c.defaultName=h}if(typeof c.timestamp==="undefined"){c.timestamp=0}this.add({header:c,choice:c.url.split("/").pop(),selected:a===c.url.replace(/^https?:\/\//,"")},{silent:true})},this);if(this.size()>0){this.addRandomChoice(a)}},maybeAddRandomChoice:function(){if(this.size()===1){this.addRandomChoice()}},addRandomChoice:function(b){var a=RegExp(this.type).test(b),c="random-"+this.type+"-image";this.add({header:{timestamp:0,random:c,width:245,height:41},choice:c,random:true,selected:a})},isRandomChoice:function(a){return(/^random-(uploaded|default)-image$/).test(a)},shouldHideTitle:function(){return this.size()<2},setImage:function(a){this.each(function(b){b.set("selected",false)});if(a){a.set("selected",true)}},removeImage:function(){this.each(function(a){a.set("selected",false)})}});d.HeaderTool.DefaultsList=d.HeaderTool.ChoiceList.extend({initialize:function(){this.type="default";this.data=_wpCustomizeHeader.defaults;d.HeaderTool.ChoiceList.prototype.initialize.apply(this)}})})(jQuery,window.wp);