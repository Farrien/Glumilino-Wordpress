(function(c,a){var b=a.customize;b.HeaderTool={};b.HeaderTool.ImageModel=Backbone.Model.extend({defaults:function(){return{header:{attachment_id:0,url:"",timestamp:_.now(),thumbnail_url:""},choice:"",selected:false,random:false}},initialize:function(){this.on("hide",this.hide,this)},hide:function(){this.set("choice","");b("header_image").set("remove-header");b("header_image_data").set("remove-header")},destroy:function(){var d=this.get("header"),e=b.HeaderTool.currentHeader.get("header").attachment_id;if(e&&d.attachment_id===e){b.HeaderTool.currentHeader.trigger("hide")}a.ajax.post("custom-header-remove",{nonce:_wpCustomizeHeader.nonces.remove,wp_customize:"on",theme:b.settings.theme.stylesheet,attachment_id:d.attachment_id});this.trigger("destroy",this,this.collection)},save:function(){if(this.get("random")){b("header_image").set(this.get("header").random);b("header_image_data").set(this.get("header").random)}else{if(this.get("header").defaultName){b("header_image").set(this.get("header").url);b("header_image_data").set(this.get("header").defaultName)}else{b("header_image").set(this.get("header").url);b("header_image_data").set(this.get("header"))}}b.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var d=this.get("header");if(d.attachment_id===undefined){return}a.ajax.post("custom-header-add",{nonce:_wpCustomizeHeader.nonces.add,wp_customize:"on",theme:b.settings.theme.stylesheet,attachment_id:d.attachment_id})},shouldBeCropped:function(){if(this.get("themeFlexWidth")===true&&this.get("themeFlexHeight")===true){return false}if(this.get("themeFlexWidth")===true&&this.get("themeHeight")===this.get("imageHeight")){return false}if(this.get("themeFlexHeight")===true&&this.get("themeWidth")===this.get("imageWidth")){return false}if(this.get("themeWidth")===this.get("imageWidth")&&this.get("themeHeight")===this.get("imageHeight")){return false}if(this.get("imageWidth")<=this.get("themeWidth")){return false}return true}});b.HeaderTool.ChoiceList=Backbone.Collection.extend({model:b.HeaderTool.ImageModel,comparator:function(d){return -d.get("header").timestamp},initialize:function(){var e=b.HeaderTool.currentHeader.get("choice").replace(/^https?:\/\//,""),d=this.isRandomChoice(b.get().header_image);if(!this.type){this.type="uploaded"}if(typeof this.data==="undefined"){this.data=_wpCustomizeHeader.uploads}if(d){e=b.get().header_image}this.on("control:setImage",this.setImage,this);this.on("control:removeImage",this.removeImage,this);this.on("add",this.maybeAddRandomChoice,this);_.each(this.data,function(g,f){if(!g.attachment_id){g.defaultName=f}if(typeof g.timestamp==="undefined"){g.timestamp=0}this.add({header:g,choice:g.url.split("/").pop(),selected:e===g.url.replace(/^https?:\/\//,"")},{silent:true})},this);if(this.size()>0){this.addRandomChoice(e)}},maybeAddRandomChoice:function(){if(this.size()===1){this.addRandomChoice()}},addRandomChoice:function(e){var f=RegExp(this.type).test(e),d="random-"+this.type+"-image";this.add({header:{timestamp:0,random:d,width:245,height:41},choice:d,random:true,selected:f})},isRandomChoice:function(d){return(/^random-(uploaded|default)-image$/).test(d)},shouldHideTitle:function(){return this.size()<2},setImage:function(d){this.each(function(e){e.set("selected",false)});if(d){d.set("selected",true)}},removeImage:function(){this.each(function(d){d.set("selected",false)})}});b.HeaderTool.DefaultsList=b.HeaderTool.ChoiceList.extend({initialize:function(){this.type="default";this.data=_wpCustomizeHeader.defaults;b.HeaderTool.ChoiceList.prototype.initialize.apply(this)}})})(jQuery,window.wp);