!function(d){function b(){return d("<div/>")}var f=Math.abs,a=Math.max,c=Math.min,g=Math.round;d.imgAreaSelect=function(aj,ax){function aw(h){return h+a8.left-s.left}function aA(h){return h+a8.top-s.top}function ai(h){return h-a8.left+s.left}function ao(h){return h-a8.top+s.top}function ar(h){return a(h.pageX||0,an(h).x)-s.left}function av(h){return a(h.pageY||0,an(h).y)-s.top}function an(j){var h=j.originalEvent||{};return h.touches&&h.touches.length?{x:h.touches[0].pageX,y:h.touches[0].pageY}:{x:0,y:0}}function am(j){var h=j||a6,k=j||aP;return{x1:g(i.x1*h),y1:g(i.y1*k),x2:g(i.x2*h),y2:g(i.y2*k),width:g(i.x2*h)-g(i.x1*h),height:g(i.y2*k)-g(i.y1*k)}}function ad(m,j,p,h,k){var l=k||a6,q=k||aP;i={x1:g(m/l||0),y1:g(j/q||0),x2:g(p/l||0),y2:g(h/q||0)},i.width=i.x2-i.x1,i.height=i.y2-i.y1}function au(){aL&&bf.width()&&(a8={left:g(bf.offset().left),top:g(bf.offset().top)},aO=bf.innerWidth(),aH=bf.innerHeight(),a8.top+=bf.outerHeight()-aH>>1,a8.left+=bf.outerWidth()-aO>>1,a0=g(ax.minWidth/a6)||0,aX=g(ax.minHeight/aP)||0,aK=g(c(ax.maxWidth/a6||1<<24,aO)),aJ=g(c(ax.maxHeight/aP||1<<24,aH)),"1.3.2"!=d().jquery||"fixed"!=bh||bi.getBoundingClientRect||(a8.top+=a(document.body.scrollTop,bi.scrollTop),a8.left+=a(document.body.scrollLeft,bi.scrollLeft)),s=/absolute|relative/.test(aF.css("position"))?{left:g(aF.offset().left)-aF.scrollLeft(),top:g(aF.offset().top)-aF.scrollTop()}:"fixed"==bh?{left:d(document).scrollLeft(),top:d(document).scrollTop()}:{left:0,top:0},aq=aw(0),a3=aA(0),(i.x2>aO||i.y2>aH)&&a4())}function ah(h){if(aB){switch(aC.css({left:aw(i.x1),top:aA(i.y1)}).add(bd).width(n=i.width).height(a5=i.height),bd.add(a9).add(bb).css({left:0,top:0}),a9.width(a(n-a9.outerWidth()+a9.innerWidth(),0)).height(a(a5-a9.outerHeight()+a9.innerHeight(),0)),d(o[0]).css({left:aq,top:a3,width:i.x1,height:aH}),d(o[1]).css({left:aq+i.x1,top:a3,width:n,height:i.y1}),d(o[2]).css({left:aq+i.x2,top:a3,width:aO-i.x2,height:aH}),d(o[3]).css({left:aq+i.x1,top:a3+i.y2,width:n,height:aH-i.y2}),n-=bb.outerWidth(),a5-=bb.outerHeight(),bb.length){case 8:d(bb[4]).css({left:n>>1}),d(bb[5]).css({left:n,top:a5>>1}),d(bb[6]).css({left:n>>1,top:a5}),d(bb[7]).css({top:a5>>1});case 4:bb.slice(1,3).css({left:n}),bb.slice(2,4).css({top:a5})}h!==!1&&(d.imgAreaSelect.onKeyPress!=e&&d(document).unbind(d.imgAreaSelect.keyPress,d.imgAreaSelect.onKeyPress),ax.keys&&d(document)[d.imgAreaSelect.keyPress](d.imgAreaSelect.onKeyPress=e)),aD&&a9.outerWidth()-a9.innerWidth()==2&&(a9.css("margin",0),setTimeout(function(){a9.css("margin","auto")},0))}}function ay(h){au(),ah(h),bj=aw(i.x1),aM=aA(i.y1),ag=aw(i.x2),ab=aA(i.y2)}function ae(j,h){ax.fadeSpeed?j.fadeOut(ax.fadeSpeed,h):j.hide()}function af(j){var h=ai(ar(j))-i.x1,k=ao(av(j))-i.y1;ak||(au(),ak=!0,aC.one("mouseout",function(){ak=!1})),a1="",ax.resizable&&(k<=ax.resizeMargin?a1="n":k>=i.height-ax.resizeMargin&&(a1="s"),h<=ax.resizeMargin?a1+="w":h>=i.width-ax.resizeMargin&&(a1+="e")),aC.css("cursor",a1?a1+"-resize":ax.movable?"move":""),aV&&aV.toggle()}function aN(){d("body").css("cursor",""),(ax.autoHide||i.width*i.height==0)&&ae(aC.add(o),function(){d(this).hide()}),d(document).off("mousemove touchmove",a7),aC.on("mousemove touchmove",af),ax.onSelectEnd(aj,am())}function ac(h){return"mousedown"==h.type&&1!=h.which?!1:(af(h),au(),a1?(d("body").css("cursor",a1+"-resize"),bj=aw(i[/w/.test(a1)?"x2":"x1"]),aM=aA(i[/n/.test(a1)?"y2":"y1"]),d(document).on("mousemove touchmove",a7).one("mouseup touchend",aN),aC.off("mousemove touchmove",af)):ax.movable?(bc=aq+i.x1-ar(h),al=a3+i.y1-av(h),aC.off("mousemove touchmove",af),d(document).on("mousemove touchmove",aY).one("mouseup touchend",function(){ax.onSelectEnd(aj,am()),d(document).off("mousemove touchmove",aY),aC.on("mousemove touchmove",af)})):bf.mousedown(h),!1)}function ap(h){aE&&(h?(ag=a(aq,c(aq+aO,bj+f(ab-aM)*aE*(ag>bj||-1))),ab=g(a(a3,c(a3+aH,aM+f(ag-bj)/aE*(ab>aM||-1)))),ag=g(ag)):(ab=a(a3,c(a3+aH,aM+f(ag-bj)/aE*(ab>aM||-1))),ag=g(a(aq,c(aq+aO,bj+f(ab-aM)*aE*(ag>bj||-1)))),ab=g(ab)))}function a4(){bj=c(bj,aq+aO),aM=c(aM,a3+aH),f(ag-bj)<a0&&(ag=bj-a0*(bj>ag||-1),aq>ag?bj=aq+a0:ag>aq+aO&&(bj=aq+aO-a0)),f(ab-aM)<aX&&(ab=aM-aX*(aM>ab||-1),a3>ab?aM=a3+aX:ab>a3+aH&&(aM=a3+aH-aX)),ag=a(aq,c(ag,aq+aO)),ab=a(a3,c(ab,a3+aH)),ap(f(ag-bj)<f(ab-aM)*aE),f(ag-bj)>aK&&(ag=bj-aK*(bj>ag||-1),ap()),f(ab-aM)>aJ&&(ab=aM-aJ*(aM>ab||-1),ap(!0)),i={x1:ai(c(bj,ag)),x2:ai(a(bj,ag)),y1:ao(c(aM,ab)),y2:ao(a(aM,ab)),width:f(ag-bj),height:f(ab-aM)},ah(),ax.onSelectChange(aj,am())}function a7(h){return ag=/w|e|^$/.test(a1)||aE?ar(h):aw(i.x2),ab=/n|s|^$/.test(a1)||aE?av(h):aA(i.y2),a4(),!1}function aI(h,j){ag=(bj=h)+i.width,ab=(aM=j)+i.height,d.extend(i,{x1:ai(bj),y1:ao(aM),x2:ai(ag),y2:ao(ab)}),ah(),ax.onSelectChange(aj,am())}function aY(h){return bj=a(aq,c(bc+ar(h),aq+aO-i.width)),aM=a(a3,c(al+av(h),a3+aH-i.height)),aI(bj,aM),h.preventDefault(),!1}function aW(){d(document).off("mousemove touchmove",aW),au(),ag=bj,ab=aM,a4(),a1="",o.is(":visible")||aC.add(o).hide().fadeIn(ax.fadeSpeed||0),aB=!0,d(document).off("mouseup touchend",aQ).on("mousemove touchmove",a7).one("mouseup touchend",aN),aC.off("mousemove touchmove",af),ax.onSelectStart(aj,am())}function aQ(){d(document).off("mousemove touchmove",aW).off("mouseup touchend",aQ),ae(aC.add(o)),ad(ai(bj),ao(aM),ai(bj),ao(aM)),this instanceof d.imgAreaSelect||(ax.onSelectChange(aj,am()),ax.onSelectEnd(aj,am()))}function aT(h){return 1!=h.which||o.is(":animated")?!1:(au(),bc=bj=ar(h),al=aM=av(h),d(document).on({"mousemove touchmove":aW,"mouseup touchend":aQ}),!1)}function aZ(){ay(!1)}function aU(){aL=!0,aR(ax=d.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},ax)),aC.add(o).css({visibility:""}),ax.show&&(aB=!0,au(),ah(),aC.add(o).hide().fadeIn(ax.fadeSpeed||0)),setTimeout(function(){ax.onInit(aj,am())},0)}function a2(j,h){for(var k in h){void 0!==ax[k]&&j.css(h[k],ax[k])}}function aR(h){if(h.parent&&(aF=d(h.parent)).append(aC.add(o)),d.extend(ax,h),au(),null!=h.handles){for(bb.remove(),bb=d([]),bg=h.handles?"corners"==h.handles?4:8:0;bg--;){bb=bb.add(b())}bb.addClass(ax.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:az+1||1}),!parseInt(bb.css("width"))>=0&&bb.width(5).height(5),(aa=ax.borderWidth)&&bb.css({borderWidth:aa,borderStyle:"solid"}),a2(bb,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(a6=ax.imageWidth/aO||1,aP=ax.imageHeight/aH||1,null!=h.x1&&(ad(h.x1,h.y1,h.x2,h.y2),h.show=!h.hide),h.keys&&(ax.keys=d.extend({shift:1,ctrl:"resize"},h.keys)),o.addClass(ax.classPrefix+"-outer"),bd.addClass(ax.classPrefix+"-selection"),bg=0;bg++<4;){d(a9[bg-1]).addClass(ax.classPrefix+"-border"+bg)}a2(bd,{selectionColor:"background-color",selectionOpacity:"opacity"}),a2(a9,{borderOpacity:"opacity",borderWidth:"border-width"}),a2(o,{outerColor:"background-color",outerOpacity:"opacity"}),(aa=ax.borderColor1)&&d(a9[0]).css({borderStyle:"solid",borderColor:aa}),(aa=ax.borderColor2)&&d(a9[1]).css({borderStyle:"dashed",borderColor:aa}),aC.append(bd.add(a9).add(aV)).append(bb),aD&&((aa=(o.css("filter")||"").match(/opacity=(\d+)/))&&o.css("opacity",aa[1]/100),(aa=(a9.css("filter")||"").match(/opacity=(\d+)/))&&a9.css("opacity",aa[1]/100)),h.hide?ae(aC.add(o)):h.show&&aL&&(aB=!0,aC.add(o).fadeIn(ax.fadeSpeed||0),ay()),aE=(aG=(ax.aspectRatio||"").split(/:/))[0]/aG[1],bf.add(o).unbind("mousedown",aT),ax.disable||ax.enable===!1?(aC.off({"mousemove touchmove":af,"mousedown touchstart":ac}),d(window).off("resize",aZ)):((ax.enable||ax.disable===!1)&&((ax.resizable||ax.movable)&&aC.on({"mousemove touchmove":af,"mousedown touchstart":ac}),d(window).resize(aZ)),ax.persistent||bf.add(o).on("mousedown touchstart",aT)),ax.enable=ax.disable=void 0}var aL,aV,aq,a3,aO,aH,aF,bc,al,a6,aP,a1,a0,aX,aK,aJ,aE,aB,bj,aM,ag,ab,ba,aG,bg,aa,n,a5,ak,bf=d(aj),aC=b(),bd=b(),a9=b().add(b()).add(b()).add(b()),o=b().add(b()).add(b()).add(b()),bb=d([]),a8={left:0,top:0},s={left:0,top:0},az=0,bh="absolute",i={x1:0,y1:0,x2:0,y2:0,width:0,height:0},bi=document.documentElement,aS=navigator.userAgent,e=function(k){var h,l,m=ax.keys,j=k.keyCode;if(h=isNaN(m.alt)||!k.altKey&&!k.originalEvent.altKey?!isNaN(m.ctrl)&&k.ctrlKey?m.ctrl:!isNaN(m.shift)&&k.shiftKey?m.shift:isNaN(m.arrows)?10:m.arrows:m.alt,"resize"==m.arrows||"resize"==m.shift&&k.shiftKey||"resize"==m.ctrl&&k.ctrlKey||"resize"==m.alt&&(k.altKey||k.originalEvent.altKey)){switch(j){case 37:h=-h;case 39:l=a(bj,ag),bj=c(bj,ag),ag=a(l+h,bj),ap();break;case 38:h=-h;case 40:l=a(aM,ab),aM=c(aM,ab),ab=a(l+h,aM),ap(!0);break;default:return}a4()}else{switch(bj=c(bj,ag),aM=c(aM,ab),j){case 37:aI(a(bj-h,aq),aM);break;case 38:aI(bj,a(aM-h,a3));break;case 39:aI(bj+c(h,aO-ai(ag)),aM);break;case 40:aI(bj,aM+c(h,aH-ao(ab)));break;default:return}}return !1};this.remove=function(){aR({disable:!0}),aC.add(o).remove()},this.getOptions=function(){return ax},this.setOptions=aR,this.getSelection=am,this.setSelection=ad,this.cancelSelection=aQ,this.update=ay;var aD=(/msie ([\w.]+)/i.exec(aS)||[])[1],be=/opera/i.test(aS),t=/webkit/i.test(aS)&&!/chrome/i.test(aS);for(ba=bf;ba.length;){az=a(az,isNaN(ba.css("z-index"))?az:ba.css("z-index")),"fixed"==ba.css("position")&&(bh="fixed"),ba=ba.parent(":not(body)")}az=ax.zIndex||az,aD&&bf.attr("unselectable","on"),d.imgAreaSelect.keyPress=aD||t?"keydown":"keypress",be&&(aV=b().css({width:"100%",height:"100%",position:"absolute",zIndex:az+2||2})),aC.add(o).css({visibility:"hidden",position:bh,overflow:"hidden",zIndex:az||"0"}),aC.css({zIndex:az+2||2}),bd.add(a9).css({position:"absolute",fontSize:0}),aj.complete||"complete"==aj.readyState||!bf.is("img")?aU():bf.one("load",aU),!aL&&aD&&aD>=7&&(aj.src=aj.src)},d.fn.imgAreaSelect=function(e){return e=e||{},this.each(function(){d(this).data("imgAreaSelect")?e.remove?(d(this).data("imgAreaSelect").remove(),d(this).removeData("imgAreaSelect")):d(this).data("imgAreaSelect").setOptions(e):e.remove||(void 0===e.enable&&void 0===e.disable&&(e.enable=!0),d(this).data("imgAreaSelect",new d.imgAreaSelect(this,e)))}),e.instance?d(this).data("imgAreaSelect"):this}}(jQuery);