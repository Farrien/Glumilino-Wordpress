(function(b,a,d){var c=function(){var z=b(document),x={suspend:false,suspendEnabled:true,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:false,connectionError:false,errorcount:0,hasConnected:false,hasFocus:true,userActivity:0,userActivityEvents:false,checkFocusTimer:0,beatTimer:0};function f(){var D,E,B,C;if(typeof a.pagenow==="string"){x.screenId=a.pagenow}if(typeof a.ajaxurl==="string"){x.url=a.ajaxurl}if(typeof a.heartbeatSettings==="object"){D=a.heartbeatSettings;if(!x.url&&D.ajaxurl){x.url=D.ajaxurl}if(D.interval){x.mainInterval=D.interval;if(x.mainInterval<15){x.mainInterval=15}else{if(x.mainInterval>120){x.mainInterval=120}}}if(D.minimalInterval){D.minimalInterval=parseInt(D.minimalInterval,10);x.minimalInterval=D.minimalInterval>0&&D.minimalInterval<=600?D.minimalInterval*1000:0}if(x.minimalInterval&&x.mainInterval<x.minimalInterval){x.mainInterval=x.minimalInterval}if(!x.screenId){x.screenId=D.screenId||"front"}if(D.suspension==="disable"){x.suspendEnabled=false}}x.mainInterval=x.mainInterval*1000;x.originalInterval=x.mainInterval;if(typeof document.hidden!=="undefined"){E="hidden";C="visibilitychange";B="visibilityState"}else{if(typeof document.msHidden!=="undefined"){E="msHidden";C="msvisibilitychange";B="msVisibilityState"}else{if(typeof document.webkitHidden!=="undefined"){E="webkitHidden";C="webkitvisibilitychange";B="webkitVisibilityState"}}}if(E){if(document[E]){x.hasFocus=false}z.on(C+".wp-heartbeat",function(){if(document[B]==="hidden"){s();a.clearInterval(x.checkFocusTimer)}else{r();if(document.hasFocus){x.checkFocusTimer=a.setInterval(e,10000)}}})}if(document.hasFocus){x.checkFocusTimer=a.setInterval(e,10000)}b(a).on("unload.wp-heartbeat",function(){x.suspend=true;if(x.xhr&&x.xhr.readyState!==4){x.xhr.abort()}});a.setInterval(q,30000);z.ready(function(){x.lastTick=m();w()})}function m(){return(new Date()).getTime()}function v(E){var B,D=E.src;if(D&&/^https?:\/\//.test(D)){B=a.location.origin?a.location.origin:a.location.protocol+"//"+a.location.host;if(D.indexOf(B)!==0){return false}}try{if(E.contentWindow.document){return true}}catch(C){}return false}function e(){if(x.hasFocus&&!document.hasFocus()){s()}else{if(!x.hasFocus&&document.hasFocus()){r()}}}function n(D,B){var C;if(D){switch(D){case"abort":break;case"timeout":C=true;break;case"error":if(503===B&&x.hasConnected){C=true;break}case"parsererror":case"empty":case"unknown":x.errorcount++;if(x.errorcount>2&&x.hasConnected){C=true}break}if(C&&!p()){x.connectionError=true;z.trigger("heartbeat-connection-lost",[D,B])}}}function k(){x.hasConnected=true;if(p()){x.errorcount=0;x.connectionError=false;z.trigger("heartbeat-connection-restored")}}function g(){var B,C;if(x.connecting||x.suspend){return}x.lastTick=m();C=b.extend({},x.queue);x.queue={};z.trigger("heartbeat-send",[C]);B={data:C,interval:x.tempInterval?x.tempInterval/1000:x.mainInterval/1000,_nonce:typeof a.heartbeatSettings==="object"?a.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:x.screenId,has_focus:x.hasFocus};x.connecting=true;x.xhr=b.ajax({url:x.url,type:"post",timeout:30000,data:B,dataType:"json"}).always(function(){x.connecting=false;w()}).done(function(D,G,F){var E;if(!D){n("empty");return}k();if(D.nonces_expired){z.trigger("heartbeat-nonces-expired")}if(D.heartbeat_interval){E=D.heartbeat_interval;delete D.heartbeat_interval}z.trigger("heartbeat-tick",[D,G,F]);if(E){y(E)}}).fail(function(E,F,D){n(F||"unknown",E.status);z.trigger("heartbeat-error",[E,F,D])})}function w(){var C=m()-x.lastTick,B=x.mainInterval;if(x.suspend){return}if(!x.hasFocus){B=120000}else{if(x.countdown>0&&x.tempInterval){B=x.tempInterval;x.countdown--;if(x.countdown<1){x.tempInterval=0}}}if(x.minimalInterval&&B<x.minimalInterval){B=x.minimalInterval}a.clearTimeout(x.beatTimer);if(C<B){x.beatTimer=a.setTimeout(function(){g()},B-C)}else{g()}}function s(){x.hasFocus=false}function r(){x.userActivity=m();x.suspend=false;if(!x.hasFocus){x.hasFocus=true;w()}}function A(){x.userActivityEvents=false;z.off(".wp-heartbeat-active");b("iframe").each(function(B,C){if(v(C)){b(C.contentWindow).off(".wp-heartbeat-active")}});r()}function q(){var B=x.userActivity?m()-x.userActivity:0;if(B>300000&&x.hasFocus){s()}if((x.suspendEnabled&&B>600000)||B>3600000){x.suspend=true}if(!x.userActivityEvents){z.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){A()});b("iframe").each(function(C,D){if(v(D)){b(D.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){A()})}});x.userActivityEvents=true}}function j(){return x.hasFocus}function p(){return x.connectionError}function o(){x.lastTick=0;w()}function i(){x.suspendEnabled=false}function y(E,C){var B,D=x.tempInterval?x.tempInterval:x.mainInterval;if(E){switch(E){case"fast":case 5:B=5000;break;case 15:B=15000;break;case 30:B=30000;break;case 60:B=60000;break;case 120:B=120000;break;case"long-polling":x.mainInterval=0;return 0;default:B=x.originalInterval}if(x.minimalInterval&&B<x.minimalInterval){B=x.minimalInterval}if(5000===B){C=parseInt(C,10)||30;C=C<1||C>30?30:C;x.countdown=C;x.tempInterval=B}else{x.countdown=0;x.tempInterval=0;x.mainInterval=B}if(B!==D){w()}}return x.tempInterval?x.tempInterval/1000:x.mainInterval/1000}function u(C,B,D){if(C){if(D&&this.isQueued(C)){return false}x.queue[C]=B;return true}return false}function t(B){if(B){return x.queue.hasOwnProperty(B)}}function h(B){if(B){delete x.queue[B]}}function l(B){if(B){return this.isQueued(B)?x.queue[B]:d}}f();return{hasFocus:j,connectNow:o,disableSuspend:i,interval:y,hasConnectionError:p,enqueue:u,dequeue:h,isQueued:t,getQueuedItem:l}};a.wp=a.wp||{};a.wp.heartbeat=new c()}(jQuery,window));