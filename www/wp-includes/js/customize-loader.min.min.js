window.wp=window.wp||{};(function(f,h){var e=wp.customize,g;h.extend(h.support,{history:!!(window.history&&history.pushState),hashchange:("onhashchange" in window)&&(document.documentMode===undefined||document.documentMode>7)});g=h.extend({},e.Events,{initialize:function(){this.body=h(document.body);if(!g.settings||!h.support.postMessage||(!h.support.cors&&g.settings.isCrossDomain)){return}this.window=h(window);this.element=h('<div id="customize-container" />').appendTo(this.body);this.bind("open",this.overlay.show);this.bind("close",this.overlay.hide);h("#wpbody").on("click",".load-customize",function(a){a.preventDefault();g.link=h(this);g.open(g.link.attr("href"))});if(h.support.history){this.window.on("popstate",g.popstate)}if(h.support.hashchange){this.window.on("hashchange",g.hashchange);this.window.triggerHandler("hashchange")}},popstate:function(a){var b=a.originalEvent.state;if(b&&b.customize){g.open(b.customize)}else{if(g.active){g.close()}}},hashchange:function(){var a=window.location.toString().split("#")[1];if(a&&0===a.indexOf("wp_customize=on")){g.open(g.settings.url+"?"+a)}if(!a&&!h.support.history){g.close()}},beforeunload:function(){if(!g.saved()){return g.settings.l10n.saveAlert}},open:function(a){if(this.active){return}if(g.settings.browser.mobile){return window.location=a}this.originalDocumentTitle=document.title;this.active=true;this.body.addClass("customize-loading");this.saved=new e.Value(true);this.iframe=h("<iframe />",{src:a,title:g.settings.l10n.mainIframeTitle}).appendTo(this.element);this.iframe.one("load",this.loaded);this.messenger=new e.Messenger({url:a,channel:"loader",targetWindow:this.iframe[0].contentWindow});if(history.replaceState){this.messenger.bind("changeset-uuid",function(c){var b=document.createElement("a");b.href=location.href;b.search=h.param(_.extend(e.utils.parseQueryString(b.search.substr(1)),{changeset_uuid:c}));history.replaceState({customize:b.href},"",b.href)})}this.messenger.bind("ready",function(){g.messenger.send("back")});this.messenger.bind("close",function(){if(h.support.history){history.back()}else{if(h.support.hashchange){window.location.hash=""}else{g.close()}}});h(window).on("beforeunload",this.beforeunload);this.messenger.bind("saved",function(){g.saved(true)});this.messenger.bind("change",function(){g.saved(false)});this.messenger.bind("title",function(b){window.document.title=b});this.pushState(a);this.trigger("open")},pushState:function(a){var b=a.split("?")[1];if(h.support.history&&window.location.href!==a){history.pushState({customize:a},"",a)}else{if(!h.support.history&&h.support.hashchange&&b){window.location.hash="wp_customize=on&"+b}}this.trigger("open")},opened:function(){g.body.addClass("customize-active full-overlay-active").attr("aria-busy","true")},close:function(){if(!this.active){return}if(!this.saved()&&!confirm(g.settings.l10n.saveAlert)){history.forward();return}this.active=false;this.trigger("close");if(this.originalDocumentTitle){document.title=this.originalDocumentTitle}},closed:function(){g.iframe.remove();g.messenger.destroy();g.iframe=null;g.messenger=null;g.saved=null;g.body.removeClass("customize-active full-overlay-active").removeClass("customize-loading");h(window).off("beforeunload",g.beforeunload);if(g.link){g.link.focus()}},loaded:function(){g.body.removeClass("customize-loading").attr("aria-busy","false")},overlay:{show:function(){this.element.fadeIn(200,g.opened)},hide:function(){this.element.fadeOut(200,g.closed)}}});h(function(){g.settings=_wpCustomizeLoaderSettings;g.initialize()});e.Loader=g})(wp,jQuery);